import{y as Yt,e7 as Tn,e as Jt,r as w,dl as Pn,ab as _n,_ as rt,j as e,g as Sn,a as Ln,s as Qe,f as An,i as Sr,h as Nn,b8 as Rn,b9 as St,aq as D,e8 as On,e9 as bn,ea as ue,aQ as Dr,as as K,eb as kt,ec as In,d4 as mt,an as Se,bg as Ge,ar as we,cc as k,az as ge,ed as Nt,aF as de,bL as $e,ee as G,ax as Lt,cd as Rt,ef as tt,c5 as Ke,eg as Me,au as je,eh as Ve,c6 as er,ei as jn,ej as Et,ek as yn,ao as Ze,d3 as Be,el as be,G as T,b4 as ye,cv as ft,cl as ee,a7 as fe,d7 as Dn,d8 as vn,T as Mn,d9 as Vn,da as Bn,C as R,cm as tr,aC as y,em as Ue,dG as Ie,bE as Re,ct as wn,cu as Un,bG as kn,en as Wn,aT as He,eo as ve,cy as qn,cz as rr,bD as Fn,aS as ke,ep as Qn,eq as Wt,aI as bt,bM as vr,dP as Kn,dO as Lr,bO as Hn,F as re,er as zn,es as Gn,cf as $n,et as nr,cg as Zn,ch as Gt,ci as Xn,eu as Yn,cr as Ct,cF as It,cG as jt,cA as or,ev as _e,cB as nt,cC as sr,bP as pt,ae as ot,aw as Jn,ew as eo,c$ as to,d0 as ro,cI as Mr,ex as no,ey as dt,cs as Vr,ez as Br,a$ as oo,eA as so,eB as ao,eC as io,bQ as lo,eD as wr,aE as co,d1 as Ar,d2 as uo,cD as Nr,cE as mo,aD as ut,bR as $t,eE as Pe,am as At,eF as Eo,cN as fo,cM as Fe,cO as Rr,cP as qt,cQ as Or,dU as Ur,cS as Co,X as Tt,dV as po,eG as ho,eH as xo,eI as go,eJ as To,d5 as ar,d6 as ir,dd as Po,de as kr,df as _o,dg as br,aH as So}from"./index-2ba9b923.js";import{m as lr,f as Lo,h as et,i as Ao,j as No,k as Ro,l as Oo,B as Ir,P as Ne,g as st,M as Pt,a as bo,T as Io,b as Wr,I as jo,S as Ft,c as Qt,A as yo,d as Do,e as Ot}from"./index-932bdf39.js";import{u as De,a as vo,s as Mo,b as Vo,c as Bo,d as at,e as wo,F as Uo}from"./hooksOperation-79bbe724.js";import{u as ko}from"./useCallBackState-404d14f4.js";import{B as Zt,P as cr,d as Wo}from"./Numbers-f6b5ce6e.js";import{d as ur}from"./Group-68c9cc62.js";import{L as qo}from"./LockCommandeHOC-4a435868.js";import{u as qr}from"./hooks-0ab2d73a.js";import{u as Fr}from"./searchHookMemory-f6f853e9.js";import{D as Fo}from"./Delete-d2be9bae.js";import{S as Qo}from"./Save-ab52fe30.js";import"./stepperIcon-58214ebb.js";import"./actions-d163bdb2.js";import"./lneContainerFidege-213a2d35.js";const Ko=["initialWidth","width"],qe=["xs","sm","md","lg","xl"],Ho=(r,t,n=!0)=>n?qe.indexOf(r)<=qe.indexOf(t):qe.indexOf(r)<qe.indexOf(t),zo=(r,t,n=!1)=>n?qe.indexOf(t)<=qe.indexOf(r):qe.indexOf(t)<qe.indexOf(r),Go=(r={})=>t=>{const{withTheme:n=!1,noSSR:o=!1,initialWidth:a}=r;function l(c){const u=Yt(),i=c.theme||u,s=Tn({theme:i,name:"MuiWithWidth",props:c}),{initialWidth:d,width:m}=s,f=Jt(s,Ko),[E,x]=w.useState(!1);Pn(()=>{x(!0)},[]);const v=i.breakpoints.keys.slice().reverse().reduce((h,M)=>{const H=_n(i.breakpoints.up(M));return!h&&H?M:h},null),_=rt({width:m||(E||o?v:void 0)||d||a},n?{theme:i}:{},f);return _.width===void 0?null:e.jsx(t,rt({},_))}return l},$o=Go;function Zo(r){const{children:t,only:n,width:o}=r,a=Yt();let l=!0;if(n)if(Array.isArray(n))for(let c=0;c<n.length;c+=1){const u=n[c];if(o===u){l=!1;break}}else n&&o===n&&(l=!1);if(l)for(let c=0;c<a.breakpoints.keys.length;c+=1){const u=a.breakpoints.keys[c],i=r[`${u}Up`],s=r[`${u}Down`];if(i&&Ho(u,o)||s&&zo(u,o)){l=!1;break}}return l?e.jsx(w.Fragment,{children:t}):null}const Xo=$o()(Zo);function Yo(r){return Sn("PrivateHiddenCss",r)}Ln("PrivateHiddenCss",["root","xlDown","xlUp","onlyXl","lgDown","lgUp","onlyLg","mdDown","mdUp","onlyMd","smDown","smUp","onlySm","xsDown","xsUp","onlyXs"]);const Jo=["children","className","only"],es=r=>{const{classes:t,breakpoints:n}=r,o={root:["root",...n.map(({breakpoint:a,dir:l})=>l==="only"?`${l}${Sr(a)}`:`${a}${Sr(l)}`)]};return Nn(o,Yo,t)},ts=Qe("div",{name:"PrivateHiddenCss",slot:"Root"})(({theme:r,ownerState:t})=>{const n={display:"none"};return rt({},t.breakpoints.map(({breakpoint:o,dir:a})=>a==="only"?{[r.breakpoints.only(o)]:n}:a==="up"?{[r.breakpoints.up(o)]:n}:{[r.breakpoints.down(o)]:n}).reduce((o,a)=>(Object.keys(a).forEach(l=>{o[l]=a[l]}),o),{}))});function rs(r){const{children:t,className:n,only:o}=r,a=Jt(r,Jo),l=Yt(),c=[];for(let s=0;s<l.breakpoints.keys.length;s+=1){const d=l.breakpoints.keys[s],m=a[`${d}Up`],f=a[`${d}Down`];m&&c.push({breakpoint:d,dir:"up"}),f&&c.push({breakpoint:d,dir:"down"})}o&&(Array.isArray(o)?o:[o]).forEach(d=>{c.push({breakpoint:d,dir:"only"})});const u=rt({},r,{breakpoints:c}),i=es(u);return e.jsx(ts,{className:An(i.root,n),ownerState:u,children:t})}const ns=["implementation","lgDown","lgUp","mdDown","mdUp","smDown","smUp","xlDown","xlUp","xsDown","xsUp"];function os(r){const{implementation:t="js",lgDown:n=!1,lgUp:o=!1,mdDown:a=!1,mdUp:l=!1,smDown:c=!1,smUp:u=!1,xlDown:i=!1,xlUp:s=!1,xsDown:d=!1,xsUp:m=!1}=r,f=Jt(r,ns);return t==="js"?e.jsx(Xo,rt({lgDown:n,lgUp:o,mdDown:a,mdUp:l,smDown:c,smUp:u,xlDown:i,xlUp:s,xsDown:d,xsUp:m},f)):e.jsx(rs,rt({lgDown:n,lgUp:o,mdDown:a,mdUp:l,smDown:c,smUp:u,xlDown:i,xlUp:s,xsDown:d,xsUp:m},f))}function ss(r,t,n,o){const a=Rn(),l=St(c=>{var u;return((u=D.find(c.PREPARATIONS.preparations,i=>i.sessionId===r&&i.codeBorne===t))==null?void 0:u.uid)||null});return w.useEffect(()=>{l===null&&a(On.PREPARATION_NEW(bn(r,t,n||ue.HOME,o)))},[l]),{operationId:l}}function as(r,t){var a,l,c,u,i,s,d,m;const n=((a=r.Article)==null?void 0:a.ART_PIECE_COL)||null,o=((l=r.Article)==null?void 0:l.ART_PDS_NET)||null;return{indice:Dr.uniqueId(),transacSeq:t.TRA_SEQ,transacLot:t.TRA_LOT,codeDepot:t.TRA_CODE_DEPOT,codeFournisseur:t.TRA_FOURNI,codeArticle:(c=r.Article)==null?void 0:c.ART_CODE,libelleArticle:(u=r.Article)==null?void 0:u.ART_LIB1,stat1Article:(i=r.Article)==null?void 0:i.ART_STAT1,stockArticle:(s=r.Article)==null?void 0:s.ART_STOCK,pickingCode:t.TRA_PICKING||((d=r.Article)==null?void 0:d.ART_PICKING),unitSaleArticle:r.Article.ART_UNIT_VEN,variableWeightArticle:!1,nbPackage:t.TRA_COLIS_LIV,nbPiece:t.TRA_QUANTITE_LIV,netWeight:t.TRA_PDS_NET_LIV,nbPackageInitial:t.TRA_COLIS_LIV,nbColisInitial:t.TRA_QUANTITE_LIV,netWeightInitial:t.TRA_PDS_NET_LIV,unitOrder:r.VEN_UNIT_CDE,unitSale:r.VEN_UNIT_VE||"",preparateur:((m=r.Preparateur)==null?void 0:m.PREP_CODE)||null,avgPieceByPackage:n,avgWeightByPackage:o,lotId:t.LOT_ID||null,valor:t.TRA_VALOR}}function is(r){var o,a,l,c,u,i,s,d;const t=((o=r.Article)==null?void 0:o.ART_PIECE_COL)||null,n=((a=r.Article)==null?void 0:a.ART_PDS_NET)||null;return{indice:Dr.uniqueId(),transacSeq:0,transacLot:null,codeDepot:r.Transactions[0].TRA_CODE_DEPOT||"",codeFournisseur:r.Transactions[0].TRA_FOURNI||"",codeArticle:(l=r.Article)==null?void 0:l.ART_CODE,libelleArticle:(c=r.Article)==null?void 0:c.ART_LIB1,stat1Article:(u=r.Article)==null?void 0:u.ART_STAT1,stockArticle:(i=r.Article)==null?void 0:i.ART_STOCK,pickingCode:(s=r.Article)==null?void 0:s.ART_PICKING,unitSaleArticle:r.Article.ART_UNIT_VEN,variableWeightArticle:!1,nbPackage:0,nbPiece:0,netWeight:0,nbPackageInitial:0,nbColisInitial:0,netWeightInitial:0,unitOrder:r.VEN_UNIT_CDE,unitSale:r.VEN_UNIT_VE||"",preparateur:((d=r.Preparateur)==null?void 0:d.PREP_CODE)||null,avgPieceByPackage:t,avgWeightByPackage:n,lotId:null,valor:"N"}}function ls(r,t,n){const o=r.VEN_UNIT_CDE==="C"?"TRA_COLIS_CDE":r.VEN_UNIT_CDE==="P"?"TRA_QUANTITE_CDE":"TRA_PDS_NET_CDE",a=r.VEN_UNIT_CDE==="C"?"TRA_COLIS_LIV":r.VEN_UNIT_CDE==="P"?"TRA_QUANTITE_LIV":"TRA_PDS_NET_LIV";return{venNumSeq:r.VEN_NUMSEQ,venLotSeq:r.VEN_LOT_SEQ,numOrder:r.VEN_CDE,dateOrder:r.VEN_DATE_CDE,totalToPrepare:r.Transactions.reduce((l,c)=>l+c[o],0),mode:t,commentPrepa1:r.VEN_COM_PREPA,commentPrepa2:r.VEN_COM_PREPA2,commentBL1:r.VEN_COM_BL,commentBL2:r.VEN_COM_BL2,comment:r.VEN_COMMENT,unitOrder:r.VEN_UNIT_CDE,unitSale:r.VEN_UNIT_VE,article:r.Article,client:r.Client,transactions:r.Transactions?D.map(r.Transactions,l=>as(r,l)):[],newTransaction:is(r),totalPrepared:r.Transactions.reduce((l,c)=>l+c[a],0),modalFor:n&&(r.VEN_COM_BL||r.VEN_COM_PREPA||r.VEN_COMMENT)?"COMMENTS":"",modalIndice:null,modalCb:null,autoCommit:null}}function Xt(r,t,n,o,a,l){return K().PrepaMethods().LotsByArticle({variables:{recherche:{rbp:1},context:r,demande:{numSeq:t,codeArticle:n,codeDepot:o,lot:a,uc:l}}})}function cs(r,t){r.codeArticle=t.ART_CODE,r.libelleArticle=t.ART_LIB1,r.stat1Article=t.ART_STAT1,r.transacLot=null,r.avgPieceByPackage=(t==null?void 0:t.ART_PIECE_COL)??null,r.avgWeightByPackage=(t==null?void 0:t.ART_PDS_NET)??null,r.nbPackage=0,r.nbPiece=0,r.netWeight=0,r.lotId=null}function jr(r,t,n,o,a){if(!D.includes(["nbPackage","nbPiece","netWeight"],o)||(n[o]=typeof a=="string"?parseFloat(a):a,!r.isRecalculActivated))return;const l=r.ruleRecalcul||"C";switch(o){case"nbPackage":case"colis":{(l==="C"||l==="U"&&n.unitOrder==="C"||!n.variableWeightArticle)&&(n.avgWeightByPackage&&(n.netWeight=c(n.nbPackage*n.avgWeightByPackage,"N")),n.avgPieceByPackage&&(console.log("line60"),n.nbPiece=c(n.nbPackage*n.avgPieceByPackage,"P")));break}case"netWeight":case"poids":{(n.nbPackage<=0&&n.nbPiece<=0||l==="U"&&n.unitOrder==="N"||!n.variableWeightArticle)&&(n.avgWeightByPackage&&n.netWeight&&(n.nbPackage=c(n.netWeight/n.avgWeightByPackage,"C")),n.avgPieceByPackage&&(n.nbPiece=c(n.nbPackage*n.avgPieceByPackage,"P")));break}case"nbPiece":case"piece":{n.nbPackage<=0&&n.netWeight<=0||l==="U"&&n.unitOrder,n.avgPieceByPackage&&(n.nbPackage=c(n.nbPiece/n.avgPieceByPackage,"C")),n.avgWeightByPackage&&(n.netWeight=c(n.nbPackage*n.avgWeightByPackage,"N"));break}}function c(u,i){switch(i){case"C":return kt(u,t.formatColis);case"N":return kt(u,t.formatPoids);case"P":return kt(u,t.formatPieces)}}}function yr(r,t,n){return n&&n!==t.lotId?"ERROR_LOT_DIFF_TV":t.dlc&&In(t.dlc)<new Date?"ERROR_LOT_DLC_EXPIRED":r.articleCode!==t.articleCode?"ERROR_LOT_ARTICLE":!0}async function us(r,t){return t&&t.nombreExemplaire?K().CommunMethods().editionEtiquetteBartender(r,t):Promise.resolve(null)}const it=r=>{var d,m;const t=mt(),{operation:n,actions:o}=De(r),a=Se(),l=Ge(),c=we({mutationFn:f=>(o.onLockOperation(!0),us(a.current,f)),onSettled(f,E,x,P){o.onLockOperation(!1),E&&l.errorMessage(k("errorMessage"))}}),u=(f,E)=>{c.mutate(f,{onSettled(x,P,v,_){P&&E({Result:"ERR_NETWORK",Error:!0,MessageError:""})},onSuccess(x,P,v){var _,h;x&&(x!=null&&x.err||((_=x==null?void 0:x.res)==null?void 0:_.Result)!=="OK")&&l.errorMessage(k(((h=x==null?void 0:x.res)==null?void 0:h.MessageError)||"errorMessage")),E((x==null?void 0:x.res)||null)}})};(d=t.getParametreBorne("V2_COLISPALETTE_SSCC"))!=null&&d.USER_ZONE1;const i=parseInt(t.getParametreBorneValue("V2_ETIQ_COLIS_PLUS")||"0"),s=(m=t.getParametreBorne("V2_ETIQ_PALETTE"))==null?void 0:m.USER_ZONE1;return{defaultImprimanteColis:t.getParametreBorneValue("IMP_THERM_CHOIX"),defaultImprimantePalette:t.getParametreBorneValue("IMP_THERM_PAL_CHOIX"),defaultImprimanteBl:t.getParametreBorneValue("IMP_LASER"),affichageImprimanteColis:t.getParametreBorneZone1("V2_ETIQ_COLIS"),affichageImprimantePalette:s!="N",affichageImprimanteBl:t.getParametreBorneZone1("V2_EDITION_BL"),editionPalette:s,nbExemplairePalette:parseInt(t.getParametreBorneValue("V2_NB_ETIQ_PALETTE")||"0"),nbExemplaireColis:parseInt(t.getParametreBorneValue("V2_NB_ETIQ_COLIS")||"0")+i,imprimanteColis:(n==null?void 0:n.imprimanteColis)||null,imprimantePalette:(n==null?void 0:n.imprimantePalette)||null,imprimanteBl:(n==null?void 0:n.imprimanteBl)||null,onSetImprimante:o.onSetImprimante,onPrintEtiquetteColisPaletteSscc:u,isPrinting:c.isLoading}},yt="keyRemoteInfoDetailPreparation",ds="keyRemoteDernierePaletteSscc",ms="keyRemoteDerniereColisSscc",Es=r=>{const t=vo(r),n=St(l=>Mo(r,l)),o=St(l=>Vo(r,l)),a=St(l=>Bo(r,l));return{venLotSeq:o,venNumSeq:n,previousStep:a,onLeaveLine:t.leaveLinePreparation,onChangeStep:t.onChangeStep}},fs=(r,t,n={suspense:!1,useErrorBoundary:!1,cacheTime:-1})=>Ke(["usePreparationByNumRemote",r.getQueryKey(),t],()=>K().PrepaMethods().ListeCommandeClient({variables:{recherche:{rbp:1,qbRules:ge("VEN_NUMSEQ",t,"=")},context:null}}),n),Qr={queryOptions:{enabled:!0}},Kr={queryOptions:{enabled:!1}},Dt=(r,t="commande")=>{if(t==="commande"){let n=r.match(/(\.CC)([0-9]*)/);if(n&&n[2])return{fast:!0,qbRules:ge("VEN_NUMSEQ",n[2],"=")};if(n=r.match(/(\.CL)([0-9A-Z]*)/),n&&n[2])return{fast:!1,qbRules:ge("VEN_CLIENT",n[2],"=")};if(n=r.match(/(\]C0)([0-9A-Z]*)/),n&&n[2])return{fast:!0,qbRules:ge("VEN_CDE",n[2],"=")}}if(t==="detail"){let n=r.match(/(\.AA)(\w*)/);return n&&n[2]?{fast:!1,qbRules:ge("article.ART_CODE",n[2],"=")}:(n=r.match(/(\]C101)([0-9]{14})/),n&&n[2]?{fast:!1,qbRules:ge("gencod.ART_EAN_CARTON",n[2],"=")}:(n=r.match(/(\]E0)([0-9]{13})/),n&&n[2]?{fast:!1,qbRules:ge("gencod.ART_EAN",n[2],"=")}:Dt(r,"commande")))}return{fast:!1,qbRules:null}},Cs=r=>{if(r&&!r.error){const t=r.result.codeArticle?ge("article.ART_CODE",r.result.codeArticle,"="):null,n=r.result.lotSeq?ge("gcvente_det.VEN_LOT_SEQ",r.result.lotSeq,"="):null;return{fast:!1,qbRules:Nt(t,n)}}return{fast:!1,qbRules:null}},Hr=(r,t,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>Ke([yt,r.getQueryKey(),t],()=>er(K().PrepaMethods().InfosLigneVente({variables:{lotSeq:t}})),n);function zr(r){const t=new Date;return Lt("VEN_DATE_ENL",`${r?Rt(t):""},${Rt(t)}`,"between")}const ps=r=>{const{t}=de(),{getParametreBorneZone1:n,operation:o,actions:a}=De(r),l=w.useMemo(()=>[zr(n("V2_CDE_JOUR"))],[n]),c=w.useCallback(i=>{const{val:s}=i,d=lr(s.value);async function m(){if(D.has(s,"value")&&(d!=tt.None||D.startsWith(s.value,"."))){const f=String(s.value);i.clearCb&&i.clearCb();let{qbRules:E,fast:x}=Dt(f,"commande");E?x?await K().PrepaMethods().ListeCommandeClient({variables:{recherche:{qbRules:E,rbp:1,page:1},context:null}}).then(P=>{if(P&&P.res&&D.size(P.res.result)>0)return a.selectPreparation(D.head(P.res.result)),!0;a.messages.errorMessage(t("orderNotFound"))}):i.updateQuickRules&&i.updateQuickRules(E):a.messages.errorMessage(t("invalidBarcode"))}else i.updateQuery(i.val);return!1}return m()},[]);return{dataPreparations:$e({key:"PreparationsClient",fxt:(i,s)=>K().PrepaMethods().ListeCommandeClient({variables:{recherche:i,context:(s==null?void 0:s.current)||null}}),options:o&&o.step===G.LISTPREPARATIONS?Qr:Kr,query:null,selectorConfig:{initialValues:l},onSetQuickFilterValueParam:c})}},hs=r=>{const{t}=de(),{getParametreBorneZone1:n,operation:o,actions:a}=De(r),l=w.useMemo(()=>[zr(n("V2_CDE_JOUR"))],[n]),c=w.useCallback(i=>{const{val:s}=i,d=lr(s.value);async function m(){if(D.has(s,"value")&&(d!=tt.None||D.startsWith(s.value,"."))){const f=String(s.value);i.clearCb&&i.clearCb();let{qbRules:E,fast:x}=Dt(f,"detail");if(!E)a.messages.errorMessage(t("invalidBarcode"));else return i.updateQuickRules&&i.updateQuickRules(E),!0}else i.updateQuery(s);return!1}return m()},[]);return{dataPreparations:$e({key:"PreparationGroupByArticle",fxt:(i,s)=>K().PrepaMethods().ListeCommandeArticle({variables:{recherche:i,context:(s==null?void 0:s.current)||null}}),options:o&&o.step===G.ARTICLES?Qr:Kr,query:null,selectorConfig:{initialValues:l},onSetQuickFilterValueParam:c})}},xs=(r,t,n,o,a={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>{const l=n!=null&&n!=0?ge("GCVENTE_DET.VEN_LOT_SEQ",n,"="):null,c=o?ge("GCVENTE_TRANS.TRA_VALOR","N","="):null,u=o?ge("GCVENTE_DET.VEN_ETAT_PREP","","null"):null,i=Nt(l,c,u);return Ke([Me,r.getQueryKey(),t],()=>K().PrepaMethods().LignesMonoCommande({variables:{numSeq:t,recherche:{rbp:1,qbRules:i},context:null}}),a)},lt=r=>{const{actions:t,operation:n}=De(r),o=Ge(),a=Se(),l=je(),{defaultImprimanteColis:c,defaultImprimantePalette:u,defaultImprimanteBl:i,imprimanteColis:s,imprimantePalette:d,imprimanteBl:m,affichageImprimanteBl:f,affichageImprimantePalette:E,affichageImprimanteColis:x}=it(r),{handleErrorScan:P,handleScanLecturePreparation:v,handleScanLecturePreparationEan128:_}=dr(),h=w.useRef(null),M={imprimanteColis:s||c,imprimanteBL:m||i,imprimantePalette:d||u,imprimeColis:x,imprimeBL:f,imprimePalette:E},H=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().FinPreparationCommande((a==null?void 0:a.current)||null,g,n.date||null,M,null,null,[])),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),N=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().FinPreparationCommande((a==null?void 0:a.current)||null,g.numSeq,g.dateEnlevement,M,g.dateCommande,g.dateLivraison,g.listManquants)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),F=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().PrepaPeseeSupplementaire((a==null?void 0:a.current)||null,g,M)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),X=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().TerminateLine((a==null?void 0:a.current)||null,g.dateEnl||null,g.lotSeq,M)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),L=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().SupprimePeseePreparation((a==null?void 0:a.current)||null,g)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),O=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().EnregistreTransactionPreparation((a==null?void 0:a.current)||null,g,M)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}}),Q=we({mutationFn:g=>(t.onLockOperation(!0),K().PrepaMethods().SupprimeTransactionPreparation((a==null?void 0:a.current)||null,g)),onSettled(g,j,A,W){t.onLockOperation(!1),j&&o.errorMessage(k("errorMessage"))}});async function me(g){if(console.log("onScanLotCodeBarre",g),g){if(g.infoSpecific&&g.infoLot&&!D.isEmpty(g.infoLot.liste)){t.scanLotSucceeded(g);return}if(g.infoSpecific&&g.infoSpecific.str_code_article){t.scanLotSucceeded(g);return}}try{h&&h.current&&h.current.focusCodeBarre()}catch{}}async function ie(g){var j,A,W,Y,q;if(console.log("detail onScanLotCodeBarreEan128",g),g&&!((j=g.infoSpecific)!=null&&j.error)){if((A=g.infoSpecific)!=null&&A.result){t.scanLotSucceededEan128(g);return}}else switch((W=g==null?void 0:g.infoSpecific)==null?void 0:W.codeError){case"ERR_MULTI_MVT":{t.updatePreparation({modalFor:"LOT",numSeqModal:g==null?void 0:g.numSeq,numLotSeqModal:g==null?void 0:g.numLotSeq,CbModal:g==null?void 0:g.infoSpecific});break}case"ERR_DLC_MINI_NONBLOQUANT":{await l.showConfirmation({title:"confirmTitle",message:k((Y=g==null?void 0:g.infoSpecific)==null?void 0:Y.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&t.scanLotSucceededEan128(g);break}default:t.messages.errorMessage(k(((q=g==null?void 0:g.infoSpecific)==null?void 0:q.codeError)||"invalidBarcode"))}try{h&&h.current&&h.current.focusCodeBarre()}catch{}}return{onFinPreparationCommandeReliquat:(g,j)=>{N.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:null})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},onFinPreparationCommande:(g,j)=>{H.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:null})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},onPreparationPeseeSup:(g,j)=>{F.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:{result:0,colisSscc:0,paletteSscc:0}})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},onTerminateLine:(g,j)=>{X.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:0})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},retourTerminateLine:(g,j,A,W,Y)=>{g===ue.PREPACLIENT?j===1||j===3?W.invalidateQueries({queryKey:[Me,A]}).then(()=>{t.onChangeStep(G.DETAILS)}):j===2&&W.invalidateQueries({queryKey:["PreparationsClient"]}).then(()=>{t.onChangeStep(G.LISTPREPARATIONS)}):W.invalidateQueries({queryKey:[Ve,Y]}).then(()=>{t.onChangeStep(G.DETAILS)})},onSupprimePesee:(g,j)=>{L.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:0})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},onPreparationEnregistreTransaction:(g,j)=>{O.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:{traSeq:0,result:0}})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},onPreparationSupprimeTransaction:(g,j)=>{Q.mutate(g,{onSettled(A,W,Y,q){W&&j({codeResult:"ERR_NETWORK",result:0})},onSuccess(A,W,Y){var q,U;(A.err||((q=A.res)==null?void 0:q.codeResult)!=="OK")&&o.errorMessage(k(((U=A.res)==null?void 0:U.codeResult)||"errorMessage")),j(A.res)}})},handleErrorScan:P,handleScanLecturePreparation:v,handleScanLecturePreparationEan128:_,onScanLotCodeBarre:me,onScanLotCodeBarreEan128:ie}},gs=(r,t)=>{const{t:n}=de(),o=Ge(),{actions:a}=De(r),l=we({mutationFn:u=>(a.onLockOperation(!0),K().PrepaMethods().CancelPreparation((t==null?void 0:t.current)||null,u)),onSettled:(u,i)=>{a.onLockOperation(!1),i&&o.errorMessage(n("errorMessage"))}});return{onCancelLine:(u,i)=>{l.mutate(u,{onSettled(s,d,m,f){d&&i({codeResult:"ERR_NETWORK",result:{result:0,colisSscc:0,paletteSscc:0}})},onSuccess(s,d,m){var f,E;(s.err||((f=s.res)==null?void 0:f.codeResult)!=="OK")&&o.errorMessage(n(((E=s.res)==null?void 0:E.codeResult)||"errorMessage")),i(s.res)}})}}},Gr=r=>{var u,i;const{actions:t,operation:n,getParametreBorne:o,getParametreBorneZone1:a,getApplicationOption:l}=De(r),c=jn((i=(u=n==null?void 0:n.preparation)==null?void 0:u.currentLine)==null?void 0:i.quantity,n==null?void 0:n.emballage,n==null?void 0:n.palette);return{actions:t,operation:n,quantity:c,getApplicationOption:l,getParametreBorneZone1:a,getParametreBorne:o}};function Ts(r){return{colisCde:D.sumByNumber(r.Transactions,t=>t.TRA_COLIS_CDE)||0,quantiteCde:D.sumByNumber(r.Transactions,t=>t.TRA_QUANTITE_CDE)||0,poidsNetCde:D.sumByNumber(r.Transactions,t=>t.TRA_PDS_NET_CDE)||0,poidsBrutCde:D.every(r.Transactions,t=>D.isNil(t.TRA_PDS_BRUT_CDE))?null:D.sumByNumber(r.Transactions,t=>t.TRA_PDS_BRUT_CDE||t.TRA_PDS_NET_CDE||0)||0,colisLiv:D.sumByNumber(r.Transactions,t=>t.TRA_COLIS_LIV)||0,quantiteLiv:D.sumByNumber(r.Transactions,t=>t.TRA_QUANTITE_LIV)||0,poidsNetLiv:D.sumByNumber(r.Transactions,t=>t.TRA_PDS_NET_LIV)||0,poidsBrutLiv:D.every(r.Transactions,t=>D.isNil(t.TRA_PDS_BRUT_LIV))?null:D.sumByNumber(r.Transactions,t=>t.TRA_PDS_BRUT_LIV||t.TRA_PDS_NET_LIV||0)||0}}function dr(){const r=je(),t=a=>r.showError({i8nmessage:a,i8ntitle:k("error"),dialogProps:{maxWidth:"md",fullWidth:!0}});async function n(a,l){try{const c=K().CommunMethods().rechercheInfoCodeBarre({variables:{context:null,codeBarre:a}}),u=K().CommunMethods().scanEan128VenteCarreau({codeBarre:a,depot:l}),i=await Promise.all([c,u]);return{err:null,res:{infoSpecific:i[0].res,infoLot:i[1].res}}}catch(c){return{err:c,res:null}}}async function o(a,l,c,u,i,s){try{const d=K().PrepaMethods().PreparationScanEan128(a,l,c,s);return{err:null,res:{infoSpecific:(await Promise.resolve(d)).res,numSeq:l,numLotSeq:c,article:u,uc:i}}}catch(d){return{err:d,res:{infoSpecific:null,numSeq:l,numLotSeq:c,article:u,uc:i}}}}return{handleErrorScan:t,handleScanLecturePreparation:n,handleScanLecturePreparationEan128:o}}function Ps(r,t,n,o,a,l){const c=w.useRef(null),u=Et(),i=Hr(r,n),[s,d]=ko(null),[m,f]=w.useState(null),E=yn(r),x=je(),{handleScanLecturePreparation:P,handleScanLecturePreparationEan128:v,handleErrorScan:_}=dr(),h=Ze(),{onPreparationEnregistreTransaction:M,onPreparationSupprimeTransaction:H}=lt(t),{actions:N,getParametreBorneZone1:F,operation:X}=Gr(t),L=F("V2_AUTO_COMMIT")||!1;it(t);function O(C,p){return!C||!p||C.precision===null?p:D.round(p,C.precision)}const Q=C=>x.showError({i8nmessage:C,i8ntitle:k("error"),dialogProps:{maxWidth:"md",fullWidth:!0}});function me(){d(be(C=>{C.modalFor=null}))}function ie(){var C;o===ue.PREPACLIENT?h.invalidateQueries({queryKey:[Me,s.venNumSeq]}).then(()=>{N.onChangeStep(G.DETAILS)}):h.invalidateQueries({queryKey:[Ve,(C=s==null?void 0:s.article)==null?void 0:C.ART_CODE]}).then(()=>{N.onChangeStep(G.DETAILS)})}function ne(){var p;const C={VEN_NUMSEQ:s.venNumSeq,VEN_DATE_ENL:X.date?Be(X.date):null,VEN_CLIENT:(s==null?void 0:s.client.CLI_CODE)||"",VEN_COM_PREPA:(s==null?void 0:s.commentPrepa1)||"",VEN_COM_PREPA2:(s==null?void 0:s.commentPrepa2)||"",VEN_COM_BL:(s==null?void 0:s.commentBL1)||"",VEN_COM_BL2:(s==null?void 0:s.commentBL2)||"",Depot:(s==null?void 0:s.newTransaction.codeDepot)||"",Details:[{VEN_LOT_SEQ:s.venLotSeq,VEN_ART_CODE:((p=s==null?void 0:s.article)==null?void 0:p.ART_CODE)||"",VEN_UNIT_VE:(s==null?void 0:s.unitSale)||"",Transactions:[{TRA_LOT_SEQ:s.venLotSeq,TRA_LOT:(s==null?void 0:s.newTransaction.transacLot)||0,TRA_COLIS_LIV:(s==null?void 0:s.newTransaction.nbPackage)||0,TRA_QUANTITE_LIV:(s==null?void 0:s.newTransaction.nbPiece)||0,TRA_PDS_NET_LIV:(s==null?void 0:s.newTransaction.netWeight)||0,TRA_CODART_AFF:s==null?void 0:s.newTransaction.codeArticle}]}]};M(C,S=>{var b;(S==null?void 0:S.codeResult)==="OK"&&((S==null?void 0:S.result.result)===0?h.invalidateQueries({queryKey:["keyRemoteInfoDetailPreparation"]}).then(()=>{ae()}):o===ue.PREPACLIENT?(S==null?void 0:S.result.result)===1||(S==null?void 0:S.result.result)===3?h.invalidateQueries({queryKey:[Me,s.venNumSeq]}).then(()=>{N.onChangeStep(G.DETAILS)}):(S==null?void 0:S.result.result)===2&&h.invalidateQueries({queryKey:["PreparationsClient"]}).then(()=>{N.onChangeStep(G.LISTPREPARATIONS)}):h.invalidateQueries({queryKey:[Ve,(b=s==null?void 0:s.article)==null?void 0:b.ART_CODE]}).then(()=>{N.onChangeStep(G.DETAILS)}))})}function ae(){d(C=>be(C,p=>{cs(p.newTransaction,p.article)}))}function $(C){d(p=>be(p,S=>{S.modalIndice===-1?(S.newTransaction.lotId=C.LOTID,S.newTransaction.transacLot=C.LOT,S.newTransaction.codeArticle=C.Article.ART_CODE,S.modalCb?q(S,S.modalCb,S.newTransaction.indice,null):S.autoCommit=null):(S.transactions[S.modalIndice].lotId=C.LOTID,S.transactions[S.modalIndice].transacLot=C.LOT,S.transactions[S.modalIndice].codeArticle=C.Article.ART_CODE),S.modalFor=null,S.modalIndice=null}),A)}function pe(C){d(p=>be(p,S=>{S.newTransaction.lotId=C.infoLot.liste[0].LOT_ID,C.infoLot.liste[0].ACH_QUANTITE&&(S.newTransaction.nbPiece=C.infoLot.liste[0].ACH_QUANTITE),C.infoLot.liste[0].ACH_COLIS&&(S.newTransaction.nbPackage=C.infoLot.liste[0].ACH_COLIS),C.infoLot.liste[0].ACH_PDS_NET&&(S.newTransaction.netWeight=C.infoLot.liste[0].ACH_PDS_NET)}))}async function he(C){var p;if(C){D.isNil(C.infoLot)&&Q("ERROR_LOT"),D.isNil(C.infoSpecific)&&Q("ERROR_CODE"),D.isEmpty(C.infoLot.liste)&&Q("ERROR_NO_LOT");const S=yr({articleCode:s.article.ART_CODE,articleStat1:((p=s.article)==null?void 0:p.ART_STAT1)||null,tourCode:null,unitOrder:s.unitOrder},{lotId:C.infoLot.liste[0].LOT_ID,dlc:C.infoSpecific.str_dlc,articleCode:C.infoSpecific.str_code_article});typeof S=="boolean"&&S?pe(C):Q(S)}}function Le(C,p){let S=null,b=null,V=null;const z=C.unitOrder;C.unitSale;const le=p!=null&&p.result.poidsNetLot&&(p!=null&&p.result.colisLot)?D.round((p==null?void 0:p.result.poidsNetLot)/(p==null?void 0:p.result.colisLot),3):null,se=p!=null&&p.result.pieceLot&&(p!=null&&p.result.colisLot)?D.round((p==null?void 0:p.result.pieceLot)/(p==null?void 0:p.result.colisLot),0):null;let J=0;if(p==null?void 0:p.result.lot){switch(p&&D.includes(["C","P"],z)===!1&&p.result.poidsNet&&p.result.poidsNet>0&&(J=p.result.poidsNet),z==="P"&&p.result.piece&&p.result.piece>0&&(J=p.result.piece),z){case"C":{S=J,b=D.round(S*(se??0),0),V=D.round(S*(le??0),4);break}case"P":{b=J;const Ae=se?D.sumByNumber([J/se]):J;V=D.round(Ae*(le??0),4),S=D.round(Ae,2);break}default:{V=J;const Ae=le?D.sumByNumber([J/le]):J;b=D.round(Ae*(se??0),0),S=D.round(Ae,2)}}p&&p.result.poidsNet&&p.result.poidsNet>0&&(V=p.result.poidsNet),p&&p.result.piece&&p.result.piece>0&&(b=p.result.piece)}return{num_colis:S,num_poids:V,num_pieces:b}}function Te(C,p){C&&C.result.lot&&d(S=>be(S,b=>{q(b,C,p,null)}),A)}async function Oe(C){var p,S,b,V,z;if(console.log("transaction onScanLotCodeBarreEan128",C),C&&!((p=C.infoSpecific)!=null&&p.error)){if((S=C.infoSpecific)!=null&&S.result){Te(C.infoSpecific,null);return}}else switch((b=C==null?void 0:C.infoSpecific)==null?void 0:b.codeError){case"ERR_MULTI_MVT":{W("-1",C==null?void 0:C.infoSpecific);break}case"ERR_DLC_MINI_NONBLOQUANT":{await x.showConfirmation({title:"confirmTitle",message:k((V=C==null?void 0:C.infoSpecific)==null?void 0:V.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&Te(C.infoSpecific,null);break}default:N.messages.errorMessage(k(((z=C==null?void 0:C.infoSpecific)==null?void 0:z.codeError)||"invalidBarcode"))}}function g(C,p,S){var b;if(p==="lotId"){const V=S;V&&Xt(r.current,s.venNumSeq,((b=s.article)==null?void 0:b.ART_CODE)||"",s.newTransaction.codeDepot||"",S,s.unitOrder).then(z=>{var le,se;if((((le=z.res)==null?void 0:le.itemsCount)||0)>1)d(J=>be(J,xe=>{xe.newTransaction.lotId=S})),W(s.newTransaction.indice);else{const J=(se=z.res)==null?void 0:se.result[0];J?K().PrepaMethods().PreparationControleMouvement(r.current||null,s.venNumSeq,s.venLotSeq,J.LOT,"").then(async xe=>{var ze,Ae,xt,ct;xe&&!xe.err&&!((ze=xe.res)!=null&&ze.error)?d(oe=>be(oe,We=>{We.newTransaction.lotId=S,We.newTransaction.transacLot=J.LOT,We.newTransaction.codeArticle=J==null?void 0:J.Article.ART_CODE,We.autoCommit=null})):((Ae=xe.res)==null?void 0:Ae.codeError)==="ERR_DLC_MINI_NONBLOQUANT"?await x.showConfirmation({title:"confirmTitle",message:k((xt=xe.res)==null?void 0:xt.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&d(We=>be(We,Xe=>{Xe.newTransaction.lotId=S,Xe.newTransaction.transacLot=J.LOT,Xe.newTransaction.codeArticle=J==null?void 0:J.Article.ART_CODE,Xe.autoCommit=null})):N.messages.errorMessage(k(((ct=xe.res)==null?void 0:ct.codeError)||"invalidBarcode"))}):N.messages.errorMessage(k("lot").concat(" ",V," ",k("inconnu")))}});return}d(V=>be(V,z=>{jr({isRecalculActivated:E.isRecalculActivated,ruleRecalcul:E.ruleRecalcul},u,z.newTransaction,p,S),z.autoCommit=null}))}function j(C,p,S){var V;const b=s.transactions.findIndex(z=>z.indice===C);if(p==="lotId"&&b>=0){S&&Xt(r.current,s.venNumSeq,((V=s.article)==null?void 0:V.ART_CODE)||"",s.transactions[b].codeDepot||"",S,s.unitOrder).then(le=>{var J;const se=(J=le.res)==null?void 0:J.result[0];if(D.isNil(se))Q("Lot non trouvé.");else{const xe=yr({articleCode:s.article.ART_CODE,articleStat1:s.article.ART_STAT1,tourCode:null,unitOrder:s.unitOrder},{lotId:se.LOTID,dlc:se.ACH_DLC,articleCode:se.Article.ART_CODE});typeof xe=="boolean"&&xe?d(ze=>be(ze,Ae=>{Ae.transactions[b].lotId=S,Ae.autoCommit=C}),A):Q(xe)}});return}d(z=>be(z,le=>{jr({isRecalculActivated:E.isRecalculActivated,ruleRecalcul:E.ruleRecalcul},u,le.transactions[b],p,S),le.autoCommit=C}),A)}function A(C){var b;if(!C||!(C!=null&&C.autoCommit))return;const p=D.find(C.transactions,V=>V.indice===C.autoCommit),S={VEN_NUMSEQ:C.venNumSeq,VEN_DATE_ENL:X.date?Be(X.date):null,VEN_CLIENT:C.client.CLI_CODE||"",VEN_COM_PREPA:C.commentPrepa1||"",VEN_COM_PREPA2:C.commentPrepa2||"",VEN_COM_BL:C.commentBL1||"",VEN_COM_BL2:C.commentBL2||"",Depot:p?p.codeDepot||"":C.newTransaction.codeDepot||"",Details:[{VEN_LOT_SEQ:C.venLotSeq,VEN_ART_CODE:((b=C.article)==null?void 0:b.ART_CODE)||"",VEN_UNIT_VE:C.unitSale||"",Transactions:[{TRA_SEQ:p?p.transacSeq:C.newTransaction.transacSeq,TRA_LOT_SEQ:s.venLotSeq,TRA_LOT:p?p.transacLot:C.newTransaction.transacLot,TRA_COLIS_LIV:p?p.nbPackage||0:C.newTransaction.nbPackage||0,TRA_QUANTITE_LIV:p?p.nbPiece||0:C.newTransaction.nbPiece||0,TRA_PDS_NET_LIV:p?p.netWeight||0:C.newTransaction.netWeight||0,TRA_CODART_AFF:p?p.codeArticle:C.newTransaction.codeArticle}]}]};M(S,V=>{var z;(V==null?void 0:V.codeResult)==="OK"&&((V==null?void 0:V.result.result)===0?h.invalidateQueries({queryKey:["keyRemoteInfoDetailPreparation"]}).then(()=>{ae()}):o===ue.PREPACLIENT?(V==null?void 0:V.result.result)===1||(V==null?void 0:V.result.result)===3?h.invalidateQueries({queryKey:[Me,s.venNumSeq]}).then(()=>{N.onChangeStep(G.DETAILS)}):(V==null?void 0:V.result.result)===2&&h.invalidateQueries({queryKey:["PreparationsClient"]}).then(()=>{N.onChangeStep(G.LISTPREPARATIONS)}):h.invalidateQueries({queryKey:[Ve,(z=s==null?void 0:s.article)==null?void 0:z.ART_CODE]}).then(()=>{N.onChangeStep(G.DETAILS)}))})}function W(C,p){d(S=>be(S,b=>{b.modalFor="LIST_LOT",b.modalIndice=b.transactions.findIndex(V=>V.indice===C),b.autoCommit=C,b.modalCb=p||null}))}function Y(C){H(C,p=>{(p==null?void 0:p.codeResult)==="OK"&&h.invalidateQueries({queryKey:["keyRemoteInfoDetailPreparation"]})})}function q(C,p,S,b){const V=C.transactions.findIndex(se=>se.indice===S),z=Le(C,p);p.result.lot&&(C.newTransaction.lotId=p.result.lot||""),b?C.newTransaction.transacLot=b:p.result.mouvement&&(C.newTransaction.transacLot=p.result.mouvement),p.result.articleLot&&(C.newTransaction.codeArticle=p.result.articleLot),p.result.fournisseurLot&&(C.newTransaction.codeFournisseur=p.result.fournisseurLot),C.newTransaction.nbPackage=O(u.formatColis,z.num_colis)||0,C.newTransaction.nbPiece=O(u.formatPieces,z.num_pieces)||0,C.newTransaction.netWeight=O(u.formatPoids,z.num_poids)||0;const le=C.newTransaction.nbPackage>0||C.newTransaction.nbPiece>0||C.newTransaction.netWeight>0;C.autoCommit=L&&le?V===-1?C.newTransaction.indice:C.transactions[V].indice:null}async function U(C,p,S,b,V){let z=ls(C,o,b);return p&&q(z,p,null,S),z}w.useEffect(()=>{var p;const C=async()=>{var V;const S=c.current!=n;let b=await U(i.data.res,S?a:null,S?l:null,S);if(c.current=n,b)if(S&&b.autoCommit&&a){const z={VEN_NUMSEQ:b.venNumSeq,VEN_DATE_ENL:X.date?Be(X.date):null,VEN_CLIENT:b.client.CLI_CODE||"",VEN_COM_PREPA:b.commentPrepa1||"",VEN_COM_PREPA2:b.commentPrepa2||"",VEN_COM_BL:b.commentBL1||"",VEN_COM_BL2:b.commentBL2||"",Depot:b.newTransaction.codeDepot||"",Details:[{VEN_LOT_SEQ:n,VEN_ART_CODE:((V=b.article)==null?void 0:V.ART_CODE)||"",VEN_UNIT_VE:b.unitSale||"",Transactions:[{TRA_SEQ:b.newTransaction.transacSeq,TRA_LOT_SEQ:n,TRA_LOT:b.newTransaction.transacLot,TRA_COLIS_LIV:b.newTransaction.nbPackage||0,TRA_QUANTITE_LIV:b.newTransaction.nbPiece||0,TRA_PDS_NET_LIV:b.newTransaction.netWeight||0,TRA_CODART_AFF:b.newTransaction.codeArticle}]}]};M(z,le=>{(le==null?void 0:le.codeResult)==="OK"?i.refetch():N.messages.errorMessage(k("errorMessage"))})}else d(b)};if(!i.isLoading)if(!((p=i.data)!=null&&p.res))f("Détail non trouvé");else try{C()}catch{f("Crap")}},[i.isLoading,i.data]);const ht={onAddTransaction:ne,resetNewTransaction:ae,onChangeDetail:j,onChangeDetailNew:g,onSelectLot:$,onOpenLot:W,onDelete:Y,handleScanLecturePreparation:P,onScanLotCodeBarre:he,handleErrorScan:_,closeModal:me,closeScreen:ie,handleScanLecturePreparationEan128:v,onScanLotCodeBarreEan128Transaction:Oe,onManageSelectLotEan128:Te};return{error:m,detail:s,isLoading:i.isLoading,actionsFunction:ht}}const _s=Qe(T)`
   
         
            zIndex: 1,
            color: "grey",
            border: '1px solid #627E8B',
            width: 40,
            height: 40,
            display: "flex",
            borderRadius: "50%",
            justifyContent: "center",
            alignItems: "center",
            cursor: "pointer",
            padding: '0.3em',
            //transition: theme.transitions.create("background"),
            "&:hover": {
                //background: "rgba(245, 176, 66)",
                opacity: 1,
            },
            '& svg': {
                width: '80%'
            },
            opacity: 0.9,
            '&.reception': {
                '&.HOME': {
                    color: '#1565c0'
                },
                //  background: 'rgba(0, 0, 0, 0.38)',
                '&.completed': {
                    //backgroundImage:  'linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%)',
                    //background: '#a8ff78',  /* fallback for old browsers */
                    //background: '-webkit-linear-gradient(to right, #78ffd6, #a8ff78)'  /* Chrome 10-25, Safari 5.1-6 */
                    backgroundImage: 'linear-gradient(to right, #1976d2 0%, #0087a9 100%)'
                },
                '&.active': {
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // backgroundImage: 'linear-gradient(to right, #DF239D 0%, #00a950 100%)',
                    //  backgroundImage: 'linear-gradient(to right, #1976d2b5 0%, #1976d266 100%)',
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // background: '#DF239D',
                    //background: '#00308F !important',
                    boxShadow: "0 4px 10px 0 rgba(0,0,0,.25)",
                    transform: 'scale(110%)'
                },

            },
            '&.arrivage': {
                '&.HOME': {
                    color: 'green'
                },
                //background: 'linear-gradient(90deg, #EAEDF0 30%, #EAEDF0 74%)',
                '&.completed': {
                    //backgroundImage:  'linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%)',
                    //background: '#a8ff78',  /* fallback for old browsers */
                    //background: '-webkit-linear-gradient(to right, #78ffd6, #a8ff78)'  /* Chrome 10-25, Safari 5.1-6 */
                    // backgroundImage: 'linear-gradient(to right, #DF239D 0%, #ED75C3 100%)',
                    backgroundImage: 'linear-gradient(to right, #46E824 0%, #a4ed75 100%)'

                },
                '&.active': {

                    // backgroundImage: 'linear-gradient(to right, #1976d2b5 0%, #1976d266 100%)',
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // background: '#DF239D',
                    //background: '#00308F !important',
                    boxShadow: "0 4px 10px 0 rgba(0,0,0,.25)",
                    transform: 'scale(110%)'
                },
            }
        }`;function Ss({mode:r,className:t,active:n,ref:o,completed:a,icon:l,imageStat:c,error:u,type:i,...s}){return e.jsx(_s,{className:ye(t,"icon",{reception:r===1},{arrivage:r===2},{active:n,completed:a}),...s,children:String(l)==="EAN13"&&c?e.jsx(ft,{codeStat:c}):e.jsx(ee,{icon:String(l)})})}const Ls=Qe(Lo)(({theme:r})=>({[`&.${et.alternativeLabel}`]:{},[`&.${et.active}`]:{[`& .${et.line}`]:{}},[`&.${et.completed}`]:{[`& .${et.line}`]:{}},[`& .${et.line}`]:{height:3,border:0,backgroundColor:r.palette.mode==="dark"?r.palette.grey[800]:"#eaeaf0",borderRadius:1}}));function As({mode:r,activeStep:t,steps:n,onChangeStep:o}){return e.jsx(fe,{sx:{width:"100%"},spacing:4,children:e.jsx(Ao,{alternativeLabel:!0,activeStep:t,nonLinear:!0,connector:e.jsx(Ls,{}),children:n.map(a=>e.jsx(Rs,{step:a,activeStep:t,onChangeStep:o,mode:r},a.type))})})}function Ns(r,t,n){if(r!==null){if(typeof r=="object"&&D.has(r,"EMB_CODE")){const o=r;return o.quantity?{title:`${o.EMB_LIB1} ${o.poids} X ${o.quantity}`,completed:!0}:{title:`${o.EMB_LIB1}`,completed:!0}}if(typeof r=="string")return{title:r,completed:!0}}return{title:n,completed:!1}}const Rs=({step:r,mode:t,activeStep:n,onChangeStep:o})=>{const{label:a,imageStat:l}=Dn(at(),r.type),{t:c}=de(),u={StepIconComponent:Ss,StepIconProps:{active:n===r.id,icon:r.icon,type:r.type,mode:t,imageStat:l}},{title:i,completed:s}=Ns(a,r.type,c(r.title));return e.jsx(No,{completed:s,sx:d=>({".MuiStepLabel-root":{flexGrow:1,...n===r.type&&{borderBottom:3,borderBottomColor:"rgb(207, 22, 97)"}},".MuiStepLabel-label":{textTransform:"capitalize",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",margin:"auto",maxWidth:150},".MuiStepLabel-label.MuiStepLabel-alternativeLabel":{margin:"auto"}}),children:e.jsx(Ro,{color:"inherit",onClick:d=>o(r.type),children:e.jsx(Oo,{...u,children:i})})},r.type)},Os=()=>{const r=Bn();return e.jsx(R,{className:"title",noWrap:!0,variant:"subtitle1",color:"inherit",children:r})},bs=({className:r,title:t,mode:n,activeStep:o,steps:a,onChangeStep:l,...c})=>e.jsx(vn,{className:r,color:"inherit",children:e.jsxs(Mn,{sx:{pt:.6},children:[e.jsx(Vn,{disableMargin:!0}),n===0?e.jsx(Os,{}):e.jsx(As,{mode:n,onChangeStep:l,activeStep:o,steps:a})]})}),Is=w.memo(bs);function js(r,t){return $e({key:["ListePeseePreparation",r],fxt:{retrieve:(n,o)=>K().PrepaMethods().ListePeseePreparation({variables:{recherche:n,context:(o==null?void 0:o.current)||null,filtresOptionnels:t,lotSeq:r}}),retrievePreferences:null},query:t})}const ys=Wn[0];function Ds({item:r,className:t="",isLoading:n,maxWidth:o,onAddFavorite:a,favorites:l,editFavorite:c,onSelect:u,ItemComponentProps:i,style:s,venLotSeq:d,displayBtDelete:m,onDelete:f,...E}){var H,N,F,X,L;const x=mt(),P=je(),v=async O=>{await P.showConfirmation({title:"confirmDeleteTitle",message:"confirmDeleteTitleBody",type:"delete",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&f(O)},_=((H=x.getApplicationOption("formatColis"))==null?void 0:H.precision)??2,h=((N=x.getApplicationOption("formatPoids"))==null?void 0:N.precision)??3,M=x.getParametreBorneZone1("V2_COLSSCC_AUTO");return e.jsx(tr,{sx:{borderBottom:1,borderBottomColor:"divider",borderLeft:"8px solid transparent"},children:e.jsxs(y,{sx:O=>({...O.typography.h6,flexGrow:1}),alignItems:"center",container:!0,spacing:1,children:[e.jsx(y,{item:!0,xs:6,md:1.5,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(fe,{direction:"row",children:e.jsx(R,{variant:"subtitle1",children:r.PES_NUM})}),e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsxs(R,{variant:"subtitle1",children:["P ...",(F=r.PES_SSCC_PALETTE)==null?void 0:F.substring(11)]})}),e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsxs(R,{variant:"subtitle1",children:["C ...",(X=r.PES_SSCC_COLIS)==null?void 0:X.substring(11)]})})]})}),e.jsx(y,{item:!0,xs:6,md:2.5,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[r.LOT_ID&&e.jsx(ee,{icon:"EAN13"}),e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(R,{variant:"subtitle1",children:r.LOT_ID})})]})}),e.jsx(y,{item:!0,xs:6,md:2,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(fe,{direction:"row",children:e.jsx(R,{variant:"subtitle1",children:r.PES_BORNE})}),e.jsx(Ue,{label:"",text:Ie(r.PES_COLIS,_),Icon:e.jsx(Re,{fontSize:"large",uvc:"C"})})]})}),e.jsx(y,{item:!0,xs:5,md:2,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(fe,{direction:"row",children:e.jsxs(T,{display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(ys,{color:"red",fill:"red",height:25,width:25}),e.jsx(R,{variant:"subtitle1",children:(L=r.Preparateur)==null?void 0:L.PREP_NOM})]})}),e.jsx(Ue,{label:"",text:Ie(r.PES_QUANTITE,0),Icon:e.jsx(Re,{fontSize:"large",uvc:"P"})})]})}),e.jsx(y,{item:!0,xs:6,md:3,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsxs(fe,{direction:"row",children:[e.jsx(wn,{color:"info",fontSize:"small"})," ",r.PES_DATE_CREAT&&Un(r.PES_DATE_CREAT)]}),e.jsx(Ue,{label:"",text:Ie(r.PES_PDS_NET,h),Icon:e.jsx(Re,{fontSize:"large",uvc:"N"})})]})}),!M&&e.jsx(y,{item:!0,xs:1,md:1,container:!0,alignItems:"center",children:m&&e.jsx(kn,{color:"error",variant:"text","aria-label":"Delete",onClick:O=>{O.stopPropagation(),v(r.PES_NUM)},size:"large"})})]})})}const vs={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100}};function Ms({venLotSeq:r,displayBtDelete:t,recherche:n=null,onSelect:o,onDelete:a}){const l=js(r,n);return e.jsx(He,{onSelect:o,HeaderComponent:null,ItemMeasureCard:vs,ItemComponent:c=>e.jsx(Ds,{venLotSeq:r,displayBtDelete:t,onDelete:a,...c}),disableFavorite:!0,state:l,IconComponent:ur,labelSearch:"Recherche préparateur",placeholderSearch:"placeholderPreparateur"})}function mr({mode:r,clef:t,codeDepot:n,codeClient:o,codeArticle:a,onClose:l}){const{defaultImprimanteColis:c,defaultImprimantePalette:u,affichageImprimanteColis:i,affichageImprimantePalette:s,imprimantePalette:d,imprimanteColis:m,nbExemplaireColis:f,nbExemplairePalette:E,onSetImprimante:x,onPrintEtiquetteColisPaletteSscc:P,isPrinting:v}=it(at()),[_,h]=w.useState({nbExPesee:1,nbExColis:f??1,nbExPalette:E??0}),M=(N,F)=>{h(X=>({...X,[N]:Fn(F,X[N])}))},H=()=>{const N={codeEtiquette:r===ve.paletteSSCC?"PAL_SSCC":"COLIS_SSCC_ENT",clef:t,nombreExemplaire:r===ve.paletteSSCC?_.nbExPalette:_.nbExColis,imprimante:r===ve.paletteSSCC?d||"":m||"",codeDepot:n,codeClient:o,codeArticle:a};P(N,F=>{(F==null?void 0:F.Result)==="OK"&&l()})};return e.jsxs(T,{display:"flex",sx:{m:2},flexDirection:"column",gap:2,children:[(r===ve.colisSSCC||r===ve.colisPaletteSSCC)&&i&&e.jsx(Ir,{onChangePrinter:N=>{x("imprimanteColis",N)},imprimante:m,label:c||k("defaultPrinter"),title:k("packagePrinter"),nbEx:_.nbExColis,onChangeNbEx:N=>M("nbExColis",N)}),(r===ve.paletteSSCC||r===ve.colisPaletteSSCC)&&s&&e.jsx(Ir,{onChangePrinter:N=>{x("imprimantePalette",N)},imprimante:d,label:u||k("defaultPrinter"),title:k("paletPrinter"),nbEx:_.nbExPalette,onChangeNbEx:N=>M("nbExPalette",N)}),e.jsxs(T,{display:"flex",gap:1,children:[e.jsx(qn,{disabled:v,variant:"outlined",onClick:N=>{H()}}),e.jsx(rr,{variant:"outlined",onClick:N=>{l()}})]})]})}const $r=({operationId:r,venLotSeq:t,displayBtDelete:n,codeDepot:o,codeClient:a,codeArticle:l})=>{const[c,u]=w.useState(null),{onSupprimePesee:i}=lt(r),s=Ze(),d=Se(),m=async f=>{i(f,E=>{(E==null?void 0:E.codeResult)==="OK"&&(s.invalidateQueries({queryKey:["ListePeseePreparation",t]}),s.invalidateQueries({queryKey:[yt,d.getQueryKey(),t]}))})};return e.jsxs(e.Fragment,{children:[e.jsx(ke,{withAppBar:!1,isOpen:!!c,onCloseDialog:function(){u(null)},className:"",children:e.jsx(mr,{mode:ve.pesee,clef:(c==null?void 0:c.PES_NUM)||0,codeDepot:o,codeClient:a,codeArticle:l,onClose:()=>u(null)})}),e.jsx(Ms,{onSelect:function(f,E){u(f)},venLotSeq:t,displayBtDelete:n,onDelete:m})]})};function Kt({onOpenListPrinters:r,color:t,printer:n,i8ntitle:o,onChangePrinter:a}){return e.jsx(vr,{sx:{width:"100%",borderLeft:4,marginBottom:1,...t==="commande"&&{borderLeftColor:Kn},...t==="livraison"&&{borderLeftColor:Lr}},raised:!0,onClick:l=>{try{r().then(c=>{c&&a(c.IMP_NOM||null)})}catch{}},children:e.jsx(Hn,{sx:{padding:.5},avatar:e.jsx(re,{color:"inherit",variant:"outlined",sx:{...t==="commande"&&{color:zn[800]},...t==="livraison"&&{color:Lr}},children:e.jsx(Gn,{})}),title:o,subheader:n})})}const Zr=({detail:r,onClose:t})=>{var x,P,v,_,h;const{defaultImprimanteColis:n,defaultImprimantePalette:o,defaultImprimanteBl:a,imprimanteColis:l,imprimantePalette:c,imprimanteBl:u,affichageImprimanteColis:i,affichageImprimantePalette:s,affichageImprimanteBl:d,onSetImprimante:m}=it(at()),f=Qn(),{t:E}=de();return e.jsxs(e.Fragment,{children:[(r==null?void 0:r.Client)&&e.jsxs(y,{container:!0,columnSpacing:1,children:[e.jsx(y,{item:!0,xs:7,children:e.jsx(Ne,{title:(x=r.Client)==null?void 0:x.CLI_CODE,subTitle:(P=r.Client)==null?void 0:P.CLI_NOM,disabled:!0,IconComponent:e.jsx(ee,{icon:"FOURNISSEUR"}),className:"fournisseur"})}),e.jsx(y,{item:!0,xs:5,children:e.jsx(Ne,{title:"Numero de commande",subTitle:r.VEN_CDE,disabled:!0,IconComponent:e.jsx(ee,{icon:"TRACA"}),className:"numero"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{className:"headerLine article",title:(v=r.Article)==null?void 0:v.ART_CODE,subTitle:(_=r.Article)==null?void 0:_.ART_LIB1,disabled:!0,IconComponent:e.jsx(ft,{codeStat:((h=r.Article)==null?void 0:h.ART_STAT_IMAGE)||null})})})]}),e.jsxs(y,{container:!0,display:"flex",flexDirection:"row",gap:1,sx:{marginTop:2,marginBottom:2,p:1},children:[i&&e.jsx(y,{item:!0,xs:12,md:5.9,children:e.jsx(Kt,{color:"livraison",onOpenListPrinters:()=>f(Wt.ETIQ),printer:l||n,i8ntitle:E("EtiqColis"),onChangePrinter:M=>{m("imprimanteColis",M)}})}),s&&e.jsx(y,{item:!0,xs:12,md:5.9,children:e.jsx(Kt,{color:"livraison",onOpenListPrinters:()=>f(Wt.ETIQ),printer:c||o,i8ntitle:E("EtiqPalette"),onChangePrinter:M=>{m("imprimantePalette",M)}})}),d&&e.jsx(y,{item:!0,xs:12,md:5.9,children:e.jsx(Kt,{color:"livraison",onOpenListPrinters:()=>f(Wt.BL),printer:u||a,i8ntitle:E("deliveryNote"),onChangePrinter:M=>{m("imprimanteBl",M)}})})]}),e.jsx(bt,{sx:{marginRight:"auto",width:200},color:"error",size:"large",variant:"contained",onClick:M=>{t()},children:E("back")})]})};function Vs({operationId:r,date:t,readOnlyDate:n,updateDate:o,onChangeDatePreparation:a,onSelectModePreparation:l}){const[c,u]=w.useState(new Date),[i,s]=w.useState({modalFor:""}),{t:d}=de(),m=()=>{s({modalFor:""})};return e.jsxs(T,{sx:{flexGrow:1,m:5},display:"flex",flexDirection:"column",gap:4,alignItems:"center",children:[e.jsxs(ke,{dialogProps:{maxWidth:i.modalFor==="PRINTERSETTINGS"?"sm":"md",fullWidth:!0,fullScreen:D.includes(["PESEEPREPARATION"],i.modalFor)},withAppBar:!0,isOpen:!!i.modalFor,onCloseDialog:m,i8ntitle:st(d,i.modalFor),className:"",children:[i.modalFor==="PRINTERSETTINGS"&&e.jsx(e.Fragment,{children:e.jsx(Zr,{onClose:m})}),i.modalFor==="PESEEPREPARATION"&&e.jsx(e.Fragment,{children:e.jsx($r,{operationId:r,venLotSeq:0,displayBtDelete:!1})})]}),e.jsxs(y,{container:!0,spacing:4,justifyContent:"center",children:[e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:f=>l(1),children:e.jsxs(Pt,{variant:"main",children:[e.jsx($n,{fontSize:"large",className:"icon"}),e.jsx(R,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("prepaArticle")})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:f=>l(2),children:e.jsxs(Pt,{variant:"main",children:[e.jsx(nr,{fontSize:"large",className:"icon"}),e.jsx(R,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("prepaClient")})]})})]}),e.jsxs(T,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsxs(T,{display:"flex",flexDirection:"row",alignItems:"center",gap:1,children:[o&&e.jsx(R,{variant:"h6",children:"Mise à jour date enlèvement :"}),o&&e.jsx(R,{variant:"h6",sx:{color:o?"red":"inherit"},children:Zn(t?Gt(t):c)})]}),!n&&e.jsx(e.Fragment,{children:e.jsx(Zt,{showResetClock:!0,readOnlyDate:n,onChange:a,date:t})})]}),e.jsxs(y,{container:!0,alignItems:"flex-end",sx:{flexGrow:1},spacing:1,children:[e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:f=>{s({modalFor:"PESEEPREPARATION"})},children:e.jsxs(Pt,{variant:"main",children:[e.jsx(Xn,{fontSize:"large",className:"icon"}),e.jsx(R,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("reedition")})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:4}),e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:f=>{s({modalFor:"PRINTERSETTINGS"})},children:e.jsxs(Pt,{variant:"main",children:[e.jsx(Yn,{fontSize:"large",className:"icon"}),e.jsx(R,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none",textAlign:"center"},className:"title",children:d("printerSettings")})]})})]})]})}const Bs="LineDetailMulti",Xr={root:`${Bs}-root`},ws=Qe(Ct)(({theme:r})=>({[`& .${Xr.root}`]:{paddingTop:0,paddingBottom:0,margin:0,"& .icon":{margin:r.spacing(.4),width:"20px",height:"20px","&.livraison":{color:It[800]},"&.preparation":{color:jt[800]},"&.commentaire":{color:r.palette.secondary.main}},"& .commentaire":{...r.typography.subtitle1,fontWeight:800,color:r.palette.secondary.main},[r.breakpoints.up("sm")]:{"& .icon":{width:"26px",height:"26px"},"& .commentaire":{...r.typography.h5}}}})),Us=({className:r,item:t,onSelect:n,showLot:o=!0,onValidateLine:a,...l})=>{var E,x;de();const c=t.VEN_ETAT_PREP,u=t.TotalUCAPreparer,i=t.TotalUCPrepare,s=or(i,u),d=c===_e.rupture||c===_e.manquant||c===_e.reliquat,m=c===_e.preparee?"#4caf50":d?"#f00020":i>0?"#ff9800":"#2196f3",f=w.useCallback(()=>{a(t)},[t.VEN_LOT_SEQ]);return e.jsxs(ws,{style:{},sxContainer:{p:0,borderRight:24,borderRightColor:m},sx:{display:"grid",gap:1,px:1,py:0,width:"100%",flexBasis:"100%",alignItems:"stretch",gridTemplateColumns:"50px 1fr 130px 200px 150px 100px",gridTemplateAreas:` "codeCommande client date preparateur unit validButton" 
                                 "nameArticle nameArticle date lot unit validButton" `,columnGap:1,rowGap:1,alignContent:"center",justifyContent:"center",...nt(t)&&{borderLeftColor:"warning.main",bgcolor:"rgba(0,0,0,0.1)"}},className:ye(r,Xr.root),onClick:P=>n(t),onValorize:f,disabledBtnValorize:d,children:[nt(t)&&e.jsx(sr,{lockByName:t.VERROU_USER}),e.jsx(T,{gridArea:"codeCommande",display:"flex",alignItems:"center",children:e.jsx(R,{variant:"subtitle2",color:"textPrimary",fontWeight:600,children:t.VEN_CDE})}),e.jsxs(T,{gridArea:"client",display:"flex",alignItems:"center",flexDirection:"row",children:[e.jsx(nr,{className:"icon client",fontSize:"small"}),e.jsx(R,{variant:"h6",color:"textPrimary",fontWeight:600,children:(E=t.Client)==null?void 0:E.CLI_NOM})]}),e.jsx(T,{gridArea:"date",display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(R,{className:"date",variant:"h6",color:"inherit",children:pt(t.VEN_DATE_ENL)})}),e.jsx(T,{gridArea:"preparateur",display:"flex",alignItems:"center",children:t.Preparateur&&e.jsxs(R,{className:"trs",variant:"body1",color:"textPrimary",children:["Preparateur ",t.Preparateur.PREP_CODE]})}),e.jsx(T,{gridArea:"nameArticle",display:"flex",alignItems:"center",children:e.jsx(R,{className:"nomclient",variant:"h5",color:"textPrimary",sx:{fontWeight:800},children:(x=t.Article)==null?void 0:x.ART_LIB1})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"left",gridArea:"lot",children:t.LOT_ID&&o&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{icon:"EAN13",className:"icon"}),e.jsx(R,{className:"commentaire",variant:"subtitle2",color:"textPrimary",children:t.LOT_ID})]})}),e.jsxs(T,{gridArea:"unit",display:"flex",alignItems:"center",justifyContent:"right",children:[e.jsxs(R,{variant:"h5",fontWeight:600,children:[t.TotalUCPrepare," / ",t.TotalUCAPreparer===null?t.TotalUCPrepare:t.TotalUCAPreparer]}),e.jsx(Re,{fontSize:"large",uvc:t.VEN_UNIT_CDE})]}),e.jsx(ot,{color:"success",classes:{bar1Indeterminate:"percent"},sx:{border:1,borderColor:"divider",bgcolor:"#fff",position:"absolute",marginX:1,bottom:0,height:5,right:0,left:0,"& .MuiLinearProgress-bar":{bgcolor:m}},variant:"determinate",value:s})]})},ks={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80},Ws=({onSelect:r,art_code:t,tour_code:n,ven_date_enl:o,onClosePreparation:a,getParametersBorne:l,onValidateLine:c,...u})=>{const{t:i}=de(),s=l("V2_AGR_TOURNEE"),d=[Lt("ART_CODE",t,"="),Lt("VEN_DATE_ENL",o,"=")];s&&d.push(Lt("tournee.TOUR_CODE",n||" ",n?"=":"null"));const m=$e({key:[Ve,t],keyConfigFilters:Ve,fxt:(f,E)=>K().PrepaMethods().LignesMultiCommande({variables:{recherche:f,context:(E==null?void 0:E.current)||null}}),query:Jn(d),options:{}});return e.jsx(T,{display:"flex",flexGrow:1,flexDirection:"column",children:e.jsx(He,{labelSearch:"",gridModes:["list"],onSelect:r,HeaderComponent:null,ItemComponent:f=>e.jsx(Us,{onValidateLine:c,...f}),placeholderSearch:i("placeHolderPreparation"),ItemMeasureCard:ks,...u,state:m,disableFavorite:!0})})};function qs({operationId:r}){const{operation:t,getParametreBorneZone1:n,actions:o}=De(r),{preparation:a}=t,{onTerminateLine:l,retourTerminateLine:c}=lt(r),u=Ze(),i=je(),s=n("V2_RELIQUAT"),d=w.useCallback(m=>{(async E=>{s?o.onOpenReliquatPreparation(E.VEN_NUMSEQ||0,E.VEN_LOT_SEQ||0):await i.showConfirmation({title:"confirmPrepaLine",message:"confirmPrepaLineBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&l({dateEnl:t.date?Be(t.date):null,lotSeq:E.VEN_LOT_SEQ||0},P=>{var v;(P==null?void 0:P.codeResult)==="OK"&&c(ue.PREPAARTICLE,P==null?void 0:P.result,E.VEN_NUMSEQ,u,(v=E.Article)==null?void 0:v.ART_CODE)})})(m)},[]);return a?e.jsx(Ws,{onSelect:o.selectArticleLine,art_code:a.art_code,tour_code:a.tour_code,ven_date_enl:a.ven_date_enl,onClosePreparation:o.unselectArticle,getParametersBorne:n,onValidateLine:d}):null}const Fs="LineDetailPreparation",Yr={root:`${Fs}-root`},Qs=Qe(Ct)(({theme:r})=>({[`& .${Yr.root}`]:{paddingTop:0,paddingBottom:0,flexDirection:"column",margin:0,"& .icon":{margin:r.spacing(.4),width:"20px",height:"20px","&.livraison":{color:It[800]},"&.preparation":{color:jt[800]},"&.commentaire":{color:r.palette.secondary.main}},"& .commentaire":{...r.typography.subtitle1,fontWeight:800,color:r.palette.secondary.main},[r.breakpoints.up("sm")]:{"& .icon":{width:"26px",height:"26px"},"& .commentaire":{...r.typography.h5}}}})),Ks=({className:r,item:t,onSelect:n,style:o,onValidateLine:a,...l})=>{var P,v,_,h,M;const c=w.useCallback(()=>{a(t)},[t.VEN_LOT_SEQ]),u=t.VEN_ETAT_PREP,i=t.TotalUCAPreparer,s=t.TotalUCPrepare,d=or(s,i),m=u===_e.rupture||u===_e.manquant||u===_e.reliquat,f=u===_e.preparee?"#4caf50":m?"#f00020":s>0?"#ff9800":"#2196f3",E=t.ExisteStock?"#4caf50":"#f00020",x=((P=t.Article)==null?void 0:P.ART_STOCK)==="L"||((v=t.Article)==null?void 0:v.ART_STOCK)==="S";return e.jsxs(Qs,{onValorize:c,sxContainer:{p:0,borderRight:24,borderRightColor:f},sx:H=>({p:1,...H.typography.h6,display:"grid",gridTemplateColumns:"1fr repeat(3, 200px) 100px 50px",gridTemplateAreas:`'articleCode preparateur lot zoneCode  numberCommander iconCommander'
                                    'articleName articleName date zoneName  numberCommander iconCommander'`}),className:ye(r,Yr.root),onClick:H=>n(t),style:o,disabledBtnValorize:m||s>=i,children:[e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"flex-start",gridArea:"articleCode",children:e.jsx(R,{variant:"subtitle2",color:"textPrimary",children:(_=t.Article)==null?void 0:_.ART_CODE})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"flex-start",gridArea:"articleName",children:e.jsx(R,{className:"nomclient",variant:"h6",color:"textPrimary",component:"span",sx:{fontWeight:800},children:(h=t.Article)==null?void 0:h.ART_LIB1})}),e.jsx(T,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridArea:"date",children:t.VEN_DATE_ENL&&e.jsxs(e.Fragment,{children:[e.jsx(cr,{type:"prep",className:"icon"}),e.jsx(R,{className:"date",variant:"inherit",color:"textPrimary",children:pt(t.VEN_DATE_ENL)})]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"zoneCode",children:t.Picking&&t.Picking.PICK_CODE&&e.jsxs(R,{variant:"subtitle2",color:"textPrimary",children:["Zone picking ",t.Picking.PICK_CODE]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"zoneName",children:t.Picking&&t.Picking.PICK_LIBELLE&&e.jsx(R,{className:"commentaire",variant:"subtitle2",color:"textPrimary",children:(M=t.Picking)==null?void 0:M.PICK_LIBELLE})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"flex-start",gridArea:"lot",children:t.LOT_ID&&x&&i>0&&s==0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{icon:"EAN13",className:"icon"}),e.jsx(R,{className:"commentaire",variant:"subtitle2",color:"textPrimary",children:t.LOT_ID})]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"preparateur",children:t.Preparateur&&e.jsxs(R,{variant:"subtitle2",color:"textPrimary",children:["Preparateur ",t.Preparateur.PREP_CODE]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"numberCommander",sx:t.ExisteStock!=null?{bgcolor:E,borderRadius:1,border:1,color:"white"}:{},children:e.jsxs(R,{className:"commentaire",variant:"inherit",children:[t.TotalUCPrepare," / ",t.TotalUCAPreparer===null?t.TotalUCPrepare:t.TotalUCAPreparer]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"iconCommander",sx:{color:"primary"},children:e.jsx(Re,{fontSize:"medium",uvc:t.VEN_UNIT_CDE})}),e.jsx(ot,{color:"success",classes:{bar1Indeterminate:"percent"},sx:{border:1,borderColor:"divider",bgcolor:"#fff",position:"absolute",marginX:1,bottom:0,height:5,right:0,left:0,"& .MuiLinearProgress-bar":{bgcolor:f}},variant:"determinate",value:d})]})},Hs=({disabledSave:r,preparation:t,gereReliquat:n,onOpenReliquat:o,onClosePreparation:a,children:l,...c})=>{var i,s;const u=eo(t);return e.jsxs(T,{sx:{display:"flex",height:"100%",flexDirection:"column",my:.5,mx:.3,gap:.3,".headerLine":{maxHeight:65}},children:[e.jsx(bo,{disabled:!0,IconComponent:null,disableIconMargin:!0,className:"fournisseur",children:e.jsxs(T,{display:"grid",gap:1,sx:{width:"100%",flexBasis:"100%",gridTemplateColumns:"3fr 1fr auto",gridTemplateAreas:` "frn cde btns"
                        "comment comment btns"`},children:[e.jsxs(T,{gridArea:"frn",sx:{paddingLeft:.8},display:"flex",alignItems:"center",children:[e.jsx(ee,{icon:"FOURNISSEUR"}),e.jsxs(T,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(R,{variant:"h6",color:"primary",children:(i=t.Client)==null?void 0:i.CLI_CODE}),e.jsx(R,{variant:"h6",children:(s=t.Client)==null?void 0:s.CLI_NOM})]})]}),e.jsxs(T,{display:"flex",alignItems:"center",gridArea:"cde",children:[e.jsx(ee,{icon:"ORDER"}),e.jsxs(T,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(R,{variant:"h6",color:"primary",children:t.VEN_CDE}),e.jsx(R,{variant:"h6",children:pt(t.VEN_DATE_CDE)})]})]}),e.jsx(T,{display:"flex",gap:1,sx:{padding:.5},gridArea:"btns",children:e.jsx(zs,{VEN_NUMSEQ:t.VEN_NUMSEQ,gereReliquat:n,onOpenReliquat:o,onClosePreparation:a,disabled:r})}),u&&e.jsxs(T,{gridArea:"comment",display:"flex",gap:2,color:"secondary.main",children:[e.jsx(to,{fontSize:"medium",color:"inherit"}),e.jsx(R,{sx:{color:"inherit",fontWeight:800},component:"p",variant:"h4",children:u})]})]})}),l]})},zs=({disabled:r,VEN_NUMSEQ:t,gereReliquat:n,onOpenReliquat:o,onClosePreparation:a})=>{const{onFinPreparationCommande:l}=lt(at()),c=je(),{t:u}=de();Se();function i(m){var f,E,x,P;return(m==null?void 0:m.codeResult)==="OK"?((f=m==null?void 0:m.result)==null?void 0:f.NB_LIGNES_NONVAL)===0?"PREPATERMINE":((E=m==null?void 0:m.result)==null?void 0:E.NB_LIGNES_RUPTURE)===((x=m==null?void 0:m.result)==null?void 0:x.NB_LIGNES_NONVAL)?"PREPATERMINEAVECRUPTURE":((P=m==null?void 0:m.result)==null?void 0:P.NB_LIGNES_DEMARREE)===0?"PREPAVIDE":"PREPACOMMENCEE":"ERR"}const s=w.useCallback(m=>{async function f(){var E;try{const x=await K().PrepaMethods().EtatPreparation(t),P=((E=x.res)==null?void 0:E.codeResult)==="OK"&&i(x.res||null);P==="PREPATERMINE"||P==="PREPATERMINEAVECRUPTURE"?await c.showConfirmation({title:"confirmTerminatePreparationTitle",message:"confirmTerminatePreparationBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&l(t,_=>{(_==null?void 0:_.codeResult)==="OK"&&a()}):n&&o(t)}catch{}}f()},[t]),d=w.useCallback(m=>{a()},[a]);return e.jsxs(e.Fragment,{children:[e.jsx(ro,{disabled:r,variant:"contained",sx:{bgcolor:"primary.dark"},onClick:s,children:u("terminatePreparation")}),e.jsx(rr,{disabled:r,variant:"contained",color:"error",onClick:d})]})};w.createContext([]);const Gs={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80},$s=({config:r,VEN_NUMSEQ:t,ven_lot_seq:n,gereReliquat:o,onSelect:a,onOpenReliquat:l,onCloseCommande:c,onValidateLine:u,onSetQuickFilterValueParam:i,...s})=>{var x,P;const{t:d}=de(),m=fs(r,t),f=D.head((P=(x=m.data)==null?void 0:x.res)==null?void 0:P.result)||null;m.isLoading,w.createContext([]);const E=$e({key:[Me,t],fxt:(v,_)=>K().PrepaMethods().LignesMonoCommande({variables:{numSeq:t,recherche:v,context:(_==null?void 0:_.current)||null}}),query:ge("VEN_NUMSEQ",t,"="),options:{queryOptions:{enabled:!!t}},onSetQuickFilterValueParam:i,decoupeScan:!0});return e.jsx(T,{display:"flex",flexGrow:1,flexDirection:"column",children:f&&e.jsx(Hs,{preparation:f,onClosePreparation:c,disabledSave:!1,gereReliquat:o,onOpenReliquat:l,children:e.jsx(He,{labelSearch:"",gridModes:["list"],onSelect:a,HeaderComponent:null,ItemComponent:v=>e.jsx(Ks,{onValidateLine:u,...v}),placeholderSearch:d("placeHolderPreparation"),ItemMeasureCard:Gs,...s,state:E,disableFavorite:!0})})})},Zs=qo($s,"",!0);function Xs({operationId:r,numSeq:t,lotSeq:n,gereReliquat:o,dateEnlevement:a,actions:l,onSetQuickFilterValueParam:c}){const{onTerminateLine:u,retourTerminateLine:i}=lt(r),s=Ze(),d=je(),m=Se(),f=w.useCallback(E=>{(async P=>{o?l.onOpenReliquatPreparation(P.VEN_NUMSEQ||0,P.VEN_LOT_SEQ||0):await d.showConfirmation({title:"confirmPrepaLine",message:"confirmPrepaLineBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&u({dateEnl:a?Be(a):null,lotSeq:P.VEN_LOT_SEQ||0},_=>{var h;(_==null?void 0:_.codeResult)==="OK"&&i(ue.PREPACLIENT,_==null?void 0:_.result,P.VEN_NUMSEQ,s,(h=P.Article)==null?void 0:h.ART_CODE)})})(E)},[]);return t?e.jsx(Zs,{config:m,VEN_NUMSEQ:t,ven_lot_seq:n,gereReliquat:o,onOpenReliquat:l.onOpenReliquatPreparation,onValidateLine:f,onCloseCommande:()=>{l.onClosePreparation(r,G.LISTPREPARATIONS)},onSelect:l.selectPreparationLine,onSetQuickFilterValueParam:c}):null}const Ys="LinePreparation",Jr={root:`${Ys}-root`},Js=Qe(Ct)(({theme:r})=>({[`& .${Jr.root}`]:{"& .icon":{margin:r.spacing(.4),width:"20px",height:"20px","&.livraison":{color:It[800]},"&.preparation":{color:jt[800]},"&.commentaire":{color:r.palette.secondary.main}},"& .commentaire":{...r.typography.subtitle1,fontWeight:800,color:r.palette.secondary.main},[r.breakpoints.up("sm")]:{"& .icon":{width:"26px",height:"26px"},"& .commentaire":{...r.typography.h5}}}})),ea=({className:r,item:t,onSelect:n,...o})=>{var d,m;const a=t.NbLignesDetail,l=t.NbLignesPreparees,c=t.NbLignesRupture,u=or(l,a),i=c>0?"#f00020":l===a?"#4caf50":l>0?"#ff9800":"#2196f3",s=t.EtatStock=="O"?"#4caf50":t.EtatStock=="N"?"#f00020":"#ff9800";return e.jsxs(Js,{style:{},sxContainer:{p:0,borderRight:24,borderRightColor:i},sx:f=>({width:"100%",...f.typography.h6,p:1,gap:.5,display:"grid",gridTemplateColumns:"40px 1fr repeat(3, 200px)",gridTemplateAreas:`'iconClient numCommande date tournee numberCommande'
                                'iconClient nameClient date tournee numberCommande'`,...nt(t)&&{borderLeftColor:"warning.main",bgcolor:"rgba(0,0,0,0.1)"}}),className:ye(r,Jr.root),onClick:f=>n(t),children:[e.jsx(T,{gridArea:"iconClient",justifyContent:"flex-end",children:e.jsx(nr,{sx:{color:f=>f.palette.primary.light}})}),nt(t)&&e.jsx(sr,{lockByName:t.VERROU_USER}),e.jsx(T,{display:"flex",gridArea:"numCommande",children:e.jsx(R,{variant:"subtitle2",color:"textPrimary",children:t.VEN_CDE})}),e.jsxs(T,{display:"flex",alignItems:"baseline",flexDirection:"row",gridArea:"nameClient",children:[e.jsx(R,{className:"nomclient",variant:"h6",color:"textPrimary",component:"span",sx:{fontWeight:800},children:(d=t.Client)==null?void 0:d.CLI_NOM}),e.jsxs(R,{className:"codeclient",variant:"caption",color:"textPrimary",component:"span",children:["(",(m=t.Client)==null?void 0:m.CLI_CODE,")"]})]}),e.jsxs(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"date",children:[e.jsx(cr,{type:"prep",className:"icon"}),e.jsx(R,{className:"date",variant:"inherit",color:"textPrimary",children:pt(t.VEN_DATE_LIV)})]}),e.jsx(T,{gridArea:"tournee",flexDirection:"row",justifyContent:"center",textAlign:"center",display:"flex",alignItems:"center",children:t.Tournee&&e.jsxs(e.Fragment,{children:[e.jsx(Mr,{className:"icon livraison"}),e.jsx(R,{className:"trs",variant:"inherit",color:"textPrimary",children:t.Tournee.TOUR_CODE})]})}),e.jsxs(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"numberCommande",sx:t.EtatStock!=null?{bgcolor:s,borderRadius:1,border:1,color:"white"}:{},children:[e.jsx(Wo,{className:"icon"}),e.jsxs(R,{className:"commentaire",variant:"inherit",children:[t.NbLignesPreparees," / ",t.NbLignesDetail]})]}),e.jsx(ot,{color:"success",classes:{bar1Indeterminate:"percent"},sx:{border:1,borderColor:"divider",bgcolor:"#fff",position:"absolute",marginX:1,bottom:0,height:5,right:0,left:0,"& .MuiLinearProgress-bar":{bgcolor:i}},variant:"determinate",value:u})]})},ta={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80},ra=({data:r,onSelect:t,...n})=>{const{t:o}=de();return e.jsx(He,{labelSearch:"",gridModes:["list"],onSelect:t,HeaderComponent:null,ItemComponent:ea,placeholderSearch:o("placeHolderPreparation"),ItemMeasureCard:ta,...n,state:r,disableFavorite:!0})},na="LineCumulArticle",en={root:`${na}-root`},oa=Qe(Ct)(({theme:r})=>({[`& .${en.root}`]:{paddingTop:0,paddingBottom:0,margin:0,"& .icon":{margin:r.spacing(.4),width:"20px",height:"20px","&.livraison":{color:It[800]},"&.preparation":{color:jt[800]},"&.commentaire":{color:r.palette.secondary.main}},"& .commentaire":{...r.typography.subtitle1,fontWeight:800,color:r.palette.secondary.main},[r.breakpoints.up("sm")]:{"& .icon":{width:"26px",height:"26px"},"& .commentaire":{...r.typography.h5}}}})),sa=({className:r,item:t,onSelect:n,...o})=>{var a,l,c;return de(),e.jsxs(oa,{sx:u=>({...u.typography.h6,display:"grid",width:"100%",borderBottom:1,borderBottomColor:"divider",borderLeft:"8px solid transparent",gridTemplateColumns:"1fr repeat(4,200px)",gridTemplateAreas:`"numCommande date tournee totalCommander totalCommande"
                                    "nomArticle date tournee totalCommander totalCommande"`,alignContent:"center",justifyContent:"center",...nt(t)&&{borderLeftColor:"warning.main",bgcolor:"rgba(0,0,0,0.1)"}}),className:ye(r,en.root),onClick:u=>n(t),style:{},children:[nt(t)&&e.jsx(sr,{lockByName:t.VERROU_USER}),e.jsx(T,{display:"flex",gridArea:"numCommande",alignItems:"flex",justifyContent:"flex-start",children:e.jsx(R,{variant:"subtitle2",color:"textPrimary",children:(a=t.Article)==null?void 0:a.ART_CODE})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"flex-start",gridArea:"nomArticle",children:e.jsx(R,{className:"nomclient",variant:"h6",color:"textPrimary",sx:{fontWeight:800},children:(l=t.Article)==null?void 0:l.ART_LIB1})}),e.jsxs(T,{alignItems:"center",display:"flex",gridArea:"date",flexDirection:"row",children:[e.jsx(cr,{type:"prep",className:"icon"}),e.jsx(R,{className:"date",variant:"inherit",color:"textPrimary",children:pt(t.VEN_DATE_ENL)})]}),e.jsx(T,{alignItems:"center",gridArea:"tournee",display:"flex",justifyContent:"center",flexDirection:"row",children:t.Tournee&&e.jsxs(e.Fragment,{children:[e.jsx(Mr,{className:"icon livraison"}),e.jsx(R,{className:"date",variant:"inherit",color:"textPrimary",children:(c=t.Tournee)==null?void 0:c.TOUR_CODE})]})}),e.jsx(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"totalCommander",children:e.jsxs(R,{className:"commentaire",variant:"inherit",color:"secondary",children:[t.TotalUCPrepare," / ",t.TotalUCAPreparer]})}),e.jsxs(T,{display:"flex",alignItems:"center",justifyContent:"center",gridArea:"totalCommande",children:[e.jsx(no,{className:"icon fournisseur"}),e.jsxs(R,{className:"commentaire",variant:"inherit",color:"secondary",children:[t.NbLignesPreparees," / ",t.NbLignesDetail]})]})]})},aa={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80},ia=({data:r,onSelect:t,...n})=>{const{t:o}=de();return e.jsx(He,{labelSearch:"PreparationArticle",gridModes:["list"],onSelect:t,HeaderComponent:null,ItemComponent:sa,placeholderSearch:o("placeHolderPreparation"),ItemMeasureCard:aa,...n,state:r,disableFavorite:!0})},tn=(r,t,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>Ke([ms,r.getQueryKey(),t],()=>er(K().CommunMethods().dernierColisSSCC(t)),n);function la(r,t){return $e({key:["ListeColisSSCC",r],fxt:{retrieve:(n,o)=>K().CommunMethods().listColisSSCC({variables:{recherche:n,context:(o==null?void 0:o.current)||null,filtresOptionnels:t,numSeq:r}}),retrievePreferences:null},query:t})}const rn=(r,t,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>Ke([ds,r.getQueryKey(),t],()=>er(K().CommunMethods().dernierePaletteSSCC(t)),n);function ca(r,t){return $e({key:["ListePaletteSSCC",r],fxt:{retrieve:(n,o)=>K().CommunMethods().listPaletteSSCC({variables:{recherche:n,context:(o==null?void 0:o.current)||null,filtresOptionnels:t,numSeq:r}}),retrievePreferences:null},query:t})}function ua(r,t){const n=Se(),o=Ke(["CountPrepaColisSscc",r],()=>K().CommunMethods().listColisSSCC({variables:{numSeq:r,context:n.current,recherche:{rbp:1}}}).then(a=>{var l;return((l=a.res)==null?void 0:l.itemsCount)||0}),{useErrorBoundary:!1,enabled:!!r&&t,refetchInterval:3e3});return{nbColis:o.data,error:o.error,refetchColis:o.refetch}}function da({item:r,className:t="",isLoading:n,maxWidth:o,onAddFavorite:a,favorites:l,editFavorite:c,onSelect:u,ItemComponentProps:i,style:s,...d}){const m=dt("C",i.format),f=dt("N",i.format),E=i==null?void 0:i.afficheImprimante,x=i==null?void 0:i.colisSsccAuto;return e.jsx(tr,{sx:{borderBottom:1,borderBottomColor:"divider",borderLeft:"8px solid transparent"},children:e.jsxs(y,{sx:P=>({...P.typography.h6,flexGrow:1,bgcolor:(i==null?void 0:i.CurrentNumCol)===r.TRA_NUMCOL?"#C4F3B3":""}),alignItems:"center",container:!0,spacing:1,children:[e.jsx(y,{container:!0,item:!0,xs:2,md:.8,className:"subtitle2",alignItems:"center",direction:"row",wrap:"nowrap",children:E&&e.jsx(Vr,{color:"secondary",onClick:P=>{u(r)}})}),e.jsx(y,{item:!0,xs:3,md:1,container:!0,alignItems:"center",children:e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(R,{variant:"h6",children:r.TRA_NUMCOL}),(r.TRA_NUMPAL||0)>0&&e.jsx(fe,{direction:"row",children:e.jsx(R,{variant:"subtitle2",children:r.TRA_NUMPAL})})]})}),e.jsx(y,{item:!0,xs:7,md:2,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(R,{variant:"subtitle1",children:r.TRA_SSCC})})}),e.jsx(y,{item:!0,xs:3.6,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_COLIS,m),Icon:e.jsx(Re,{fontSize:"large",uvc:"C"})})})}),e.jsx(y,{item:!0,xs:3.6,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_QUANTITE,0),Icon:e.jsx(Re,{fontSize:"large",uvc:"P"})})})}),e.jsx(y,{item:!0,xs:3.8,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_PDS_NET,f),Icon:e.jsx(Re,{fontSize:"large",uvc:"N"})})})}),!x&&e.jsx(y,{item:!0,xs:1,md:1,container:!0,alignItems:"center",children:e.jsx(Br,{color:"secondary",variant:"text","aria-label":"Select",onClick:P=>{P.stopPropagation(),i==null||i.onSelectColis(r.TRA_NUMCOL,r.TRA_NUMPAL),i==null||i.onClose()},size:"large"})})]})})}const ma={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100}};function Ea({CurrentNumCol:r,numSeq:t,recherche:n=null,paramsOptions:o,onSelectColis:a,onSelect:l,onClose:c}){const u=la(t,n),i=o.getParametreBorneZone1("V2_ETIQ_COLIS"),s=o.getParametreBorneZone1("V2_COLSSCC_AUTO"),d=qr(),m=w.useMemo(()=>({numSeq:t,CurrentNumCol:r,format:d,afficheImprimante:i,colisSsccAuto:s,onSelectColis:a,onClose:c}),[t,a,c,r]);return e.jsx(He,{onSelect:l,HeaderComponent:null,ItemComponentProps:m,ItemMeasureCard:ma,ItemComponent:da,disableFavorite:!0,state:u,IconComponent:ur,labelSearch:"SSCC",placeholderSearch:"placeholderSSCC"})}const fa=({numSeq:r,currentColis:t,codeDepot:n,codeClient:o,codeArticle:a,onSelect:l,onClose:c})=>{const u=mt(),[i,s]=w.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{withAppBar:!1,isOpen:!!i,onCloseDialog:function(){s(null)},className:"",children:e.jsx(mr,{mode:ve.colisSSCC,clef:(i==null?void 0:i.TRA_NUMCOL)||0,codeDepot:n,codeClient:o,codeArticle:a,onClose:()=>s(null)})}),e.jsx(Ea,{onSelect:function(d,m){s(d)},numSeq:r,CurrentNumCol:t||null,onClose:c,onSelectColis:l,paramsOptions:u})]})};function Ca({item:r,className:t="",isLoading:n,maxWidth:o,onAddFavorite:a,favorites:l,editFavorite:c,onSelect:u,ItemComponentProps:i,style:s,...d}){const m=dt("C",i.format),f=dt("N",i.format),E=i==null?void 0:i.afficheImprimante;return e.jsx(tr,{sx:{borderBottom:1,borderBottomColor:"divider",borderLeft:"8px solid transparent"},children:e.jsxs(y,{sx:x=>({...x.typography.h6,flexGrow:1,bgcolor:(i==null?void 0:i.CurrentNumPal)===r.TRA_NUMPAL?"#C4F3B3":""}),alignItems:"center",container:!0,spacing:1,children:[e.jsx(y,{container:!0,item:!0,xs:2,md:.8,className:"subtitle2",alignItems:"center",direction:"row",wrap:"nowrap",children:E&&e.jsx(Vr,{color:"secondary",onClick:x=>{u(r)}})}),e.jsx(y,{item:!0,xs:3,md:1,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(R,{variant:"subtitle1",children:r.TRA_NUMPAL})})}),e.jsx(y,{item:!0,xs:7,md:2,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(R,{variant:"subtitle1",children:r.TRA_SSCC})})}),e.jsx(y,{item:!0,xs:3.6,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_COLIS,m),Icon:e.jsx(Re,{fontSize:"large",uvc:"C"})})})}),e.jsx(y,{item:!0,xs:3.6,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_QUANTITE,0),Icon:e.jsx(Re,{fontSize:"large",uvc:"P"})})})}),e.jsx(y,{item:!0,xs:3.8,md:2.4,container:!0,alignItems:"center",children:e.jsx(T,{display:"flex",flexDirection:"column",children:e.jsx(Ue,{label:"",text:Ie(r.TRA_PDS_NET,f),Icon:e.jsx(Re,{fontSize:"large",uvc:"N"})})})}),e.jsx(y,{item:!0,xs:1,md:1,container:!0,alignItems:"center",children:e.jsx(Br,{color:"secondary",variant:"text","aria-label":"Select",onClick:x=>{x.stopPropagation(),i==null||i.onSelectPalette(r.TRA_NUMPAL),i==null||i.onClose()},size:"large"})})]})})}const pa={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:100}};function ha({CurrentNumPal:r,numSeq:t,recherche:n=null,paramsOptions:o,onSelect:a,onSelectPalette:l,onClose:c}){var m;const u=ca(t,n),i=qr(),s=((m=o.getParametreBorne("V2_ETIQ_PALETTE"))==null?void 0:m.USER_ZONE1)!=="N",d=w.useMemo(()=>({numSeq:t,CurrentNumPal:r,format:i,afficheImprimante:s,onSelectPalette:l,onClose:c}),[t,l,c,r]);return e.jsx(He,{onSelect:a,HeaderComponent:null,ItemMeasureCard:pa,ItemComponentProps:d,ItemComponent:Ca,disableFavorite:!0,state:u,IconComponent:ur,labelSearch:"SSCC"})}const xa=({numSeq:r,currentPalette:t,codeDepot:n,codeClient:o,codeArticle:a,onSelect:l,onClose:c})=>{const u=mt(),[i,s]=w.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{withAppBar:!1,isOpen:!!i,onCloseDialog:function(){s(null)},className:"",children:e.jsx(mr,{mode:ve.paletteSSCC,onClose:()=>s(null),clef:(i==null?void 0:i.TRA_NUMPAL)||0,codeDepot:n,codeClient:o,codeArticle:a})}),e.jsx(ha,{onSelect:function(d,m){s(d)},numSeq:r,onClose:c,CurrentNumPal:t||null,onSelectPalette:l,paramsOptions:u})]})};function ga(r,t){const n=Se(),o=Ke(["CountPrepaPaletteSscc",r],()=>K().CommunMethods().listPaletteSSCC({variables:{numSeq:r,context:n.current,recherche:{rbp:1}}}).then(a=>{var l;return((l=a.res)==null?void 0:l.itemsCount)||0}),{useErrorBoundary:!1,enabled:!!r&&t,refetchInterval:3e3});return{nbPalette:o.data,error:o.error,refetchPalette:o.refetch}}function Ta(r,t){const n=Se(),o=Ke(["CountPeseePreparation",r],()=>K().PrepaMethods().ListePeseePreparation({variables:{lotSeq:r,context:n.current,recherche:{rbp:1}}}).then(a=>{var l;return((l=a.res)==null?void 0:l.itemsCount)||0}),{useErrorBoundary:!1,enabled:!!r&&t,refetchInterval:3e3});return{nbPesee:o.data,error:o.error,refetch:o.refetch}}const Pa=r=>{const t=oo(),n=Ge(),o=Se(),{imprimanteColis:a,imprimantePalette:l,imprimanteBl:c}=it(r),u={imprimanteBL:c,imprimantePalette:l},i=so({mutationFn:d=>(t.showModalWaitLock(),d.lotSeq!=null?K().PrepaMethods().LigneReliquat((o==null?void 0:o.current)||null,d.numSeq,d.dateEnlevement,d.lotSeq,d.dateCommande,d.dateLivraison,d.listManquants.length>0?"M":"R",u):K().PrepaMethods().FinPreparationCommande((o==null?void 0:o.current)||null,d.numSeq,d.dateEnlevement,u,d.dateCommande,d.dateLivraison,d.listManquants)),onSettled(d,m,f,E){t.closeModalWaitLock(),m&&n.errorMessage(k("errorMessage"))}});return{onFinPreparationCommandeReliquat:(d,m)=>{i.mutate(d,{onSettled(f,E,x,P){E&&m({codeResult:"ERR_NETWORK",result:null})},onSuccess(f,E,x){var P,v;(f.err||((P=f.res)==null?void 0:P.codeResult)!=="OK")&&n.errorMessage(k(((v=f.res)==null?void 0:v.codeResult)||"errorMessage")),m(f.res)}})}}};function nn({hasPrevious:r,hasNext:t,onPrevious:n,onNext:o,variant:a="contained",color:l="secondary"}){return e.jsxs(e.Fragment,{children:[e.jsx(re,{size:"large",className:"grid-actions",color:l,variant:a,disabled:!r,onClick:n,children:e.jsx(ao,{fontSize:"inherit"})}),e.jsx(re,{size:"large",className:"grid-actions",color:l,variant:a,disabled:!t,onClick:o,children:e.jsx(io,{fontSize:"inherit"})})]})}const _a={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:120,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:70}};function Sa(r,t){var n,o,a;return{VEN_LOT_SEQ:r.VEN_LOT_SEQ,ART_CODE:((n=r.Article)==null?void 0:n.ART_CODE)||"",ART_LIB1:((o=r.Article)==null?void 0:o.ART_LIB1)||"",ART_STAT_IMAGE:((a=r.Article)==null?void 0:a.ART_STAT_IMAGE)||null,unite:lo(r.VEN_UNIT_CDE||""),quantityPrepare:r.TotalUCPrepare||0,quantityCommande:r.TotalUCAPreparer||0,UC:r.VEN_UNIT_CDE||"",modeManquant:t,art:r.Article}}const La=({style:r,item:t,ItemComponentProps:n})=>{var m,f,E,x,P,v,_;dt(t.UC,n.format);const{VEN_LOT_SEQ:o,quantityPrepare:a,quantityCommande:l,unite:c,modeManquant:u,ART_CODE:i,ART_LIB1:s,ART_STAT_IMAGE:d}=t;return e.jsxs(Ct,{style:r,disabledBtDel:!0,sx:{display:"grid",gridTemplateColumns:{sm:"1fr",md:"repeat(6, minmax(0, 1fr))"},justifyContent:"space-between",alignItems:"center",gridTemplateAreas:{xs:` "art art art art btns btns" 
                "art art art art btns btns"
                "qte qte qte qte btns btns"
                `,md:' "btns btns art art art qte"'}},children:[e.jsx(T,{gridArea:"btns",children:e.jsx(Io,{ManquantReliquat:u,onChangeManquantReliquat:h=>{n==null||n.onChange(o,h)}})}),e.jsx(T,{display:"flex",gridArea:"art",alignItems:"center",className:"article",sx:{m:1},children:e.jsxs(T,{display:"flex",flexDirection:"column",sx:{overflow:"hidden"},children:[e.jsxs(T,{display:"flex",alignItems:"center",columnGap:.4,children:[e.jsx(Nr,{field:"ART_CODE",typoProps:{noWrap:!0,variant:"subtitle2",color:"textPrimary"},content:(m=t.art)==null?void 0:m.ART_CODE,matchSearch:(f=t._properties)==null?void 0:f.matchSearch}),!!((E=t.art)!=null&&E.ART_PAYS)&&((x=t.art)==null?void 0:x.ART_PAYS)!=="0"&&e.jsx(mo,{svg:!0,countryCode:(P=t.art)==null?void 0:P.ART_PAYS})]}),e.jsx(Nr,{field:"ART_LIB1",typoProps:{noWrap:!0},content:(v=t.art)==null?void 0:v.ART_LIB1,matchSearch:(_=t._properties)==null?void 0:_.matchSearch})]})}),e.jsxs(R,{gridArea:"qte",sx:{fontWeight:800,color:"#f50057"},variant:"h6",children:[a," / ",l," ",c]})]})};function Aa({details:r,onChange:t,onSave:n,onClose:o}){const a=Et(),[l,c]=w.useState(Rt(new Date)),[u,i]=w.useState(Rt(new Date)),s=Ge(),{t:d}=de(),m=w.useRef(),f=Fr("DetailReliquat",r),{hasNext:E,hasPrevious:x,onPrevious:P,onNext:v}=wr(f.rowPosition,m);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{container:!0,children:[e.jsxs(y,{item:!0,xs:6,md:6,children:[e.jsx(R,{variant:"h6",sx:{margin:"auto",textAlign:"center",color:"info.main",userSelect:"none"},children:d("orderDate")}),e.jsx(Zt,{readOnlyDate:!1,onChange:c,date:l})]}),e.jsxs(y,{item:!0,xs:6,md:6,justifyContent:"center",children:[e.jsx(R,{variant:"h6",sx:{margin:"auto",textAlign:"center",color:"info.main",userSelect:"none"},children:d("deliveryDate")}),e.jsx(Zt,{readOnlyDate:!1,onChange:i,date:u})]})]}),e.jsxs(T,{display:"flex",flexDirection:"column",sx:{m:1,flex:1,overflow:"auto"},children:[e.jsx(He,{HeaderComponent:null,onSelect:()=>{},ref:m,state:f,ItemMeasureCard:_a,ItemComponent:La,ItemComponentProps:{format:a,onChange:t},labelSearch:"",disableFavorite:!0,disableSort:!0,disableBottom:!0,disableAdvanced:!0,placeholderSearch:""}),e.jsx(os,{mdDown:!0,children:e.jsx(T,{gridArea:"scan",flexDirection:"row",display:"flex",sx:{gap:.5,pt:1,px:1},children:e.jsx(nn,{hasPrevious:x,hasNext:E,onPrevious:P,onNext:v})})})]}),e.jsx(T,{display:"flex",gap:1,children:e.jsx(co,{onSave:function(){try{Ar(l)&&Ar(u)&&(uo(Gt(l),Gt(u),"date")?n({dateCommande:Be(l),dateLivraison:Be(u)}):s.errorMessage(d("invalidDate")))}catch{}},onClose:function(){o()}})})]})}function vt({operationId:r,mode:t,VEN_NUMSEQ:n,dateEnl:o,VEN_LOT_SEQ:a,codeArticle:l,onCloseCommande:c,onOpenEditionPreparation:u,onChangeStep:i}){var P;const{onFinPreparationCommandeReliquat:s}=Pa(r),d=Se(),m=xs(d,n,a,!0),[f,E]=w.useState([]),x=Ze();return w.useEffect(()=>{var v,_;if(!m.isLoading){const h=D.map((_=(v=m.data)==null?void 0:v.res)==null?void 0:_.result,M=>Sa(M,"R"));E(h)}},[m.isLoading,m.data,E]),m.isLoading?e.jsx(ot,{}):(m.isLoading===!1&&(m.error||(P=m.data)!=null&&P.err)&&c(),e.jsx(Aa,{details:f,onClose:c,onSave:function(v){const _={dateEnlevement:o?Be(o):null,dateCommande:v.dateCommande,dateLivraison:v.dateLivraison,numSeq:n,lotSeq:a||null,listManquants:D.map(D.filter(f,h=>h.modeManquant==="M"),h=>h.VEN_LOT_SEQ),codeArticle:l};s(_,h=>{(h==null?void 0:h.codeResult)==="OK"&&(t===ue.PREPACLIENT?h.result===1&&a===0||h.result===2?x.invalidateQueries({queryKey:["PreparationsClient"]}).then(()=>{i(G.LISTPREPARATIONS)}):x.invalidateQueries({queryKey:[Me,_.numSeq]}).then(()=>{i(G.DETAILS)}):x.invalidateQueries({queryKey:[Ve,_.codeArticle]}).then(()=>{i(G.DETAILS)}))})},onChange:function(v,_){E(h=>D.map(h,M=>M.VEN_LOT_SEQ===v?{...M,modeManquant:_}:M))}}))}const on=({detail:r,onClose:t})=>{const n=De(at()),{VEN_CDE:o,VEN_COM_PREPA:a,VEN_COM_PREPA2:l,VEN_COM_BL:c,VEN_COM_BL2:u,VEN_COMMENT:i}=r,{commentPrepa:s,commentPrepa2:d,commentBl:m,commentBl2:f,commentLine:E}=n.operation,x=n.getParametreBorneZone1("V2_SAI_COMM"),[P,v]=w.useState({comPrepa1:s??a,comPrepa2:d??l,comBL1:m??c,comBL2:f??u,comLigne:E??i}),_=(M,H)=>{v(N=>({...N,[M]:H}))};function h(){x&&n.actions.updatePreparation({commentPrepa:P.comPrepa1,commentPrepa2:P.comPrepa2,commentBl:P.comBL1,commentBl2:P.comBL2,commentLine:P.comLigne}),t()}return e.jsx(sn,{client:r.Client,venCommande:o,article:r.Article,modifCommentaire:x,comments:P,handleUpdate:_,onClose:t,handleClick:h})},Na=({detail:r,onClose:t})=>{const n=De(at()),{commentPrepa:o,commentPrepa2:a,commentBl:l,commentBl2:c,commentLine:u}=n.operation,i=n.getParametreBorneZone1("V2_SAI_COMM"),[s,d]=w.useState({comPrepa1:o??r.commentPrepa1,comPrepa2:a??r.commentPrepa2,comBL1:l??r.commentBL1,comBL2:c??r.commentBL2,comLigne:u??r.comment}),m=(E,x)=>{d(P=>({...P,[E]:x}))};function f(){i&&n.actions.updatePreparation({commentPrepa:s.comPrepa1,commentPrepa2:s.comPrepa2,commentBl:s.comBL1,commentBl2:s.comBL2,commentLine:s.comLigne}),t()}return e.jsx(sn,{client:r.client,venCommande:r.numOrder,article:r.article,comments:s,modifCommentaire:i,handleUpdate:m,handleClick:f,onClose:t})},sn=({client:r,venCommande:t,article:n,comments:o,onClose:a,modifCommentaire:l,handleClick:c,handleUpdate:u})=>e.jsxs(e.Fragment,{children:[r&&e.jsxs(y,{container:!0,columnSpacing:1,sx:{marginTop:1,paddingLeft:1,paddingRight:1},children:[e.jsx(y,{item:!0,xs:7,children:e.jsx(Ne,{title:r.CLI_CODE,subTitle:r.CLI_NOM,disabled:!0,IconComponent:e.jsx(ee,{icon:"FOURNISSEUR"}),className:"fournisseur"})}),e.jsx(y,{item:!0,xs:5,children:e.jsx(Ne,{title:"Numero de commande",subTitle:t,disabled:!0,IconComponent:e.jsx(ee,{icon:"TRACA"}),className:"numero"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{className:"headerLine article",title:n==null?void 0:n.ART_CODE,subTitle:n==null?void 0:n.ART_LIB1,disabled:!0,IconComponent:e.jsx(ft,{codeStat:(n==null?void 0:n.ART_STAT_IMAGE)||null})})})]}),e.jsxs(y,{container:!0,display:"flex",flexDirection:"row",gap:1,sx:{marginTop:1,paddingLeft:1,paddingRight:1},children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(Ne,{title:"Commentaire Bon préparation",subTitle:"",IconComponent:e.jsx(ee,{icon:"COMMENTAIRE"}),className:"numero",disabled:!l,children:[e.jsx(ut,{color:"secondary",variant:"standard",name:"VEN_COM_PREPA",type:"text",InputLabelProps:{shrink:!0},value:o.comPrepa1,onChange:i=>{u("comPrepa1",i.target.value)},fullWidth:!0,autoComplete:"off",readOnly:!l,disabled:!l}),e.jsx(ut,{color:"secondary",variant:"standard",name:"VEN_COM_PREPA2",type:"text",InputLabelProps:{shrink:!0},value:o.comPrepa2,onChange:i=>{u("comPrepa2",i.target.value)},fullWidth:!0,autoComplete:"off",readOnly:!l,disabled:!l})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(Ne,{title:"Commentaire Bon de livraison",subTitle:"",IconComponent:e.jsx(ee,{icon:"COMMENTAIRE"}),className:"numero",disabled:!l,children:[e.jsx(ut,{color:"secondary",variant:"standard",name:"VEN_COM_BL",type:"text",InputLabelProps:{shrink:!0},value:o.comBL1,onChange:i=>{u("comBL1",i.target.value)},fullWidth:!0,autoComplete:"off",readOnly:!l,disabled:!l}),e.jsx(ut,{color:"secondary",variant:"standard",name:"VEN_COM_BL2",type:"text",InputLabelProps:{shrink:!0},value:o.comBL2,onChange:i=>{u("comBL2",i.target.value)},fullWidth:!0,autoComplete:"off",readOnly:!l,disabled:!l})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{title:"Commentaire Ligne",subTitle:"",IconComponent:e.jsx(ee,{icon:"COMMENTAIRE"}),className:"numero",disabled:!l,children:e.jsx(ut,{color:"secondary",variant:"standard",name:"VEN_COMMENT_PREPA",type:"text",InputLabelProps:{shrink:!0},value:o.comLigne,onChange:i=>{u("comLigne",i.target.value)},fullWidth:!0,autoComplete:"off",readOnly:!l,disabled:!l})})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(Wr,{sx:{justifyContent:"center"},children:[e.jsx(bt,{color:"error",size:"large",variant:"contained",onClick:i=>{a()}}),l&&!!c&&e.jsx($t,{variant:"contained",color:"success",size:"large",onClick:i=>{c()}})]})})]})]}),Ra=({operationId:r,detail:t,onClose:n,mode:o})=>{var ie,ne,ae,$,pe,he,Le,Te,Oe,g;const{t:a}=de(),l=je(),c=Ze(),u=Se(),[i,s]=w.useState({modalFor:""}),[d,m]=w.useState(!0),f=De(r),E=mt(),{onCancelLine:x}=gs(r,u),{nbPesee:P}=Ta(t.VEN_LOT_SEQ,d),{nbPalette:v}=ga(t.VEN_NUMSEQ,d),{nbColis:_}=ua(t.VEN_NUMSEQ,d),h=rn(u,t.VEN_NUMSEQ),M=tn(u,t.VEN_NUMSEQ),H=((ie=f.operation.paletteSsccPrepa)==null?void 0:ie.CurrentPalette)==null?(ne=h.data)==null?void 0:ne.res:(ae=f.operation.paletteSsccPrepa)==null?void 0:ae.CurrentPalette,N=(($=f.operation.colisSsccPrepa)==null?void 0:$.CurrentColis)==null?(pe=M.data)==null?void 0:pe.res:(he=f.operation.colisSsccPrepa)==null?void 0:he.CurrentColis,F=((Le=E.getParametreBorne("V2_COLISPALETTE_SSCC"))==null?void 0:Le.USER_ZONE1)||"0",X=F===Pe.colisPaletteSSCC||F===Pe.colisSscc,L=F===Pe.colisPaletteSSCC||F===Pe.paletteSSCC;E.getParametreBorneZone1("V2_RELIQUAT");const O=t.VEN_ETAT_PREP===_e.manquant||t.VEN_ETAT_PREP===_e.reliquat||t.VEN_ETAT_PREP===_e.rupture,Q=()=>{s({modalFor:""}),m(!0)},me=async()=>{await l.showConfirmation({title:"confirmCancelPreparation",message:"confirmCancelPreparationBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&x(t.VEN_LOT_SEQ,A=>{var W;(A==null?void 0:A.codeResult)==="OK"&&(F===Pe.paletteSSCC&&H!=(A==null?void 0:A.result.paletteSscc)&&f.actions.onSelectPalette(A==null?void 0:A.result.paletteSscc),(F===Pe.colisPaletteSSCC||F===Pe.colisSscc)&&N!=(A==null?void 0:A.result.colisSscc)&&f.actions.onSelectColis(A==null?void 0:A.result.colisSscc,A==null?void 0:A.result.paletteSscc),o===ue.PREPACLIENT?c.invalidateQueries({queryKey:[Me,t.VEN_NUMSEQ]}):c.invalidateQueries({queryKey:[Ve,(W=t.Article)==null?void 0:W.ART_CODE]}),c.invalidateQueries({queryKey:[yt,u.getQueryKey(),t.VEN_LOT_SEQ]}).then(()=>{n()}))})};return e.jsxs(T,{sx:{p:2},children:[e.jsxs(ke,{dialogProps:{maxWidth:"md",fullWidth:!0,fullScreen:D.includes(["PESEEPREPARATION","COMMENTS","PACKAGESSCC","PALETTESSCC","RELIQUAT"],i.modalFor)},withAppBar:!0,isOpen:!!i.modalFor,onCloseDialog:Q,i8ntitle:st(a,i.modalFor),className:"",children:[i.modalFor==="PRINTERSETTINGS"&&e.jsx(e.Fragment,{children:e.jsx(Zr,{detail:t,onClose:Q})}),i.modalFor==="COMMENTS"&&e.jsx(e.Fragment,{children:e.jsx(on,{detail:t,onClose:Q})}),i.modalFor==="PACKAGESSCC"&&e.jsx(e.Fragment,{children:e.jsx(fa,{numSeq:t.VEN_NUMSEQ,currentColis:N||0,codeDepot:t.Transactions[0].TRA_CODE_DEPOT||"",codeClient:t.Client.CLI_CODE,codeArticle:((Te=t.Article)==null?void 0:Te.ART_CODE)||"",onSelect:f.actions.onSelectColis,onClose:Q})}),i.modalFor==="PALETTESSCC"&&e.jsx(e.Fragment,{children:e.jsx(xa,{numSeq:t.VEN_NUMSEQ,currentPalette:H||0,codeDepot:t.Transactions[0].TRA_CODE_DEPOT||"",codeClient:t.Client.CLI_CODE,codeArticle:((Oe=t.Article)==null?void 0:Oe.ART_CODE)||"",onSelect:f.actions.onSelectPalette,onClose:Q})}),i.modalFor==="PESEEPREPARATION"&&e.jsx($r,{operationId:r,venLotSeq:t.VEN_LOT_SEQ,displayBtDelete:!0,codeDepot:t.Transactions[0].TRA_CODE_DEPOT||"",codeClient:t.Client.CLI_CODE,codeArticle:((g=t.Article)==null?void 0:g.ART_CODE)||""}),i.modalFor==="RELIQUAT"&&e.jsx(T,{sx:{maxWidth:"lg",margin:"auto",height:"100%",display:"flex",flexDirection:"column"},children:e.jsx(vt,{onCloseCommande:Q,VEN_NUMSEQ:t.VEN_NUMSEQ,dateEnl:f.operation.date||null,VEN_LOT_SEQ:t.VEN_LOT_SEQ,onOpenEditionPreparation:()=>{},onChangeStep:f.actions.onChangeStep,mode:f.operation.mode,operationId:r})})]}),e.jsxs(y,{container:!0,marginY:1,spacing:2,children:[L&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{startIcon:e.jsx(At,{badgeContent:v,color:"secondary",children:e.jsx(ee,{icon:"LIST"})}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{m(!1),s({modalFor:"PALETTESSCC"})},children:a("listPaletSSCC")})}),X&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{startIcon:e.jsx(At,{badgeContent:_,color:"secondary",children:e.jsx(ee,{icon:"LIST"})}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{m(!1),s({modalFor:"PACKAGESSCC"})},children:a("listPackageSSCC")})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{m(!1),s({modalFor:"PRINTERSETTINGS"})},children:a("printerSettings")})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{startIcon:e.jsx(At,{badgeContent:P,color:"secondary",children:e.jsx(ee,{icon:"LIST"})}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{m(!1),s({modalFor:"PESEEPREPARATION"})},disabled:O,children:a("listWeight")})}),L&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{f.actions.onClosePalette(),n()},children:a("endPallet")})}),X&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{f.actions.onCloseColis(),n()},children:a("endPackage")})}),e.jsx(y,{item:!0,xs:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{m(!1),s({modalFor:"COMMENTS"})},children:a("com")})}),e.jsx(y,{item:!0,xs:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,disabled:O,onClick:j=>{m(!1),s({modalFor:"RELIQUAT"})},children:a("reliquat")})}),e.jsx(y,{item:!0,xs:3,children:e.jsx(re,{size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:j=>{j.stopPropagation(),me()},children:a("cancelPreparation")})}),e.jsx(T,{sx:{width:"100%"}}),e.jsx(y,{item:!0,xs:12,children:e.jsx(bt,{color:"error",size:"large",variant:"contained",onClick:j=>{n()}})})]})]})};function Oa({operationId:r,client:t,resetLine:n,affichePalette:o,afficheEmballage:a,poidsObligatoire:l,colisOrPaletteSSCC:c,peseeSuplementaire:u,emballage:i,palette:s,lotId:d,mouvement:m,codeArticleLot:f,actions:E,recalculationQuantity:x,unitRecalcul:P,lotAuto:v,behaviorLotUndefined:_,mode:h,isPreparationClient:M,currentColis:H,currentPalette:N,gereReliquat:F,dateEnlevement:X,detail:L,...O}){var xr,gr;const Q=Eo(),{onPreparationPeseeSup:me,onTerminateLine:ie,retourTerminateLine:ne,onScanLotCodeBarreEan128:ae,handleScanLecturePreparationEan128:$,handleErrorScan:pe}=lt(r),{imprimantePalette:he,imprimanteColis:Le,nbExemplaireColis:Te,nbExemplairePalette:Oe,onPrintEtiquetteColisPaletteSscc:g,isPrinting:j,affichageImprimanteColis:A,editionPalette:W}=it(r),Y=Ze(),q=Se(),{t:U}=de();w.useRef(!1);const ht=w.useRef(null),C=Ge(),p=je(),S=Et("VENTE"),[b,V]=w.useState({modalFor:L.VEN_COM_BL||L.VEN_COM_PREPA||L.VEN_COMMENT?"COMMENTS":""}),[z,le]=fo("panelExpandedReception","",!1,"SCALAR"),se=()=>{V({modalFor:"",emballageOuPalette:null})},J=w.useCallback(async()=>{const I=await p.showInfiniteSearch({title:"emballageSelection",type:"Emballages",props:{},dialogProps:{fullScreen:!0}});I!=null&&V({modalFor:"Emballages",emballageOuPalette:I})},[V,p.showInfiniteSearch]),xe=w.useCallback(async()=>{const I=await p.showInfiniteSearch({title:"palettSelection",type:"Palettes",props:{},dialogProps:{fullScreen:!0}});I!=null&&V({modalFor:"Palettes",emballageOuPalette:I})},[V,p.showInfiniteSearch]),ze=w.useCallback((I,Z)=>{var te,Ee;E.updateQuantityPreparation(I,Z,{poidsColisMoyen:((te=L.Article)==null?void 0:te.ART_PDS_NET)||null,pieceParColisMoyen:((Ee=L.Article)==null?void 0:Ee.ART_PIECE_COL)||null,poidsPieceMoyen:1,uniteCommande:L.VEN_UNIT_CDE||"",SIT_VE_RECALCUL_UNITES:x,SIT_VE_FORMAT_COLIS:S.formatColis,SIT_VE_FORMAT_POIDS:S.formatPoids,unitRecalcul:P,articlePoidsVariable:!0},M)},[L]),Ae=w.useCallback(I=>{V({modalFor:"Emballages",emballageOuPalette:I})},[]),xt=w.useCallback(I=>{V({modalFor:"Palettes",emballageOuPalette:I})},[s]),ct=I=>(Z,te)=>{le(te?I:" ")};let oe;const We=async()=>{var Z;const I=await p.showInputText({i8ntitle:"Lot",dialogProps:{maxWidth:"md",fullWidth:!1},props:{}});I&&Xt(q.current||null,L.VEN_NUMSEQ,((Z=L.Article)==null?void 0:Z.ART_CODE)||"",L.Transactions[0].TRA_CODE_DEPOT||"",I,gt).then(te=>{var Ee,B;(((Ee=te.res)==null?void 0:Ee.itemsCount)||0)>1?E.updatePreparation({modalFor:"LOT",numSeqModal:L.VEN_NUMSEQ,numLotSeqModal:L.VEN_LOT_SEQ,CbModal:{error:!1,codeError:"",result:{lotSeq:L.VEN_LOT_SEQ,lot:I}}}):(oe=(B=te.res)==null?void 0:B.result[0],oe?K().PrepaMethods().PreparationControleMouvement(q.current||null,L.VEN_NUMSEQ,L.VEN_LOT_SEQ||0,oe.LOT,"").then(async ce=>{var Je,Tr,Pr,_r;ce&&!ce.err&&!((Je=ce.res)!=null&&Je.error)?E.updatePreparation({lotId:oe==null?void 0:oe.LOTID,lot:oe==null?void 0:oe.LOT,codeArticleLot:oe==null?void 0:oe.Article.ART_CODE}):((Tr=ce.res)==null?void 0:Tr.codeError)==="ERR_DLC_MINI_NONBLOQUANT"?await p.showConfirmation({title:"confirmTitle",message:U((Pr=ce.res)==null?void 0:Pr.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&E.updatePreparation({lotId:oe==null?void 0:oe.LOTID,lot:oe==null?void 0:oe.LOT,codeArticleLot:oe==null?void 0:oe.Article.ART_CODE}):E.messages.errorMessage(U(((_r=ce.res)==null?void 0:_r.codeError)||"invalidBarcode"))}):C.errorMessage(U("lot").concat(" ",I," ",U("inconnu"))))})},Xe=()=>{switch(L.VEN_UNIT_CDE){case"C":if(O.colis===L.VEN_CDE)return!0;break;case"N":if(O.poids===L.VEN_CDE)return!0;break;case"P":if(O.piece===L.VEN_CDE)return!0;break;default:return!1}return!1},Er=async()=>{if(!D.isEmpty(Ut)){const Z=D.head(Ut);return p.showError({i8nmessage:U(Z.err,Z.variables||{}),i8ntitle:U("error"),dialogProps:{maxWidth:"md",fullWidth:!0}}),!1}if((v||(Ce==null?void 0:Ce.ART_STOCK)==="S")&&_.USER_ZONE1==="O"){if(oe)return!0;switch(_.USER_ZONE2){case"2":var I=await p.showConfirmation({title:"confirmLotUndefined",message:"confirmLotUndefinedBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}});return I;case"3":return p.showError({i8nmessage:U("lotUndefinedError"),i8ntitle:U("error"),dialogProps:{maxWidth:"md",fullWidth:!0}}),!1}}return!0},fr=async(I=!1)=>{var te,Ee;if(!I&&await Er()===!1)return;const Z={VEN_NUMSEQ:L.VEN_NUMSEQ,VEN_DATE_ENL:X?Be(X):null,VEN_CLIENT:L.Client.CLI_CODE,VEN_COM_PREPA:L.VEN_COM_PREPA,VEN_COM_PREPA2:L.VEN_COM_PREPA2,VEN_COM_BL:L.VEN_COM_BL,VEN_COM_BL2:L.VEN_COM_BL2,Depot:L.Transactions[0].TRA_CODE_DEPOT||"",Dsd:O.dsd,ColisSscc:H||0,PaletteSscc:N,Details:[{VEN_LOT_SEQ:L.VEN_LOT_SEQ,VEN_ART_CODE:(te=L.Article)==null?void 0:te.ART_CODE,VEN_UNIT_VE:L.VEN_UNIT_VE,Transactions:[{TRA_LOT_SEQ:L.VEN_LOT_SEQ,TRA_LOT:m,TRA_COLIS_LIV:O.colis,TRA_QUANTITE_LIV:O.piece,TRA_PDS_NET_LIV:O.poids,TRA_PDS_BRUT_LIV:O.poidsBrut,TRA_CODART_AFF:f||((Ee=L.Article)==null?void 0:Ee.ART_CODE)}]}]};me(Z,B=>{var ce,Je;(B==null?void 0:B.codeResult)==="OK"&&(c===Pe.paletteSSCC&&N!=(B==null?void 0:B.result.paletteSscc)&&E.onSelectPalette(B==null?void 0:B.result.paletteSscc),(c===Pe.colisPaletteSSCC||c===Pe.colisSscc)&&H!=(B==null?void 0:B.result.colisSscc)&&E.onSelectColis(B==null?void 0:B.result.colisSscc,B==null?void 0:B.result.paletteSscc),(B==null?void 0:B.result.result)===0?(h===ue.PREPACLIENT?Y.invalidateQueries({queryKey:[Me,L.VEN_NUMSEQ]}):Y.invalidateQueries({queryKey:[Ve,(ce=L.Article)==null?void 0:ce.ART_CODE]}),Y.invalidateQueries({queryKey:[yt,q.getQueryKey(),L.VEN_LOT_SEQ]}).then(()=>{E.addWeight()})):h===ue.PREPACLIENT?(B==null?void 0:B.result.result)===1||(B==null?void 0:B.result.result)===3?Y.invalidateQueries({queryKey:[Me,L.VEN_NUMSEQ]}).then(()=>{E.onClosePreparationLine(L.VEN_NUMSEQ,L.VEN_CDE,G.DETAILS)}):(B==null?void 0:B.result.result)===2&&Y.invalidateQueries({queryKey:["PreparationsClient"]}).then(()=>{E.onClosePreparationLine(L.VEN_NUMSEQ,L.VEN_CDE,G.LISTPREPARATIONS)}):Y.invalidateQueries({queryKey:[Ve,(Je=L.Article)==null?void 0:Je.ART_CODE]}).then(()=>{E.onChangeStep(G.DETAILS)}))})},un=async()=>{if(await Er()===!1)return;let I=!1;O.colis>0&&(I=await p.showConfirmation({title:"confirmAddPeseePrepaLine",message:"confirmAddPeseePrepaLineBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}}),I&&fr(!0));const Z=Xe();F&&(I&&Z?!1:pr>0)?V({modalFor:"RELIQUAT"}):await p.showConfirmation({title:"confirmPrepaLine",message:"confirmPrepaLineBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&ie({dateEnl:X?Be(X):null,lotSeq:L.VEN_LOT_SEQ},B=>{var ce;(B==null?void 0:B.codeResult)==="OK"&&ne(h,B==null?void 0:B.result,L.VEN_NUMSEQ,Y,(ce=L.Article)==null?void 0:ce.ART_CODE)})},{colisCde:dn,quantiteCde:mn,poidsNetCde:En,colisLiv:fn,quantiteLiv:Cn,poidsNetLiv:pn}=Ts(L),Mt=dn-fn,Vt=mn-Cn,Bt=En-pn,{Client:Ye,Article:Ce,VEN_CDE:Cr}=L,gt=L.VEN_UNIT_CDE,wt=L.VEN_UNIT_VE,hn=L.VEN_ETAT_PREP===_e.manquant||L.VEN_ETAT_PREP===_e.reliquat||L.VEN_ETAT_PREP===_e.rupture,pr=gt==="C"?Mt:gt==="P"?Vt:Bt,Ut=(()=>{var Ee;const I=[],Z=B=>+B<0,te=(B,ce=null)=>I.push({err:B,variables:ce});return l&&Z(O.poids||-1)&&te("ERR_POIDS_NR"),(Z(O.colis)||wt==="C"&&!O.colis)&&te("ERR_QTE_COLIS",{colis:O.colis}),(Z(O.poids)||D.includes(["N","K"],wt)&&!O.poids)&&te("ERR_QTE_POIDS",{poids:O.poids}),(Z(O.piece)||wt==="P"&&!O.piece)&&te("ERR_QTE_PIECE",{piece:O.piece}),((Ee=L.Article)==null?void 0:Ee.ART_STOCK)==="L"&&!m&&te("ERR_LOT_MUSTBESET"),I})(),xn=I=>D.some(Ut,Z=>Z.err===I),hr=I=>I==="VALIDATE"?!hn&&pr>0:!0,gn=I=>{var te,Ee;if((I==="P"?N:H)===0)return;const Z={codeEtiquette:I==="P"?"PAL_SSCC":"COLIS_SSCC_ENT",clef:I==="P"?N:H,nombreExemplaire:I==="P"?Oe:Te,imprimante:I==="P"?he||"":Le||"",codeDepot:L.Transactions[0].TRA_CODE_DEPOT,codeClient:L.Client.CLI_CODE,codeArticle:(te=L.Article)==null?void 0:te.ART_CODE};if(I==="P"&&H>0){const B={codeEtiquette:"COLIS_SSCC_ENT",clef:H,nombreExemplaire:Te,imprimante:Le||"",codeDepot:L.Transactions[0].TRA_CODE_DEPOT,codeClient:L.Client.CLI_CODE,codeArticle:(Ee=L.Article)==null?void 0:Ee.ART_CODE};g(B,ce=>{(ce==null?void 0:ce.Result)==="OK"&&C.successMessage(U("changeSsccPackage"))})}I==="P"&&W==="P"||I==="C"&&A?Z.nombreExemplaire==0?C.errorMessage(U("paramEdition")):g(Z,B=>{(B==null?void 0:B.Result)==="OK"&&(I==="P"?(E.onClosePalette(),C.successMessage(U("changeSsccPalett"))):(E.onCloseColis(),C.successMessage(U("changeSsccPackage"))))}):I==="P"?(E.onClosePalette(),C.successMessage(U("changeSsccPalett"))):(E.onCloseColis(),C.successMessage(U("changeSsccPackage")))};return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{dialogProps:{maxWidth:"md",fullWidth:!0,fullScreen:D.includes(["TRACA","FRN","ART","LOT","PESEE","RELIQUAT"],b.modalFor)},withAppBar:!0,isOpen:!!b.modalFor,onCloseDialog:se,i8ntitle:st(U,b.modalFor),className:"",children:[(b.modalFor==="Palettes"||b.modalFor==="Emballages")&&e.jsx(jo,{mode:b.modalFor,onClose:se,emballage:b.emballageOuPalette,quantity:b.modalFor==="Emballages"?O.colis:(s==null?void 0:s.quantity)||1,onSave:function(I,Z,te){b.modalFor==="Palettes"?E.updatePalette({...I,poids:Z,quantity:te}):E.updateEmballage({...I,poids:Z,quantity:te}),se()}}),b.modalFor==="FRN"&&e.jsx(Fe,{type:"ClientsMeca",onSelect:function(I){E.updatePreparation({client:I}),se()}}),b.modalFor==="TOOLS"&&e.jsx(Ra,{detail:L,onClose:()=>se(),operationId:r,mode:h}),b.modalFor==="COMMENTS"&&e.jsx(e.Fragment,{children:e.jsx(on,{detail:L,onClose:()=>se()})}),b.modalFor==="LOT"&&e.jsx(Fe,{type:"LotsPreparation",componentProps:{numSeq:L.VEN_NUMSEQ,codeArticle:((xr=L.Article)==null?void 0:xr.ART_CODE)||"",codeDepot:L.Transactions[0].TRA_CODE_DEPOT||"",lot:"",uc:gt},onSelect:function(I){se(),K().PrepaMethods().PreparationControleMouvement(q.current||null,L.VEN_NUMSEQ,L.VEN_LOT_SEQ||0,I.LOT,"").then(async Z=>{var te,Ee,B,ce;Z&&!Z.err&&!((te=Z.res)!=null&&te.error)?E.updatePreparation({lotId:I.LOTID,lot:I.LOT,codeArticleLot:I.Article.ART_CODE}):((Ee=Z.res)==null?void 0:Ee.codeError)==="ERR_DLC_MINI_NONBLOQUANT"?await p.showConfirmation({title:"confirmTitle",message:U((B=Z.res)==null?void 0:B.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&E.updatePreparation({lotId:I.LOTID,lot:I.LOT,codeArticleLot:I.Article.ART_CODE}):E.messages.errorMessage(U(((ce=Z.res)==null?void 0:ce.codeError)||"invalidBarcode"))})}}),b.modalFor==="RELIQUAT"&&e.jsx(T,{sx:{maxWidth:"lg",margin:"auto",height:"100%",display:"flex",flexDirection:"column"},children:e.jsx(vt,{operationId:r,VEN_NUMSEQ:L.VEN_NUMSEQ,dateEnl:X,VEN_LOT_SEQ:L.VEN_LOT_SEQ,mode:h,codeArticle:(gr=L.Article)==null?void 0:gr.ART_CODE,onOpenEditionPreparation:()=>{},onChangeStep:E.onChangeStep,onCloseCommande:se})})]}),e.jsxs(y,{container:!0,columnSpacing:.5,rowSpacing:.2,children:[e.jsx(y,{item:!0,xs:7,children:e.jsx(Ne,{title:Ye==null?void 0:Ye.CLI_CODE,subTitle:Ye==null?void 0:Ye.CLI_NOM,disabled:!0,IconComponent:e.jsx(ee,{icon:"FOURNISSEUR"}),className:"fournisseur"})}),e.jsx(y,{item:!0,xs:5,children:e.jsx(Ne,{title:"Numero de commande",subTitle:Cr>0?Cr:"toBeDetermined",disabled:!0,IconComponent:e.jsx(ee,{icon:"TRACA"}),className:"numero"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{className:"headerLine article",title:Ce==null?void 0:Ce.ART_CODE,subTitle:Ce==null?void 0:Ce.ART_LIB1,disabled:!0,IconComponent:e.jsx(ft,{codeStat:(Ce==null?void 0:Ce.ART_STAT_IMAGE)||null})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Ne,{className:"headerLine commentaire",title:U("comment"),subTitle:L.VEN_COM_PREPA,disabled:!0,IconComponent:e.jsx(ee,{icon:"COMMENTAIRE"})})})]}),e.jsx(T,{sx:{flex:1,flexGrow:100},children:e.jsxs(T,{sx:{height:"100%",maxWidth:"lg",overflow:"auto",mx:"auto",flex:1,flexGrow:100,position:"relative",display:"grid",gridTemplateColumns:"350px auto",gridTemplateAreas:`"traca colis colis"
                    "traca piece piece"
                    "traca poidsBrut poidsBrut"
                    "traca poids tareBalance"
                    "traca balance balance"`,gap:{sm:.5,lg:1},"> *":{p:.5},".traca":{marginLeft:"auto",position:"absolute",width:"350px",flexShrink:0}},children:[e.jsxs(vr,{className:"traca",sx:{height:"100%",gridArea:"traca",borderLeft:4,borderLeftColor:"warning.main",display:"flex",flexDirection:"column",p:{md:1,sm:.5}},children:[a&&e.jsxs(Ft,{expanded:z==="pemballage",onChange:ct("pemballage"),children:[e.jsxs(Qt,{"aria-controls":"panel1a-content",id:"panel1a-header",children:[e.jsx(re,{size:"large",variant:"outlined",color:"warning",onClick:J,children:e.jsx(ee,{icon:"EMBALLAGE"})}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(R,{variant:"subtitle1",component:"p",color:i!=null&&i.EMB_CODE?"primary":"text.disabled",children:[i!=null&&i.EMB_CODE?i==null?void 0:i.EMB_LIB1:U("uniteC"),"  "]}),e.jsx(R,{sx:{fontWeight:500},component:"p",color:i!=null&&i.EMB_CODE?"secondary.main":"text.disabled",variant:"h6",children:i?O.colis+" X "+Rr(i==null?void 0:i.poids):"Aucun"})]}),e.jsx(qt,{iconType:"BACK",size:"large",variant:"contained",color:"error",disabled:!(i!=null&&i.EMB_CODE),onClick:I=>{I.stopPropagation(),E.clearEmballage()}})]}),e.jsx(Or,{sx:{flex:1,overflow:"auto"},children:e.jsx(yo,{onSelect:Ae})})]}),o&&e.jsxs(Ft,{expanded:z==="ppalette",onChange:ct("ppalette"),children:[e.jsxs(Qt,{children:[e.jsx(re,{size:"large",variant:"outlined",onClick:xe,children:e.jsx(ee,{icon:"PALETTE"})}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(R,{variant:"subtitle1",color:s!=null&&s.EMB_CODE?"primary":"text.disabled",children:[s!=null&&s.EMB_CODE?s==null?void 0:s.EMB_LIB1:U("palett"),"  "]}),e.jsx(fe,{direction:"row",gap:.5,children:s!=null&&s.EMB_CODE?e.jsxs(R,{sx:{fontWeigt:500},component:"p",color:"secondary.main",variant:"h6",children:[(s==null?void 0:s.quantity)||0," X ",Rr(s.poids)]}):e.jsx(R,{sx:{fontWeight:500},component:"p",color:s!=null&&s.EMB_CODE?"primary":"text.disabled",variant:"h6",children:"Aucune"})})]}),e.jsx(qt,{iconType:"BACK",size:"large",variant:"contained",color:"error",onClick:I=>{I.stopPropagation(),E.clearPalette()},disabled:!(s!=null&&s.EMB_CODE)})]}),e.jsx(Or,{sx:{flex:1,overflow:"auto"},children:e.jsx(Do,{onSelect:xt})})]}),!v&&(Ce==null?void 0:Ce.ART_STOCK)!=="S"&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{onClick:We,sx:{marginTop:2},children:e.jsxs(Qt,{children:[e.jsx(re,{size:"large",variant:"outlined",onClick:I=>{I.stopPropagation(),V({modalFor:"LOT"})},children:e.jsx(ee,{icon:"EAN13"})}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1},children:[e.jsx(R,{variant:"subtitle1",component:"p",color:d?"primary":"text.disabled",children:"Lot"}),e.jsx(R,{sx:{fontWeight:500},component:"p",color:d?"secondary.main":"text.disabled",variant:"h6",children:d||"Aucun"})]}),e.jsx(qt,{iconType:"BACK",size:"large",variant:"contained",color:"error",disabled:!d,onClick:I=>{I.stopPropagation(),E.updatePreparation({lotId:null,lot:null,codeArticleLot:null})}})]})}),e.jsx(Ur,{rootClassName:"",disableRemote:!1,disabledPadding:!0,onError:pe,onScanSuccess:ae,lecture:I=>$(q.current,L.VEN_NUMSEQ,L.VEN_LOT_SEQ,L.Article,L.VEN_UNIT_CDE,I),sx:{backgroundColor:"yellowgreen"},autoFocus:!0})]})]}),e.jsx(Co,{ref:ht,disablePdsBrut:!!b.modalFor,NUM_FORMAT_PIECES:S.formatPieces,NUM_FORMAT_COLIS:S.formatColis,NUM_FORMAT_POIDS:S.formatPoids,updateQuantity:ze,quantity:O,hasError:xn,plateauConfig:Q,ACH_PDS_NET_CDE:Bt<0?0:Bt,ACH_QUANTITE_CDE:Vt<0?0:Vt,ACH_COLIS_CDE:Mt<0?0:Mt,UC:Ce.ART_UNIT_CDE,UV:Ce.ART_UNIT_VEN})]})}),e.jsxs(Wr,{children:[e.jsx(bt,{color:"error",size:"large",variant:"contained",onClick:I=>{E.updatePreparationBackward({})}}),e.jsx(T,{className:"validate"}),e.jsx(re,{startIcon:e.jsx(At,{color:"secondary",children:e.jsx(ee,{icon:"LIST"})}),size:"large",fullWidth:!0,variant:"contained",onClick:I=>{V({modalFor:"TOOLS"})},children:U("moreTools")}),e.jsx(ba,{colisOrPaletteSSCC:c,onCloseSscc:gn}),e.jsx(T,{className:"validate"}),e.jsx($t,{className:"validate",disabled:!hr("VALIDATE"),size:"large",variant:"contained",color:"success",onClick:I=>{un()},children:U("lineDone")}),e.jsx($t,{className:"validate",disabled:!hr("PESEESUP"),size:"large",variant:"contained",color:"success",onClick:()=>fr(!1),children:U("newWeight")})]})]})}const ba=({colisOrPaletteSSCC:r,onCloseSscc:t})=>e.jsxs(e.Fragment,{children:[r==="1"&&e.jsx(re,{startIcon:e.jsx(Tt,{}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:n=>{t("C")},children:k("endPackage")}),r==="2"&&e.jsx(re,{startIcon:e.jsx(Tt,{}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:n=>{t("P")},children:k("endPallet")}),r==="3"&&e.jsxs(T,{flexDirection:"row",display:"flex",gap:.5,children:[e.jsx(re,{startIcon:e.jsx(Tt,{}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:n=>{t("C")},children:k("endPackage")}),e.jsx(re,{startIcon:e.jsx(Tt,{}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:n=>{t("P")},children:k("endPallet")})]})]});function Ia({isTransactionEntry:r,article:t,numOrder:n,client:o,lot:a,comment:l,comment2:c,unitOrder:u,totalPrepared:i,totalToPrepare:s,onClose:d}){const m='"client btFermer" "article numOrder""comment  unitOrder"',f='"client  numOrder" "article  article""comment  comment"',E={px:.5,boxShadow:1,flexDirection:"row",display:"flex",alignItems:"center",gap:1,border:1,borderRadius:2};return e.jsxs(T,{sx:{display:"grid",gridTemplateAreas:r?m:f,gridTemplateColumns:"1fr minmax(200px,auto)",gridTemplateRows:"60px 60px 80px",gap:.1},children:[e.jsxs(T,{gridArea:"client",sx:{borderColor:"black",bgColor:"#79D765",color:"info.contrastText",...E},children:[e.jsx(ee,{icon:"FOURNISSEUR"}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1,gap:1},children:[e.jsx(R,{variant:"h6",children:o.CLI_CODE}),e.jsx(R,{variant:"h5",children:o.CLI_NOM})]})]}),e.jsxs(T,{gridArea:"numOrder",sx:{borderColor:"black",bgcolor:"#79D765",color:"warning.contrastText",...E},children:[e.jsx(ee,{icon:"ORDER"}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1,gap:1},children:[e.jsx(R,{variant:"h6",children:"Numéro de commande"}),e.jsx(R,{variant:"h5",children:n})]})]}),e.jsxs(T,{gridArea:"article",sx:{borderColor:"black",bgcolor:"#FFC49B",color:"info.contrastText",...E},children:[e.jsx(ft,{codeStat:t==null?void 0:t.ART_STAT_IMAGE,fontSize:"large"}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1,gap:1},children:[e.jsx(R,{variant:"h6",children:t==null?void 0:t.ART_CODE}),e.jsx(R,{variant:"h5",children:t==null?void 0:t.ART_LIB1})]})]}),e.jsx(T,{gridArea:"btFermer",children:e.jsx(rr,{sx:{minHeight:"60px",...E},size:"large",variant:"contained",color:"error",onClick:()=>{d()},children:k("back")})}),e.jsxs(T,{gridArea:"comment",sx:{borderColor:"black",bgcolor:"#FA98A1",color:"info.contrastText",...E},children:[e.jsx(ee,{icon:"COMMENTAIRE"}),e.jsxs(fe,{direction:"column",sx:{flexGrow:1,gap:1},children:[e.jsx(R,{variant:"h5",children:"Commentaire"}),e.jsxs(R,{variant:"h4",children:[l,l&&c?"/":"",c]})]})]}),r&&e.jsxs(T,{gridArea:"unitOrder",sx:{bgcolor:"var(--palette-uc-bgcolor)",borderColor:"black",color:"white",justifyContent:"space-between",...E},children:[e.jsx(Re,{uvc:u||"",fontSize:"large"}),e.jsx(fe,{direction:"row",alignItems:"center",children:e.jsxs(fe,{direction:"column",alignItems:"center",justifyContent:"center",children:[e.jsx(R,{variant:"body1",children:"Préparé"}),e.jsx(R,{variant:"h3",children:i})]})}),e.jsxs(fe,{direction:"column",alignItems:"center",children:[e.jsx(R,{variant:"body1",children:" "}),e.jsx(R,{variant:"h4",children:"/"})]}),e.jsxs(fe,{direction:"column",alignItems:"center",children:[e.jsx(R,{variant:"body1",children:"Commandé"}),e.jsx(R,{variant:"h3",children:s})]})]})]})}const _t=r=>{switch(r){case"TRA_LOT":case"lotId":return"lotNumber";case"NB_COLIS":case"nbPackage":return"uniteC";case"NB_PIECES":case"nbPiece":return"uniteP";case"netWeight":return"uniteN";default:return"uniteN"}},an=({isNew:r,transaction:t,poidsObligatoire:n,onValidate:o,onDelete:a,onReset:l,format:c,onChangeDetail:u,onOpenLot:i})=>{var x,P,v;const s=je(),d=w.useCallback(_=>{const h=()=>{var M,H,N;switch(_){case"lotId":return 0;case"nbPackage":return((M=c.formatColis)==null?void 0:M.precision)??3;case"nbPiece":return((H=c.formatPieces)==null?void 0:H.precision)??3;default:return((N=c.formatPoids)==null?void 0:N.precision)??0}};_!="lotId"?s.showInputNumber({i8ntitle:k(_t(_)),dialogProps:{maxWidth:"md",fullWidth:!0},props:{label:k(_t(_)),maximumFractionDigits:h()}}).then(M=>{D.isNil(M)===!1&&u(t.indice,_,M)}):s.showInputText({i8ntitle:k(_t(_)),dialogProps:{maxWidth:"md",fullWidth:!0},props:{label:k(_t(_))}}).then(M=>{D.isNil(M)===!1&&u(t.indice,_,M)})},[t.indice,c]),f=(()=>{const _=[],h=H=>+H<0,M=(H,N=null)=>_.push({err:H,variables:N});return n&&h(t.netWeight||-1)&&M("ERR_POIDS_NR"),(h(t.nbPackage)||t.unitSale==="C"&&!t.nbPackage)&&M("ERR_QTE_COLIS",{colis:t.nbPackage}),(h(t.netWeight||-1)||D.includes(["N","K"],t.unitSale)&&!t.netWeight)&&M("ERR_QTE_POIDS",{poids:t.netWeight}),(h(t.nbPiece)||t.unitSale==="P"&&!t.nbPiece)&&M("ERR_QTE_PIECE",{piece:t.nbPiece}),t.stockArticle==="L"&&!t.lotId&&M("ERR_LOT_MUSTBESET"),_})(),E=async()=>{if(!D.isEmpty(f)){const _=D.head(f);return s.showError({i8nmessage:k(_.err,_.variables||{}),i8ntitle:k("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})}o()};return e.jsxs(T,{sx:{display:"grid",gridTemplateColumns:"min-content minmax(260px,1fr) 1fr 1fr 1fr auto",fontSize:_=>_.typography.h5.fontSize,alignItems:"stretch",gap:.6,"& .icon":{position:"absolute",top:"40%",left:0,opacity:.8},"& .float":{position:"absolute",top:2,left:2},"& .input-uvc":{fontSize:{md:24,xs:16}},"& .bottomLarge":{minHeight:90}},children:[e.jsx(re,{variant:"contained",size:"large",className:ye({bottomLarge:r}),color:"warning",onClick:l,sx:{opacity:r?1:.3},disabled:!r,children:e.jsx(po,{})}),e.jsxs(ho,{sx:{bgcolor:"white"},variant:"contained","aria-label":"outlined button group",fullWidth:!0,children:[e.jsx(re,{className:ye("lot","lot-btn",{bottomLarge:r}),fullWidth:!1,variant:"outlined",size:"large",onClick:_=>i(t.indice),children:e.jsx(xo,{})}),e.jsxs(re,{variant:"outlined",className:ye("lot","lot-kb",{bottomLarge:r}),color:"inherit",size:"large",onClick:()=>d("lotId"),sx:{padding:.3,paddingBottom:r?1:0,position:"relative",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(T,{display:"flex",alignItems:"center",children:e.jsx(ee,{icon:"EAN13"})}),e.jsx(R,{color:t.transacLot?"text.primary":"text.disabled",variant:r?"h4":"h6",children:t.lotId||"Lot"})]})]}),e.jsx(Ht,{label:k("uniteC"),typUVC:"C",onChangeForm:D.bind(d,null,"nbPackage"),value:Ie(t.nbPackage,((x=c.formatColis)==null?void 0:x.precision)??3),className:zt(r,t.unitSale,t.unitOrder,"C")}),e.jsx(Ht,{label:k("uniteP"),typUVC:"P",onChangeForm:D.bind(d,null,"nbPiece"),value:Ie(t.nbPiece,((P=c.formatPieces)==null?void 0:P.precision)??0),className:zt(r,t.unitSale,t.unitOrder,"P")}),e.jsx(Ht,{label:k("uniteN"),typUVC:"N",onChangeForm:D.bind(d,null,"netWeight"),value:Ie(t.netWeight,((v=c.formatPoids)==null?void 0:v.precision)??3),className:zt(r,t.unitSale,t.unitOrder,"N")}),a&&e.jsx(re,{variant:"contained",size:"large",color:"error",onClick:()=>a(t.transacSeq),children:e.jsx(Fo,{})}),o&&e.jsx(re,{className:ye({bottomLarge:r}),variant:"contained",size:"large",color:"success",onClick:()=>E(),children:e.jsx(Qo,{})})]})},Ht=({onChangeForm:r,value:t,label:n,typUVC:o,className:a})=>e.jsxs(re,{sx:{position:"relative",bgcolor:"#fff",color:"text.primary",p:1},className:a,color:"inherit",variant:"outlined",size:"large",onClick:l=>r(),children:[e.jsx(Re,{className:"icon",uvc:o,fontSize:"medium"}),e.jsx(T,{className:"float",children:e.jsx(R,{variant:"subtitle1",children:n})}),e.jsx(R,{color:"inherit",sx:{zIndex:1,width:"100%",textAlign:"right",alignSelf:"flex-end"},variant:"h4",children:t})]});function zt(r,t,n,o,a){return ye("input-uvc","cold",{error:!0,bottomLarge:r,UC:n===o,UV:t===o})}const ja={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:120,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:70}},ya=w.forwardRef(({state:r,...t},n)=>e.jsx(go,{state:r,onSelect:()=>{},ref:n,ItemMeasureCard:ja,ItemComponent:Da,ItemComponentProps:t,labelSearch:"",disableBottom:!0,disablePadding:!0}));function Da({item:r,ItemComponentProps:t}){return e.jsx(T,{width:"99%",children:e.jsx(an,{isNew:!1,format:t.format,transaction:r,onChangeDetail:t.onChangeDetail,onOpenLot:t.onOpenLot,onDelete:t.onDelete})})}function va({operationId:r,client:t,affichePalette:n,afficheEmballage:o,poidsObligatoire:a,colisOrPaletteSSCC:l,emballage:c,palette:u,lotId:i,mouvement:s,actions:d,recalculationQuantity:m,unitRecalcul:f,lotAuto:E,behaviorLotUndefined:x,mode:P,isPreparationClient:v,currentColis:_,currentPalette:h,gereReliquat:M,context:H,detail:N,actionsFunction:F,SCAN_RESULT:X,...L}){var Oe;const{t:O}=de();function Q(g){return g?D.startsWith(g,"CONFIRM")?"warning":D.startsWith(g,"ERROR")?"error":"primary":"primary"}const me=w.useRef(null),ie=Fr("transactionsDetails"+w.useId(),N.transactions.filter(g=>g.valor=="O")||[]),ne=Et(),ae=w.useRef(),{hasNext:$,hasPrevious:pe,onPrevious:he,onNext:Le}=wr(ie.rowPosition,ae),Te=je();return e.jsxs(T,{sx:{display:"flex",flexDirection:"column",width:"100",overflow:"auto",height:"100%"},children:[e.jsxs(ke,{dialogProps:{maxWidth:"md",fullScreen:N.modalFor==="LIST_LOT",fullWidth:!1},i8ntitle:st(O,N.modalFor||""),onCloseDialog:F.closeModal,"aria-labelledby":"customized-dialog-title",isOpen:!!N.modalFor,color:Q(N.modalFor),withAppBar:!0,className:"",children:[N.modalFor==="LIST_LOT"&&e.jsx(Fe,{type:"LotsPreparation",componentProps:{numSeq:N.venNumSeq,codeArticle:((Oe=N.article)==null?void 0:Oe.ART_CODE)||"",codeDepot:(N.modalIndice===-1?N.newTransaction.codeDepot:N.transactions[N.modalIndice].codeDepot)||"",lot:null,uc:N.unitOrder},onSelect:function(g){F.closeModal(),K().PrepaMethods().PreparationControleMouvement(H.current||null,N.venNumSeq,N.venLotSeq,g.LOT,(X==null?void 0:X.result.codeArticle)||"").then(async j=>{var A,W,Y,q,U;j&&!j.err?j&&!j.err&&!((A=j.res)!=null&&A.error)?F.onSelectLot(g):((W=j.res)==null?void 0:W.codeError)==="ERR_DLC_MINI_NONBLOQUANT"?await Te.showConfirmation({title:"confirmTitle",message:O((Y=j.res)==null?void 0:Y.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&F.onSelectLot(g):d.messages.errorMessage(O(((q=j.res)==null?void 0:q.codeError)||"invalidBarcode")):d.messages.errorMessage(O(((U=j.res)==null?void 0:U.codeError)||"invalidBarcode"))})}}),N.modalFor==="COMMENTS"&&e.jsx(Na,{detail:N,onClose:()=>F.closeModal()})]}),e.jsx(Ia,{article:N.article,client:N.client,comment:N.commentPrepa1,comment2:N.commentPrepa2,numOrder:N.numOrder,isTransactionEntry:!0,totalPrepared:N.totalPrepared,totalToPrepare:N.totalToPrepare,unitOrder:N.unitOrder,onClose:F.closeScreen}),e.jsx(ya,{state:ie,format:ne,onOpenLot:F.onOpenLot,onChangeDetail:F.onChangeDetail,onDelete:F.onDelete,ref:ae}),e.jsxs(T,{flexDirection:"row",display:"flex",gap:"0.5",children:[e.jsx(nn,{hasPrevious:pe,hasNext:$,onPrevious:he,onNext:Le}),e.jsx(Ur,{sx:{height:"100%","& .MuiInputBase-root":{height:"100%"},backgroundColor:"yellowgreen"},autoFocus:!0,ref:me,disabled:!1,onError:F.handleErrorScan,onScanSuccess:F.onScanLotCodeBarreEan128Transaction,lecture:g=>F.handleScanLecturePreparationEan128(H.current,N.venNumSeq,N.venLotSeq,N.article,N.unitOrder,g),rootClassName:"",disableRemote:!1,disabledPadding:!0})]}),e.jsx(T,{sx:{borderRadius:1,border:1,padding:{md:.5,lg:1},background:"rgb(68 255 223 / 10%)"},children:e.jsx(an,{isNew:!0,format:ne,transaction:N.newTransaction,onValidate:F.onAddTransaction,onReset:F.resetNewTransaction,onChangeDetail:F.onChangeDetailNew,onOpenLot:F.onOpenLot,poidsObligatoire:a})})]})}const Ma=({operationId:r,VEN_NUMSEQ:t,VEN_LOT_SEQ:n})=>{const{actions:o,operation:a,getParametreBorneZone1:l,quantity:c,getApplicationOption:u,getParametreBorne:i}=Gr(r),s=Se(),d=w.useMemo(()=>{var m,f;return{V2_PALETTE:l("V2_PALETTE"),V2_SEL_EMB:l("V2_SEL_EMB"),V2_POIDS:l("V2_POIDS"),colisPalette:((m=i("V2_COLISPALETTE_SSCC"))==null?void 0:m.USER_ZONE1)||"0",recalculationQuantity:!0,lotAuto:u("CDE_LOT_AUTO"),gereReliquat:l("V2_RELIQUAT"),unitRecalcul:((f=i("V2_RECALCUL"))==null?void 0:f.USER_ZONE1)||"C",behaviorLotUndefined:i("V2_BLOC_LOTTELEVENTE")||{USER_VAR:"V2_BLOC_LOTTELEVENTE",USER_ZONE1:"N",USER_ZONE2:"2"},isTransactionEntry:l("V2_LISTE_TR")}},[l,i,u]);return e.jsxs(e.Fragment,{children:[!d.isTransactionEntry&&e.jsx(Va,{context:s,actions:o,lotSeq:n,config:d,operation:a,operationId:r,numSeq:t,quantity:c}),d.isTransactionEntry&&e.jsx(Ba,{actions:o,config:d,numSeq:t,lotSeq:n,quantity:c,operation:a,operationId:r,context:s})]})},Va=({context:r,lotSeq:t,actions:n,config:o,operation:a,operationId:l,numSeq:c,quantity:u})=>{var x,P,v,_,h,M;const i=Hr(r,t),s=o.colisPalette===Pe.colisPaletteSSCC||o.colisPalette===Pe.paletteSSCC?rn(r,c):{data:{res:0}},d=o.colisPalette===Pe.colisPaletteSSCC||o.colisPalette===Pe.colisSscc?tn(r,c):{data:{res:0}},m=((x=a.paletteSsccPrepa)==null?void 0:x.CurrentPalette)==null?(P=s.data)==null?void 0:P.res:(v=a.paletteSsccPrepa)==null?void 0:v.CurrentPalette,f=((_=a.colisSsccPrepa)==null?void 0:_.CurrentColis)==null?(h=d.data)==null?void 0:h.res:(M=a.colisSsccPrepa)==null?void 0:M.CurrentColis;if(i.isLoading)return e.jsx(ot,{});const E=i.data.res;return e.jsx(Oa,{operationId:l,client:a.client,resetLine:n.resetLine,peseeSuplementaire:!!a.preparation.currentLine.PESEE_SUP_ACH_LOT_SEQ,affichePalette:o.V2_PALETTE,afficheEmballage:o.V2_SEL_EMB,poidsObligatoire:o.V2_POIDS,colisOrPaletteSSCC:o.colisPalette,recalculationQuantity:o.recalculationQuantity,unitRecalcul:o.unitRecalcul,lotAuto:!!o.lotAuto,behaviorLotUndefined:o.behaviorLotUndefined,actions:n,emballage:(a==null?void 0:a.emballage)||null,palette:(a==null?void 0:a.palette)||null,lotId:(a==null?void 0:a.lotId)||null,mouvement:(a==null?void 0:a.lot)||null,codeArticleLot:(a==null?void 0:a.codeArticleLot)||null,mode:a.mode,...u,detail:E,isPreparationClient:a.mode==ue.PREPACLIENT,currentColis:f||0,currentPalette:m||0,gereReliquat:o.gereReliquat,dateEnlevement:a==null?void 0:a.date})},Ba=({operationId:r,operation:t,actions:n,config:o,numSeq:a,lotSeq:l,quantity:c,context:u})=>{const{detail:i,isLoading:s,actionsFunction:d}=Ps(u,r,l,t.mode,t==null?void 0:t.preparation.InfoCodeBarre,t==null?void 0:t.lot);return s||!i?e.jsx(ot,{}):e.jsx(va,{operationId:r,client:t.client,affichePalette:o.V2_PALETTE,afficheEmballage:o.V2_SEL_EMB,poidsObligatoire:o.V2_POIDS,colisOrPaletteSSCC:o.colisPalette,recalculationQuantity:o.recalculationQuantity,unitRecalcul:o.unitRecalcul,lotAuto:!!o.lotAuto,actionsFunction:d,behaviorLotUndefined:o.behaviorLotUndefined,actions:n,emballage:(t==null?void 0:t.emballage)||null,palette:(t==null?void 0:t.palette)||null,lotId:(t==null?void 0:t.lotId)||null,mouvement:(t==null?void 0:t.lot)||null,mode:t.mode,...c,detail:i,isPreparationClient:t.mode==ue.PREPACLIENT,gereReliquat:o.gereReliquat,context:u})},wa=To(Ma),ln=({operationId:r,mode:t})=>{const{venNumSeq:n,previousStep:o,venLotSeq:a,onLeaveLine:l,onChangeStep:c}=Es(r);if(t===ue.PREPACLIENT?n>0&&a>0:a>0)return e.jsx(wa,{operationId:r,VEN_NUMSEQ:n,VEN_LOT_SEQ:a,onCloseDetail:l});Ge().errorMessage(k("ERR_NO_LINE_SELECTED")),c(o)},Ua=Qe("div")`



    &.preparation-module {
        flex-grow: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
 
  
    
    
    
        & .MuiStepLabel-label {
            font-weight: 500;
            font-size: 18px;
          
        }
    
        & .MuiStepLabel-iconContainer > * {
            background-color: white;
            font-weight: 500;
          
        }
  }
  

`;function cn({operationId:r}){var u,i,s,d;const{actions:t,operation:n,steps:o,step:a,getParametreBorneZone1:l,getParametreBorne:c}=wo(r);{if(n===null)throw new Error("operation de reception non trouvée!"+r);const m=n!=null&&n.isOpenNumSeqOnly?G.DETAILS:a,f=l("V2_MULTI_DEPOT"),E=c("V2_DEP_ENT"),x=f||(E==null?void 0:E.USER_ZONE1)==="N"?"":E==null?void 0:E.USER_ZONE2,P=l("V2_RELIQUAT"),v=((u=c("V2_RECALCUL"))==null?void 0:u.USER_ZONE1)||"C",_=l("V2_LISTE_TR"),h=((i=c("V2_ENL_DATE"))==null?void 0:i.USER_ZONE1)=="O",M=((s=c("V2_ENL_DATE"))==null?void 0:s.USER_ZONE1)=="O"&&((d=c("V2_ENL_DATE"))==null?void 0:d.USER_ZONE2)=="O";return e.jsx(e.Fragment,{children:e.jsx(Uo.Provider,{value:r,children:e.jsxs(Ua,{className:ye("preparation-module","preparation"),children:[e.jsx(Is,{className:"appbar",onChangeStep:t.onChangeStep,activeStep:m,mode:n.mode,title:" ",steps:o}),a===G.HOME&&e.jsx(Vs,{date:n.date,operationId:r,onChangeDatePreparation:t.onSetDatePreparation,onSelectModePreparation:t.onSelectModePreparation,readOnlyDate:!M,updateDate:h}),n.mode===ue.PREPAARTICLE&&e.jsx(ka,{actions:t,step:a,operationId:r,mode:n.mode,modalFor:n.modalFor||"",numSeqModal:n.numSeqModal||0,numLotSeqModal:n.numLotSeqModal||0,codeArticle:n.art_code||"",dateEnl:n.date||null}),n.mode===ue.PREPACLIENT&&e.jsx(Wa,{actions:t,step:a,operationId:r,mode:n.mode,modalFor:n.modalFor||"",numSeqModal:n.numSeqModal||0,numLotSeqModal:n.numLotSeqModal||0,CbModal:n.CbModal,optionQuickFiterModal:n.optionQuickFiterModal,depot:x,gereReliquat:P,unitRecalcul:v,isEntryTransaction:_})]})})})}}const ka=({operationId:r,actions:t,step:n,mode:o,modalFor:a,numSeqModal:l,numLotSeqModal:c,codeArticle:u,dateEnl:i})=>{const{dataPreparations:s}=hs(r),{t:d}=de(),m=f=>{t.onCloseModal(),t.onChangeStep(f)};return e.jsxs(ar,{fallbackRender:f=>e.jsx(ir,{errorOrigin:"PreparationArticle",...f,resetMessage:"retour"}),onReset:()=>t.updatePreparation({mode:1}),children:[e.jsx(ke,{dialogProps:{maxWidth:"md",fullScreen:!0,fullWidth:!1},withAppBar:!0,isOpen:!!a,onCloseDialog:()=>t.onCloseModal(),i8ntitle:st(d,a||""),className:"",children:a==="RELIQUATPREPARATION"&&e.jsx(T,{sx:{maxWidth:"lg",margin:"auto",height:"100%",display:"flex",flexDirection:"column"},children:e.jsx(vt,{operationId:r,VEN_NUMSEQ:l||0,dateEnl:i||null,VEN_LOT_SEQ:c||0,mode:ue.PREPAARTICLE,codeArticle:u,onCloseCommande:t.onCloseModal,onOpenEditionPreparation:function(){throw new Error("Function not implemented.")},onChangeStep:m})})}),n===G.ARTICLES&&e.jsx(ia,{data:s,onSelect:t.selectArticle}),n===G.DETAILS&&e.jsx(qs,{operationId:r}),n===G.PALETTES&&e.jsx(Fe,{type:"Palettes",onSelect:function(f){t.updatePreparationForward({palette:Ot(f)})}}),n===G.EMBALLAGES&&e.jsx(Fe,{type:"Emballages",onSelect:function(f){t.updatePreparationForward({emballage:Ot(f)})}}),n===G.CURRENTPREPARATION&&e.jsx(ln,{operationId:r,mode:o})]})},Wa=({operationId:r,actions:t,step:n,mode:o,modalFor:a,numSeqModal:l,numLotSeqModal:c,CbModal:u,unitRecalcul:i,optionQuickFiterModal:s,depot:d,gereReliquat:m,isEntryTransaction:f})=>{const{dataPreparations:E}=ps(r),{t:x}=de(),P=je(),v=Se(),_=De(r),{preparation:h}=_.operation,{formatColis:M,formatPoids:H}=Et("VENTE"),{handleScanLecturePreparationEan128:N}=dr(),F=O=>{t.onCloseModal(),t.onChangeStep(O)},X=(O,Q,me,ie)=>{K().PrepaMethods().LignesMonoCommande({variables:{numSeq:h==null?void 0:h.VEN_NUMSEQ,recherche:{rbp:1,qbRules:O.qbRules},context:v.current||null}}).then(ne=>{var ae;ne&&ne.res&&(ne.res.itemsCount??0)===1?t.selectPreparationLineCb(f||!1,(ae=ne==null?void 0:ne.res)==null?void 0:ae.result[0],Q,G.CURRENTPREPARATION,i||"C",M,H,ie):ne&&ne.res&&(ne.res.itemsCount??0)>1?me.updateQuickRules&&me.updateQuickRules(O.qbRules):t.messages.errorMessage(x("notFound"))})},L=w.useCallback(async O=>{var he;const{val:Q}=O,me=String(Q.value),ie=lr(Q.value),ne={ART_CODE:h==null?void 0:h.art_code},ae=ie===tt.Ean128?await N(v.current,h==null?void 0:h.VEN_NUMSEQ,0,ne,(h==null?void 0:h.orderUnit)||"",me):null,$=(he=ae==null?void 0:ae.res)==null?void 0:he.infoSpecific,pe=ie===tt.Ean128?Cs($):Dt(me,"detail");if(D.has(Q,"value")&&(ie!=tt.None||D.startsWith(Q.value,".")))if(O.clearCb&&O.clearCb(),pe.qbRules)X(pe,$,O,null);else if(ie===tt.Ean128&&($!=null&&$.error))switch($==null?void 0:$.codeError){case"ERR_MULTI_MVT":{t.updatePreparation({modalFor:"LOT",numSeqModal:h==null?void 0:h.VEN_NUMSEQ,numLotSeqModal:null,CbModal:$,optionQuickFiterModal:O});break}case"ERR_DLC_MINI_NONBLOQUANT":{if(await P.showConfirmation({title:"confirmTitle",message:x($==null?void 0:$.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})){const Te=ge("gcvente_det.VEN_LOT_SEQ",($==null?void 0:$.result.lotSeq)||0,"="),Oe={fast:!1,qbRules:Nt(Te)};X(Oe,$,O,null)}break}default:t.messages.errorMessage(x($==null?void 0:$.codeError))}else t.messages.errorMessage(x("invalidBarcode"));else O.updateQuery(O.val)},[h==null?void 0:h.VEN_NUMSEQ]);return e.jsxs(ar,{fallbackRender:O=>e.jsx(ir,{errorOrigin:"PreparationArticle",...O,resetMessage:"retour"}),onReset:()=>t.updatePreparation({mode:2}),children:[e.jsxs(ke,{dialogProps:{maxWidth:"md",fullScreen:!0,fullWidth:!1},withAppBar:!0,isOpen:!!a,onCloseDialog:()=>t.onCloseModal(),i8ntitle:st(x,a||""),className:"",children:[a==="RELIQUATPREPARATION"&&e.jsx(T,{sx:{maxWidth:"lg",margin:"auto",height:"100%",display:"flex",flexDirection:"column"},children:e.jsx(vt,{operationId:r,VEN_NUMSEQ:l||0,dateEnl:_.operation.date||null,VEN_LOT_SEQ:c||0,mode:ue.PREPACLIENT,onCloseCommande:t.onCloseModal,onOpenEditionPreparation:function(){throw new Error("Function not implemented.")},onChangeStep:F})}),a==="LOT"&&e.jsx(Fe,{type:"LotsPreparation",componentProps:{numSeq:l,codeDepot:d,lot:u==null?void 0:u.result.lot},onSelect:function(O){t.onCloseModal(),K().PrepaMethods().PreparationControleMouvement(v.current||null,h==null?void 0:h.VEN_NUMSEQ,0,O.LOT,(u==null?void 0:u.result.codeArticle)||"").then(async Q=>{var me,ie,ne,ae,$,pe;if(Q&&!Q.err)if(c)Q&&!Q.err&&!((me=Q.res)!=null&&me.error)?t.updatePreparation({lotId:O.LOTID,lot:O.LOT,codeArticleLot:O.Article.ART_CODE}):((ie=Q.res)==null?void 0:ie.codeError)==="ERR_DLC_MINI_NONBLOQUANT"?await P.showConfirmation({title:"confirmTitle",message:x((ne=Q.res)==null?void 0:ne.codeError),type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&t.updatePreparation({lotId:O.LOTID,lot:O.LOT,codeArticleLot:O.Article.ART_CODE}):t.messages.errorMessage(x(((ae=Q.res)==null?void 0:ae.codeError)||"invalidBarcode"));else{const he=ge("gcvente_det.VEN_LOT_SEQ",(($=Q.res)==null?void 0:$.result.lotSeq)||0,"="),Le={fast:!1,qbRules:Nt(he)};X(Le,u,s,O.LOT)}else t.messages.errorMessage(x(((pe=Q.res)==null?void 0:pe.codeError)||"invalidBarcode"))})}})]}),n===G.LISTPREPARATIONS&&e.jsx(ra,{data:E,onSelect:t.selectPreparation}),n===G.DETAILS&&e.jsx(Xs,{operationId:r,numSeq:h==null?void 0:h.VEN_NUMSEQ,lotSeq:(h==null?void 0:h.VEN_LOT_SEQ)||0,gereReliquat:m||!1,dateEnlevement:_.operation.date||null,actions:t,onSetQuickFilterValueParam:L}),n===G.PALETTES&&e.jsx(Fe,{type:"Palettes",onSelect:function(O){t.updatePreparationForward({palette:Ot(O)})}}),n===G.EMBALLAGES&&e.jsx(Fe,{type:"Emballages",onSelect:function(O){t.updatePreparationForward({emballage:Ot(O)})}}),n===G.CURRENTPREPARATION&&e.jsx(ln,{operationId:r,mode:o})]})};function qa({session:r,borneId:t}){const n=r.sessionId,{operationId:o}=ss(n,t,ue.HOME,null);return o?e.jsx(e.Fragment,{children:e.jsx(cn,{operationId:o})}):null}function Fa(){const{operationId:r}=kr(),t=So();return e.jsx(ar,{fallbackRender:n=>e.jsx(e.Fragment,{children:e.jsx(ir,{errorOrigin:"PreparationFicheOperationRouter",...n,resetMessage:"back"})}),onReset:()=>{t("/")},children:e.jsx(cn,{operationId:r})})}function ai(){const{session:r,onLaunchOption:t}=Po(),{borneId:n}=kr();return e.jsxs(_o,{children:[e.jsx(br,{index:!0,element:e.jsx(qa,{session:r,borneId:n})}),e.jsx(br,{path:":operationId",element:e.jsx(Fa,{})})]})}export{ai as default};
