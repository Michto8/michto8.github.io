import{ao as C,fT as m,f0 as N,f3 as l,h9 as p,cb as f,el as _,fK as g,fL as L,fM as T,aq as E,bb as h,ee as O,ea as Q}from"./index-2ba9b923.js";const S="cacheKeyStatutPreparationFidege",K="KeyPreparationFidegeSTATUNARTICLE",P="KeyListeCommandeDetailFidege",I="KeyDetailPreparationFidege",u="KeyCommandesFidege",b="KeyStatCommandesFidege",D="KPreparationClientDetails",F="SCAN",x="KeyPrioPreparationFidege",M=()=>{const e=C(),r=p((i=[],n=!1)=>{const a=s=>E.isEmpty(i)||E.includes(i,s);a("PRIO")&&e.invalidateQueries({queryKey:[x],exact:!1}),a("COMMANDES")&&(n?e.removeQueries({queryKey:[u],exact:!1}):e.invalidateQueries({queryKey:[u],exact:!1}),e.invalidateQueries({queryKey:[K],exact:!1})),a("DETAILS")&&(e.invalidateQueries({queryKey:[D],exact:!1}),e.invalidateQueries({queryKey:[P],exact:!1})),a("DETAIL")&&(e.invalidateQueries({queryKey:[I],exact:!1}),e.invalidateQueries({queryKey:[K],exact:!1})),a("STATUT")&&e.invalidateQueries({queryKey:[S],exact:!1}),a("SCAN")&&e.removeQueries({queryKey:[F],exact:!1})}),t=(i,n=3)=>{n&1&&e.setQueriesData([P],f(a=>a.VEN_NUMSEQ===i)),n&2&&e.setQueriesData([u],f(a=>a.VEN_NUMSEQ===i))},c=p((i,n)=>{e.setQueriesData({queryKey:[S],exact:!1},a=>_(a,s=>{var o;s&&s.result&&(s.result.NB_LIGNES_NONVAL=Math.max((((o=s.result)==null?void 0:o.NB_LIGNES_NONVAL)||0)+n,0))}))});return{clearCache:r,setStatus:c,queryClient:e,removeOrder:t}};function q(e,r,t,c=Q.HOME,i){return{orderPrio:null,codeBorne:r,sessionId:e,plateauState:!0,uid:h(),date:null,mode:c,stepClient:O.HOME,codeArticle:null,preparation:null,zoneTravailPersonnelCode:(t==null?void 0:t.ZONE_CODE)||null,zoneTravailPersonnelLibelle:(t==null?void 0:t.ZONE_LIB)||null,editionBl:!1}}function U(e,r,t,c=null){return async(i,n,a)=>{var d;const s=n(),{codePersonnel:o}=g(s,e),y=L(s,e,r);if(o&&y){const A=await T(o,r,y,a.getQueryClient(),a.remoteApi());i(l.PREPARATION_NEW(q(e,r,((d=A.res)==null?void 0:d.zoneTravail)||null,t)))}else throw new Error("ERR_INVALID_REDUX_STATE")}}function V(e,r){return async(t,c,i)=>{const n=c();return t(m(n[N].preparations[e].sessionId,r))}}function v(e){return async(r,t,c)=>(r(l.PREPARATION_UPDATE({indice:e.indice,nextStep:e.nextStep,update:e.update||{}})),null)}function k({indice:e,detail:r,throwIfOpen:t}){return async(c,i,n)=>{var s;const a=i()[N];return t&&((s=a.preparations[e].preparation)==null?void 0:s.VEN_LOT_SEQ)===r.VEN_LOT_SEQ?new Error("alreadyOpen"):(c(l.SELECT_PREPARATION_MODAL({indice:e,detail:r})),null)}}export{v as P,u as a,b,S as c,P as d,U as e,V as f,D as g,K as h,I as i,x as j,F as k,k as s,M as u};
