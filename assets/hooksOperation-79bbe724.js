import{h6 as h,aq as C,h7 as A,f1 as f,ee as N,r as L,b9 as S,c0 as w,bf as k,h8 as V,d4 as K,bg as G,au as W,aF as H,b8 as Y,e8 as a,b_ as Z,as as j,e9 as X,ea as M,fj as F,f4 as b}from"./index-2ba9b923.js";import{a as v}from"./actions-d163bdb2.js";const z=(e,n)=>C.find(e[A].preparations,r=>r.uid===n)||null,q=(e,n)=>{const r=z(e,n);return{...r,step:h(r)}},J=e=>f(n=>n[A].preparations[e].sessionId,n=>n[A].preparations[e].mode,n=>n[A].preparations[e].stepClient,n=>n[A].preparations[e].steps,n=>n[A].preparations[e].date,n=>n[A].preparations[e].modalFor,n=>n[A].preparations[e].numSeqModal,n=>n[A].preparations[e].numLotSeqModal,n=>n[A].preparations[e].CbModal,n=>n[A].preparations[e].optionQuickFiterModal,n=>n[A].preparations[e].editionBl,n=>n[A].preparations[e].imprimanteEtiquette,n=>n[A].preparations[e].imprimanteBl,n=>{var r;return(r=n[A].preparations[e].preparation)==null?void 0:r.art_code},n=>{var r,c;return((r=n[A].preparations[e].preparation)==null?void 0:r.VEN_NUMSEQ)&&!((c=n[A].preparations[e].preparation)!=null&&c.VEN_LOT_SEQ)},(n,r,c,i,u,o,_,T,l,O,D,U,m,t,E)=>({sessionId:n,mode:r,step:c,steps:i,date:u,modalFor:o,numSeqModal:_,numLotSeqModal:T,CbModal:l,optionQuickFiterModal:O,editionBl:D,imprimanteEtiquette:U,imprimanteBl:m,art_code:t,isOpenNumSeqOnly:E&&c===N.CURRENTPREPARATION})),Pe=(e,n)=>{var r,c;return((c=(r=C.find(n[A].preparations,i=>i.uid===e))==null?void 0:r.preparation)==null?void 0:c.VEN_NUMSEQ)||0},Te=(e,n)=>{var r,c;return((c=(r=C.find(n[A].preparations,i=>i.uid===e))==null?void 0:r.preparation)==null?void 0:c.VEN_LOT_SEQ)||0},oe=(e,n)=>{var r;return((r=C.find(n[A].preparations,c=>c.uid===e))==null?void 0:r.previousStep)||0},$=e=>n=>n[A].preparations[e].mode,ee=e=>n=>h(n[A].preparations[e]),te=e=>n=>n[A].preparations[e].steps,ne=L.createContext(null),Se=()=>L.useContext(ne),Re=e=>{const n=S($(e)),r=S(ee(e)),c=S(te(e)),i=V(n||null,c||null);return I(e,i,r)},re=(e,n)=>(console.log("preparationpreparationpreparation",e),{VEN_NUMSEQ:e.VEN_NUMSEQ,VEN_LOT_SEQ:n,numOrder:e.VEN_CDE,InfoCodeBarre:null,art_code:null,tour_code:null,ven_date_enl:null,articleStat1:null,articleDestock:null,orderUnit:null,articleStockage:null}),le=e=>({VEN_NUMSEQ:e.VEN_NUMSEQ,VEN_LOT_SEQ:e.VEN_LOT_SEQ,InfoCodeBarre:null,art_code:e.Article.ART_CODE,tour_code:null,ven_date_enl:null,articleStat1:e.Article.ART_STAT1,articleDestock:e.Article.ART_DESTOCK_ART,orderUnit:e.VEN_UNIT_CDE,articleStockage:e.Article.ART_STOCK,numOrder:e.VEN_CDE}),ae=(e,n)=>({VEN_NUMSEQ:e,VEN_LOT_SEQ:0,InfoCodeBarre:null,art_code:null,tour_code:null,ven_date_enl:null,articleStat1:null,articleDestock:null,orderUnit:null,articleStockage:null,numOrder:n}),Ee=(e,n)=>{var r,c,i,u;return{art_code:e.Article.ART_CODE,tour_code:(r=e.Tournee)==null?void 0:r.TOUR_CODE,ven_date_enl:F(e.VEN_DATE_ENL),VEN_LOT_SEQ:n,InfoCodeBarre:null,VEN_NUMSEQ:null,articleStat1:((c=e.Article)==null?void 0:c.ART_STAT1)||null,articleDestock:((i=e.Article)==null?void 0:i.ART_DESTOCK_ART)||null,articleStockage:((u=e.Article)==null?void 0:u.ART_STOCK)||null,orderUnit:e.VEN_UNIT_CDE,numOrder:e.VEN_CDE}},ce=e=>{var n,r,c,i;return{art_code:e.Article.ART_CODE,ven_date_enl:F(e.VEN_DATE_ENL),VEN_LOT_SEQ:e.VEN_LOT_SEQ,tour_code:(n=e.Tournee)==null?void 0:n.TOUR_CODE,InfoCodeBarre:null,VEN_NUMSEQ:null,articleStat1:null,articleDestock:((r=e.Article)==null?void 0:r.ART_DESTOCK_ART)||null,articleStockage:((c=e.Article)==null?void 0:c.ART_STOCK)||null,orderUnit:((i=e.Article)==null?void 0:i.ART_UNIT_CDE)||null,numOrder:e.VEN_CDE}};function ie(e){return async(n,r,c)=>{try{await c.getQueryClient().removeQueries({queryKey:[v],exact:!1})}catch{}return n(a.PREPARATION_UPDATE({indice:e,update:{mode:M.PREPACLIENT},nextStep:N.LISTPREPARATIONS})),null}}function Ae(e){return async(n,r,c)=>{try{await c.getQueryClient().removeQueries({queryKey:[v],exact:!1})}catch{}return n(a.PREPARATION_UPDATE({indice:e,update:{mode:M.PREPAARTICLE},nextStep:N.LISTPREPARATIONS})),null}}function B(e){return async(n,r,c)=>(n(a.PREPARATION_UPDATE({indice:e.indice,nextStep:e.nextStep,update:e.update||{}})),null)}const I=(e,n,r)=>{const c=G(),i=W(),{t:u}=H(),{getFirstStep:o,getNextStep:_,getPreviousStep:T}=n,l=Y(),{sessionId:O,borneId:D,dateEnl:U}=se(e),m=t=>{i.showError({i8nmessage:t,i8ntitle:u("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})};return L.useMemo(()=>({messages:c,onSelectColis:(t,E)=>{l(a.PREPARATION_UPDATE_COLISSSCC({indice:e,update:t})),l(a.PREPARATION_UPDATE_PALETTESSCC({indice:e,update:E}))},onSelectPalette:t=>{l(a.PREPARATION_UPDATE_PALETTESSCC({indice:e,update:t})),l(a.PREPARATION_UPDATE_COLISSSCC({indice:e,update:0}))},onClosePalette:()=>{l(a.PREPARATION_UPDATE_PALETTESSCC({indice:e,update:0})),l(a.PREPARATION_UPDATE_COLISSSCC({indice:e,update:0}))},onCloseColis:()=>{l(a.PREPARATION_UPDATE_COLISSSCC({indice:e,update:0}))},onOpenReliquatPreparation:(t,E)=>{l(a.PREPARATION_UPDATE({indice:e,update:{numSeqModal:t,numLotSeqModal:E,modalFor:"RELIQUATPREPARATION"}}))},onOpenModalSearchOrder:()=>{l(a.PREPARATION_UPDATE({indice:e,update:{modalFor:"SEARCHORDER"}}))},onNavigateListCommande:()=>{l(ie(e))},onNavigateListArticles:()=>{l(Ae(e))},onLockOperation:t=>l(Z(t)),updateQuantityPreparation:(t,E=null,s,P=!0)=>l(a.PREPARATION_UPDATE_QUANTITY({indice:e,update:t,plateauState:E,config:s,isPreparationClient:P})),addNewArticle:()=>l(a.ADD_NEW_ARTICLE({indice:e})),updatePreparationForward:t=>l(a.PREPARATION_UPDATE({indice:e,nextStep:_(r),update:{...t}})),updatePreparationBackward:t=>l(a.PREPARATION_UPDATE({indice:e,nextStep:T(r),update:{...t}})),updateArticleForward:t=>l(a.ARTICLE_UPDATE({indice:e,nextStep:_(r),update:{...t}})),updateArticleBackward:t=>l(a.ARTICLE_UPDATE({indice:e,nextStep:T(r),update:{...t}})),onChangeStep:t=>l(B({indice:e,nextStep:t})),onStepBack:()=>l(a.STEP_BACK({indice:e})),onCloseModal:()=>l(a.PREPARATION_CLOSE_MODAL({indice:e})),onClosePreparationLine:(t,E,s)=>l(a.SELECT_ARTICLE({indice:e,prepaArticle:ae(t,E),step:s})),onSelectModePreparation:t=>l(a.PREPARATION_UPDATE({indice:e,nextStep:o(t),update:{mode:t}})),updatePreparation:t=>l(a.PREPARATION_UPDATE({indice:e,update:t})),updateLineCommandeAchat:t=>l(a.PREPARATION_UPDATE_LINE({indice:e,update:t})),onChangeNbExPreparation:(t,E)=>l(a.PREPARATION_UPDATE_LINE_NBEX({indice:e,type:t,increment:E})),leaveLinePreparation:(t=null)=>l(async(E,s)=>{var R,p;const P=q(s(),e);P&&((R=P.preparation)!=null&&R.VEN_LOT_SEQ)&&await j().LockMethods().libereDetailAchat(null,(p=P.preparation)==null?void 0:p.VEN_LOT_SEQ),E(a.PREPARATION_LEAVE_LINE({indice:e,nextStep:t}))}),onContinuePreparation:(t,E)=>{l(a.PREPARATION_UPDATE_LINE({indice:e,update:{quantity:null,nbExColis:null,nbExPalette:null}}))},scanLotSucceeded:t=>l(a.UPDATE_DETAIL_BY_SCAN({indice:e,scan:t})),scanLotSucceededEan128:t=>{var s,P,R,p,d;const E=(s=t==null?void 0:t.infoSpecific)==null?void 0:s.result;l(a.PREPARATION_UPDATE({indice:e,update:{lotId:((P=t==null?void 0:t.infoSpecific)==null?void 0:P.result.lot)||"",lot:(R=t==null?void 0:t.infoSpecific)==null?void 0:R.result.mouvement},nextStep:r})),l(a.PREPARATION_UPDATE_QUANTITY({indice:e,update:{poids:E==null?void 0:E.poidsNet,piece:E==null?void 0:E.piece},plateauState:null,config:{poidsColisMoyen:((p=t==null?void 0:t.article)==null?void 0:p.ART_PDS_NET)||null,pieceParColisMoyen:((d=t==null?void 0:t.article)==null?void 0:d.ART_PIECE_COL)||null,poidsPieceMoyen:1,uniteCommande:(t==null?void 0:t.uc)||"",SIT_VE_RECALCUL_UNITES:!0,SIT_VE_FORMAT_COLIS:null,SIT_VE_FORMAT_POIDS:null,unitRecalcul:"C",articlePoidsVariable:!0},isPreparationClient:!0}))},selectPreparationLineModal:(t,E=null)=>{l(a.SELECT_PREPARATION_MODAL({indice:e,VEN_LOT_SEQ:t,InfoCodeBarre:E}))},selectPreparation:(t,E=N.DETAILS)=>l(a.SELECT_PREPARATION({indice:e,preparation:re(t,0),nextStep:E||null})),selectPreparationLine:t=>l(a.SELECT_PREPARATION({indice:e,preparation:le(t),nextStep:_(r)})),selectPreparationLineCb:(t,E,s,P,R,p,d,g)=>{var Q,x,y;l(a.PREPARATION_UPDATE({indice:e,update:{preparation:{VEN_NUMSEQ:E.VEN_NUMSEQ,VEN_LOT_SEQ:E.VEN_LOT_SEQ,InfoCodeBarre:s,art_code:(Q=E.Article)==null?void 0:Q.ART_CODE,ven_date_enl:null,tour_code:null,articleStat1:null,articleDestock:null,articleStockage:null,orderUnit:null,numOrder:E.VEN_CDE,currentLine:{}},lotId:(s==null?void 0:s.result.lot)||"",lot:g||(s==null?void 0:s.result.mouvement)},nextStep:P})),t||l(a.PREPARATION_UPDATE_QUANTITY({indice:e,update:{poids:s==null?void 0:s.result.poidsNet,piece:s==null?void 0:s.result.piece},plateauState:null,config:{poidsColisMoyen:((x=E.Article)==null?void 0:x.ART_PDS_NET)||null,pieceParColisMoyen:((y=E.Article)==null?void 0:y.ART_PIECE_COL)||null,poidsPieceMoyen:1,uniteCommande:E.VEN_UNIT_CDE||"",SIT_VE_RECALCUL_UNITES:!0,SIT_VE_FORMAT_COLIS:p,SIT_VE_FORMAT_POIDS:d,unitRecalcul:R||"C",articlePoidsVariable:!0},isPreparationClient:!0}))},unSelectPreparation:(t=null)=>l(a.UNSELECT_PREPARATION({indice:e,nextStep:t})),selectArticle:t=>l(a.SELECT_ARTICLE({indice:e,prepaArticle:Ee(t,0),step:_(r)})),selectArticleLine:t=>l(a.SELECT_ARTICLE({indice:e,prepaArticle:ce(t),step:_(r)})),unselectArticle:(t=null)=>l(a.UNSELECT_ARTICLE({indice:e,nextStep:t})),resetLine:()=>l(a.PREPARATION_RESET_LINE({indice:e})),addWeight:()=>l(a.PREPARATION_RESET_WEIGHT({indice:e})),clearPalette:()=>l(a.PREPARATION_CLEAR_PALETTE({indice:e})),clearEmballage:()=>l(a.PREPARATION_CLEAR_EMBALLAGE({indice:e})),updatePalette:t=>l(a.PREPARATION_UPDATE_PALETTE({indice:e,palette:t})),updatePaletteIncrement:t=>l(a.PREPARATION_UPDATE_PALETTE_INCREMENT({indice:e,increment:t})),updateEmballage:t=>l(a.PREPARATION_UPDATE_EMBALLAGE({indice:e,emballage:t})),updateEmballageIncrement:t=>l(a.PREPARATION_UPDATE_EMBALLAGE_INCREMENT({indice:e,increment:t})),restartPreparation:()=>l(a.RESTART_PREPARATION({indice:e})),onSetDatePreparation:t=>l(a.setDatePreparation({indice:e,date:t})),onSetImprimante:(t,E)=>l(a.PREPARATION_UPDATE({indice:e,update:{[t]:E}})),onSelectOrder:t=>l(a.SELECT_PREPARATION({indice:e,preparation:{VEN_NUMSEQ:t,VEN_LOT_SEQ:null,InfoCodeBarre:null,art_code:null,tour_code:null,ven_date_enl:null,articleDestock:null,articleStat1:null,orderUnit:null,articleStockage:null,numOrder:null},nextStep:N.CURRENTPREPARATION})),onNotFoundOrder:t=>m(t+" "+u("notFound")+"."),onClosePreparation:(t,E)=>{l(a.PREPARATION_CLOSE(t)),l(B({indice:e,nextStep:E})),l(a.PREPARATION_NEW(X(O,D||"",M.HOME,null,U)))}}),[o,_,T,r,c,e])},se=e=>{const n=S(i=>i.PREPARATIONS.preparations[e].sessionId),r=S(i=>i.PREPARATIONS.preparations[e].codeBorne),c=S(i=>i.PREPARATIONS.preparations[e].date);return{sessionId:n,borneId:r,dateEnl:c}},pe=e=>{const n=S(T=>q(T,e),w),{getParametreBorneZone1:r,getParametreBorne:c,getParametreBorneValue:i}=k(),u=V((n==null?void 0:n.mode)||null,(n==null?void 0:n.steps)||null),o=I(e,u,(n==null?void 0:n.step)||null),{getApplicationOption:_}=K();return{actions:o,operation:n,getApplicationOption:_,getParametreBorneZone1:r,getParametreBorne:c,getParametreBorneValue:i}},Ne=e=>{const n=L.useMemo(()=>J(e),[e]),r=S(l=>{try{return n(l)}catch{return null}}),{getParametreBorneZone1:c,getParametreBorne:i}=k(),u=V((r==null?void 0:r.mode)||null,(r==null?void 0:r.steps)||null),o=I(e,u,(r==null?void 0:r.step)||N.HOME),{codePersonnel:_,nomPersonnel:T}=b((r==null?void 0:r.sessionId)||"");return{codePersonnel:_,nomPersonnel:T,operation:r,actions:o,getParametreBorneZone1:c,getParametreBorne:i,steps:u.steps,step:(r==null?void 0:r.step)||N.HOME}};export{ne as F,Re as a,Te as b,oe as c,Se as d,Ne as e,Pe as s,pe as u};
