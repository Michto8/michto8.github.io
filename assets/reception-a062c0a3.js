import{g as wn,a as Qn,k as zt,s as Se,i as $e,_ as Be,d as $t,r as g,u as Gn,e as Vn,j as e,f as qn,h as Wn,c as ke,aq as f,bW as zn,b9 as Ee,bf as Ye,bX as Et,bY as H,bg as Ae,b8 as mt,bZ as S,b_ as $n,as as B,b$ as He,c0 as Xe,c1 as Zn,c2 as Kn,c3 as Yn,c4 as Xn,an as oe,c5 as we,c6 as Jn,aF as W,c7 as Je,ar as pe,c8 as ht,bL as De,c9 as $,ca as Zt,ao as Kt,cb as er,cc as z,az as de,ax as tr,cd as Ze,G as T,aC as G,ce as nr,C as P,cf as rr,cg as sr,ch as at,ci as or,w as Yt,x as Xt,bB as _t,bq as pt,bt as xt,cj as ir,ck as Nt,au as ge,cl as te,a7 as re,bC as Dt,aD as ct,bE as Re,cm as Jt,br as en,cn as ar,bu as cr,bG as lr,aj as tn,F as se,am as Ct,co as ur,aI as Qe,ae as Ie,aa as dr,cp as Er,cq as mr,cr as et,cs as hr,I as _r,ct as nn,cu as pr,cv as Pe,cw as Ue,aT as ye,cx as xr,cy as Cr,cz as tt,bD as fr,aS as Ce,cA as Ar,cB as lt,cC as rn,E as gr,cD as yt,cE as Pr,cF as Tr,cG as Rr,b4 as ft,cH as sn,bP as on,cI as Lr,bM as Ge,cJ as Sr,bN as Ir,bO as Or,bs as jr,cK as At,Z as br,cL as vr,cM as Fe,cN as an,cO as Ke,cP as je,cQ as be,cR as cn,cS as ln,X as Mr,cT as nt,bR as Ve,cU as un,cV as Nr,cW as Dr,cX as yr,cY as Br,cZ as Ur,c_ as Fr,c$ as kr,d0 as dn,bQ as Hr,d1 as Bt,d2 as wr,d3 as Ut,d4 as Qr,d5 as gt,d6 as Pt,d7 as Gr,d8 as Vr,T as qr,d9 as Wr,da as zr,db as $r,dc as Zr,dd as Kr,de as En,df as Yr,dg as Ft,aH as Xr}from"./index-2ba9b923.js";import{B as ut,P as Jr,d as es}from"./Numbers-f6b5ce6e.js";import{M as it,P as Le,a as fe,B as Ne,b as qe,g as Tt,I as mn,S as ve,c as Me,A as hn,d as _n,L as ts,T as ns,s as rs,e as kt,f as ss,h as Oe,i as os,j as is,k as as,l as cs}from"./index-932bdf39.js";import{u as pn}from"./hooks-0ab2d73a.js";import{d as ls}from"./Group-68c9cc62.js";import"./stepperIcon-58214ebb.js";import"./actions-d163bdb2.js";import"./lneContainerFidege-213a2d35.js";function us(t){return wn("MuiCircularProgress",t)}Qn("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const ds=["className","color","disableShrink","size","style","thickness","value","variant"];let rt=t=>t,Ht,wt,Qt,Gt;const xe=44,Es=zt(Ht||(Ht=rt`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),ms=zt(wt||(wt=rt`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),hs=t=>{const{classes:r,variant:n,color:s,disableShrink:i}=t,a={root:["root",n,`color${$e(s)}`],svg:["svg"],circle:["circle",`circle${$e(n)}`,i&&"circleDisableShrink"]};return Wn(a,us,r)},_s=Se("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,r[n.variant],r[`color${$e(n.color)}`]]}})(({ownerState:t,theme:r})=>Be({display:"inline-block"},t.variant==="determinate"&&{transition:r.transitions.create("transform")},t.color!=="inherit"&&{color:(r.vars||r).palette[t.color].main}),({ownerState:t})=>t.variant==="indeterminate"&&$t(Qt||(Qt=rt`
      animation: ${0} 1.4s linear infinite;
    `),Es)),ps=Se("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(t,r)=>r.svg})({display:"block"}),xs=Se("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.circle,r[`circle${$e(n.variant)}`],n.disableShrink&&r.circleDisableShrink]}})(({ownerState:t,theme:r})=>Be({stroke:"currentColor"},t.variant==="determinate"&&{transition:r.transitions.create("stroke-dashoffset")},t.variant==="indeterminate"&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}),({ownerState:t})=>t.variant==="indeterminate"&&!t.disableShrink&&$t(Gt||(Gt=rt`
      animation: ${0} 1.4s ease-in-out infinite;
    `),ms)),Cs=g.forwardRef(function(r,n){const s=Gn({props:r,name:"MuiCircularProgress"}),{className:i,color:a="primary",disableShrink:u=!1,size:d=40,style:l,thickness:o=3.6,value:c=0,variant:E="indeterminate"}=s,_=Vn(s,ds),h=Be({},s,{color:a,disableShrink:u,size:d,thickness:o,value:c,variant:E}),x=hs(h),A={},C={},p={};if(E==="determinate"){const R=2*Math.PI*((xe-o)/2);A.strokeDasharray=R.toFixed(3),p["aria-valuenow"]=Math.round(c),A.strokeDashoffset=`${((100-c)/100*R).toFixed(3)}px`,C.transform="rotate(-90deg)"}return e.jsx(_s,Be({className:qn(x.root,i),style:Be({width:d,height:d},C,l),ownerState:h,ref:n,role:"progressbar"},p,_,{children:e.jsx(ps,{className:x.svg,ownerState:h,viewBox:`${xe/2} ${xe/2} ${xe} ${xe}`,children:e.jsx(xs,{className:x.circle,style:A,ownerState:h,cx:xe,cy:xe,r:(xe-o)/2,fill:"none",strokeWidth:o})})}))}),fs=Cs,xn=ke(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),As=ke(e.jsx("path",{d:"M20 2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h4v5l4-2 4 2v-5h4c1.11 0 2-.89 2-2V4c0-1.11-.89-2-2-2zm0 13H4v-2h16v2zm0-5H4V4h16v6z"}),"CardMembership"),gs=ke(e.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"}),"Chat"),Ps=ke([e.jsx("path",{d:"M5 8h2v8H5zm7 0H9c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 6h-1v-4h1v4zm7-6h-3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 6h-1v-4h1v4z"},"0"),e.jsx("path",{d:"M2 4v16h20V4H2zm2 14V6h16v12H4z"},"1")],"Money"),Ts=ke(e.jsx("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.64 15H6.49v-4.5l-.9.66-.58-.89L6.77 9h.87v6zm5.86 0H9.61v-1.02c1.07-1.07 1.77-1.77 2.13-2.15.4-.42.54-.69.54-1.06 0-.4-.31-.72-.81-.72-.52 0-.8.39-.9.72l-1.01-.42c.01-.02.18-.76 1-1.15.69-.33 1.48-.2 1.95.03.86.44.91 1.24.91 1.48 0 .64-.31 1.26-.92 1.86-.25.25-.72.71-1.4 1.39l.03.05h2.37V15zm5.25-.85c-.08.13-.56.85-1.76.85-.04 0-1.6.08-2.05-1.51l1.03-.41c.03.1.19.86 1.02.86.41 0 .89-.28.89-.77 0-.55-.48-.79-1.04-.79h-.5v-1h.46c.33 0 .88-.14.88-.72 0-.39-.31-.65-.75-.65-.5 0-.74.32-.85.64l-.99-.41C15.2 9.9 15.68 9 16.94 9c1.09 0 1.54.64 1.62.75.33.5.28 1.16.02 1.57-.15.22-.32.38-.52.48v.07c.28.11.51.28.68.52.37.52.33 1.27.01 1.76z"}),"Pin"),Rt=(t,r,n,s,i)=>({arrivage:{activeLot:r,paramLot:i,listeComplements:n,listeLitiges:s},pesee:t}),Lt=t=>f.map(t,r=>({ACH_LIT_LIBELLE:r.ACH_LIT_LIBELLE||"",ACH_LIT_CODE:r.ACH_LIT_CODE||"",ACH_LIT_QTE_PREVU:r.ACH_LIT_QTE_PREVU||0,ACH_LIT_QTE_RECU:r.ACH_LIT_QTE_RECU||0,ACH_LIT_TYPE:r.ACH_LIT_TYPE||"",ACH_LIT_MSG_COURT:r.ACH_LIT_MSG_COURT||"",ACH_LIT_MSG_LONG1:r.ACH_LIT_MSG_LONG1||"",ACH_LIT_MSG_LONG2:r.ACH_LIT_MSG_LONG2||"",ACH_LIT_MSG_LONG3:r.ACH_LIT_MSG_LONG3||"",ACH_LIT_MSG_LONG4:r.ACH_LIT_MSG_LONG4||"",ACH_LIT_MSG_LONG5:r.ACH_LIT_MSG_LONG5||"",ACH_LIT_MSG_LONG6:r.ACH_LIT_MSG_LONG6||""})),St=t=>{const{mode:r,step:n}=Ee(s=>f.pick(He(s,t),["mode","step"]),Xe);return It(t,Et(r),n)},Rs=(t,r)=>({ACH_NUMSEQ:t.ACH_NUMSEQ,fournisseur:t.Fournisseur,ACH_LOT_SEQ:r,ACH_ADLIV:t.ACH_ADLIV}),Ls=t=>({ACH_NUMSEQ:t.ACH_NUMSEQ,fournisseur:t.Fournisseur,ACH_LOT_SEQ:t.ACH_LOT_SEQ,ACH_ADLIV:t.ACH_ADLIV});function Ss(t){return async(r,n)=>{var a,u;if(t.nextStep===H.CURRENTLINESAVE)return;const i=n().RECEPTIONS.receptions[t.indice];i&&i.mode===1&&((a=i.reception)!=null&&a.ACH_NUMSEQ)&&(f.includes([H.CURRENTLINECPL,H.CURRENTRECEPTION,H.CURRENTLINESAVE],t.nextStep)||await B().LockMethods().libereAchat(null,(u=i.reception)==null?void 0:u.ACH_NUMSEQ)),r(S.RECEPTION_UPDATE({indice:t.indice,nextStep:t.nextStep,update:{}}))}}const It=(t,r,n)=>{const s=Ae(),{steps:i,getFirstStep:a,getNextStep:u,getPreviousStep:d}=r,l=mt();return g.useMemo(()=>({messages:s,onOpenReliquatReception:o=>{l(S.RECEPTION_UPDATE({indice:t,update:{numSeqModal:o}})),l(S.RECEPTION_UPDATE_LINE({indice:t,update:{modalFor:"RELIQUATRECEPTION"}}))},updateQuantityArrivage:(o,c=null,E)=>l(S.ARRIVAGE_UPDATE_QUANTITY({indice:t,update:o,plateauState:c,config:E})),updateQuantityReception:(o,c=null,E)=>l(S.RECEPTION_UPDATE_QUANTITY({indice:t,update:o,plateauState:c,config:E})),onLockOperation:o=>{l($n(o))},updateReceptionForward:o=>l(S.RECEPTION_UPDATE({indice:t,nextStep:u(n),update:{...o}})),updateReceptionBackward:o=>l(S.RECEPTION_UPDATE({indice:t,nextStep:d(n),update:{...o}})),updateReceptionToArticles:()=>l(S.RECEPTION_UPDATE({indice:t,nextStep:H.ARTICLES,update:{}})),onChangeStep:o=>l(Ss({indice:t,nextStep:o})),onCloseModal:()=>l(S.RECEPTION_CLOSE_MODAL({indice:t})),onSelectModeReception:o=>l(S.RECEPTION_UPDATE({indice:t,nextStep:a(o),update:{mode:o}})),updateReception:o=>l(S.RECEPTION_UPDATE({indice:t,update:o})),onContinueArrivage:(o,c)=>l(async(E,_)=>{try{if(!c)return;const h=await Promise.all([B().CommunMethods().rechercheInfoArticleSaisiArrivage({variables:{codeArticle:c.PESEE_ART,context:null}}),B().CommunMethods().rechercheInfoFournisseur({variables:{codeFournisseur:c.PESEE_FOU,context:null}})]);if(!h[0]||!h[1])return;E(S.RECEPTION_UPDATE({indice:t,update:{articleArrivage:h[0],fournisseurArrivage:h[1]}})),E(S.RECEPTION_CLEAR_COMPLEMENTS({indice:t})),E(S.ARRIVAGE_UPDATE_LINE({indice:t,update:{PESEE_SUP_ACH_LOT_SEQ:c.PESEE_ACH_LOTSEQ,quantity:null,nbExColis:null,nbExPalette:null,modalFor:""}}))}catch{}}),updateLineCommandeAchat:o=>l(S.RECEPTION_UPDATE_LINE({indice:t,update:o})),updateLineArrivage:o=>l(S.ARRIVAGE_UPDATE_LINE({indice:t,update:o})),onChangeNbExReception:(o,c)=>l(S.RECEPTION_UPDATE_LINE_NBEX({indice:t,type:o,increment:c})),onChangeNbExArrivage:(o,c)=>l(S.ARRIVAGE_UPDATE_LINE_NBEX({indice:t,type:o,increment:c})),leaveLineReception:(o=null)=>l(async(c,E)=>{var h,x;const _=He(E(),t);_&&((h=_.reception)!=null&&h.ACH_LOT_SEQ)&&await B().LockMethods().libereDetailAchat(null,(x=_.reception)==null?void 0:x.ACH_LOT_SEQ),c(S.RECEPTION_LEAVE_LINE({indice:t,nextStep:o}))}),selectReception:(o,c=H.CURRENTRECEPTION)=>l(S.SELECT_RECEPTION({indice:t,reception:Rs(o,0),step:c||null})),selectReceptionLine:(o,c=H.CURRENTRECEPTION)=>l(S.SELECT_RECEPTION({indice:t,reception:Ls(o),step:c})),unSelectReception:(o=null)=>l(S.UNSELECT_RECEPTION({indice:t,nextStep:o})),updateComplement:o=>l(S.RECEPTION_UPDATE_COMPLEMENT({indice:t,complement:o})),resetLine:()=>l(S.RECEPTION_RESET_LINE({indice:t})),updateLitige:o=>l(S.RECEPTION_UPDATE_LITIGE({indice:t,litige:o})),updateCurrentLitige:o=>l(S.RECEPTION_UPDATE_CURRENT_LITIGE({indice:t,uuid:o})),removeLitige:o=>l(S.RECEPTION_REMOVE_LITIGE({indice:t,uuid:o})),addLitige:o=>l(S.RECEPTION_ADD_LITIGE({indice:t,litige:o})),clearComplements:()=>l(S.RECEPTION_CLEAR_COMPLEMENTS({indice:t})),clearPalette:()=>l(S.RECEPTION_CLEAR_PALETTE({indice:t})),clearEmballage:()=>l(S.RECEPTION_CLEAR_EMBALLAGE({indice:t})),updatePalette:o=>l(S.RECEPTION_UPDATE_PALETTE({indice:t,palette:o})),updatePaletteIncrement:o=>l(S.RECEPTION_UPDATE_PALETTE_INCREMENT({indice:t,increment:o})),updateEmballage:o=>l(S.RECEPTION_UPDATE_EMBALLAGE({indice:t,emballage:o})),updateEmballageIncrement:o=>l(S.RECEPTION_UPDATE_EMBALLAGE_INCREMENT({indice:t,increment:o})),onSetDateReception:o=>l(S.setDateReception({indice:t,date:o})),restartArrivage:()=>l(S.RESTART_ARRIVAGE({indice:t})),onSetImprimante:(o,c)=>l(S.RECEPTION_UPDATE({indice:t,update:{[o]:c}})),onContinueCommandeAchat:(o,c=!0)=>{l(S.RECEPTION_CLEAR_COMPLEMENTS({indice:t})),l(S.RECEPTION_UPDATE_LINE({indice:t,update:{PESEE_SUP_ACH_LOT_SEQ:o,...c&&{quantity:null,nbExColis:null,nbExPalette:null}}})),l(S.RECEPTION_UPDATE({indice:t,nextStep:H.CURRENTRECEPTION,update:{}}))},onContinuePeseeArrivage:o=>{l(S.RECEPTION_CLEAR_COMPLEMENTS({indice:t})),l(S.ARRIVAGE_UPDATE_LINE({indice:t,update:{PESEE_SUP_ACH_LOT_SEQ:o,quantity:null,nbExColis:null,nbExPalette:null}})),l(S.RECEPTION_UPDATE({indice:t,nextStep:H.CURRENTARRIVAGE,update:{}}))},onOpenLitige:()=>l(S.RECEPTION_UPDATE_LINE({indice:t,update:{modalFor:"LITIGE"}})),onOpenLitigeArrivage:()=>l(S.ARRIVAGE_UPDATE_LINE({indice:t,update:{modalFor:"LITIGE"}})),onOpenReedition:()=>l(S.RECEPTION_UPDATE({indice:t,update:{modalFor:"LotPeseeBorne"}}))}),[i,n,s,t])},me=t=>{const r=Ee(d=>He(d,t),Xe),{getApplicationOption:n,getParametreBorneZone1:s,getParametreBorne:i}=Ye(),a=Et(r==null?void 0:r.mode);return{actions:It(t,a,(r==null?void 0:r.step)||null),operation:r,getPropertyies:n,getParametreBorneZone1:s,getParametreBorne:i}},Is=t=>{const r=g.useMemo(()=>zn(t),[t]),n=Ee(u=>{try{return r(u)}catch{return null}}),{getParametreBorneZone1:s}=Ye(),i=Et(n==null?void 0:n.mode),a=It(t,i,(n==null?void 0:n.step)||H.HOME);return{operation:n,actions:a,getParametreBorneZone1:s,steps:i.steps,step:(n==null?void 0:n.step)||H.HOME}},st=t=>{const r=g.useMemo(()=>Kn(t),[t]);return Ee(r)},Os=t=>{const r=Ee(s=>Zn(s,t));return{actions:St(t),...r}},js=t=>{const{lotActif:r,mode:n}=Ee(o=>Yn(o,t)),{actions:s,operation:i,getParametreBorne:a,getParametreBorneZone1:u}=me(t),d=g.useCallback(o=>{n===1&&s.updateLineCommandeAchat({lotActif:o}),n===2&&s.updateLineArrivage({lotActif:o})},[n,s.updateLineCommandeAchat,s.updateLineArrivage]),l=g.useMemo(()=>{const o=a("PE_LOT_ACTIF");return o&&o.USER_ZONE1==="O"},[a]);return{lotActif:r,onChangeLotActif:d,gereLotActif:l}},bs=(t,r,n,s,i={suspense:!1,useErrorBoundary:!0,cacheTime:5e4})=>we(["useInfoTracaPalette",t.getQueryKey(),r],()=>Jn(B().CommunMethods().rechercheComplementsTracaDetail({variables:{recherche:{rbp:0},filtresOptionnels:null,context:t.current,params:r,fournisseur:n.FOU_CODE,adliv:s}})),i),vs=(t,r,n,s)=>{const i=oe(),a=bs(i,r,n,s,{});return g.useMemo(()=>{var c,E;const u=((E=(c=a.data)==null?void 0:c.res)==null?void 0:E.result)||[],d=f.map(u,_=>{const h=f.find(t,{TRA_NUM:_.TRA_NUM});return{..._,COMP_VAL:h?h.COMP_VAL||"":_.COMP_VAL||_.TRA_DEFAUT_VALEUR}}),l=f.filter(u,{TRA_OBLIG:"O"});return{infoComplements:{obligatoire:f.size(l),total:f.size(u),saisi:f.size(f.filter(d,_=>!!_.COMP_VAL))},complements:d}},[a.data,t])},We=t=>{const r=Ee(_=>Xn(_,t)),{currentLotSeq:n,codeArticle:s,PESEE_SUP_ACH_LOT_SEQ:i,fournisseur:a,adliv:u}=Ee(_=>{var L,I,M,O,U,w;const h=He(_,t),x=(h==null?void 0:h.mode)===1&&((L=h==null?void 0:h.reception)==null?void 0:L.ACH_LOT_SEQ)||0,A=(h==null?void 0:h.mode)===1&&((M=(I=h==null?void 0:h.reception)==null?void 0:I.currentLine)==null?void 0:M.PESEE_SUP_ACH_LOT_SEQ)||0,C=(h==null?void 0:h.mode)===1?"":((O=h==null?void 0:h.articleArrivage)==null?void 0:O.ACH_COM_ART)||"",p=(h==null?void 0:h.mode)===1?(U=h==null?void 0:h.reception)==null?void 0:U.fournisseur:h==null?void 0:h.fournisseurArrivage,R=(h==null?void 0:h.mode)===1?((w=h==null?void 0:h.reception)==null?void 0:w.ACH_ADLIV)||1:(h==null?void 0:h.adlivArrivage)||1;return{currentLotSeq:x,codeArticle:C,PESEE_SUP_ACH_LOT_SEQ:A,fournisseur:p,adliv:R}},Xe),d=mt(),l=_=>d(S.RECEPTION_UPDATE_COMPLEMENT({indice:t,complement:{..._,COMP_ACH_LOTSEQ:n}})),o=_=>d(S.RECEPTION_CLEAR_COMPLEMENT({indice:t,COMP_ACH_LOTSEQ:n,TRA_NUM:_})),{complements:c,infoComplements:E}=vs(r,{lotSeq:i||n,litige:!1,codeArticle:s},a,u);return{complements:c,infoComplements:E,fournisseur:a,onUpdateComplement:l,onClearComplement:o}},Ms=t=>{var ie,Z,ue,ae,K;const r=Ae(),{t:n}=W(),s=oe(),{actions:i,operation:a,getParametreBorne:u,getParametreBorneZone1:d}=me(t),l=st(t),o=We(t),c=(ie=a==null?void 0:a.arrivage)==null?void 0:ie.ACH_NUMSEQ,E=(Z=a==null?void 0:a.arrivage)==null?void 0:Z.ACH_LOT_SEQ,_=a==null?void 0:a.palette,h=a==null?void 0:a.emballage,x=(ue=a==null?void 0:a.arrivage)==null?void 0:ue.currentLine,A=Je(x==null?void 0:x.quantity,h,_,u("PE_EMB_PART")),C=()=>{var j,m;return{PESEE_ART:((j=a==null?void 0:a.articleArrivage)==null?void 0:j.ART_CODE)||"",PESEE_FOU:((m=a==null?void 0:a.fournisseurArrivage)==null?void 0:m.FOU_CODE)||"",PESEE_ACH_NUMSEQ:c,PESEE_ACH_LOTSEQ:E,PESEE_NBEMB:A.colis||0,PESEE_PIE:A.piece||0,PESEE_PDSNET:A.poids||0,PESEE_LOT:"0",PESEE_TYPE_PAL:(_==null?void 0:_.EMB_CODE)||"",PESEE_NB_PAL:(_==null?void 0:_.quantity)||0,PESEE_TARE_PALETTE:(_==null?void 0:_.poids)||0,PESEE_EMB:(h==null?void 0:h.EMB_CODE)||"",PESEE_TARE:(h==null?void 0:h.poids)||0,PESEE_MARQUE:A.dsd||"",PESEE_ACH_LOTLIG:null,PESEE_DATE:ht(new Date),PESEE_BORNE:s.current.codeBorne,PESEE_EMP:s.current.codePersonnel,PESEE_FREINTE:null,PESEE_ANNONCE:null,PESEE_PRIX:(x==null?void 0:x.prixAchat)||null}},p=g.useMemo(()=>({PE_ETIQ_ORI:u("PE_ETIQ_ORI"),PE_ETIQ_PLUS:u("PE_ETIQ_PLUS"),PE_LOT_ACTIF:u("PE_LOT_ACTIF"),PE_ETIQ:d("PE_ETIQ"),PE_ETIQ_PAL:d("PE_ETIQ_PAL"),PP_DSD_ACTIF:d("PP_ACTIF")&&d("PP_DEBUT_DSD"),PE_PRIX:d("PE_PRIX"),PE_LOT:u("PE_LOT"),PE_ETIQ_NB_P:u("PE_ETIQ_NB_P")}),[d]),R=()=>{const j=p.PE_ETIQ_ORI;return j===null?1:j.USER_ZONE1==="K"?parseInt(j.USER_ZONE2):j.USER_ZONE1==="C"?f.ceil(A.colis||0):f.ceil(A.piece||0)},L=()=>{const j=p.PE_ETIQ_PLUS;return j===null?0:parseInt(j.USER_ZONE2)},I=()=>{const j=p.PE_LOT_ACTIF;return j===null?!1:j.USER_ZONE2==="A"},M=(()=>{const j=p.PE_LOT_ACTIF;return j===null?!1:j.USER_ZONE1==="O"})(),O=()=>{const j=p.PE_ETIQ_NB_P;return j===null?1:j.USER_ZONE1==="P"?((_==null?void 0:_.quantity)??0)+parseInt(j.USER_ZONE2):j.USER_ZONE1==="K"?parseInt(j.USER_ZONE2):f.ceil((_==null?void 0:_.quantity)||0)},U=p.PE_ETIQ,w=p.PE_ETIQ_PAL,V=p.PP_DSD_ACTIF,k=((ae=p.PE_LOT)==null?void 0:ae.USER_ZONE1)||"A",D=p.PE_PRIX,F=(x==null?void 0:x.lotActif)??I(),N=+(U&&((x==null?void 0:x.nbExColis)??R()+L())),J=+(w&&((x==null?void 0:x.nbExPalette)??O())),le=pe({mutationFn:j=>(i.onLockOperation(!0),B().AchatMethods().insertLotPeseeBorneArrivage(s.current,j)),onSettled(j,m,b,y){i.onLockOperation(!1),m&&r.errorMessage(n("errorMessage"))},onError:()=>{r.errorMessage(n("errorMessage"))}}),ee=(j=null)=>{const m=()=>Rt(C(),F,f.map(o.complements,b=>({TRA_NUM:b.TRA_NUM,TRA_VAL:b.COMP_VAL})),Lt(l),k);le.mutate(m(),{onSuccess(b,y,q){var _e,ne;if(b.err||((_e=b.res)==null?void 0:_e.codeResult)!=="OK")r.errorMessage(n("errorMessage"));else try{const Y=(ne=b.res)==null?void 0:ne.result;if(Y&&Y.numeroPesee){const Te=N?B().AchatMethods().editionEtiquetteReception(s.current,{codeEtiquette:"BRE_PESEE",numeroPesee:Y.numeroPesee,nombreExemplaire:N,imprimante:(a==null?void 0:a.imprimanteColis)||""}):Promise.resolve("OK"),he=J?B().AchatMethods().editionEtiquetteReception(s.current,{codeEtiquette:"BRE_PESEE_PAL",numeroPesee:Y.numeroPesee,nombreExemplaire:J,imprimante:(a==null?void 0:a.imprimantePalette)||""}):Promise.resolve("OK");Promise.all([Te,he]).catch(v=>{try{r.errorMessage(v)}catch{}}),i.onContinuePeseeArrivage(Y.achLotSeq),j&&j(Y)}}catch{}}})},X=we(["remotePrixAchatFournisseur",s.getQueryKey()],()=>B().AchatMethods().recherchePrixAchat(C()));return{traca:o,palette:a==null?void 0:a.palette,quantity:A,prixAchat:x==null?void 0:x.prixAchat,nbExColis:N,nbExPalette:J,nbLitiges:f.size(l),lotActif:F,imprimanteColis:(a==null?void 0:a.imprimanteColis)||null,imprimantePalette:(a==null?void 0:a.imprimantePalette)||null,gereLotActif:M,gereDsd:V,gereEditionColis:U,gereEditionPalette:w,gerePrixAchat:D,onValidatePesee:ee,isSaving:le.isLoading,onChangeLotActif:j=>i.updateLineArrivage({lotActif:j}),onSetImprimante:i.onSetImprimante,onChangeNbEx:i.onChangeNbExArrivage,onOpenLitige:i.onOpenLitigeArrivage,onGotoPrevious:()=>i.updateReceptionBackward({}),onChangePrixAchat:j=>i.updateLineArrivage({prixAchat:j}),articleArrivage:a==null?void 0:a.articleArrivage,PrixAchatFournisseur:(K=X.data)==null?void 0:K.res}},Ns=t=>{var o,c;const{actions:r,operation:n,getParametreBorne:s,getParametreBorneZone1:i,getPropertyies:a}=me(t),u=We(t),d=st(t),l=Je((c=(o=n==null?void 0:n.arrivage)==null?void 0:o.currentLine)==null?void 0:c.quantity,n==null?void 0:n.emballage,n==null?void 0:n.palette,s("PE_EMB_PART"));return{actions:r,operation:n,litiges:d,quantity:l,infoComplements:u,emballage:(n==null?void 0:n.emballage)||null,palette:(n==null?void 0:n.palette)||null,getPropertyies:a,getParametreBorneZone1:i,articleArrivage:(n==null?void 0:n.articleArrivage)||null,fournisseurArrivage:(n==null?void 0:n.fournisseurArrivage)||null,adlivArrivage:(n==null?void 0:n.adlivArrivage)||1}};function Ds(t,r,n,s){return De({key:"ReceptionsDetail",fxt:(i,a)=>B().AchatMethods().ListeDetailAchat({variables:{recherche:i,context:(a==null?void 0:a.current)||null}}),options:r,query:t,selectorConfig:n,onSetQuickFilterValueParam:s})}function ys(t,r,n,s){return De({key:"Receptions",fxt:(i,a)=>B().AchatMethods().ListeCommandeAchat({variables:{recherche:i,context:(a==null?void 0:a.current)||null}}),options:r,query:t,selectorConfig:n,onSetQuickFilterValueParam:s})}const Cn="keyRemoteInfoDetailReception",Bs=t=>{var ue,ae,K,j;const r=oe(),{actions:n,operation:s,getParametreBorne:i,getParametreBorneZone1:a}=me(t),u=st(t),d=Ae(),l=We(t),o=(ue=s==null?void 0:s.reception)==null?void 0:ue.ACH_NUMSEQ,c=(ae=s==null?void 0:s.reception)==null?void 0:ae.ACH_LOT_SEQ,E=s==null?void 0:s.palette,_=s==null?void 0:s.emballage,h=(K=s==null?void 0:s.reception)==null?void 0:K.currentLine,x=Je(h==null?void 0:h.quantity,_,E,i("PE_EMB_PART")),A=()=>({PESEE_ACH_NUMSEQ:o,PESEE_ACH_LOTSEQ:c,PESEE_NBEMB:x.colis||0,PESEE_PIE:x.piece||0,PESEE_PDSNET:x.poids||0,PESEE_TARE:x.tare||0,PESEE_MARQUE:x.dsd||"",PESEE_LOT:"0",PESEE_TYPE_PAL:(E==null?void 0:E.EMB_CODE)||"",PESEE_NB_PAL:(E==null?void 0:E.quantity)||0,PESEE_TARE_PALETTE:(E==null?void 0:E.poids)||0,PESEE_EMB:(_==null?void 0:_.EMB_CODE)||"",PESEE_ACH_LOTLIG:null,PESEE_DATE:ht(new Date),PESEE_BORNE:r.current.codeBorne,PESEE_EMP:r.current.codePersonnel,PESEE_FREINTE:null,PESEE_ANNONCE:null,PESEE_PRIX:(h==null?void 0:h.prixAchat)||null}),C=g.useMemo(()=>({PE_ETIQ_ORI:i("PE_ETIQ_ORI"),PE_ETIQ_PLUS:i("PE_ETIQ_PLUS"),PE_LOT_ACTIF:i("PE_LOT_ACTIF"),PE_RELIQUAT:a("PE_RELIQUAT"),PE_BT_LITIGE:a("PE_BT_LITIGE"),PE_ETIQ:a("PE_ETIQ"),PE_ETIQ_PAL:a("PE_ETIQ_PAL"),PP_DSD_ACTIF:a("PP_ACTIF")&&a("PP_DEBUT_DSD"),PE_PRIX:a("PE_PRIX"),PE_LOT:i("PE_LOT"),PE_ETIQ_NB_P:i("PE_ETIQ_NB_P")}),[a]),p=()=>{const m=C.PE_ETIQ_ORI;return m===null?1:m.USER_ZONE1==="K"?parseInt(m.USER_ZONE2):m.USER_ZONE1==="C"?f.ceil(x.colis||0):f.ceil(x.piece||0)},R=()=>{const m=C.PE_ETIQ_PLUS;return m===null?0:parseInt(m.USER_ZONE2)},L=()=>{const m=C.PE_LOT_ACTIF;return m===null?!1:m.USER_ZONE2==="A"},I=(()=>{const m=C.PE_LOT_ACTIF;return m===null?!1:m.USER_ZONE1==="O"})(),M=()=>{const m=C.PE_ETIQ_NB_P;return m===null?1:m.USER_ZONE1==="P"?((E==null?void 0:E.quantity)??0)+parseInt(m.USER_ZONE2):m.USER_ZONE1==="K"?parseInt(m.USER_ZONE2):f.ceil((E==null?void 0:E.quantity)||0)},O=C.PE_ETIQ,U=C.PE_ETIQ_PAL,w=C.PE_RELIQUAT,V=C.PE_BT_LITIGE,k=C.PP_DSD_ACTIF,D=C.PE_PRIX,F=(h==null?void 0:h.lotActif)??L(),N=+(O&&((h==null?void 0:h.nbExColis)??p()+R())),J=+(U&&((h==null?void 0:h.nbExPalette)??M())),le=((j=C.PE_LOT)==null?void 0:j.USER_ZONE1)||"A",ee=pe({mutationFn:m=>(n.onLockOperation(!0),B().AchatMethods().insertLotPeseeBorneReception(r.current,m)),onSettled(m,b,y,q){n.onLockOperation(!1),b&&d.errorMessage(z("errorMessage"))}}),X=(m=null)=>{const b=()=>Rt(A(),F,f.map(l.complements,y=>({TRA_NUM:y.TRA_NUM,TRA_VAL:y.COMP_VAL})),Lt(u),le);ee.mutate(b(),{onSuccess(y,q,_e){var ne,Y,Te;if(y.err||((ne=y.res)==null?void 0:ne.codeResult)!=="OK")d.errorMessage(z(((Y=y.res)==null?void 0:Y.codeResult)||"errorMessage"));else{try{const he=(Te=y.res)==null?void 0:Te.result;if(he&&he.numeroPesee){const v=N?B().AchatMethods().editionEtiquetteReception(r.current,{codeEtiquette:"BRE_PESEE",numeroPesee:he.numeroPesee,nombreExemplaire:N,imprimante:(s==null?void 0:s.imprimanteColis)||""}):Promise.resolve("OK"),Q=J?B().AchatMethods().editionEtiquetteReception(r.current,{codeEtiquette:"BRE_PESEE_PAL",numeroPesee:he.numeroPesee,nombreExemplaire:J,imprimante:(s==null?void 0:s.imprimantePalette)||""}):Promise.resolve("OK");Promise.all([v,Q]).catch(ce=>{try{d.errorMessage(ce)}catch{}})}}catch{}m&&m(y.res.result)}}})},ie=pe({mutationFn:m=>(n.onLockOperation(!0),B().AchatMethods().finReceptionLigne(m.lotSeq,m.reliquat)),onSettled(m,b,y,q){n.onLockOperation(!1),b&&d.errorMessage(z("errorMessage"))}}),Z=(m,b)=>{ie.mutate({lotSeq:c,reliquat:m},{onSettled(y,q,_e,ne){q&&b({codeResult:"ERR_NETWORK",result:null})},onSuccess(y,q,_e){var ne,Y;(y.err||((ne=y.res)==null?void 0:ne.codeResult)!=="OK")&&d.errorMessage(z(((Y=y.res)==null?void 0:Y.codeResult)||"errorMessage")),b(y.res)}})};return{traca:l,palette:s==null?void 0:s.palette,quantity:x,prixAchat:h==null?void 0:h.prixAchat,nbExColis:N,nbExPalette:J,nbLitiges:f.size(u),lotActif:F,imprimanteColis:(s==null?void 0:s.imprimanteColis)||null,imprimantePalette:(s==null?void 0:s.imprimantePalette)||null,gereLotActif:I,gereEditionColis:O,gereEditionPalette:U,gerePrixAchat:D,gereReliquat:w,gereLitige:V,gereDsd:k,onValidatePesee:X,isSaving:ee.isLoading||ie.isLoading,onChangeLotActif:m=>n.updateLineCommandeAchat({lotActif:m}),onSetImprimante:n.onSetImprimante,onChangeNbEx:n.onChangeNbExReception,onOpenLitige:n.onOpenLitige,onGotoPrevious:()=>n.updateReceptionBackward({}),onChangePrixAchat:m=>n.updateLineCommandeAchat({prixAchat:m}),onContinueCommandeAchat:n.onContinueCommandeAchat,onFinReceptionLigne:Z,onLeaveLine:n.leaveLineReception}},fn=(t,r=[])=>{const{actions:n}=me(t),s=Ae(),i=Kt(),a=pe({mutationFn:d=>(n.onLockOperation(!0),B().AchatMethods().finReceptionLigne(d)),onSuccess:(d,l)=>{i.setQueriesData(["ReceptionsDetail"],er(o=>o.ACH_LOT_SEQ===l))},onSettled(d,l,o,c){var E;n.onLockOperation(!1),l?s.errorMessage(z("errorMessage")):d&&(d.err||((E=d.res)==null?void 0:E.codeResult)!=="OK"?s.errorMessage(z("errorMessage")):(n.leaveLineReception(),i.invalidateQueries({queryKey:["ReceptionsDetail"]}),i.invalidateQueries({queryKey:["ReceptionsDetailReception"]})))}});return{onFinReceptionLigne:g.useCallback(d=>{try{a.mutate(d)}catch(l){console.error(l)}},[]),isSaving:a.isLoading}},Us=(t,r,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>we(["CommandeAchatRemoteInfo",t.getQueryKey(),r],()=>B().AchatMethods().ListeCommandeAchat({variables:{recherche:{rbp:1,qbRules:de("ACH_NUMSEQ",r,"=")},context:null}}),n),An=(t,r,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>we([Cn,t.getQueryKey(),r],()=>B().AchatMethods().DetailAchatDetailReception(r),n),Vt={queryOptions:{enabled:!0}},qt={queryOptions:{enabled:!1}},dt=(t,r="commande")=>{if(r==="commande"){let n=t.match(/(\]C0\.CA)([0-9]*)/);if(n&&n[2])return{fast:!0,qbRules:de("ACH_NUMSEQ",n[2],"=")};if(n=t.match(/(\]C0)([0-9A-Z]*)/),n&&n[2])return{fast:!0,qbRules:de("ACH_CDE",n[2],"=")}}if(r==="detail"){let n=t.match(/(\]C0\.AA)(\w*)/);return n&&n[2]?{fast:!1,qbRules:de("gencod.ART_EAN",n[2],"=")}:(n=t.match(/(\]C1)([0-9]{13})/),n&&n[2]?{fast:!1,qbRules:de("gencod.ART_EAN",n[2],"=")}:(n=t.match(/([0-9]{13})/),n?{fast:!1,qbRules:de("gencod.ART_EAN",n[1],"=")}:dt(t,"commande")))}return{fast:!1,qbRules:null}};function Fs(t){const r=new Date;return tr("ACH_DATE_REC",`${t?Ze(r):""},${Ze(r)}`,"between")}const ks=()=>{const{t}=W(),{getParametreBorneZone1:r,operation:n,actions:s}=me($()),i=g.useMemo(()=>[Fs(r("PE_CDE_JOUR"))],[r]),a=g.useCallback(async o=>{const{val:c,clearCb:E,updateQuickRules:_,updateQuery:h}=o;if(f.has(c,"value")&&f.startsWith(c.value,"]C0")){const x=String(c.value);E&&E();let{qbRules:A,fast:C}=dt(x,"detail");A?C?B().AchatMethods().ListeCommandeAchat({variables:{recherche:{qbRules:A,rbp:1,page:1},context:null}}).then(p=>{p&&p.res&&f.size(p.res.result)>0?s.selectReception(f.head(p.res.result)):s.messages.errorMessage(t("invalidBarcode"))}):_(A):s.messages.errorMessage(t("invalidBarcode"))}else c.operator?h(c):c.value===""?E():h(c);return!0},[]),u=Ds(null,n&&n.step===H.LISTDETAILS?Vt:qt,{initialValues:i},a),d=g.useCallback(async o=>{const{val:c,clearCb:E,updateQuery:_}=o,h=String(c.value);if(f.startsWith(h,"]C1")||f.startsWith(h,"]C0")){E&&E();const{qbRules:x,fast:A}=dt(h);x?B().AchatMethods().ListeCommandeAchat({variables:{recherche:{qbRules:x,rbp:1,page:1},context:null}}).then(C=>{C&&C.res&&f.size(C.res.result)>0?s.selectReception(f.head(C.res.result)):s.messages.errorMessage(t("invalidBarcode"))}):s.messages.errorMessage(t("invalidBarcode"))}else _(c);return!0},[]);return{dataReceptions:ys(null,n&&n.step===H.LISTRECEPTIONS?Vt:qt,{initialValues:i},d),dataDetails:u}},Hs=t=>{const r=oe(),n=Ee(s=>Zt(t,s));return An(r,n)},ws=t=>{const r=St(t);return{achLotSeq:Ee(s=>Zt(t,s)),onLeaveLine:r.leaveLineReception}},Qs=t=>{var R;const r=Ae(),n=oe(),s=me(t),i=We(t),a=st(t),{currentLine:u,ACH_NUMSEQ:d,ACH_LOT_SEQ:l}=s.operation.reception,{palette:o,emballage:c}=s.operation,E=s.getParametreBorne("PE_LOT_ACTIF"),_=((R=s.getParametreBorne("PE_LOT"))==null?void 0:R.USER_ZONE1)||"A",h=(u==null?void 0:u.lotActif)??(E&&E.USER_ZONE2==="A"||!1),x=Je(u==null?void 0:u.quantity,c,o,s.getParametreBorne("PE_EMB_PART")),A=()=>({PESEE_ACH_NUMSEQ:d,PESEE_ACH_LOTSEQ:l,PESEE_NBEMB:x.colis||0,PESEE_PIE:x.piece||0,PESEE_PDSNET:x.poids||0,PESEE_LOT:"0",PESEE_TYPE_PAL:(o==null?void 0:o.EMB_CODE)||"",PESEE_NB_PAL:(o==null?void 0:o.quantity)||0,PESEE_TARE_PALETTE:(o==null?void 0:o.poids)||0,PESEE_EMB:(c==null?void 0:c.EMB_CODE)||"",PESEE_TARE:(c==null?void 0:c.poids)||0,PESEE_MARQUE:x.dsd||"",PESEE_ACH_LOTLIG:null,PESEE_DATE:ht(new Date),PESEE_BORNE:n.current.codeBorne,PESEE_EMP:n.current.codePersonnel,PESEE_FREINTE:null,PESEE_ANNONCE:null,PESEE_PRIX:(u==null?void 0:u.prixAchat)||null}),C=pe({mutationFn:L=>B().AchatMethods().insertLotPeseeBorneReception(n.current,L),onError:()=>{r.errorMessage(z("errorMessage"))}});return{litiges:a,quantity:x,info:s,infoComplements:i,onValidatePeseeDirect:(L=null)=>{s.actions.onLockOperation(!0);const I=()=>Rt(A(),h,f.map(i.complements,M=>({TRA_NUM:M.TRA_NUM,TRA_VAL:M.COMP_VAL})),Lt(a),_);C.mutate(I(),{onSettled(){s.actions.onLockOperation(!1)},onSuccess(M,O,U){var w,V,k;if(M.err||((w=M.res)==null?void 0:w.codeResult)!=="OK")r.errorMessage(z("errorMessage"));else try{const D=(V=M.res)==null?void 0:V.result;if(D&&D.numeroPesee){const F=B().AchatMethods().editionEtiquetteReception(n.current,{codeEtiquette:"BRE_PESEE",numeroPesee:D.numeroPesee,nombreExemplaire:1,imprimante:((k=s.operation)==null?void 0:k.imprimanteColis)||""});Promise.all([F]).catch(N=>{try{r.errorMessage(N)}catch{}}),L&&L(D)}}catch{}}})}}},gn=t=>{const{actions:r,operation:n,getParametreBorne:s,getParametreBorneZone1:i}=me(t),a=Ae(),u=pe({mutationFn:c=>(r.onLockOperation(!0),B().AchatMethods().finReceptionCommande(c)),onSettled(c,E,_,h){r.onLockOperation(!1),E&&a.errorMessage(z("errorMessage"))}}),d=pe({mutationFn:c=>(r.onLockOperation(!0),B().AchatMethods().finReceptionCommandeReliquat(c.numSeq,c.dateCommande,c.dateReception,c.listManquants)),onSettled(c,E,_,h){r.onLockOperation(!1),E&&a.errorMessage(z("errorMessage"))}});return{onFinReceptionCommande:(c,E)=>{u.mutate(c,{onSettled(_,h,x,A){h&&E({codeResult:"ERR_NETWORK",result:null})},onSuccess(_,h,x){var A,C;(_.err||((A=_.res)==null?void 0:A.codeResult)!=="OK")&&a.errorMessage(z(((C=_.res)==null?void 0:C.codeResult)||"errorMessage")),E(_.res)}})},onFinReceptionCommandeReliquat:(c,E)=>{d.mutate(c,{onSettled(_,h,x,A){h&&E({codeResult:"ERR_NETWORK",result:null})},onSuccess(_,h,x){var A,C;(_.err||((A=_.res)==null?void 0:A.codeResult)!=="OK")&&a.errorMessage(z(((C=_.res)==null?void 0:C.codeResult)||"errorMessage")),E(_.res)}})}}},Gs=(t,r,n={suspense:!1,useErrorBoundary:!0,cacheTime:-1})=>we(["DetailsReception",t.getQueryKey(),r],()=>B().AchatMethods().rechercheListeDetailAchat({variables:{numSeq:r,context:t.current}}),n),Pn=t=>{const r=oe().current.codeBorne,{getParametreBorne:n,getParametreBorneZone1:s}=Ye(),i=g.useMemo(()=>{const o=s("PP_ACTIF"),c=s("PP2_ACTIF"),E=!o&&!c,_=!E&&s("PP_DEBUT_DSD");return{PP_ACTIF:o,PP2_ACTIF:c,PP_DSD_ACTIF:_,aucuneBalance:E}},[s]),a=mt(),u=Ee(o=>{const c=He(o,t);return{plateauPeseur:(c==null?void 0:c.plateauPeseur)||1,plateauState:(c==null?void 0:c.plateauState)??null}},Xe),d=g.useCallback(o=>{a(S.RECEPTION_UPDATE({indice:t,update:{plateauPeseur:o}}))},[a]);return{config:i,plateauPeseur:u.plateauPeseur||null,plateauState:u.plateauState||null,onChangePlateauPeseur:d,codeBorne:r}};async function Vs(t,r){return Promise.all([r.colis&&r.colis.nombreExemplaire?B().AchatMethods().editionEtiquetteReception(t,r.colis):Promise.resolve(null),r.palette&&r.palette.nombreExemplaire?B().AchatMethods().editionEtiquetteReception(t,r.palette):Promise.resolve(null)])}const qs=t=>{const{operation:r,actions:n}=me(t),s=oe(),i=pe({mutationFn:u=>Vs(s.current,u)}),a=g.useCallback((u,d)=>i.mutate({colis:{...d.colis,numeroPesee:u,codeEtiquette:"BRE_PESEE"},palette:{...d.palette,numeroPesee:u,codeEtiquette:"BRE_PESEE_PAL"}}),[]);return{imprimanteColis:(r==null?void 0:r.imprimanteColis)||null,imprimantePalette:(r==null?void 0:r.imprimantePalette)||null,onSetImprimante:n.onSetImprimante,onPrintEtiquette:a,isPrinting:i.isLoading}};function Ws({date:t,readOnlyDate:r,onChangeDateRecept:n,onOpenReedition:s,onSelectModeReception:i}){const[a,u]=g.useState(new Date),{t:d}=W();return e.jsxs(T,{sx:{flexGrow:1,m:5},display:"flex",flexDirection:"column",gap:4,alignItems:"center",children:[e.jsxs(G,{container:!0,spacing:4,justifyContent:"center",children:[e.jsx(G,{item:!0,xs:12,sm:6,md:4,onClick:l=>i(1),children:e.jsxs(it,{variant:"main",children:[e.jsx(nr,{fontSize:"large",className:"icon"}),e.jsx(P,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("reception")})]})}),e.jsx(G,{item:!0,xs:12,sm:6,md:4,onClick:l=>i(2),children:e.jsxs(it,{variant:"main",children:[e.jsx(rr,{fontSize:"large",className:"icon"}),e.jsx(P,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("arrival")})]})})]}),e.jsxs(T,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(P,{variant:"h6",children:sr(t?at(t):a)}),!r&&e.jsx(e.Fragment,{children:e.jsx(ut,{showResetClock:!0,readOnlyDate:r,onChange:n,date:t})})]}),e.jsx(G,{container:!0,alignItems:"flex-end",sx:{flexGrow:1},spacing:1,children:e.jsx(G,{item:!0,xs:12,sm:6,md:4,onClick:l=>s(),children:e.jsxs(it,{variant:"main",children:[e.jsx(or,{fontSize:"large",className:"icon"}),e.jsx(P,{variant:"h3",sx:{textTransform:"capitalize",userSelect:"none"},className:"title",children:d("reedition")})]})})})]})}var Ot={},zs=Xt;Object.defineProperty(Ot,"__esModule",{value:!0});var Tn=Ot.default=void 0,$s=zs(Yt()),Zs=e,Ks=(0,$s.default)((0,Zs.jsx)("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3zm1-4.3h-2V7h2v6z"}),"Report");Tn=Ot.default=Ks;function ot({sx:t,complements:r}){return e.jsx(_t,{sx:{width:"100%",...t},children:f.map(r,n=>e.jsx(pt,{divider:!0,disableGutters:!0,disablePadding:!0,dense:!0,children:e.jsx(xt,{sx:{m:0,p:0},disableTypography:!0,primary:e.jsxs(T,{display:"flex",alignItems:"center",children:[e.jsx(P,{noWrap:!0,sx:{width:250,textOverflow:"ellipsis"},variant:"inherit",color:"text.primary",children:n.TRA_LIBELLE}),e.jsx(P,{sx:{fontWeight:600},variant:"inherit",color:"purple",children:n.COMP_VAL})]})})},n.TRA_NUM))})}function jt({onChangeLotActif:t,lotActif:r}){const{t:n}=W();return e.jsxs(ir,{size:"large",sx:{my:1,p:1,width:"100%","&:hover":{background:"inherit"}},exclusive:!0,onChange:(s,i)=>t(i==="A"),value:r?"A":"I",children:[e.jsx(Nt,{sx:{width:"100%","&.Mui-selected, &.Mui-selected:hover":{bgcolor:"red",color:"#fff"}},fullWidth:!0,value:"I","aria-label":"list",children:n("lotDisable")}),e.jsx(Nt,{sx:{width:"100%","&.Mui-selected,  &.Mui-selected:hover":{bgcolor:"green",color:"#fff"}},fullWidth:!0,value:"A","aria-label":"module",children:n("lotEnable")})]})}function Wt(t){return t==="CO"?e.jsx(Re,{uvc:"C"}):t==="PI"?e.jsx(Re,{uvc:"P"}):t==="PN"?e.jsx(Re,{uvc:"N"}):t==="PB"?e.jsx(Re,{uvc:"K"}):t==="TA"?e.jsx(te,{icon:"TARE"}):null}function Rn(t){return f.includes(["CO","PB","PN","PI","TA"],t)}function Ys(t){const r=f.fromPairs(f.times(6,n=>[[`ACH_LIT_MSG_LONG${n+1}`],t[`LIT_MSG_LONG${n+1}`]]));return{ACH_LIT_CODE:t.LIT_CODE,ACH_LIT_LIBELLE:t.LIT_LIBELLE,ACH_LIT_TYPE:t.LIT_TYPE,ACH_LIT_MSG_COURT:t.LIT_MSG_COURT,...r,...!Rn(t.LIT_TYPE)&&{ACH_LIT_QTE_PREVU:0,ACH_LIT_QTE_RECU:0}}}function Xs({litige:t,updatelitige:r}){const{t:n}=W(),s=ge(),{gereLotActif:i,lotActif:a,onChangeLotActif:u}=js($()),d=async()=>{const c=await s.showInfiniteSearch({title:"selectLitige",dialogProps:{fullScreen:!0,maxWidth:"lg",fullWidth:!0},type:"Litige"});if(!c)return null;r(Ys(c))},l=c=>{r({[c.target.name]:c.target.value})},o=Rn(t.ACH_LIT_TYPE);return e.jsxs(T,{sx:{p:2,height:"100%"},children:[e.jsxs(G,{container:!0,rowSpacing:1,alignItems:"stretch",children:[e.jsx(G,{item:!0,xs:12,md:4,children:e.jsx(Le,{sx:{height:"100%"},title:n("litige"),onClick:c=>{d()},subTitle:t.ACH_LIT_LIBELLE||"",IconComponent:e.jsx(te,{icon:"LITIGE"}),className:"litige"})}),e.jsx(G,{item:!0,xs:12,md:8,children:e.jsx(fe,{sx:{display:o?"block":"none"},className:"quantity",IconComponent:e.jsx(Tn,{}),children:e.jsxs(re,{sx:{flexGrow:1},direction:"row",justifyContent:"space-around",children:[e.jsx(Dt,{disabled:!o,isUs:!1,label:"prévu",name:"ACH_LIT_QTE_PREVU",showAddBtn:!1,isCompleted:!!t.ACH_LIT_QTE_PREVU,value:t.ACH_LIT_QTE_PREVU,onChange:l,InputProps:{startAdornment:Wt(t.ACH_LIT_TYPE)}}),e.jsx(Dt,{isUs:!1,disabled:!o,label:"recu",name:"ACH_LIT_QTE_RECU",showAddBtn:!1,isCompleted:!!t.ACH_LIT_QTE_RECU,value:t.ACH_LIT_QTE_RECU,onChange:l,InputProps:{startAdornment:Wt(t.ACH_LIT_TYPE)}})]})})})]}),e.jsxs(re,{sx:{flexGrow:1,mt:2},gap:.5,direction:"column",children:[e.jsx(ct,{color:"secondary",sx:{bgcolor:"#e0ebf7"},variant:"outlined",name:"ACH_LIT_MSG_COURT",type:"text",label:n("litigeShortMessage"),InputLabelProps:{shrink:!0},value:t.ACH_LIT_MSG_COURT||"",onChange:l,fullWidth:!0,autoComplete:"off"}),f.times(6,c=>{const E="ACH_LIT_MSG_LONG"+(c+1);return e.jsx(ct,{color:"secondary",sx:{bgcolor:"#e0ebf7"},variant:"filled",name:E,type:"text",label:n("litigeLongMessage",{cpt:c}),InputLabelProps:{shrink:!0},value:t[E]||"",onChange:l,fullWidth:!0,autoComplete:"off"})})]}),i&&e.jsx(G,{container:!0,item:!0,xs:12,md:4,children:e.jsx(jt,{lotActif:a,onChangeLotActif:u})})]})}const Js=({litige:t,onEdit:r,onDelete:n})=>e.jsxs(e.Fragment,{children:[e.jsxs(pt,{alignItems:"flex-start",children:[e.jsxs(Jt,{onClick:s=>r(t.uuid),dense:!0,disableGutters:!0,children:[e.jsx(en,{children:e.jsx(ar,{text:(t==null?void 0:t.ACH_LIT_TYPE)||""})}),e.jsx(xt,{primary:t.ACH_LIT_LIBELLE,secondary:e.jsxs(e.Fragment,{children:[e.jsxs(P,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:["Quantités ",t.ACH_LIT_QTE_PREVU," /  ",t.ACH_LIT_QTE_RECU]}),t.ACH_LIT_MSG_COURT]})})]}),e.jsx(cr,{children:e.jsx(lr,{"aria-label":"Delete",onClick:s=>n(t.uuid),size:"large"})})]}),e.jsx(tn,{variant:"inset",component:"li"})]}),eo=({litiges:t,onEdit:r,onDelete:n})=>e.jsx(_t,{sx:{width:"100%",bgcolor:"background.paper"},children:f.map(t,s=>e.jsx(Js,{onEdit:r,onDelete:n,litige:s},s.uuid))}),to={ACH_LIT_LIBELLE:"",ACH_LIT_CODE:"",ACH_LIT_QTE_PREVU:null,ACH_LIT_QTE_RECU:null,ACH_LIT_TYPE:"",ACH_LIT_MSG_COURT:"",ACH_LIT_MSG_LONG1:"",ACH_LIT_MSG_LONG2:"",ACH_LIT_MSG_LONG3:"",ACH_LIT_MSG_LONG4:"",ACH_LIT_MSG_LONG5:"",ACH_LIT_MSG_LONG6:""};function no({onBack:t,currentLitige:r,removeLitige:n,litiges:s,updateCurrentLitige:i,addLitige:a,updateLitige:u}){const d=()=>{const o=f.find(s,{uuid:r})||{};return{...to,...o}},l=f.isEmpty(s);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{sx:{flexGrow:1,overflow:"auto"},children:[!l&&!r&&e.jsx(eo,{litiges:s,onEdit:o=>{i(o)},onDelete:function(o){n(o)}}),(l||r)&&e.jsx(Xs,{updatelitige:u,litige:d()})]}),e.jsxs(T,{display:"flex",gap:2,justifyContent:"flex-end",sx:{m:.8,gridArea:"footer","> *":{maxWidth:"180px",minHeight:80}},children:[e.jsx(se,{color:"primary",fullWidth:!0,disabled:f.isEmpty(s),size:"large",variant:"contained",onClick:o=>a({uuid:f.uniqueId()}),children:"+1"}),e.jsx(se,{fullWidth:!0,startIcon:e.jsx(Ct,{color:"secondary",badgeContent:f.size(s),children:e.jsx(ur,{})}),disabled:f.isEmpty(s),size:"large",variant:"contained",onClick:o=>i()}),e.jsx(Qe,{color:"error",fullWidth:!0,size:"large",variant:"contained",onClick:o=>t()})]})]})}function ro({onBack:t}){const{litiges:r,currentLitige:n,actions:s}=Os($());return e.jsx(no,{litiges:r,currentLitige:n,updateLitige:s.updateLitige,addLitige:s.addLitige,updateCurrentLitige:s.updateCurrentLitige,removeLitige:s.removeLitige,onBack:t})}function Ln(t){return r=>{var i;const n=Hs($()),s=n.isLoading?null:(i=n.data)==null?void 0:i.res;return n.isLoading?e.jsx(Ie,{}):e.jsx(t,{...r,detail:s})}}function so({detail:t,onClose:r}){const n=ge(),{t:s}=W(),{onFinReceptionLigne:i,isSaving:a}=fn($()),d=[{label:"terminateLineReception",icon:Er,click:async l=>{await n.showConfirmation({title:"confirmTerminateReceptionTitle",message:"confirmTerminateReceptionBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&i(t.ACH_LOT_SEQ)}},{label:"closeMenu",icon:mr,click:r}];return e.jsx(T,{sx:{m:1,minHeight:0,flex:1},children:e.jsx(_t,{children:f.map(d,({label:l,icon:o,click:c,...E},_)=>e.jsx(pt,{divider:!0,onClick:c,...E,children:e.jsxs(Jt,{children:[e.jsx(dr,{children:e.jsx(o,{})}),e.jsx(xt,{children:s(l)})]})},_))})})}const oo=Ln(so);function Sn(t,r,n){return De({key:["LotPeseesBorne",t],keyConfigFilters:t?"LotPeseesBorneReception":"LotPeseesBorne",fxt:{retrieve:(s,i)=>{const a=t?de("det.ACH_LOT_SEQ",t,"="):null;return B().AchatMethods().recherchePeseesBorne({variables:{recherche:s,filtresOptionnels:a,context:(i==null?void 0:i.current)||null}})},retrievePreferences:null},query:r})}function io({item:t,className:r="",isLoading:n,maxWidth:s,onAddFavorite:i,favorites:a,editFavorite:u,onSelect:d,ItemComponentProps:l,style:o,...c}){var p,R,L;const E=oe().current,_=pe({mutationFn:I=>B().AchatMethods().supprimePeseeReception(E,I)}),h=Kt(),x=I=>{_.mutate(I,{onSuccess:M=>{h.invalidateQueries({queryKey:["LotPeseesBorne"]}),h.invalidateQueries({queryKey:[Cn]})}})};if(!t)return null;const A=(p=t.Article)==null?void 0:p.ART_STAT_IMAGE,C=l&&l.onContinueReception;return e.jsxs(et,{style:o,onDelete:()=>x(t.PESEE_NUM),sx:{display:"grid",gridTemplateColumns:"auto 150px 3fr 120px 1fr 1fr 1fr",alignItems:"center",width:"100%",typography:"body2"},children:[e.jsxs(T,{display:"flex",alignItems:"center",children:[e.jsx(hr,{color:"secondary",onClick:I=>{d(t)}}),C&&e.jsx(_r,{size:"large",color:"info",onClick:I=>C(t.PESEE_ACH_LOTSEQ,t),children:e.jsx(xn,{color:"secondary"})})]}),e.jsxs(T,{display:"flex",alignItems:"center",children:[e.jsx(nn,{color:"info"})," ",t.PESEE_DATE&&pr(t.PESEE_DATE)]}),e.jsxs(T,{display:"flex",flexDirection:"row",alignItems:"center",sx:{overflow:"hidden"},children:[e.jsx(Pe,{codeStat:A}),e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(P,{variant:"subtitle1",sx:{color:"info.dark"},children:t.PESEE_ART}),e.jsx(P,{variant:"h5",textOverflow:"ellipsis",noWrap:!0,children:(R=t.Article)==null?void 0:R.ART_LIB1})]}),e.jsx(P,{variant:"subtitle1",children:(L=t.Fournisseur)==null?void 0:L.FOU_NOM})]}),e.jsx(P,{variant:"subtitle1",children:t.LOT_ID}),e.jsx(Ue,{uvc:"C",qtePesee:t.PESEE_NBEMB}),e.jsx(Ue,{uvc:"P",qtePesee:t.PESEE_PIE}),e.jsx(Ue,{uvc:"N",qtePesee:t.PESEE_PDSNET})]})}const ao={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80};function co({recherche:t=null,onSelect:r,onContinueReception:n,...s}){const i=Sn(null,null);return e.jsx(In,{data:i,onSelect:r,onContinueReception:n})}function lo({recherche:t=null,onSelect:r,ach_lot_seq:n,onContinueReception:s,...i}){const a=Sn(n,null);return e.jsx(In,{data:a,onSelect:r,onContinueReception:s})}function In({data:t,onSelect:r,onContinueReception:n=null,...s}){const i=g.useMemo(()=>({...t,actions:{...t.actions,onSetQuickFilterValue:(u,d,l)=>{d?(l&&l(),d.str_num_lot?t.actions.onSetQuickRulesValue(de("arrivage.LOT_ID",d.str_num_lot,"=")):d.str_num_mvt?t.actions.onSetQuickRulesValue(de("arrivage.ACH_LOT",d.str_num_mvt,"=")):d.str_ean_article&&t.actions.onSetQuickRulesValue(de("gencod.ART_EAN",String(d.str_ean_article).substring(1,14),"="))):u.value===""?t.actions.onClearQuickSearchValue():t.actions.onSetQuickFilterValue(u)}}}),[t]),a={...n};return e.jsx(ye,{onSelect:r,HeaderComponent:null,...s,state:i,ItemComponent:io,ItemComponentProps:a,ItemMeasureCard:ao,IconComponent:xr,labelSearch:"article",placeholderSearch:"placeholderArticle"})}function On({numeroPesee:t,onClose:r}){const{imprimantePalette:n,imprimanteColis:s,onSetImprimante:i,onPrintEtiquette:a,isPrinting:u}=qs($()),[d,l]=g.useState({nbExColis:1,nbExPalette:0}),o=(c,E)=>{l(_=>({..._,[c]:fr(E,_[c])}))};return e.jsxs(T,{display:"flex",sx:{m:2},flexDirection:"column",gap:2,children:[e.jsx(Ne,{onChangePrinter:c=>{i("imprimanteColis",c)},imprimante:s,label:z("defaultPrinter"),title:z("packagePrinter"),nbEx:d.nbExColis,onChangeNbEx:c=>o("nbExColis",c)}),e.jsx(Ne,{onChangePrinter:c=>{i("imprimantePalette",c)},imprimante:n,label:z("defaultPrinter"),title:z("paletPrinter"),nbEx:d.nbExPalette,onChangeNbEx:c=>o("nbExPalette",c)}),e.jsxs(T,{display:"flex",gap:1,children:[e.jsx(Cr,{disabled:u,variant:"outlined",onClick:c=>{a(t,{colis:{nombreExemplaire:d.nbExColis,imprimante:s||""},palette:{nombreExemplaire:d.nbExPalette,imprimante:n||""}})}}),e.jsx(tt,{variant:"outlined",onClick:c=>{r()}})]})]})}function uo({ach_lot_seq:t,onContinueReception:r}){const[n,s]=g.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{withAppBar:!1,isOpen:!!n,onCloseDialog:function(){s(null)},className:"",children:e.jsx(On,{onClose:()=>s(null),numeroPesee:n==null?void 0:n.PESEE_NUM})}),e.jsx(lo,{ach_lot_seq:t,onContinueReception:r,onSelect:function(i,a){s(i)}})]})}function jn({onContinueReception:t}){const[r,n]=g.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{withAppBar:!1,isOpen:!!r,onCloseDialog:function(){n(null)},className:"",children:e.jsx(On,{onClose:()=>n(null),numeroPesee:r==null?void 0:r.PESEE_NUM})}),e.jsx(co,{onContinueReception:t,onSelect:function(s,i){n(s)}})]})}const Eo=jn;var bt={},mo=Xt;Object.defineProperty(bt,"__esModule",{value:!0});var vt=bt.default=void 0,ho=mo(Yt()),_o=e,po=(0,ho.default)((0,_o.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"}),"Sms");vt=bt.default=po;const bn=({className:t,item:r,ItemComponentProps:n,onSelect:s,style:i,...a})=>{var R,L,I,M,O,U,w,V;const{t:u}=W(),d=ge(),{onFinReceptionLigne:l}=fn($());(R=r.Article)==null||R.ART_CODE,(L=r.Article)!=null&&L.ART_PICKING,r.ACH_LOT_SEQ;const o=r.TOTAL_A_REC,c=r.TOTAL_REC,E=r.ACH_COM_ART;(I=r.Article)==null||I.ART_STAT_IMAGE;const _=r.ACH_UNIT_CDE?u("unite"+r.ACH_UNIT_CDE,{count:o}):null,h=c,x=Ar(h,o),A=async()=>{await d.showConfirmation({title:"confirmTerminateReceptionTitle",message:"confirmTerminateReceptionBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})&&l(r.ACH_LOT_SEQ)};n==null||n.showHeader;const C=h===0?"#4caf50":h>=o?"#2196f3":"#ff9800",p={ART_STAT_IMAGE:"",ART_RUB1:"",ART_LIB1:((M=r.Article)==null?void 0:M.ART_LIB1)||"",ART_CODE:((O=r.Article)==null?void 0:O.ART_CODE)||"",ART_PAYS:((U=r.Article)==null?void 0:U.ART_PAYS)||""};return e.jsxs(et,{onClick:()=>s(r),onDelete:A,sxContainer:{p:0,borderRight:24,borderRightColor:C},sx:{display:"grid",px:2,py:0,width:"100%",flexBasis:"100%",alignItems:"stretch",gridTemplateColumns:"1fr 1fr 1fr 1fr 15px",gridTemplateAreas:` "article article article qtecde qtecde"
                "comment comment comment qtecde qtecde" `,fontSize:32},style:i,children:[lt(r)&&e.jsx(rn,{lockByName:r.VERROU_USER}),e.jsxs(T,{display:"flex",alignItems:"center",className:"article",gridArea:"article",children:[e.jsx(gr,{title:p.ART_RUB1,children:e.jsx(en,{children:e.jsx(Pe,{codeStat:p.ART_STAT_IMAGE})})}),e.jsxs(T,{display:"flex",flexDirection:"column",sx:{overflow:"hidden"},children:[e.jsxs(T,{display:"flex",alignItems:"center",columnGap:.4,children:[e.jsx(yt,{field:"ART_CODE",typoProps:{noWrap:!0,variant:"subtitle2",color:"textPrimary"},content:p.ART_CODE,matchSearch:(w=r._properties)==null?void 0:w.matchSearch}),!!p.ART_PAYS&&p.ART_PAYS!=="0"&&e.jsx(Pr,{svg:!0,countryCode:p.ART_PAYS})]}),e.jsx(yt,{field:"ART_LIB1",typoProps:{noWrap:!0},content:p.ART_LIB1,matchSearch:(V=r._properties)==null?void 0:V.matchSearch})]})]}),e.jsxs(T,{gridArea:"qtecde",display:"flex",alignItems:"center",children:[e.jsx(Re,{fontSize:"medium",uvc:r.ACH_UNIT_CDE}),e.jsxs(P,{sx:{fontWeight:700,whiteSpace:"nowrap",color:"#e91e63",marginRight:"2px",textAlign:"right"},variant:"h5",component:"div",children:[h," / ",o,"    ",_]})]}),e.jsxs(T,{gridArea:"comment",display:"flex",alignItems:"center",sx:{color:"secondary.main"},children:[e.jsx(vt,{className:"iconPrepa",color:"inherit"}),e.jsx(P,{gridArea:"comment",className:"commentaire",variant:"subtitle2",color:"inherit",children:E})]}),e.jsx(Ie,{color:"success",classes:{bar1Indeterminate:"percent"},sx:{border:1,borderColor:"divider",bgcolor:"#fff",position:"absolute",marginX:1,bottom:0,height:5,right:0,left:0,"& .MuiLinearProgress-bar":{bgcolor:C}},variant:"determinate",value:x})]})},xo={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:90},Co={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:90},vn={showHeader:!0},fo=({data:t,...r})=>{W();const n=St($()),s=g.useCallback(i=>{n.selectReceptionLine(i)},[n.selectReceptionLine]);return e.jsx(ye,{disableFavorite:!0,labelSearch:"",onSelect:s,ItemComponent:bn,ItemComponentProps:vn,ItemMeasureCard:Co,placeholderSearch:"",...r,state:t})},Ao=({ActionsButtons:t,onSelect:r,data:n,...s})=>{const{t:i}=W();return e.jsx(ye,{labelSearch:"",onSelect:r,ItemComponent:bn,ItemComponentProps:vn,ItemMeasureCard:xo,disableFavorite:!0,placeholderSearch:i("placeholderArticle"),...s,state:n,ActionsButtons:t})},go="AfficheUneLigneReception",Po={root:`${go}-root`},To=Se(et)(({theme:t})=>({paddingTop:0,paddingBottom:0,display:"flex",flexDirection:"column",margin:0,alignItems:"flex-start","& .icon":{margin:t.spacing(.4),width:"20px",height:"20px","&.livraison":{color:Tr[800]},"&.preparation":{color:Rr[800]},"&.commentaire":{color:t.palette.secondary.main}},"& .commentaire":{...t.typography.subtitle1,fontWeight:800,color:t.palette.secondary.main},[t.breakpoints.up("sm")]:{"& .icon":{width:"26px",height:"26px"},"& .commentaire":{...t.typography.h5}}})),Ro=({className:t,item:r,onSelect:n,style:s,...i})=>{var u,d,l;const a=f.join(f.reject([r.ACH_COMMENTAIRE1,r.ACH_COMMENTAIRE2],o=>!o),"/");return e.jsxs(To,{style:s,sx:{borderLeft:"8px solid transparent",...lt(r)&&{borderLeftColor:"warning.main",bgcolor:"rgba(0,0,0,0.1)"}},className:ft(t,Po.root),onClick:o=>n(r),children:[e.jsxs(G,{sx:o=>({...o.typography.h6,flexGrow:1}),alignItems:"center",container:!0,spacing:0,children:[e.jsxs(G,{container:!0,item:!0,xs:12,md:5,className:"subtitle2",alignItems:"center",direction:"row",wrap:"nowrap",children:[e.jsx(sn,{sx:{color:o=>o.palette.primary.light}}),lt(r)&&e.jsx(rn,{lockByName:r.VERROU_USER}),e.jsxs(T,{display:"flex",flexDirection:"column",children:[e.jsx(re,{direction:"row",children:e.jsx(P,{variant:"subtitle2",color:"textPrimary",children:r.ACH_CDE})}),e.jsxs(T,{display:"flex",alignItems:"baseline",children:[e.jsx(P,{className:"nomclient",variant:"h6",color:"textPrimary",component:"span",sx:{fontWeight:800},children:(u=r.Fournisseur)==null?void 0:u.FOU_NOM}),e.jsxs(P,{className:"codeclient",variant:"caption",color:"textPrimary",component:"span",children:["(",(d=r.Fournisseur)==null?void 0:d.FOU_CODE,")"]})]})]})]}),e.jsxs(G,{item:!0,xs:6,md:2,container:!0,alignItems:"center",children:[e.jsx(Jr,{type:"prep",className:"icon"}),e.jsx(P,{className:"date",variant:"inherit",color:"textPrimary",children:on(r.ACH_DATE_REC)})]}),e.jsxs(G,{container:!0,item:!0,xs:6,md:!0,alignItems:"center",children:[e.jsx(Lr,{className:"icon livraison"}),e.jsx(P,{className:"trs",variant:"inherit",color:"textPrimary",children:(l=r.Transporteur)==null?void 0:l.TRSP_NOM})]}),e.jsx(G,{item:!0,md:2,children:e.jsxs(T,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(es,{className:"icon"}),e.jsxs(P,{className:"commentaire",variant:"inherit",color:"secondary",children:[r.NbLignesRecep," / ",r.NbLignesDetail]})]})})]}),a&&e.jsxs(T,{display:"flex",alignItems:"center",children:[e.jsx(vt,{className:"icon commentaire  "}),e.jsx(P,{className:"commentaire  ",variant:"inherit",color:"secondary",children:a})]})]})},Lo={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80},So=({data:t,onSelect:r,...n})=>{const{t:s}=W();return e.jsx(ye,{disableFavorite:!0,labelSearch:"",gridModes:["list"],onSelect:r,HeaderComponent:null,ItemComponent:Ro,placeholderSearch:s("placeHolderNumOrder"),ItemMeasureCard:Lo,...n,state:t})};function Io(t,r=null){return De({key:["ComplementsTracaDetailMemory",JSON.stringify(t)],fxt:(n,s)=>{const i=(()=>{var l;let u=null,d=null;try{const c=((l=n.qbRules)==null?void 0:l.rules[0]).rules[0];u=c.value,d=c.operator,console.error(d)}catch{}return u?f.filter(t,o=>d==="beginsWith"?f.startsWith(o.TRA_LIBELLE,u):d==="endsWith"?f.endsWith(o.TRA_LIBELLE,u):d==="contains"?typeof o.TRA_LIBELLE=="string"&&o.TRA_LIBELLE.includes(u):o.TRA_LIBELLE===u):t})(),a=n.offset?f.slice(i,n.offset):i;return Promise.resolve({err:null,res:{isLastPage:!0,itemsCount:f.size(i),result:a}})},query:r})}const Oo=t=>({LOOKUP:br,DATE:nn,ALPHA:gs,ENTIER:Ts,REEL:Ps})[t]||As,jo=({maxWidth:t,style:r,item:n,onSelect:s,ItemComponentProps:i,...a})=>{const u=n.TRA_OBLIG==="O"||n.TRA_OBLIG==="C"&&(i==null?void 0:i.typeAchat)===1||n.TRA_OBLIG==="A"&&(i==null?void 0:i.typeAchat)===2;if(!n)return null;const d=()=>n.COMP_VAL?u?{bgcolor:"success.dark"}:{bgcolor:"success.main"}:u?{backgroundImage:"background-image: linear-gradient(to right, #ff9b00, #f19d09, #e49f15, #d7a01f, #cba028);",bgcolor:"warning.dark"}:n.TRA_OBLIG==="B"?{bgcolor:"#618833"}:{bgcolor:"grey.400"},l=Oo(n.TRA_TYPE_TABLE==="D"||n.TRA_TYPE_TABLE==="O"?"LOOKUP":n.TRA_TYPE_VALEUR);return e.jsx(T,{sx:{width:t,m:.4},style:r,children:e.jsxs(Ge,{raised:!0,sx:{height:"100%",width:"100%",position:"relative",display:"flex",flexGrow:1,borderBottom:6,borderBottomColor:"grey.100",...!!n.COMP_VAL&&{borderBottomColor:"success.light"},...u&&!n.COMP_VAL&&{backgroundImage:"linear-gradient(180deg, rgba(255,189,3,1) 0%, rgba(221,167,19,0.38699229691876746) 82%);",borderBottomColor:"warning.light"},...n.TRA_OBLIG==="B"&&!n.COMP_VAL&&{backgroundImage:"linear-gradient(180deg, #618833 0%, #afd683 82%);",borderBottomColor:"#618833"}},children:[e.jsx(Sr,{disabled:!n.COMP_VAL,color:"secondary",sx:{alignSelf:"center",order:2},size:"large",onClick:o=>(o.stopPropagation(),i.onClearComplement(n.TRA_NUM),!1)}),e.jsxs(Ir,{sx:{flexGrow:1},onClick:o=>s(n),children:[e.jsx(Or,{disableTypography:!0,avatar:e.jsx(jr,{sx:{...d()},"aria-label":"recipe",children:e.jsx(l,{sx:{p:1}})}),sx:{paddingTop:.5,paddingBottom:.5},title:e.jsx(P,{variant:"h6",children:n.TRA_LIBELLE})}),e.jsxs(At,{children:[e.jsx(tn,{}),e.jsx(T,{display:"flex",alignItems:"center",children:e.jsx(P,{component:"span",sx:{fontWeight:700},variant:"h5",color:"text.secondary",children:n.COMP_VAL})})]})]})]})})},bo={COLUMN_WIDTH:33,COLUMN_UNIT:"%",ROW_HEIGHT:125},Mt=({typeAchat:t,fournisseur:r,adliv:n,onUpdateComplement:s,onClearComplement:i,complementsTracaDetail:a,onContinue:u,onBack:d})=>{const{t:l}=W(),o=ge(),c=Io(a,null),E={typeAchat:t,onClearComplement:i,onUpdateComplement:s},_=(p,R)=>{s({TRA_NUM:p.TRA_NUM,COMP_VAL:R})},h=async(p,R)=>{try{if(p.TRA_MODIF=="N"||p.TRA_MODIF=="A"&&R==1||p.TRA_MODIF=="C"&&R==2)return await o.showError({message:"cantEdit",dialogProps:{maxWidth:"md"}}),!1;if(p.TRA_TYPE_TABLE=="D"||p.TRA_TYPE_TABLE=="O"){const L=await o.showInfiniteSearch({i8ntitle:p.TRA_LIBELLE,type:"ComplementsTraca",props:{numero:p.TRA_NUM,fournisseur:r==null?void 0:r.FOU_CODE,adliv:n},dialogProps:{fullScreen:!0}});return L&&_(p,L.TRA_LIBC),!1}if(p.TRA_TYPE_VALEUR=="DATE"){const L=M=>{const O=p.TRA_LIMITE_INF,U=p.TRA_LIMITE_SUP;if(O!=0||U!=0){const w=vr(M,new Date);if(O!=0&&w<O)return l("dateLimitMin",{limit:O});if(U!=0&&w>U)return l("dateLimitMax",{limit:U})}return null},I=await o.showInputDate({i8ntitle:p.TRA_LIBELLE,dialogProps:{maxWidth:"md",fullWidth:!0},props:{onControlInput:L,inputFormat:"dd/MM/yy"}});return I!==null&&_(p,I.inputValue),!1}if(p.TRA_TYPE_VALEUR=="ENTIER"){const L=await o.showInputNumber({i8ntitle:p.TRA_LIBELLE,dialogProps:{maxWidth:"md",fullWidth:!0},props:{maximumFractionDigits:0}});return L!==null&&_(p,f.ceil(L).toString()),!1}if(p.TRA_TYPE_VALEUR=="REEL"){const L=await o.showInputNumber({i8ntitle:p.TRA_LIBELLE,dialogProps:{maxWidth:"md",fullWidth:!0},props:{maximumFractionDigits:3}});return L!==null&&_(p,L.toString()),!1}if(p.TRA_TYPE_VALEUR=="ALPHA"){const L=await o.showInputText({i8ntitle:p.TRA_LIBELLE,dialogProps:{maxWidth:"md",fullWidth:!0},props:{}});return L!==null&&_(p,L.toString()),!1}}catch{}},x=p=>{h(p,t)},A=()=>{const p=[],R=(I,M=null)=>p.push({err:I,variables:M});return f.find(a,I=>(I.COMP_VAL==null||I.COMP_VAL=="")&&(I.TRA_OBLIG=="O"||I.TRA_OBLIG=="A"&&t==2||I.TRA_OBLIG=="C"&&t==1))&&R("ERR_COMPLEMENTS_TRACA"),p},C=async()=>{const p=A();let R=!0;if(!f.isEmpty(p)){const I=f.head(p);return o.showError({i8nmessage:l(I.err,I.variables||{}),i8ntitle:l("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})}f.find(a,I=>(I.COMP_VAL==null||I.COMP_VAL=="")&&I.TRA_OBLIG=="B")?R=!1:f.find(a,M=>M.COMP_VAL!=null&&M.TRA_OBLIG=="B")&&(R=!0),u(R)};return e.jsxs(e.Fragment,{children:[e.jsx(ye,{HeaderComponent:null,onSelect:x,state:c,ItemMeasureCard:bo,ItemComponent:jo,ItemComponentProps:E,labelSearch:"Traçabilité",placeholderSearch:"placeHolderTracabilite",disableFavorite:!0,disableSort:!0,disableAdvanced:!0}),e.jsxs(qe,{sx:{padding:1},children:[e.jsxs(se,{fullWidth:!0,size:"large",color:"success",variant:"contained",onClick:p=>{C()},children:[" ",l("continue")]}),d&&e.jsx(Qe,{size:"large",variant:"contained",color:"error",onClick:p=>{d()}})]})]})};function Mn({onSelect:t}){const r=ge(),{t:n}=W();return e.jsx(Fe,{type:"Articles",onSelect:function(s){B().CommunMethods().rechercheInfoArticleSaisiArrivage({variables:{codeArticle:s.ART_CODE,context:null}}).then(i=>{i&&t(i)}).catch(i=>{r.showError({i8nmessage:n("networkError"),i8ntitle:n("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})})}})}function Nn({children:t}){return e.jsx(T,{sx:{display:"flex",flex:1,flexDirection:"column",gap:.3,".footer":{bgcolor:r=>r.palette.background.paper,m:0,p:{lg:1,sm:.3},flexGrow:0}},children:t})}function vo({infoComplements:t,nbPesee:r,fournisseur:n,adliv:s,article:i,resetLine:a,affichePalette:u,poidsObligatoire:d,nbLitiges:l,getPropertyies:o,emballage:c,palette:E,actions:_,typeAchat:h,...x}){const A=pn("ACHAT"),[C,p]=an("panelExpandedArrivage","",!1,"SCALAR"),R=Pn($()),L=i==null?void 0:i.ART_UNIT_ACH,I=(i==null?void 0:i.ART_PIECE_COL)||null,M=(i==null?void 0:i.ART_PDS_NET)||null,{t:O}=W(),U=g.useRef(!1),w=g.useRef(null),V=ge(),[k,D]=g.useState({modalFor:""}),F=()=>{D({modalFor:"",emballageOuPalette:null})},N=g.useCallback(async()=>{const m=await V.showInfiniteSearch({title:"emballageSelection",type:"Emballages",props:{},dialogProps:{fullScreen:!0}});m!=null&&D({modalFor:"Emballages",emballageOuPalette:m})},[D,V.showInfiniteSearch]),J=g.useCallback(async()=>{const m=await V.showInfiniteSearch({title:"palettSelection",type:"Palettes",props:{},dialogProps:{fullScreen:!0}});m!=null&&D({modalFor:"Palettes",emballageOuPalette:m})},[D,V.showInfiniteSearch]),le=g.useCallback(m=>{D({modalFor:"Emballages",emballageOuPalette:m})},[]),ee=g.useCallback(m=>{D({modalFor:"Palettes",emballageOuPalette:m})},[D,E]),X=g.useCallback((m,b)=>{_.updateQuantityArrivage(m,b,{poidsColisMoyen:M,pieceParColisMoyen:I,poidsPieceMoyen:1,unite:L||"",SIT_AC_RECALCUL_UNITES:o("SIT_AC_RECALCUL_UNITES",!1)||!1,SIT_AC_FORMAT_COLIS:A.formatColis,SIT_AC_FORMAT_POIDS:A.formatPoids})},[I,M,L,_.updateQuantityArrivage]),Z=(()=>{const m=[],b=q=>+q<0,y=(q,_e=null)=>m.push({err:q,variables:_e});return d&&!U.current&&y("ERR_POIDSOBLIGATOIRE"),(b(x.colis)||L==="C"&&!x.colis)&&y("ERR_QTE_COLIS",{colis:x.colis}),(b(x.poids)||f.includes(["N","K"],L)&&!x.poids)&&y("ERR_QTE_POIDS",{poids:x.poids}),(b(x.piece)||L==="P"&&!x.piece)&&y("ERR_QTE_PIECE",{piece:x.piece}),m})(),ue=m=>f.some(Z,b=>b.err===m),ae=m=>!0,K=async()=>{if(!f.isEmpty(Z)){const m=f.head(Z);return V.showError({i8nmessage:O(m.err,m.variables||{}),i8ntitle:O("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})}if(w&&w.current&&w.current.gereDsd()){const m=await w.current.getDsdPlateau();if(m.err)return null;X({dsd:m.dsd})}_.updateReceptionForward({})},j=m=>(b,y)=>{p(y?m:" ")};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{dialogProps:{maxWidth:"sm",fullWidth:!1},withAppBar:!1,isOpen:!1,onCloseDialog:()=>console.warn("no action"),i8ntitle:"",className:"",children:e.jsx(re,{justifyContent:"center",sx:{m:3},children:e.jsx(fs,{})})}),e.jsxs(Ce,{dialogProps:{maxWidth:"md",fullWidth:!0,fullScreen:f.includes(["TRACA","FRN","ART","LotPeseeBorne"],k.modalFor)},withAppBar:!0,isOpen:!!k.modalFor,onCloseDialog:()=>F(),i8ntitle:Tt(O,k.modalFor),className:"",children:[(k.modalFor==="Palettes"||k.modalFor==="Emballages")&&e.jsx(mn,{mode:k.modalFor,onClose:()=>F(),emballage:k.emballageOuPalette,quantity:k.modalFor==="Emballages"?x.colis:(E==null?void 0:E.quantity)||1,onSave:function(m,b,y){k.modalFor==="Palettes"?(_.updatePalette({...m,poids:b,quantity:y}),X({tareBalance:null})):(_.updateEmballage({...m,poids:b,quantity:y}),X({colis:y,tareBalance:null})),F()}}),k.modalFor==="FRN"&&e.jsx(Fe,{type:"Fournisseurs",onSelect:function(m){_.updateReception({fournisseurArrivage:m}),F()}}),k.modalFor==="ART"&&e.jsx(Mn,{onSelect:function(m){_.updateReception({articleArrivage:m}),F()}}),k.modalFor==="LotPeseeBorne"&&e.jsx(jn,{onContinueReception:(m,b)=>{_.onContinueArrivage(m,b),F()}}),k.modalFor==="TRACA"&&e.jsx(Mt,{complementsTracaDetail:t.complements,typeAchat:h,fournisseur:n,adliv:s,onClearComplement:t.onClearComplement,onUpdateComplement:t.onUpdateComplement,onContinue:function(m){_.updateLineArrivage({lotActif:m}),F()}})]}),e.jsx(Le,{title:n==null?void 0:n.FOU_CODE,subTitle:n==null?void 0:n.FOU_NOM,IconComponent:e.jsx(te,{icon:"FOURNISSEUR"}),className:"fournisseur",onClick:m=>D({modalFor:"FRN"})}),e.jsx(Le,{className:"headerLine article",title:i==null?void 0:i.ART_CODE,subTitle:i==null?void 0:i.ART_LIB1,IconComponent:e.jsx(Pe,{codeStat:(i==null?void 0:i.ART_STAT_IMAGE)||null}),onClick:m=>D({modalFor:"ART"})}),e.jsx(fe,{className:"headerLine commentaire",disabled:!0,IconComponent:e.jsx(te,{icon:"COMMENTAIRE"}),children:e.jsx(P,{sx:{fontWeight:800},component:"p",color:"warning.dark",variant:"h4",children:(i==null?void 0:i.ACH_COM_ART)||""})}),e.jsx(T,{sx:{flex:1,flexGrow:100},children:e.jsxs(T,{sx:{height:"100%",maxWidth:"lg",overflow:"auto",mx:"auto",flex:1,flexGrow:100,position:"relative",display:"grid",gridTemplateColumns:"350px auto",gridTemplateAreas:`"traca colis colis"
                    "traca piece piece"
                    "traca poidsBrut poidsBrut"
                    "traca poids tareBalance"
          
                    "traca balance balance"`,gap:{sm:.5,lg:1},"> *":{p:.5},".traca":{marginLeft:"auto",position:"absolute",width:"350px",flexShrink:0}},children:[e.jsxs(Ge,{className:"traca",sx:{height:"100%",gridArea:"traca",borderLeft:4,borderLeftColor:"warning.main",display:"flex",flexDirection:"column",p:{md:1,sm:.5}},children:[e.jsxs(ve,{expanded:C==="pemballage",onChange:j("pemballage"),children:[e.jsxs(Me,{"aria-controls":"panel1a-content",id:"panel1a-header",children:[e.jsx(se,{size:"large",variant:"outlined",color:"warning",onClick:N,children:e.jsx(Re,{uvc:"C"})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(P,{variant:"subtitle1",component:"p",color:c!=null&&c.EMB_CODE?"primary":"text.disabled",children:[c!=null&&c.EMB_CODE?c==null?void 0:c.EMB_LIB1:O("uniteC"),"  "]}),e.jsx(P,{sx:{fontWeight:500},component:"p",color:c!=null&&c.EMB_CODE?"secondary.main":"text.disabled",variant:"h6",children:c?x.colis+" X "+Ke(c==null?void 0:c.poids):"Aucun"})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",disabled:!(c!=null&&c.EMB_CODE),onClick:m=>{m.stopPropagation(),_.clearEmballage()}})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(hn,{onSelect:le})})]}),u&&e.jsxs(ve,{expanded:C==="ppalette",onChange:j("ppalette"),children:[e.jsxs(Me,{children:[e.jsx(se,{size:"large",variant:"outlined",onClick:J,children:e.jsx(te,{icon:"PALETTE"})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(P,{variant:"subtitle1",color:E!=null&&E.EMB_CODE?"primary":"text.disabled",children:[E!=null&&E.EMB_CODE?E==null?void 0:E.EMB_LIB1:O("palett"),"  "]}),e.jsx(re,{direction:"row",gap:.5,children:E!=null&&E.EMB_CODE?e.jsx(e.Fragment,{children:e.jsxs(P,{sx:{fontWeigt:500},component:"p",color:"secondary.main",variant:"h6",children:[(E==null?void 0:E.quantity)||0," X ",Ke(E.poids)]})}):e.jsx(P,{sx:{fontWeight:500},component:"p",color:E!=null&&E.EMB_CODE?"primary":"text.disabled",variant:"h6",children:"Aucune"})})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",onClick:m=>{m.stopPropagation(),_.clearPalette()},disabled:!(E!=null&&E.EMB_CODE)})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(_n,{onSelect:ee})})]}),e.jsxs(ve,{expanded:C==="ptraca",onChange:j("ptraca"),sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(Me,{"aria-controls":"panel1a-content",id:"panel1a-header",children:[e.jsx(se,{size:"large",variant:"outlined",color:"warning",onClick:m=>D({modalFor:"TRACA"}),children:e.jsx(cn,{})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsx(P,{component:"p",color:"primary",variant:"subtitle1",children:O("complementsTraca")}),e.jsx(P,{sx:{fontWeight:500},component:"p",variant:"h6",color:"secondary.main",children:t.infoComplements.saisi+"/"+t.infoComplements.total})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",onClick:m=>{m.stopPropagation(),_.clearComplements()},disabled:t.infoComplements.saisi===0})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(ot,{sx:{overflow:"auto"},complements:t.complements})})]})]}),e.jsx(ln,{ref:w,disablePdsBrut:!!k.modalFor,NUM_FORMAT_PIECES:A.formatPieces,NUM_FORMAT_COLIS:A.formatColis,NUM_FORMAT_POIDS:A.formatPoids,updateQuantity:X,quantity:x,UC:L||"",UV:"",hasError:ue,ACH_PDS_NET_CDE:null,ACH_QUANTITE_CDE:null,ACH_COLIS_CDE:null,plateauConfig:R})]})}),e.jsxs(qe,{className:"footer",children:[e.jsx(se,{startIcon:e.jsx(Mr,{}),size:"large",variant:"contained",color:"info",fullWidth:!0,onClick:m=>{_.restartArrivage()},children:O("reset")}),e.jsx(nt,{nbLitiges:l,disabled:!ae(),color:"warning",size:"large",variant:"contained",fullWidth:!0,onClick:m=>{_.updateLineArrivage({modalFor:"LITIGE"})},children:O("litige")}),e.jsx(se,{startIcon:e.jsx(Ct,{badgeContent:r,color:"secondary",children:e.jsx(te,{icon:"LIST"})}),size:"large",fullWidth:!0,variant:"contained",onClick:m=>{D({modalFor:"LotPeseeBorne"})},children:O("pesee")}),e.jsx(T,{className:"validate"}),e.jsx(Ve,{className:"validate",disabled:!ae(),size:"large",variant:"contained",color:"success",onClick:m=>{K()},children:O("validateWeighing")}),e.jsx(Qe,{color:"error",size:"large",variant:"contained",onClick:m=>{_.updateReceptionToArticles()}})]})]})}const Mo=({...t})=>{const r=$(),{actions:n,emballage:s,palette:i,litiges:a,infoComplements:u,quantity:d,getPropertyies:l,getParametreBorneZone1:o,articleArrivage:c,fournisseurArrivage:E,adlivArrivage:_,operation:h}=Ns(r);return e.jsx(Nn,{children:e.jsx(vo,{infoComplements:u,article:c,fournisseur:E,adliv:_,resetLine:n.resetLine,nbLitiges:f.size(a),nbPesee:0,affichePalette:o("PE_PALETTE"),poidsObligatoire:o("PE_POIDS"),actions:n,emballage:s,palette:i,getPropertyies:l,typeAchat:h.mode||2,...d,...t})})};function No(){const{t}=W(),{traca:r,palette:n,quantity:s,nbExColis:i,nbExPalette:a,nbLitiges:u,lotActif:d,onChangeLotActif:l,onSetImprimante:o,onChangeNbEx:c,onValidatePesee:E,onOpenLitige:_,onGotoPrevious:h,onChangePrixAchat:x,isSaving:A,imprimanteColis:C,imprimantePalette:p,gereEditionColis:R,gereEditionPalette:L,prixAchat:I,articleArrivage:M,gereLotActif:O,gereDsd:U,gerePrixAchat:w,PrixAchatFournisseur:V}=Ms($()),k=N=>un(N,(s==null?void 0:s.colis)||0,(s==null?void 0:s.poids)||0,(s==null?void 0:s.piece)||0),D=N=>null,F=N=>null;return e.jsxs(T,{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gridTemplateRows:"min-content min-content 1fr min-content ",sx:{minHeight:0,flex:1,gridTemplateAreas:` "article article article article article"
                "palette palette quantity quantity quantity"
                "complements complements print print print"
                "footer footer footer footer footer"
        `},children:[e.jsx(Le,{sx:{gridArea:"article"},className:"headerLine article",disabled:!0,title:M==null?void 0:M.ART_CODE,subTitle:M==null?void 0:M.ART_LIB1,IconComponent:e.jsx(Pe,{codeStat:(M==null?void 0:M.ART_STAT_IMAGE)||null})}),e.jsx(fe,{sx:{gridArea:"palette"},className:"palette",IconComponent:e.jsx(te,{icon:"PALETTE"}),children:e.jsxs(T,{sx:{width:"100%"},children:[n?e.jsxs(P,{component:"p",color:"inherit",variant:"subtitle1",children:[" ",t("palett")]}):e.jsxs(P,{component:"p",color:"warning.main",variant:"subtitle1",children:[" ",t("missingPalett")]}),e.jsx(T,{display:"flex",alignItems:"center",children:n&&e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{fontWeight:500},component:"p",color:"inherit",variant:"h5",children:n==null?void 0:n.EMB_LIB1}),e.jsxs(P,{sx:{mx:1},variant:"body1",color:"text.primary",children:[n==null?void 0:n.poids," Kg  X ",n==null?void 0:n.quantity]})]})})]})}),e.jsx(fe,{disabled:!0,sx:{gridArea:"quantity"},className:"quantity",disableIconMargin:!0,IconComponent:null,children:e.jsx(G,{container:!0,sx:{px:2},alignItems:"center",children:f.map(["C","P","N"],N=>e.jsx(G,{item:!0,xs:4,children:e.jsx(Ue,{uvc:N,qtePesee:k(N),qteCommande:D(),qteDejaReceptionne:F(),subTitle:U&&N==="N"?`DSD: ${s.dsd||""}`:""})},N))})}),e.jsxs(T,{display:"flex",alignItems:"stretch",flexDirection:"column",sx:{gridArea:"complements",overflow:"hidden",p:.6},children:[e.jsx(Ge,{sx:{flex:1,overflow:"auto",minHeight:0},children:e.jsx(At,{children:e.jsx(ot,{complements:r.complements})})}),O&&e.jsx(jt,{lotActif:d,onChangeLotActif:l})]}),e.jsxs(T,{display:"flex",alignItems:"stretch",flexDirection:"column",sx:{gridArea:"print",overflowY:"auto",p:.6},children:[R&&e.jsx(Ne,{onChangePrinter:N=>{o("imprimanteColis",N)},label:t("defaultPrinter"),title:t("packagePrinter"),imprimante:C,nbEx:i,onChangeNbEx:N=>c("nbExColis",N)}),L&&e.jsx(Ne,{onChangePrinter:N=>{o("imprimantePalette",N)},imprimante:p,label:t("defaultPrinter"),title:t("paletPrinter"),nbEx:a,onChangeNbEx:N=>c("nbExPalette",N)}),w&&!V&&e.jsxs(e.Fragment,{children:[e.jsx(P,{color:"primary",variant:"h5",children:t("purchase price")}),e.jsx(ts,{isUs:!1,title:"",name:"purchase price",icon:10,label:t("purchase price"),maskProps:{},value:I,onChange:N=>x(N.target.value),isCompleted:!1})]})]}),e.jsxs(qe,{sx:{gridArea:"footer"},children:[e.jsx(nt,{nbLitiges:u,size:"large",variant:"contained",color:"warning",fullWidth:!0,onClick:N=>_()}),e.jsx(T,{className:"validate"}),e.jsx(Ve,{disabled:A,size:"large",variant:"contained",color:"success",onClick:N=>{E()},children:t("validateWeighing")}),e.jsx(Qe,{disabled:A,size:"large",variant:"contained",color:"error",onClick:N=>{h()}})]})]})}function Dn(){const t=me($()),r=We($());return e.jsx(Mt,{onContinue:function(n){t.operation.mode==1?t.actions.updateLineCommandeAchat({lotActif:n}):t.actions.updateLineArrivage({lotActif:n}),t.actions.updateReceptionForward({})},onBack:()=>{t.actions.updateReceptionBackward({})},complementsTracaDetail:r.complements,onUpdateComplement:r.onUpdateComplement,onClearComplement:r.onClearComplement,typeAchat:t.operation.mode||1,fournisseur:r.fournisseur||null})}const yn=(t,r="",n=!0,s=!0)=>i=>{const{onCloseReception:a,ACH_NUMSEQ:u}=i;W();const d=oe(),l=Nr(d.current,u,r);g.useEffect(()=>{if(l.lockSuccess)return()=>{B().LockMethods().libereAchat(d.current,u)}},[l.lockSuccess,u]);const o=g.useCallback(()=>{n&&l.lockSuccess&&B().LockMethods().libereAchat(d.current,u),a()},[a,n,l.lockSuccess,u]);return l.isLocking?e.jsx(Ie,{}):!l.lockSuccess&&!l.lockSuccess?e.jsx(Dr,{onClose:a,lock:l}):e.jsx(t,{...i,onCloseReception:o})};function Do({operationId:t,commentairesEntete:r,gerePeseeDirect:n,onValidatePeseeDirect:s,peseeSuplementaire:i,infoComplements:a,resetLine:u,affichePesees:d,afficheLitiges:l,affichePalette:o,poidsObligatoire:c,typeAchat:E,nbLitiges:_,refresh:h,getPropertyies:x,emballage:A,palette:C,actions:p,detail:R,complementStore:L,fournisseur:I,adliv:M,...O}){var Y,Te,he;const{t:U}=W(),w=Pn(t),V=g.useRef(null),k=ge(),[D,F]=g.useState({modalFor:""}),N=()=>{F({modalFor:"",emballageOuPalette:null})},J=g.useCallback(async v=>{v.stopPropagation();const Q=await k.showInfiniteSearch({title:"emballageSelection",type:"Emballages",props:{},dialogProps:{fullScreen:!0}});Q!=null&&F({modalFor:"Emballages",emballageOuPalette:Q})},[F,k.showInfiniteSearch]),le=g.useCallback(async v=>{v.stopPropagation();const Q=await k.showInfiniteSearch({title:"palettSelection",type:"Palettes",props:{},dialogProps:{fullScreen:!0}});Q!=null&&F({modalFor:"Palettes",emballageOuPalette:Q})},[F,k.showInfiniteSearch]);g.useCallback(async()=>{F({modalFor:"Palettes",emballageOuPalette:C})},[F,C]),g.useCallback(async()=>{F({modalFor:"Emballages",emballageOuPalette:A})},[F,A]);const ee=pn("ACHAT"),X=((Y=R.Article)==null?void 0:Y.ART_PIECE_COL)||null,ie=((Te=R.Article)==null?void 0:Te.ART_PDS_NET)||null,Z=R.ACH_UNIT_CDE,ue=g.useCallback(v=>{F({modalFor:"Palettes",emballageOuPalette:v})},[F,C]),ae=g.useCallback(v=>{F({modalFor:"Emballages",emballageOuPalette:v})},[]),K=g.useCallback((v,Q)=>{p.updateQuantityReception(v,Q,{poidsColisMoyen:ie,pieceParColisMoyen:X,poidsPieceMoyen:1,unite:Z||"",SIT_AC_RECALCUL_UNITES:x("SIT_AC_RECALCUL_UNITES",!1)||!1,SIT_AC_FORMAT_COLIS:ee.formatColis,SIT_AC_FORMAT_POIDS:ee.formatPoids})},[X,ie,Z,p.updateQuantityReception]),m=(()=>{const v=[],Q=ze=>+ze<0,ce=(ze,Hn=null)=>v.push({err:ze,variables:Hn});return c&&!O.poidsSaisi&&ce("ERR_POIDSOBLIGATOIRE"),(Q(O.colis)||R.ACH_UNIT_CDE==="C"&&!O.colis)&&ce("ERR_QTE_COLIS",{colis:O.colis}),(Q(O.poids)||f.includes(["N","K"],R.ACH_UNIT_CDE)&&!O.poids)&&ce("ERR_QTE_POIDS",{poids:O.poids}),(Q(O.piece)||R.ACH_UNIT_CDE==="P"&&!O.piece)&&ce("ERR_QTE_PIECE",{piece:O.piece}),v})(),b=v=>f.some(m,Q=>Q.err===v),y=async(v="NORMAL")=>{if(!f.isEmpty(m)){const Q=f.head(m);return k.showError({i8nmessage:U(Q.err,Q.variables||{}),i8ntitle:U("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})}if(V&&V.current&&V.current.gereDsd()){const Q=await V.current.getDsdPlateau();if(Q.err)return null;K({dsd:Q.dsd})}v==="NORMAL"?p.updateReceptionForward({}):s(Q=>{K({colis:0,poids:0,piece:0,tareBalance:null,poidsBrut:null}),h()})},[q,_e]=an("panelExpandedReception","",!1,"SCALAR"),ne=v=>(Q,ce)=>{_e(ce?v:" ")};return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{dialogProps:{maxWidth:"md",fullWidth:!0,fullScreen:f.includes(["TRACA","LotPeseeBorne"],D.modalFor)},withAppBar:!0,isOpen:!!D.modalFor,onCloseDialog:()=>N(),i8ntitle:Tt(U,D.modalFor),className:"",children:[(D.modalFor==="Palettes"||D.modalFor==="Emballages")&&e.jsx(mn,{onClose:()=>N(),mode:D.modalFor,emballage:D.emballageOuPalette,quantity:D.modalFor==="Emballages"?O.colis:(C==null?void 0:C.quantity)||1,onSave:function(v,Q,ce){D.modalFor==="Palettes"?(p.updatePalette({...v,poids:Q,quantity:ce}),K({tareBalance:null})):(p.updateEmballage({...v,poids:Q,quantity:ce}),K({colis:ce,tareBalance:null})),N()}}),D.modalFor==="LotPeseeBorne"&&e.jsx(uo,{ach_lot_seq:R.ACH_LOT_SEQ,onContinueReception:v=>{p.onContinueCommandeAchat(v,!1),N()}}),D.modalFor==="TRACA"&&e.jsx(Mt,{complementsTracaDetail:a.complements,typeAchat:E,fournisseur:I,adliv:M,onUpdateComplement:a.onUpdateComplement,onClearComplement:a.onClearComplement,onContinue:function(v){p.updateLineCommandeAchat({lotActif:v}),N()}})]}),e.jsx(Le,{className:"headerLine article",disabled:!0,title:R.Article.ART_CODE,subTitle:R.Article.ART_LIB1,IconComponent:e.jsx(Pe,{fontSize:"large",codeStat:R.Article.ART_STAT_IMAGE||null})}),e.jsx(fe,{className:"commentaire",disabled:!0,IconComponent:e.jsx(te,{icon:"COMMENTAIRE"}),children:e.jsxs(T,{children:[e.jsx(P,{sx:{color:"secondary.main",fontWeight:500},component:"div",variant:"h5",children:f.join(f.reject(r,f.isEmpty),"/")}),e.jsx(P,{sx:{color:"secondary.main",fontWeight:800},component:"div",variant:"h5",children:R.ACH_COM_ART||"NA"})]})}),e.jsx(T,{sx:{flex:1,flexGrow:100},children:e.jsxs(T,{sx:{height:"100%",maxWidth:"lg",overflow:"auto",mx:"auto",flex:1,flexGrow:100,position:"relative",display:"grid",gridTemplateColumns:"350px auto",gridTemplateAreas:`"traca colis colis"
                    "traca piece piece"
                    "traca poidsBrut poidsBrut"
                    "traca poids tareBalance"
          
                    "traca balance balance"`,gap:{sm:.5,lg:1},"> *":{p:.5},".traca":{marginLeft:"auto",position:"absolute",width:"350px",flexShrink:0}},children:[e.jsxs(Ge,{className:"traca",sx:{height:"100%",gridArea:"traca",borderLeft:4,borderLeftColor:"warning.main",display:"flex",flexDirection:"column",p:{md:1,sm:.5}},children:[e.jsxs(ve,{expanded:q==="pemballage",onChange:ne("pemballage"),children:[e.jsxs(Me,{"aria-controls":"panel1a-content",id:"panel1a-header",children:[e.jsx(se,{size:"large",variant:"outlined",color:"warning",onClick:J,children:e.jsx(Re,{uvc:"C"})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(P,{variant:"subtitle1",component:"p",color:A!=null&&A.EMB_CODE?"primary":"text.disabled",children:[A!=null&&A.EMB_CODE?A==null?void 0:A.EMB_LIB1:U("uniteC"),"  "]}),e.jsx(P,{sx:{fontWeight:500},component:"p",color:A!=null&&A.EMB_CODE?"secondary.main":"text.disabled",variant:"h6",children:A?O.colis+" X "+Ke(A==null?void 0:A.poids):"Aucun"})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",disabled:!(A!=null&&A.EMB_CODE),onClick:v=>{v.stopPropagation(),p.clearEmballage()}})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(hn,{onSelect:ae})})]}),o&&e.jsxs(ve,{expanded:q==="ppalette",onChange:ne("ppalette"),children:[e.jsxs(Me,{children:[e.jsx(se,{size:"large",variant:"outlined",onClick:le,children:e.jsx(te,{icon:"PALETTE"})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsxs(P,{variant:"subtitle1",color:C!=null&&C.EMB_CODE?"primary":"text.disabled",children:[C!=null&&C.EMB_CODE?C==null?void 0:C.EMB_LIB1:U("palett"),"  "]}),e.jsx(re,{direction:"row",gap:.5,children:C!=null&&C.EMB_CODE?e.jsx(e.Fragment,{children:e.jsxs(P,{sx:{fontWeigt:500},component:"p",color:"secondary.main",variant:"h6",children:[(C==null?void 0:C.quantity)||0," X ",Ke(C.poids)]})}):e.jsx(P,{sx:{fontWeight:500},component:"p",color:C!=null&&C.EMB_CODE?"primary":"text.disabled",variant:"h6",children:"Aucune"})})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",onClick:v=>{v.stopPropagation(),p.clearPalette()},disabled:!(C!=null&&C.EMB_CODE)})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(_n,{onSelect:ue})})]}),!!a.infoComplements.total&&e.jsxs(ve,{expanded:q==="ptraca",onChange:ne("ptraca"),sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(Me,{"aria-controls":"panel1a-content",id:"panel1a-header",children:[e.jsx(se,{size:"large",variant:"outlined",color:"warning",onClick:v=>F({modalFor:"TRACA"}),children:e.jsx(cn,{})}),e.jsxs(re,{direction:"column",sx:{flexGrow:1},children:[e.jsx(P,{color:"primary",variant:"subtitle1",children:U("complementsTraca")}),e.jsx(P,{sx:{fontWeight:500},component:"p",variant:"h6",color:"secondary.main",children:a.infoComplements.saisi+"/"+a.infoComplements.total})]}),e.jsx(je,{iconType:"BACK",size:"large",variant:"contained",color:"error",onClick:v=>{v.stopPropagation(),p.clearComplements()},disabled:a.infoComplements.saisi===0})]}),e.jsx(be,{sx:{flex:1,overflow:"auto"},children:e.jsx(ot,{sx:{overflow:"auto"},complements:a.complements})})]})]}),e.jsx(ln,{ref:V,disablePdsBrut:!!D.modalFor,NUM_FORMAT_PIECES:ee.formatPieces,NUM_FORMAT_COLIS:ee.formatColis,NUM_FORMAT_POIDS:ee.formatPoids,updateQuantity:K,quantity:O,UC:Z,UV:"",hasError:b,ACH_PDS_NET_CDE:R.ACH_PDS_NET_CDE<0?0:R.ACH_PDS_NET_CDE,ACH_QUANTITE_CDE:R.ACH_QUANTITE_CDE<0?0:R.ACH_QUANTITE_CDE,ACH_COLIS_CDE:R.ACH_COLIS_CDE<0?0:R.ACH_COLIS_CDE,plateauConfig:w})]})}),e.jsxs(qe,{className:"footer",sx:{},children:[e.jsx(Ur,{color:"primary",size:"large",variant:"outlined",onClick:v=>p.updateLineCommandeAchat({modalFor:"TOOLS"}),children:U("menu")}),l&&e.jsx(nt,{color:"warning",size:"large",variant:"outlined",fullWidth:!0,onClick:v=>{p.updateLineCommandeAchat({modalFor:"LITIGE"})},nbLitiges:_}),d&&e.jsx(se,{color:"primary",variant:"outlined",startIcon:e.jsx(Ct,{badgeContent:(he=R.pesee)==null?void 0:he.NB_PESEE,color:"primary",children:e.jsx(te,{icon:"LIST"})}),size:"large",fullWidth:!0,onClick:v=>{F({modalFor:"LotPeseeBorne"})},children:U("pesee")}),e.jsx(T,{className:"validate"}),n&&e.jsx(se,{className:"validate",color:"success",variant:"contained",onClick:v=>{y("DIRECT")},disabled:!i,size:"large",fullWidth:!0,startIcon:e.jsx(xn,{}),children:U("directWeighing")}),e.jsx(Ve,{size:"large",variant:"contained",color:"success",onClick:v=>{y()},children:U("validateWeighing")}),e.jsx(tt,{color:"error",size:"large",variant:"contained",onClick:v=>{p.leaveLineReception()},children:U("close")})]})]})}const yo=({operationId:t,detail:r,fournisseur:n,adliv:s,refresh:i})=>{var _,h,x;const{litiges:a,info:u,infoComplements:d,quantity:l,onValidatePeseeDirect:o}=Qs(t),c=g.useContext(Bn),E=g.useMemo(()=>({PE_BT_PES:u.getParametreBorneZone1("PE_BT_PES"),PE_BT_LITIGE:u.getParametreBorneZone1("PE_BT_LITIGE"),PE_VALID:u.getParametreBorneZone1("PE_VALID"),PE_PALETTE:u.getParametreBorneZone1("PE_PALETTE"),PE_POIDS:u.getParametreBorneZone1("PE_POIDS")}),[u.getParametreBorneZone1]);return e.jsx(Do,{operationId:t,commentairesEntete:c,detail:r,infoComplements:d,resetLine:u.actions.resetLine,peseeSuplementaire:!!u.operation.reception.currentLine.PESEE_SUP_ACH_LOT_SEQ,complementStore:u.operation.complementsTracaDetail||[],nbLitiges:f.size(a),refresh:i,affichePesees:E.PE_BT_PES,afficheLitiges:E.PE_BT_LITIGE,gerePeseeDirect:E.PE_VALID,affichePalette:E.PE_PALETTE,poidsObligatoire:E.PE_POIDS,actions:u.actions,onValidatePeseeDirect:o,emballage:((_=u.operation)==null?void 0:_.emballage)||null,palette:((h=u.operation)==null?void 0:h.palette)||null,typeAchat:((x=u.operation)==null?void 0:x.mode)||1,fournisseur:n,adliv:s,...l,getPropertyies:u.getPropertyies})},Bo=({operationId:t,fournisseur:r,adliv:n})=>{var E;const{t:s}=W(),i=Ae(),a=oe(),{achLotSeq:u,onLeaveLine:d}=ws(t),l=yr(a.current,u),o=An(a,u,{enabled:!!l.lockSuccess});if(o.isLoading||l.isLocking)return e.jsx(Ie,{});if(!l.lockSuccess)return e.jsx(Br,{errorTitle:s("lockError"),firstActionMessage:s("retry"),onFirstAction:l.retryLock,secondActionMessage:s("close"),onSecondAction:d});const c=(E=o.data)==null?void 0:E.res;return c?e.jsx(yo,{detail:c,refresh:o.refetch,operationId:t,fournisseur:r,adliv:n}):(i.errorMessage("detail non trouvé"),d(),null)},Uo=({ACH_NUMSEQ:t,onSelectLigne:r,ActionsButtons:n})=>{const s=De({key:["ReceptionsDetailReception",t],keyConfigFilters:"ReceptionsDetailReception",fxt:(i,a)=>B().AchatMethods().ListeDetailAchat({variables:{recherche:i,context:(a==null?void 0:a.current)||null}}),query:de("ACH_NUMSEQ",t,"="),options:{}});return e.jsx(Ao,{ActionsButtons:n,onSelect:r,data:s})},Fo=({reception:t,onCloseReception:r,onOpenReliquat:n,gereReliquat:s,showCommentaire:i,children:a,...u})=>{var l,o;const d=g.useMemo(()=>Fr(t),[t]);return e.jsxs(Nn,{children:[e.jsx(fe,{disabled:!0,IconComponent:null,disableIconMargin:!0,className:"fournisseur",children:e.jsxs(T,{display:"grid",gap:1,sx:{width:"100%",flexBasis:"100%",gridTemplateColumns:"3fr 1fr auto",gridTemplateAreas:` "frn cde btns"
                "comment comment btns"
                 
            `},children:[e.jsxs(T,{gridArea:"frn",sx:{paddingLeft:.8},display:"flex",alignItems:"center",children:[e.jsx(te,{icon:"FOURNISSEUR"}),e.jsxs(T,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(P,{variant:"h6",color:"primary",children:(l=t.Fournisseur)==null?void 0:l.FOU_CODE}),e.jsx(P,{variant:"h6",children:(o=t.Fournisseur)==null?void 0:o.FOU_NOM})]})]}),e.jsxs(T,{display:"flex",alignItems:"center",gridArea:"cde",children:[e.jsx(te,{icon:"ORDER"}),e.jsxs(T,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(P,{variant:"h6",color:"primary",children:t.ACH_CDE}),e.jsx(P,{variant:"h6",children:on(t.ACH_DATE_REC)})]})]}),e.jsx(T,{display:"flex",gap:1,sx:{padding:.5},gridArea:"btns",children:e.jsx(ko,{disabled:!i,onOpenReliquat:n,ACH_NUMSEQ:t.ACH_NUMSEQ,onCloseReception:r,gereReliquat:s})}),i&&d&&e.jsxs(T,{gridArea:"comment",display:"flex",gap:2,color:"secondary.main",children:[e.jsx(kr,{fontSize:"medium",color:"inherit"}),e.jsx(P,{sx:{color:"inherit",fontWeight:800},component:"p",variant:"h4",children:d})]})]})}),a]})},ko=({disabled:t,ACH_NUMSEQ:r,onOpenReliquat:n,onCloseReception:s,gereReliquat:i})=>{const{onFinReceptionCommande:a}=gn($()),u=ge(),{t:d}=W(),l=oe(),o=g.useCallback(E=>{async function _(){var x;if(await u.showConfirmation({title:"confirmTerminateReceptionTitle",message:"confirmTerminateReceptionBody",type:"terminate",dialogProps:{fullScreen:!1,maxWidth:"sm"}})){if(i){const A=await B().AchatMethods().rechercheListeDetailAchat({variables:{numSeq:r,context:l.current}});if(f.some((x=A.res)==null?void 0:x.result,C=>C.TOTAL_A_REC>0&&C.TOTAL_A_REC>C.TOTAL_REC))return n(r)}a(r,A=>{(A==null?void 0:A.codeResult)==="OK"&&s()})}}_()},[r]),c=g.useCallback(E=>{s()},[s]);return e.jsxs(e.Fragment,{children:[e.jsx(dn,{disabled:t,variant:"contained",sx:{bgcolor:"primary.dark"},onClick:o,children:d("terminateReception")}),e.jsx(tt,{disabled:t,variant:"contained",color:"error",onClick:c})]})},Bn=g.createContext([]),Ho=({operationId:t,onOpenReliquat:r,ACH_LOT_SEQ:n,ACH_NUMSEQ:s,gereReliquat:i,onSelectLigne:a,onCloseReception:u})=>{var h,x;const d=oe(),l=Us(d,s),o=f.head((x=(h=l.data)==null?void 0:h.res)==null?void 0:x.result)||null,c=!l.isLoading&&!o;g.useEffect(()=>{c&&u()},[c]);const E=g.useCallback(A=>{a(A)},[a]),_=g.useMemo(()=>[(o==null?void 0:o.ACH_COMMENTAIRE1)||"",(o==null?void 0:o.ACH_COMMENTAIRE2)||""],[o]);return e.jsx(e.Fragment,{children:l.isLoading?e.jsx(Ie,{}):e.jsx(Bn.Provider,{value:_,children:o&&e.jsxs(Fo,{reception:o,showCommentaire:!n,onCloseReception:u,gereReliquat:i,onOpenReliquat:r,children:[!!n&&e.jsx(Bo,{operationId:t,fournisseur:o==null?void 0:o.Fournisseur,adliv:o==null?void 0:o.ACH_ADLIV}),!n&&e.jsx(Uo,{ACH_NUMSEQ:s,onSelectLigne:E,ActionsButtons:null})]})})})};function Un(t){var r,n,s;return{ACH_LOT_SEQ:t.ACH_LOT_SEQ,ART_CODE:((r=t.Article)==null?void 0:r.ART_CODE)||"",ART_LIB1:((n=t.Article)==null?void 0:n.ART_LIB1)||"",ART_STAT_IMAGE:(s=t.Article)==null?void 0:s.ART_STAT_IMAGE,unite:Hr(t.ACH_UNIT_CDE),quantityReceptionne:t.TOTAL_REC||0,quantityTotal:t.TOTAL_A_REC||0,quantityPesee:0,modeManquant:"M"}}function Fn({details:t,onChange:r,onSave:n,onClose:s}){const[i,a]=g.useState(Ze(new Date)),[u,d]=g.useState(Ze(new Date)),l=Ae(),{t:o}=W();return e.jsxs(T,{sx:{m:1,minHeight:0,flex:1,maxHeight:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(G,{container:!0,children:[e.jsxs(G,{item:!0,xs:12,md:6,children:[e.jsx(P,{variant:"h6",sx:{margin:"auto",textAlign:"center",color:"info.main",userSelect:"none"},children:o("orderDate")}),e.jsx(ut,{readOnlyDate:!1,onChange:a,date:i})]}),e.jsxs(G,{item:!0,xs:12,md:6,justifyContent:"center",children:[e.jsx(P,{variant:"h6",sx:{margin:"auto",textAlign:"center",color:"info.main",userSelect:"none"},children:o("remainderDate")}),e.jsx(ut,{readOnlyDate:!1,onChange:d,date:u})]})]}),e.jsx(T,{display:"flex",flexDirection:"column",sx:{m:1,overflow:"auto"},children:f.map(t,({ACH_LOT_SEQ:c,quantityReceptionne:E,quantityPesee:_,quantityTotal:h,unite:x,modeManquant:A,ART_CODE:C,ART_LIB1:p,ART_STAT_IMAGE:R})=>e.jsxs(G,{spacing:1,container:!0,alignItems:"stretch",flexWrap:"nowrap",children:[e.jsx(G,{item:!0,xs:12,md:4,flexShrink:0,children:e.jsx(ns,{ManquantReliquat:A,onChangeManquantReliquat:L=>{r(c,L)}})}),e.jsx(G,{item:!0,xs:12,md:!0,children:e.jsx(Le,{className:"headerLine quantity fullHeight",sx:{"& .text > p":{whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"300px",overflow:"hidden"}},FooterComponent:L=>e.jsxs(P,{sx:{fontWeight:800,color:"#f50057"},variant:"h6",children:[E+_," / ",h," ",x]}),disabled:!0,title:C,subTitle:p,IconComponent:e.jsx(Pe,{codeStat:R})})})]},c))}),e.jsxs(T,{display:"flex",gap:1,children:[e.jsx(Ve,{variant:"outlined",onClick:c=>{try{Bt(i)&&Bt(u)&&(wr(at(i),at(u),"date")?n(t,{dateCommande:Ut(i),dateReception:Ut(u)}):l.errorMessage(o("invalidDate")))}catch{}}}),e.jsx(tt,{variant:"outlined",onClick:c=>{s()}})]})]})}function wo({detail:t}){var K,j;const{t:r}=W(),{traca:n,palette:s,quantity:i,nbExColis:a,nbExPalette:u,nbLitiges:d,lotActif:l,onLeaveLine:o,onChangeLotActif:c,onSetImprimante:E,onChangeNbEx:_,onValidatePesee:h,onOpenLitige:x,onGotoPrevious:A,onChangePrixAchat:C,onContinueCommandeAchat:p,onFinReceptionLigne:R,isSaving:L,imprimanteColis:I,imprimantePalette:M,gereEditionColis:O,gereEditionPalette:U,prixAchat:w,gereLotActif:V,gerePrixAchat:k,gereReliquat:D,gereLitige:F,gereDsd:N}=Bs($()),[J,le]=g.useState(""),[ee,X]=g.useState([]);if(g.useEffect(()=>{t&&X([{...Un(t),quantityPesee:Z(t==null?void 0:t.ACH_UNIT_CDE)||0}])},[t,X]),!t)return e.jsx("div",{children:":("});const ie=g.useRef(0),Z=m=>t&&un(m,(i==null?void 0:i.colis)||0,(i==null?void 0:i.poids)||0,(i==null?void 0:i.piece)||0),ue=m=>m===(t&&t.ACH_UNIT_CDE)?t.TOTAL_A_REC:null,ae=m=>m===(t&&t.ACH_UNIT_CDE)?t.TOTAL_REC:null;return e.jsxs(T,{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gridTemplateRows:"min-content min-content 1fr min-content ",sx:{gap:.4,minHeight:0,flex:1,gridTemplateAreas:` "article article article article article"
                "palette palette quantity quantity quantity"
                "complements complements print print print"
                "footer footer footer footer footer"
        `},children:[e.jsx(Ce,{dialogProps:{maxWidth:"lg",fullWidth:!0,fullScreen:!1},withAppBar:!1,isOpen:!!J,onCloseDialog:()=>le(""),i8ntitle:null,className:"",children:e.jsx(Fn,{details:ee,onClose:function(){p(ie.current)},onSave:function(m,b){const y=f.head(m).modeManquant==="M";R(y?null:b,q=>{(q==null?void 0:q.codeResult)==="OK"&&o()})},onChange:function(m,b){X(y=>f.map(y,q=>q.ACH_LOT_SEQ===m?{...q,modeManquant:b}:q))}})}),e.jsx(Le,{sx:{gridArea:"article"},className:"headerLine article",disabled:!0,title:(K=t==null?void 0:t.Article)==null?void 0:K.ART_CODE,subTitle:t.Article.ART_LIB1,IconComponent:e.jsx(Pe,{codeStat:((j=t==null?void 0:t.Article)==null?void 0:j.ART_STAT_IMAGE)||null})}),e.jsx(fe,{sx:{gridArea:"palette"},disabled:!0,className:"palette",IconComponent:e.jsx(te,{icon:"PALETTE"}),children:e.jsx(T,{sx:{width:"100%"},children:s?e.jsxs(e.Fragment,{children:[e.jsxs(P,{component:"p",color:"inherit",variant:"subtitle1",children:[" ",r("palett")]}),e.jsxs(T,{display:"flex",alignItems:"center",children:[e.jsx(P,{sx:{fontWeight:500},component:"p",color:"inherit",variant:"h5",children:s==null?void 0:s.EMB_LIB1}),e.jsxs(P,{sx:{mx:1},variant:"body1",color:"text.primary",children:[s==null?void 0:s.poids," Kg  X ",s==null?void 0:s.quantity]})]})]}):e.jsxs(P,{component:"p",color:"warning.main",variant:"subtitle1",children:[" ",r("missingPalett")]})})}),e.jsx(fe,{disabled:!0,sx:{gridArea:"quantity"},className:"quantity",disableIconMargin:!0,IconComponent:null,children:e.jsx(G,{container:!0,sx:{px:2},alignItems:"center",children:f.map(["C","P","N"],m=>e.jsx(G,{item:!0,xs:4,children:e.jsx(Ue,{uvc:m,qtePesee:Z(m),qteCommande:ue(m),qteDejaReceptionne:ae(m),subTitle:N&&m==="N"?`DSD: ${i.dsd||""}`:""})},m))})}),e.jsxs(T,{display:"flex",alignItems:"stretch",flexDirection:"column",sx:{gridArea:"complements",overflow:"hidden",p:.6},children:[e.jsx(Ge,{sx:{flex:1,overflow:"auto",minHeight:0},children:e.jsx(At,{children:e.jsx(ot,{complements:n.complements})})}),V&&e.jsx(jt,{lotActif:l,onChangeLotActif:c})]}),e.jsxs(T,{display:"flex",alignItems:"stretch",flexDirection:"column",sx:{gridArea:"print",overflowY:"auto",p:.6},children:[O&&e.jsx(Ne,{onChangePrinter:m=>{E("imprimanteColis",m)},label:r("defaultPrinter"),title:r("packagePrinter"),imprimante:I,nbEx:a,onChangeNbEx:m=>_("nbExColis",m)}),U&&e.jsx(Ne,{onChangePrinter:m=>{E("imprimantePalette",m)},imprimante:M,label:r("defaultPrinter"),title:r("paletPrinter"),nbEx:u,onChangeNbEx:m=>_("nbExPalette",m)}),k&&!t.ACH_PRIX_ACHAT&&e.jsx(ct,{sx:rs,id:"ref",name:"PRICE",type:"number",label:r("purchase price"),maskProps:{precision:3},InputLabelProps:{shrink:!0},value:f.isNil(w)?t.ACH_PRIX_ACHAT:w,onChange:m=>C(m.target.value),autoComplete:"off"})]}),e.jsxs(qe,{sx:{gridArea:"footer"},children:[F&&e.jsx(nt,{nbLitiges:d,size:"large",variant:"outlined",color:"warning",fullWidth:!0,onClick:m=>x()}),e.jsx(T,{className:"validate"}),e.jsx(dn,{sx:{bgcolor:"primary.dark"},disabled:L,size:"large",variant:"contained",color:"error",onClick:m=>{h(b=>{if(b){const y=t==null?void 0:t.ACH_UNIT_CDE;D&&Z(y)+t.TOTAL_REC<(t.TOTAL_A_REC||0)?(ie.current=b.achLotSeq,le("RELIQUAT")):R(null,()=>{o()})}})},children:r("terminateReception")}),e.jsx(Ve,{disabled:L,size:"large",variant:"contained",color:"success",onClick:m=>{h(b=>{b&&p(b.achLotSeq)})},children:r("validateWeighing")}),e.jsx(Qe,{disabled:L,size:"large",variant:"contained",color:"error",onClick:m=>{A()}})]})]})}const Qo=Ln(wo);function Go(t){const{step:r,...n}=t;return e.jsxs(e.Fragment,{children:[r===H.CURRENTLINECPL&&e.jsx(Dn,{}),r===H.CURRENTLINESAVE&&e.jsx(Qo,{}),r===H.CURRENTRECEPTION&&e.jsx(Ho,{...n})]})}const Vo=yn(Go,"",!0);function qo({step:t}){const r=$(),n=me(r),{reception:s}=n.operation,i=n.actions.selectReceptionLine;if(!s)return null;const{ACH_NUMSEQ:a,ACH_LOT_SEQ:u}=s;return e.jsx(Vo,{operationId:r,step:t,gereReliquat:n.getParametreBorneZone1("PE_RELIQUAT"),ACH_LOT_SEQ:u,ACH_NUMSEQ:a,onOpenReliquat:n.actions.onOpenReliquatReception,onSelectLigne:i,onCloseReception:n.actions.unSelectReception})}function Wo(t,r){return De({key:["AdresseLivraisonFournisseur",t],fxt:{retrieve:(n,s)=>B().CommunMethods().listAdresseLivraisonFournisseur({variables:{recherche:n,context:(s==null?void 0:s.current)||null,filtresOptionnels:r,fournisseur:t}}),retrievePreferences:null},query:r})}function zo({item:t,className:r="",isLoading:n,maxWidth:s,onAddFavorite:i,favorites:a,editFavorite:u,onSelect:d,ItemComponentProps:l,style:o,...c}){return e.jsx(et,{sx:{borderBottom:1,borderBottomColor:"divider",borderLeft:"8px solid transparent",padding:.5,height:"100%"},onClick:E=>d(t),style:o,children:e.jsxs(T,{sx:{height:"100%",width:"100%",gap:1,display:"flex"},children:[e.jsx(sn,{color:"disabled"}),e.jsx(G,{container:!0,flexDirection:"row",children:e.jsxs(G,{item:!0,xs:12,md:8,children:[e.jsxs(T,{sx:{display:"flex",gap:1,justifyContent:"flex-start"},children:[e.jsxs(P,{variant:"body1",component:"div",color:"primary",children:[t.LIVF_NUM," - ",t.LIVF_NOM]}),e.jsx(P,{variant:"body1",sx:{fontWeight:"600"},component:"div",color:"textPrimary",children:t.PAYS_FOU})]}),e.jsxs(P,{variant:"subtitle1",children:[t.LIVF_ADR1,"  ",t.LIVF_POSTAL," ",t.LIVF_VILLE]})]})})]})})}const $o={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:80}};function Zo({fournisseur:t,recherche:r=null,paramsOptions:n,onSelect:s,onClose:i}){const a=Wo(t,r),u=g.useMemo(()=>({fournisseur:t,onClose:i}),[t,i]);return e.jsx(ye,{onSelect:s,HeaderComponent:null,ItemMeasureCard:$o,ItemComponentProps:u,ItemComponent:zo,disableFavorite:!0,state:a,IconComponent:ls,labelSearch:"SSCC"})}const Ko=({fournisseur:t,onSelect:r,onClose:n})=>{const s=Qr();return e.jsx(e.Fragment,{children:e.jsx(Zo,{onSelect:r,fournisseur:t,onClose:n,paramsOptions:s})})},Yo=({actions:t,step:r})=>{const{dataDetails:n,dataReceptions:s}=ks();return e.jsxs(gt,{fallbackRender:i=>e.jsx(Pt,{errorOrigin:"AfficheStepReception",...i,resetMessage:"retour"}),onReset:()=>t.updateReception({mode:0}),children:[r===H.LISTRECEPTIONS&&e.jsx(So,{data:s,onSelect:t.selectReception}),r===H.LISTDETAILS&&e.jsx(fo,{data:n}),f.includes([H.CURRENTLINESAVE,H.CURRENTRECEPTION,H.CURRENTLINECPL],r)&&e.jsx(qo,{step:r})]})},Xo=({actions:t,step:r})=>{var a;const[n,s]=g.useState({modalFor:"",fournisseur:null}),i=()=>{s({modalFor:"",fournisseur:null})};return e.jsxs(gt,{fallbackRender:u=>e.jsx(Pt,{errorOrigin:"AfficheStepArrrivage",...u,resetMessage:"retour"}),onReset:()=>t.updateReception({stepArrivage:H.HOME}),children:[e.jsx(Ce,{dialogProps:{maxWidth:"md",fullWidth:!0,fullScreen:f.includes(["ADRESSLIVFOURNISSEUR"],n.modalFor)},withAppBar:!0,isOpen:!!n.modalFor,onCloseDialog:()=>i(),i8ntitle:Tt(z,n.modalFor),className:"",children:n.modalFor==="ADRESSLIVFOURNISSEUR"&&e.jsx(e.Fragment,{children:e.jsx(Ko,{fournisseur:(a=n.fournisseur)==null?void 0:a.FOU_CODE,onSelect:function(u){s({modalFor:"",fournisseur:null}),t.updateReceptionForward({fournisseurArrivage:n.fournisseur,adlivArrivage:u.LIVF_NUM})},onClose:i})})}),r===H.CURRENTARRIVAGE&&e.jsx(Mo,{}),r===H.CURRENTLINECPL&&e.jsx(Dn,{}),r===H.PALETTES&&e.jsx(Fe,{type:"Palettes",onSelect:function(u){t.updateReceptionForward({palette:kt(u)})}}),r===H.CURRENTLINESAVE&&e.jsx(No,{}),r===H.EMBALLAGES&&e.jsx(Fe,{type:"Emballages",onSelect:function(u){t.updateReceptionForward({emballage:kt(u)})}}),r===H.ARTICLES&&e.jsx(Mn,{onSelect:function(u){t.updateReceptionForward({articleArrivage:u})}}),r===H.FOURNISSEURS&&e.jsx(Fe,{type:"Fournisseurs",onSelect:function(u){B().AchatMethods().affichageAdresseLivraison(u.FOU_CODE).then(d=>{d&&!d.err&&d.res?s({modalFor:"ADRESSLIVFOURNISSEUR",fournisseur:u}):t.updateReceptionForward({fournisseurArrivage:u,adlivArrivage:1})})}})]})};function Jo({operationId:t,ACH_NUMSEQ:r,onCloseReception:n}){const{onFinReceptionCommandeReliquat:s}=gn(t),i=Gs(oe(),r,{enabled:!!r}),[a,u]=g.useState([]);return g.useEffect(()=>{var d,l;i.isLoading||u(f.map((l=(d=i.data)==null?void 0:d.res)==null?void 0:l.result,Un))},[i.isLoading,i.data,u]),i.isLoading?e.jsx(Ie,{}):e.jsx(Fn,{details:a,onClose:n,onSave:function(d,l){s({dateCommande:l.dateCommande,dateReception:l.dateReception,numSeq:r,listManquants:f.map(f.filter(d,o=>o.modeManquant==="M"),o=>o.ACH_LOT_SEQ)},o=>{(o==null?void 0:o.codeResult)==="OK"&&n()})},onChange:function(d,l){u(o=>f.map(o,c=>c.ACH_LOT_SEQ===d?{...c,modeManquant:l}:c))}})}const ei=yn(Jo,"E",!0),ti=Se(T)`
      
            zIndex: 1,

            color: "grey",
            border: '1px solid #627E8B',
            width: 40,
            height: 40,
            display: "flex",
            borderRadius: "50%",
            justifyContent: "center",
            alignItems: "center",
            cursor: "pointer",
            padding: '0.3em',
            //transition: theme.transitions.create("background"),
            "&:hover": {
                //background: "rgba(245, 176, 66)",
                opacity: 1,
            },
            '& svg': {
                width: '80%'
            },
            opacity: 0.9,
            '&.reception': {
                '&.HOME': {
                    color: '#1565c0'
                },
                //  background: 'rgba(0, 0, 0, 0.38)',
                '&.completed': {
                    //backgroundImage:  'linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%)',
                    //background: '#a8ff78',  /* fallback for old browsers */
                    //background: '-webkit-linear-gradient(to right, #78ffd6, #a8ff78)'  /* Chrome 10-25, Safari 5.1-6 */
                    backgroundImage: 'linear-gradient(to right, #1976d2 0%, #0087a9 100%)'
                },
                '&.active': {
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // backgroundImage: 'linear-gradient(to right, #DF239D 0%, #00a950 100%)',
                    //  backgroundImage: 'linear-gradient(to right, #1976d2b5 0%, #1976d266 100%)',
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // background: '#DF239D',
                    //background: '#00308F !important',
                    boxShadow: "0 4px 10px 0 rgba(0,0,0,.25)",
                    transform: 'scale(110%)'
                },
    
            },
            '&.arrivage': {
                '&.HOME': {
                    color: 'green'
                },
                //background: 'linear-gradient(90deg, #EAEDF0 30%, #EAEDF0 74%)',
                '&.completed': {
                    //backgroundImage:  'linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%)',
                    //background: '#a8ff78',  /* fallback for old browsers */
                    //background: '-webkit-linear-gradient(to right, #78ffd6, #a8ff78)'  /* Chrome 10-25, Safari 5.1-6 */
                    // backgroundImage: 'linear-gradient(to right, #DF239D 0%, #ED75C3 100%)',
                    backgroundImage: 'linear-gradient(to right, #46E824 0%, #a4ed75 100%)'
    
                },
                '&.active': {
    
                    // backgroundImage: 'linear-gradient(to right, #1976d2b5 0%, #1976d266 100%)',
                    // backgroundImage:
                    //     "linear-gradient( 136deg, rgb(242,113,33) 0%, rgb(233,64,87) 50%, rgb(138,35,135) 100%) !important",
                    // background: '#DF239D',
                    //background: '#00308F !important',
                    boxShadow: "0 4px 10px 0 rgba(0,0,0,.25)",
                    transform: 'scale(110%)'
                },
            }
        }`;function ni({mode:t,className:r,active:n,ref:s,completed:i,icon:a,imageStat:u,error:d,type:l,...o}){return e.jsx(ti,{className:ft(r,"icon",{reception:t===1,arrivage:t===2,active:n,completed:i}),...o,children:String(a)==="EAN13"&&u?e.jsx(Pe,{codeStat:u}):e.jsx(te,{icon:String(a)})})}const ri=Se(ss)(({theme:t})=>({[`&.${Oe.alternativeLabel}`]:{},[`&.${Oe.active}`]:{[`& .${Oe.line}`]:{}},[`&.${Oe.completed}`]:{[`& .${Oe.line}`]:{}},[`& .${Oe.line}`]:{height:3,border:0,backgroundColor:t.palette.mode==="dark"?t.palette.grey[800]:"#eaeaf0",borderRadius:1}}));function si({mode:t,activeStep:r,steps:n,onChangeStep:s}){return e.jsx(re,{sx:{width:"100%"},spacing:4,children:e.jsx(os,{alternativeLabel:!0,activeStep:r,nonLinear:!0,connector:e.jsx(ri,{}),children:n.map(i=>e.jsx(ii,{step:i,activeStep:r,onChangeStep:s,mode:t},i.type))})})}function oi(t,r,n){if(t!==null){if(typeof t=="object"&&f.has(t,"EMB_CODE")){const s=t;return s.quantity?{title:`${s.EMB_LIB1} ${s.poids} X ${s.quantity}`,completed:!0}:{title:`${s.EMB_LIB1}`,completed:!0}}if(typeof t=="string")return{title:t,completed:!0}}return{title:n,completed:!1}}const ii=({step:t,mode:r,activeStep:n,onChangeStep:s})=>{const{label:i,imageStat:a}=Gr($(),t.type),{t:u}=W(),d={StepIconComponent:ni,StepIconProps:{active:n===t.id,icon:t.icon,type:t.type,mode:r,imageStat:a}},{title:l,completed:o}=oi(i,t.type,u(t.title));return e.jsx(is,{completed:o,sx:c=>({".MuiStepLabel-root":{flexGrow:1,...n===t.type&&{borderBottom:3,borderBottomColor:"rgb(207, 22, 97)"}},".MuiStepLabel-label":{textTransform:"capitalize",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",margin:"auto",maxWidth:150},".MuiStepLabel-label.MuiStepLabel-alternativeLabel":{margin:"auto"}}),children:e.jsx(as,{color:"inherit",onClick:c=>s(t.type),children:e.jsx(cs,{...d,children:l})})},t.type)},ai=()=>{const t=zr();return e.jsx(P,{className:"title",noWrap:!0,variant:"subtitle1",color:"inherit",children:t})},ci=({className:t,title:r,mode:n,activeStep:s,steps:i,onChangeStep:a,...u})=>e.jsx(Vr,{className:t,color:"inherit",children:e.jsxs(qr,{sx:{pt:.6},children:[e.jsx(Wr,{disableMargin:!0}),n===0?e.jsx(ai,{}):e.jsx(si,{mode:n,onChangeStep:a,activeStep:s,steps:i})]})}),li=g.memo(ci),ui=Se("div")`


&.reception-module {
    flex-grow: 1;
    height: 100%;
    display: flex;
    flex-direction: column;
  
    
    &.commandes {
    
      
      & .outlinedButton {
        background: #0c5177;
        color: #fff;
      }
      &.commandes {
        & .iconLookup{
          color:#0c5177;
        }
      }
       
    }
  
    &.arrivage {
      & .appbar {
        background-color: rgb(93 199 97);
      }
      & .MuiStepLabel-label {
        color: black;
      }
  
      & .MuiButtonBase-root.lookup {
        background-color: rgb(93 199 97);
      }
   
    }
  
    & .MuiStepLabel-label {
      font-weight: 500;
      font-size: 18px;      
    }
  
    & .MuiStepLabel-iconContainer > * {
      background-color: white;
      font-weight: 500;     
    }
  }
  

`;function kn({operationId:t}){const{actions:r,operation:n,steps:s,step:i,getParametreBorneZone1:a}=Is(t);if(n===null)throw new Error("operation de reception non trouvée!"+t);const u=n.isOpenNumSeqOnly?H.LISTDETAILS:i;return e.jsx($r.Provider,{value:t,children:e.jsxs(ui,{className:ft("reception-module",(n==null?void 0:n.mode)===0?"menu":(n==null?void 0:n.mode)===1?"commandes":"arrivage"),children:[e.jsx(li,{className:"appbar",mode:n.mode,onChangeStep:r.onChangeStep,activeStep:u,title:" ",steps:s}),e.jsxs(Ce,{dialogProps:{maxWidth:n.modalFor==="TOOLS"?"sm":"md",fullWidth:!0,fullScreen:f.includes(["LITIGE","LotPeseeBorne"],n.modalFor)},withAppBar:n.modalFor==="LotPeseeBorne",isOpen:!!n.modalFor,onCloseDialog:()=>r.onCloseModal(),i8ntitle:null,className:"",children:[n.modalFor==="TOOLS"&&e.jsx(oo,{onClose:()=>r.onCloseModal()}),n.modalFor==="RELIQUATRECEPTION"&&e.jsx(ei,{onCloseReception:()=>{r.onCloseModal(),r.unSelectReception()},ACH_NUMSEQ:n.numSeqModal,operationId:t}),n.modalFor==="LotPeseeBorne"&&e.jsx(Eo,{onContinueReception:d=>{alert("x")}}),n.modalFor==="LITIGE"&&e.jsx(ro,{onBack:()=>{r.onCloseModal()}})]}),i===H.HOME&&e.jsx(Ws,{date:n.date,onChangeDateRecept:r.onSetDateReception,onSelectModeReception:r.onSelectModeReception,onOpenReedition:r.onOpenReedition,readOnlyDate:!a("PE_DATE")}),e.jsxs(g.Suspense,{fallback:e.jsx(Ie,{}),children:[n.mode===1&&e.jsx(Yo,{actions:r,step:i}),n.mode===2&&e.jsx(Xo,{actions:r,step:i})]})]})})}function di({session:t,borneId:r,readOnlyDate:n}){const s=t.sessionId,{reception:i,actions:a}=Zr(s,r);return i?e.jsx(kn,{operationId:i.uid}):null}function Ei(){const{operationId:t}=En(),r=Xr();return e.jsx(gt,{fallbackRender:n=>e.jsx(e.Fragment,{children:e.jsx(Pt,{errorOrigin:"ReceptionFicheOperationRouter",...n,resetMessage:"back"})}),onReset:()=>{r("/")},children:e.jsx(kn,{operationId:t})})}function gi(){const{session:t,onLaunchOption:r}=Kr(),{borneId:n}=En(),{getParametreBorneZone1:s}=Ye();return e.jsxs(Yr,{children:[e.jsx(Ft,{index:!0,element:e.jsx(di,{readOnlyDate:!s("PE_DATE"),session:t,borneId:n})}),e.jsx(Ft,{path:":operationId",element:e.jsx(Ei,{})})]})}export{gi as default};
