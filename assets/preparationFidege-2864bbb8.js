import{e$ as mr,c as bn,j as e,a$ as je,bg as Ee,eA as Ie,as as y,cc as Y,c5 as Mn,aF as U,c6 as Er,r as f,eL as be,aq as L,ax as hr,az as ue,bL as pr,f0 as ce,f1 as xr,ee as O,ea as b,b8 as vn,f2 as Cr,b9 as re,f3 as _,au as fr,aQ as Dn,b_ as gr,bf as yn,f4 as Nr,c0 as Vn,e1 as Ar,d4 as Ke,e6 as Sr,w as Fn,x as Bn,dR as Me,G as x,ag as _e,F as W,dW as ke,ah as un,C as S,bE as ne,dG as G,dS as Rr,dT as Pr,dU as wn,dV as kn,aC as le,eP as Un,f5 as _r,f6 as Tr,cv as $e,aE as ee,ez as Ce,f7 as qn,a7 as Te,cE as Qn,f8 as Lr,b4 as X,eG as Or,eH as Ze,bs as jr,E as zn,bP as me,cP as Hn,s as he,cH as Ir,aT as ge,cY as Ne,cW as br,aS as ve,a6 as oe,a8 as ie,f9 as se,fa as Mr,dY as Gn,d5 as De,d6 as ye,fb as mn,fc as vr,fd as Dr,fe as yr,bM as Ye,eQ as Vr,eR as Fr,cz as Br,ae as Ae,ff as Wn,cN as Ge,bO as Kn,c$ as wr,aj as Ve,cK as $n,aD as En,bD as Ue,eq as hn,fg as pn,fh as kr,fi as Ur,bR as qr,cy as Qr,fj as xn,cd as Cn,bI as zr,d1 as fn,d2 as Hr,ch as gn,d3 as Nn,cl as Gr,et as Xe,dJ as Zn,fk as Wr,fl as Je,fm as Kr,fn as $r,fo as Zr,d8 as Yr,fp as qe,dX as Xr,ey as en,br as Jr,cD as fe,fq as et,cr as nt,cB as Yn,cC as Xn,cI as nn,dD as rt,fr as tt,fs as at,ft as st,fu as ot,fv as it,fw as lt,aH as ct,dd as dt,de as Jn,df as ut,dg as An}from"./index-2ba9b923.js";import{c as mt,a as Et,b as ht,d as pt,e as xt,u as rn,f as Ct,P as ft,s as gt,g as Nt}from"./actions-d163bdb2.js";import{u as Fe,a as At,F as St,P as Rt,B as Pt}from"./FidegeAccueil-319b8bfb.js";import{m as _t,f as Tt,p as er,a as Lt,t as Le,D as nr,e as Sn,u as Se,b as Ot,c as jt,g as It,d as Rn,R as bt,h as Mt,i as xe,j as vt,k as Dt,L as yt,I as tn,l as Vt,n as Ft,o as Bt,q as wt,r as kt,s as Ut}from"./hooks-0ab2d73a.js";import{Z as qt,B as Qe,C as Z,d as Qt,a as zt,b as Pn,c as Ht}from"./index-8ca0a290.js";import{L as rr}from"./LockCommandeHOC-4a435868.js";import{S as Gt}from"./Save-ab52fe30.js";import{B as Wt}from"./BoxDisplayUVC-b7e42416.js";import{L as an,B as Oe}from"./lneContainerFidege-213a2d35.js";import{B as Kt,d as $t,P as Zt,a as Yt}from"./Numbers-f6b5ce6e.js";import{A as Xt}from"./AppMain-106513ab.js";function Jt(){return _t(1)}function _n(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Jt()(Tt(n,er(n)))}function ea(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var s=er(n);return mr(function(a,o){(s?_n(n,a,s):_n(n,a)).subscribe(o)})}const na=bn(e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"}),"LocationOn"),ra=bn(e.jsx("path",{d:"m20.5 10 .5-2h-4l1-4h-2l-1 4h-4l1-4h-2L9 8H5l-.5 2h4l-1 4h-4L3 16h4l-1 4h2l1-4h4l-1 4h2l1-4h4l.5-2h-4l1-4h4zm-7 4h-4l1-4h4l-1 4z"}),"NumbersOutlined"),ta=n=>{const r=je(),s=Ee(),a=Ie({mutationFn:t=>(r.showModalWaitLock(),y().PrepaFidegeMethods().ValidationCommande({variables:{context:n.current,mutation:{venNumSeq:t}}})),onSettled(t,u,d,i){r.closeModalWaitLock(),u&&s.errorMessage(Y("errorMessage"))}});return{onFinPreparationCommande:(t,u)=>{a.mutate(t,{onSettled(d,i,l,c){i&&u({codeResult:"ERR_NETWORK",result:null})},onSuccess(d,i,l){var c,m;(d.err||((c=d.res)==null?void 0:c.codeResult)!=="OK")&&s.errorMessage(Y(((m=d.res)==null?void 0:m.codeResult)||"errorMessage")),u(d.res)}})}}},aa=n=>{const r=je(),s=Ee();return{FinPreparationCommandeReliquat:Ie({mutationFn:o=>(r.showModalWaitLock(),y().PrepaFidegeMethods().FinPreparationCommandeReliquat({variables:{mutation:o,context:n==null?void 0:n.current}})),onSettled(o,t,u,d){r.closeModalWaitLock(),t&&s.errorMessage(Y("errorMessage"))}})}},sa=(n,r,s,a={})=>Mn([mt,n.getQueryKey(),r,s],()=>y().PrepaFidegeMethods().StatutValorisationPreparation({variables:{demande:{venNumSeq:r},context:n.current}}).then(o=>{if(o.err||!o.res)throw new Error("empty result");return o.res}),a),oa=n=>{const r=Ee(),{t:s}=U(),a=je(),o=Ie({mutationFn:u=>(a.showModalWaitLock(),y().PrepaFidegeMethods().EditionPreparationFidege({variables:{context:n.current,mutation:u}})),onSettled(u,d,i,l){a.closeModalWaitLock(),d&&r.errorMessage(s("errorMessage"))}});return{onEditionPreparationFidege:(u,d)=>{o.mutate(u,{onSettled(i,l,c,m){l&&d({Error:!0,MessageError:"ERR_NETWORK",Result:""})},onSuccess(i,l,c){var m,E;(i.err||((m=i.res)==null?void 0:m.codeResult)!=="OK")&&r.errorMessage(((E=i.res)==null?void 0:E.infoResult)||"error"),d({Error:!1,MessageError:"",Result:"OK"})}})}}},ia=(n,r,s={})=>Mn(["InitEcranEditionFidege",r],()=>Er(y().PrepaFidegeMethods().InitEcranEditionFidege({variables:{context:n.current,demande:{venNumSeq:r}}})).then(a=>{var o,t,u;if(((o=a.res)==null?void 0:o.codeResult)!="OK")throw new Error(((t=a.res)==null?void 0:t.infoResult)||":(");return(u=a.res)==null?void 0:u.result}),s),la=n=>{const r=je(),s=Ee();return{FinPreparationCommandeReliquat:Ie({mutationFn:o=>(r.showModalWaitLock(),y().PrepaFidegeMethods().FinPreparationCommandeManquantReliquat({variables:{mutation:o,context:n==null?void 0:n.current}})),onSettled(o,t,u,d){t&&s.errorMessage(Y("errorMessage"))},onSuccess(o){var t,u;r.closeModalWaitLock(),(o.err||((t=o.res)==null?void 0:t.codeResult)!=="OK")&&s.errorMessage(Y(((u=o.res)==null?void 0:u.codeResult)||"errorMessage"))}})}};function sn({cbValue:n,origine:r}){let s=n.match(/(\]C0\.CA)([0-9]*)/);return s&&s[2]?{fast:!0,qbRules:ue("VEN_NUMSEQ",s[2],"=")}:(s=n.match(/(\]C0)([0-9A-Z]*)/),s&&s[2]?{fast:!0,qbRules:ue("VEN_CDE",s[2],"=")}:(s=n.match(/(\]C0)?([0-9]{1,})/),s&&s[2]?{fast:!0,qbRules:ue("VEN_CDE",s[2],"=")}:{fast:!1,qbRules:null}))}const ca=(n,r,s,a,o,t,u)=>{const{parseScan:d}=Fe(),i=f.useCallback(c=>{const{clearCb:m}=c;async function E(){const h=d(c);if(h)try{m&&m();const{qbRules:C,fast:R}=sn(h);if(!C)a({type:"invalidBarcode"});else{const A=await y().PrepaFidegeMethods().ListeCommandeClientFidege({variables:{recherche:{qbRules:C,rbp:1,page:1},context:n.current}});if(A&&A.res&&L.size(A.res.result)>0)return s(L.head(A.res.result).VEN_NUMSEQ),!0;a({type:"orderNotFound",order:h.cbValue})}}catch{}else return c.updateQuery(c.val),!0;return!1}return E()},[]);return be(n,{key:[Et],keyConfigFilters:"FidegePrepaListeCommande",disableFields:u?[]:["VEN_MANQRELIQ"],transform:[Lt],fxt:(c,m)=>y().PrepaFidegeMethods().ListeCommandeClientFidege({variables:{recherche:c,filtresOptionnels:r,context:(m==null?void 0:m.current)||null}}),query:r,options:{queryOptions:{enabled:t}},onSetQuickFilterValueParam:i,onOpenScanInputText:o})},da=(n,r,s,a,o,t)=>{const{parseScan:u}=Fe(),d=f.useCallback(i=>{async function l(){const c=u(i);if(c)try{i.clearCb&&i.clearCb();const{qbRules:m,fast:E}=sn(c);if(!m)a({type:"invalidBarcode"});else{const h=await y().PrepaFidegeMethods().ListeCommandeClientFidege({variables:{recherche:{qbRules:m,rbp:1,page:1},context:n.current}});if(h&&h.res&&L.size(h.res.result)>0)return s(L.head(h.res.result).VEN_NUMSEQ),!0;a({type:"orderNotFound",order:c.cbValue})}}catch{}else return i.updateQuery(i.val),!0;return!1}return l()},[]);return be(n,{key:[ht],keyConfigFilters:"FidegePreparationParArticle",disableFields:t?[]:["VEN_MANQRELIQ"],fxt:(i,l)=>y().PrepaFidegeMethods().PreparationParArticleFidege({variables:{recherche:i,filtresOptionnels:r,context:(l==null?void 0:l.current)||null}}),query:r,options:{queryOptions:{enabled:o}},onSetQuickFilterValueParam:d})},ua=(n,r,s,a,o,t,u)=>{const{parseScan:d}=Fe(),i=f.useCallback(async l=>{const c=d(l);if(c)try{l.clearCb&&l.clearCb();const{qbRules:m,fast:E}=sn(c);if(!m)o({type:"invalidBarcode"});else{const h=await y().PrepaFidegeMethods().ListeCommandeClientFidege({variables:{recherche:{qbRules:m,rbp:1,page:1},context:n.current}});if(h&&h.res&&L.size(h.res.result)>0)return a(L.head(h.res.result).VEN_NUMSEQ),!0;o({type:"orderNotFound",order:c.cbValue})}}catch{}else return l.updateQuery(l.val),!0;return!1},[]);return be(n,{key:[pt,s||""],keyConfigFilters:"ListDetailAvecCommandeFidege",fxt:(l,c)=>y().PrepaFidegeMethods().ListeDetailAvecCommandeFidege({variables:{recherche:l,filtresOptionnels:s?hr("detail.VEN_ART_CODE",s,"="):null,context:(c==null?void 0:c.current)||null}}),query:r,options:{queryOptions:{enabled:u}},onSetQuickFilterValueParam:i,onBeforeRefetch:t})};function ma(n,r,s){return pr({key:["InfoLotFidegePreparationList",n],fxt:(a,o)=>y().PrepaFidegeMethods().RechercheLotsFidege({variables:{recherche:a,filtresOptionnels:n,context:null}}),options:r,query:n,selectorConfig:s})}function v(n){return n[ce]}const tr=(n,r)=>L.find(v(n).preparations,s=>s.uid===r)||null,Ea=n=>xr(r=>v(r).preparations[n].orderPrio,r=>v(r).preparations[n].zoneTravailPersonnelCode,r=>v(r).preparations[n].zoneTravailPersonnelLibelle,r=>v(r).preparations[n].manquantLotSeq,r=>v(r).preparations[n].manquantNumSeq,r=>v(r).preparations[n].codeArticle,r=>v(r).preparations[n].sessionId,r=>v(r).preparations[n].mode,r=>v(r).preparations[n].stepClient,r=>v(r).preparations[n].date,r=>v(r).preparations[n].modalFor,r=>v(r).preparations[n].numSeqModal,r=>v(r).preparations[n].editionBl,r=>{var s,a;return((s=v(r).preparations[n].preparation)==null?void 0:s.VEN_NUMSEQ)&&!((a=v(r).preparations[n].preparation)!=null&&a.VEN_LOT_SEQ)},r=>v(r).preparations[n].previousStep===O.HOME,(r,s,a,o,t,u,d,i,l,c,m,E,h,C,R)=>({orderPrio:r,zoneTravailPersonnelCode:s,zoneTravailPersonnelLibelle:a,manquantLotSeq:o,manquantNumSeq:t,codeArticle:u,sessionId:d,mode:i,step:l,date:c,modalFor:m,numSeqModal:E,editionBl:h,isOpenNumSeqOnly:C&&l===O.CURRENTPREPARATION,prepaOpen:l===O.CURRENTPREPARATION,showListCommandes:i===b.PREPAARTICLE?l===O.CLIENTS||l===O.CURRENTPREPARATION:l===O.LISTPREPARATIONS||l===O.CURRENTPREPARATION&&!R}));function ha(n,r,s){var a;return((a=L.find(v(n).preparations,o=>o.sessionId===r&&o.codeBorne===s))==null?void 0:a.uid)||null}function pa(n,r){return{zoneTravail:n[ce].preparations[r].zoneTravailPersonnelCode}}function xa(n,r,s){const a=vn(),o=Cr(),t=re(d=>ha(d,n,r)),u=f.useCallback(()=>{t&&a(_.PREPARATION_CLOSE(t))},[t]);return f.useEffect(()=>{t===null&&a(xt(n,r,s||b.HOME,null)).catch(o.showBoundary)},[t]),{operationId:t,preparationClose:u}}const Ca=n=>re(r=>r[ce].preparations[n].qbRules||null),ar=n=>on(n),fa=n=>re(r=>r[ce].preparations[n].stepClient||null),ga=n=>re(r=>r[ce].preparations[n].mode),Na=n=>re(r=>{var a;const s=r[ce];return String(s.preparations[n].mode===b.PREPAARTICLE?s.preparations[n].codeArticle:(a=s.preparations[n].preparation)==null?void 0:a.VEN_NUMSEQ)}),Aa=n=>({VEN_NUMSEQ:n.VEN_NUMSEQ,VEN_LOT_SEQ:n.VEN_LOT_SEQ,InfoCodeBarre:null,MessagesTransactions:[]});function Sa(n,r,s,a=!0,o=!1){return(t,u)=>{const i=u()[ce];if(i.preparations[n].orderPrio&&i.preparations[n].orderPrio.VEN_NUMSEQ!==s.VEN_NUMSEQ)return r(String(s.VEN_CDE)),!1;t(_.SELECT_PREPARATION({indice:n,preparation:{VEN_NUMSEQ:s.VEN_NUMSEQ,VEN_LOT_SEQ:null,InfoCodeBarre:null},resetMode:a,nextStep:O.CURRENTPREPARATION,modePrioritaire:o}))}}const on=n=>{const r=Ee(),s=fr(),{t:a}=U(),{clearCache:o}=rn(),t=vn(),u=d=>{s.showError({i8nmessage:d,i8ntitle:a("error"),dialogProps:{maxWidth:"md",fullWidth:!0}})};return f.useMemo(()=>{const d=(i,l=!0,c=!1)=>t(Sa(n,()=>{u(a("ERR_ORDER_NOT_PRIO",{order:i.VEN_CDE}))},i,l,c));return{messages:r,onSetOrderPrio:i=>t(_.SET_ORDERPRIO({indice:n,order:i})),onNewTransaction:i=>{t(_.onNewTransaction({indice:n,transaction:{...i,id:Dn.uniqueId()}}))},onOpenFenetreManquantDetail:(i,l)=>{t(_.PREPARATION_UPDATE({indice:n,update:{modalFor:"MANQUANT",manquantNumSeq:l,manquantLotSeq:i}}))},onCloseFenetreManquantDetail:()=>{t(_.PREPARATION_UPDATE({indice:n,update:{modalFor:""}}))},onOpenReliquatPreparation:()=>{t(_.PREPARATION_MODALFORPREPARATION({indice:n,modalFor:"RELIQUATPREPARATION"}))},onOpenEditionPreparation:()=>{t(_.PREPARATION_MODALFORPREPARATION({indice:n,modalFor:"EDITIONPREPARATION"}))},onOpenCloturePreparation:()=>{t(_.PREPARATION_MODALFORPREPARATION({indice:n,modalFor:"CLOTUREPREPARATION"}))},onOpenModalSearchOrder:()=>{t(_.PREPARATION_UPDATE({indice:n,update:{modalFor:"SEARCHORDER"}}))},onScanError:({type:i,order:l})=>{u(a(i,{order:l}))},onSelectArticlePreparation:(i,l)=>{t(_.PREPARATION_UPDATE({indice:n,update:{stepClient:O.CLIENTS,codeArticle:i,qbRules:l}}))},onChangePersonnel:async i=>{i&&await t(Ct(n,i))},onChangeZoneTravail:i=>{t(_.setZoneTravail({indice:n,zoneTravail:i}))},onChangeMode:i=>{t(_.PREPARATION_UPDATE({indice:n,update:{mode:i}}))},onNavigateListCommande:()=>{t(_.PREPARATION_UPDATE({indice:n,update:{mode:b.PREPACLIENT},nextStep:O.LISTPREPARATIONS}))},onNavigateListArticles:()=>{t(_.PREPARATION_UPDATE({indice:n,update:{mode:b.PREPAARTICLE},nextStep:O.LISTPREPARATIONS}))},onLockOperation:i=>t(gr(i)),onChangeStep:i=>t(ft({indice:n,nextStep:i})),onStepBack:()=>t(_.STEP_BACK({indice:n})),onCloseModal:()=>t(_.PREPARATION_CLOSE_MODAL({indice:n})),updatePreparation:i=>t(_.PREPARATION_UPDATE({indice:n,update:i})),updateStepPreparation:i=>t(_.UPDATE_STEP({indice:n,step:i})),leaveLinePreparation:(i=null)=>t(async(l,c)=>{var E,h;const m=tr(c(),n);m&&((E=m.preparation)!=null&&E.VEN_LOT_SEQ)&&await y().LockMethods().libereDetailCommande(null,(h=m.preparation)==null?void 0:h.VEN_LOT_SEQ),l(_.PREPARATION_LEAVE_LINE({indice:n,nextStep:i}))}),selectPreparation:(i,l=O.CURRENTPREPARATION)=>t(_.SELECT_PREPARATION({indice:n,preparation:i,nextStep:l||null})),selectPreparationLine:i=>t(_.SELECT_PREPARATION({indice:n,preparation:Aa(i),nextStep:O.CURRENTPREPARATION})),onLateScan:i=>{t(_.PREPARATION_LATESCAN({indice:n,scan:i}))},selectPreparationLineModal:(i,l)=>t(gt({indice:n,detail:i,throwIfOpen:l})),unSelectPreparation:(i=null)=>{o(["COMMANDES","PRIO"]),t(_.UNSELECT_PREPARATION({indice:n,nextStep:i}))},onCloseAutoScanMessage:i=>{t(_.onCloseAutoScanMessage({indice:n,update:i}))},onSetDatePreparation:i=>t(_.setDatePreparation({indice:n,date:i})),onOpenReedition:()=>t(_.PREPARATION_UPDATE({indice:n,update:{modalFor:"PESEE"}})),onSelectOrderCommandes:d,onOpenCommandePrioritaire:i=>d(i,!0,!0),onSelectOrder:d,onNotFoundOrder:i=>u(a("orderNotFound",{order:i})),onShowError:u}},[r,n])},Ra=n=>n[ce],Pa=n=>re(r=>Ra(r).preparations[n].mode),_a=n=>{const r=re(u=>tr(u,n),Vn),{getParametreBorneZone1:s,getParametreBorne:a}=yn(),o=on(n),{getApplicationOption:t}=Ke();return{actions:o,operation:r,getApplicationOption:t,getParametreBorneZone1:s,getParametreBorne:a}},Ta=n=>{const r=f.useMemo(()=>Ea(n),[n]),s=re(E=>{try{return r(E)}catch{return null}}),{getParametreBorneZone1:a,getParametreBorne:o,getApplicationOption:t}=yn(),u=on(n),{codePersonnel:d,nomPersonnel:i}=Nr((s==null?void 0:s.sessionId)||""),l=o("V2_AFFPREP"),c=(l==null?void 0:l.USER_ZONE1)==="O",m=c&&(l==null?void 0:l.USER_ZONE2)==="O";return{codePersonnel:d,nomPersonnel:i,operation:s,actions:u,getParametreBorneZone1:a,gereZoneTravail:t("SPE_ZONE_TRAVAIL")??!1,gereMANQRELIQ:a("V2_MANQRELIQ"),gereAffPrepa:c,gereLockAffPrepa:m,step:(s==null?void 0:s.step)||O.HOME}},sr=n=>{const r=re(s=>pa(s,n),Vn);return Ar(r)};function La(n,r,s){return n===O.HOME?"Recherche":n===O.LISTPREPARATIONS&&r===b.PREPACLIENT?"Commandes":n===O.LISTPREPARATIONS&&r===b.PREPAARTICLE?"Articles":s||(r===b.PREPAARTICLE?"Article":"Commande")}const Oa=({operationId:n})=>{const r=ar(n),s=fa(n),a=ga(n),o=Na(n);return e.jsx(At,{title:La(s,a,o),typeMod:Sr.PREPARATION,isHome:s===O.HOME,onStepBack:r.onStepBack})},ja=f.memo(Oa);var ln={},Ia=Bn;Object.defineProperty(ln,"__esModule",{value:!0});var or=ln.default=void 0,ba=Ia(Fn()),Ma=e,va=(0,ba.default)((0,Ma.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"}),"FormatListNumbered");or=ln.default=va;function Da({mode:n,onOpenCommandePrioritaire:r,zoneTravailValid:s,orderPrio:a,disableFilter:o,gereZoneTravail:t,modalOpen:u,disableSwitchPersonnel:d,className:i,contextGlobal:l,codePersonnel:c,nomPersonnel:m,zoneTravailPersonnelCode:E,zoneTravailPersonnelLibelle:h,dataCommandes:C,onNavigateListCommande:R,onNavigateListArticles:A,onChangePersonnel:N,onChangeZoneTravail:p,onSelectOrder:g,onNotFoundOrder:T,onShowError:q,onOpenModalSearchOrder:V,onChangeMode:F}){const M=f.useRef(null),I=f.useCallback(j=>{let Q=null,K=j.match(/(\]C0\.CC)([0-9]*)/);return K&&K[2]?Q=ue("VEN_NUMSEQ",K[2],"="):Q=ue("VEN_CDE",+j,"="),y().PrepaFidegeMethods().ListeCommandeClientFidege({variables:{context:l.current,recherche:{rbp:1,qbRules:Q}}}).then(({err:J,res:$})=>({err:J,res:L.head($==null?void 0:$.result)||null})).catch(J=>({err:null,res:null}))},[l]),B=(j,Q)=>{j&&g(Le(j))},D=Me(!u);return e.jsxs(St,{className:i,children:[e.jsx(Rt,{className:"personnel",onChange:N,disabled:d,typeBorne:l.current.typeBorne,title:m,code:c,lookupProps:{disabledClear:!0}}),t&&e.jsx(qt,{className:"zoneTravail",onChange:p,title:h,code:E}),o&&e.jsxs(x,{className:" filtresQuick margin ",children:[a&&e.jsxs(_e,{sx:{typography:"h3",alignItems:"center",wordWrap:"break-word","& .MuiAlert-icon":{fontSize:40}},action:e.jsx(W,{color:"success",variant:"contained",className:" margin orderList nextstep",size:"large",startIcon:e.jsx(ke,{}),onClick:j=>r(Le(a)),children:"Ouvrir"}),variant:"outlined",severity:"warning",children:[e.jsxs(un,{children:[" ",e.jsx(S,{variant:"h4",children:"Une commande prioritaire vous a été affectée. "})]}),a.VEN_CDE," ",a.NOM_CLIENT," -  ",a.VILLE_CLIENT,e.jsx("br",{}),e.jsxs(x,{alignItems:"center",display:"flex",children:[e.jsx(ne,{uvc:"C",fontSize:"inherit"})," ",G(a.COLIS_LIV,2)," / ",G(a.COLIS_CDE,2)]}),e.jsxs(x,{alignItems:"center",display:"flex",children:[e.jsx(ne,{uvc:"N",fontSize:"inherit"})," ",G(a.PDS_NET_CDE,2)," Kg"]}),e.jsxs(x,{alignItems:"center",display:"flex",children:[e.jsx(or,{fontSize:"inherit"})," ",G(a.NB_LIGNES,0)," ligne(s)"]})]}),!a&&e.jsx(_e,{variant:"outlined",severity:"info",children:e.jsx(un,{children:"Aucune commande affectée. "})})]}),!o&&C.visualState.query&&e.jsx(Rr,{ref:M,className:"filtresQuick",readOnly:!0,fields:C.Recherches.fields,query:C.visualState.query,onQueryChange:C.actions.onUpdateQuery}),(!o||a)&&e.jsxs(x,{className:"scanContainer",display:"flex",alignItems:"center",flexDirection:"row",children:[e.jsx(W,{disabled:!s,className:"grid-actions kb-scan",color:"info",variant:"contained",size:"large",onClick:j=>V(),children:e.jsx(Pr,{color:"inherit"})}),e.jsx(wn,{size:"kingSize",virtualKeyboard:[],sxProps:{height:80},placeholder:"Numero de commande",autoFocus:!0,ref:D,disabled:!s,onError:(j,Q)=>T(+(Q||0)),onScanSuccess:B,lecture:I,rootClassName:"",disableRemote:!1,type:"text",showClearButton:!0,disabledPadding:!0})]}),!s&&e.jsx(_e,{severity:"error",children:"Zone de travail obligatoire."}),!o&&e.jsxs(x,{className:"navigate",flexGrow:1,alignItems:"stretch",justifyContent:"space-between",children:[e.jsx(W,{className:"clear",startIcon:e.jsx(kn,{}),color:"error",fullWidth:!0,variant:"contained",size:"large",onClick:j=>C.actions.onClearAll(),children:Y("clearFilters")}),e.jsx(W,{disabled:!s,className:"product nextstep",startIcon:e.jsx(ke,{}),color:"secondary",fullWidth:!0,variant:"outlined",size:"large",onClick:j=>{A()},children:Y("product")}),e.jsx(W,{disabled:!s,className:"orderList nextstep",startIcon:e.jsx(ke,{}),color:"success",fullWidth:!0,variant:"outlined",size:"large",onClick:j=>{R()},children:Y("orderList")})]})]})}function ya({onConfirm:n,onCancel:r,transaction:s}){return e.jsxs(le,{rowSpacing:.7,columnSpacing:.3,container:!0,sx:Un({p:{xs:0,sm:1,lg:2}},_r),children:[e.jsx(le,{item:!0,xs:12,children:e.jsx(Tr,{className:"cold",type:"text",disabled:!0,tabIndex:1,autoFocus:!1,readOnly:!0,enableAddBtn:!1,showAddBtn:!1,name:"DESART",InputProps:{startAdornment:e.jsx($e,{codeStat:s.ART_STAT1})},label:s.CODE_ART,isCompleted:!0,value:s.DESART})}),e.jsx(ee,{ButtonValidate:Ce,textValidate:"Remplacer",onSave:()=>n(),onClose:()=>r()})]})}const Va=({detail:n,classNameColor:r})=>{var s;return!n||!n.Article?null:e.jsxs(x,{sx:{display:"grid",gridTemplateAreas:`"article prep cde"
            "comment comment comment"`,gridTemplateColumns:"1fr minmax(150px,auto) minmax(150px,auto)",columnGap:.5,alignItems:"stretch"},children:[e.jsxs(x,{className:r,gridArea:"article",sx:{...qn,position:"relative",px:.5,boxShadow:1,borderColor:"black",color:"info.contrastText"},children:[e.jsx(Te,{direction:"row",alignItems:"center",children:e.jsxs(Te,{direction:"row",alignItems:"center",sx:{flexGrow:1,gap:1},children:[e.jsx(nr,{variant:"h5",PICK_CODE:((s=n.Article.Picking)==null?void 0:s.PICK_CODE)||""}),e.jsx($e,{codeStat:n.Article.ART_STAT_IMAGE,fontSize:"large"}),e.jsxs(S,{variant:"h5",children:[" ",n.Article.ART_CODE," "]}),!!n.Article.ART_PAYS&&n.Article.ART_PAYS!=="0"&&e.jsx(Qn,{svg:!0,countryCode:n.Article.ART_PAYS})]})}),e.jsxs(S,{variant:"h3",alignSelf:"flex-start",children:["     ",n.Article.ART_LIB1]})]}),e.jsxs(x,{gridArea:"prep",sx:{px:1,boxShadow:1,borderColor:"black",bgcolor:"#52c33c",color:"warning.contrastText"},children:[e.jsx(S,{variant:"body1",children:"Préparé "}),e.jsxs(x,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(S,{sx:{fontSize:50,fontWeight:800},children:n.VEN_QTE_LIV}),e.jsx(ne,{className:"icon icon-uvc with-border",uvc:Sn(n)?"BOX":n.VEN_UNIT_CDE})]})]}),e.jsxs(x,{gridArea:"cde",sx:{px:1,boxShadow:1,borderColor:"black",bgcolor:"warning.light",color:"warning.contrastText"},children:[e.jsx(S,{variant:"body1",children:"Commandé "}),e.jsxs(x,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(S,{sx:{fontSize:50,fontWeight:800},children:n.VEN_QTE_CDE}),e.jsx(ne,{className:"icon icon-uvc with-border",uvc:Sn(n)?"BOX":n.VEN_UNIT_CDE})]})]})]})};var cn={},Fa=Bn;Object.defineProperty(cn,"__esModule",{value:!0});var ir=cn.default=void 0,Ba=Fa(Fn()),Tn=e,wa=(0,Ba.default)([(0,Tn.jsx)("path",{d:"M15 2h-3.5l-1-1h-5l-1 1H1v2h14zm1 7c-.7 0-1.37.1-2 .29V5H2v12c0 1.1.9 2 2 2h5.68c1.12 2.36 3.53 4 6.32 4 3.87 0 7-3.13 7-7s-3.13-7-7-7zm0 12c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"},"0"),(0,Tn.jsx)("path",{d:"M16.5 12H15v5l3.6 2.1.8-1.2-2.9-1.7z"},"1")],"AutoDelete");ir=cn.default=wa;const ze=(n,r,s,a,o)=>X("input-uvc","cold",{error:!0,bottomLarge:n,UC:s===a,UV:r===a,UVMOD:o}),Ln=n=>{switch(n){case"TRA_LOT":return"lotNumber";case"NB_COLIS":return"uniteC";case"NB_PIECES":return"uniteP";default:return"uniteN"}},lr=({className:n,onShowInputNumber:r,isLoading:s,canValidateNew:a,format:o,transaction:t,isNew:u,onValidate:d,onClose:i,onOpenLot:l,onDelete:c,onChangeForm:m,onReset:E})=>{var A,N,p;const{t:h}=U(),C=Lr(()=>{const g=T=>{const q=()=>{var I,B,D;switch(T){case"TRA_LOT":return 0;case"NB_COLIS":return((I=o.formatColis)==null?void 0:I.precision)??3;case"NB_PIECES":return((B=o.formatPieces)==null?void 0:B.precision)??3;default:return((D=o.formatPoids)==null?void 0:D.precision)??0}},V=T=="NB_COLIS"?"C":T==="NB_PIECES"?"P":"N",F=T!=="TRA_LOT",M=F&&!!t.traSeq&&V!=="C"&&t.TYPE_SAISIE!=="T";r({i8ntitle:h(Ln(T)),dialogProps:{maxWidth:"md",fullWidth:!0},props:{showSSRecalcul:F,disableSSRecalcul:!M,label:h(Ln(T)),maximumFractionDigits:q()}}).then(I=>{I&&L.isNil(I.value)===!1&&m(t.indice,T,I.value,I.recalc)})};return{handleLot2:()=>l(t.indice),handleLot1:()=>l(t.indice),onChangeFormModalNB_COLIS:()=>g("NB_COLIS"),onChangeFormModalNB_PIECES:()=>g("NB_PIECES"),onChangeFormModalPDS_NET:()=>g("PDS_NET")}},[t.indice,o,t.traSeq,t.TYPE_SAISIE]);t.NB_COLIS||t.NB_PIECES;const R=u?"h6":"body1";return e.jsxs(x,{className:X("line-transaction",n),children:[e.jsx(W,{variant:"contained",size:"large",color:"warning",onClick:E,className:"btn-raz",disabled:!u,children:e.jsx(kn,{})}),e.jsxs(Or,{disabled:s,className:"group-lot",children:[e.jsx(W,{variant:"outlined",className:"bgpaper",color:"inherit",size:"large",onClick:C.handleLot1,children:e.jsx(Ze,{})}),e.jsxs(W,{variant:"outlined",className:X("bgpaper","btn-lot"),color:"inherit",size:"large",onClick:C.handleLot2,children:[e.jsx(jr,{className:"type-saisie",children:t.TYPE_SAISIE}),e.jsxs(x,{display:"flex",alignItems:"center",children:[t.VEN_UNIT_VE&&e.jsx(ne,{fontSize:"small",uvc:t.VEN_UNIT_VE}),e.jsxs(S,{color:"info.dark",variant:R,children:["CDT:",t.CDT_MOYEN]})]}),t.ACH_DLC&&e.jsxs(x,{display:"flex",alignItems:"center",children:[e.jsx(zn,{title:"DLC",children:e.jsx(ir,{fontSize:"small"})}),e.jsxs(S,{variant:R,color:t.ACH_DLC?"warning.dark":"warning.light",children:["DLC: ",t.ACH_DLC&&me(t.ACH_DLC)]})]}),e.jsx(S,{color:t.TRA_LOT?"text.primary":"text.disabled",variant:u||!t.ACH_DLC?"h4":"h6",children:t.TRA_LOT||"Lot"})]})]}),e.jsx(Qe,{label:h("uniteC"),fontSize:"medium",onChangeForm:C.onChangeFormModalNB_COLIS,value:G(t.NB_COLIS,((A=o.formatColis)==null?void 0:A.precision)??3),typUVC:"C",className:ze(u,t.VEN_UNIT_VE,t.VEN_UNIT_CDE,"C",t.UVMOD)}),e.jsx(Qe,{label:h("uniteP"),fontSize:"medium",onChangeForm:C.onChangeFormModalNB_PIECES,value:G(t.NB_PIECES,((N=o.formatPieces)==null?void 0:N.precision)??0),typUVC:"P",className:ze(u,t.VEN_UNIT_VE,t.VEN_UNIT_CDE,"P",t.UVMOD)}),e.jsx(Qe,{label:h("uniteN"),fontSize:"medium",onChangeForm:C.onChangeFormModalPDS_NET,value:G(t.PDS_NET,((p=o.formatPoids)==null?void 0:p.precision)??3),typUVC:"N",className:ze(u,t.VEN_UNIT_VE,t.VEN_UNIT_CDE,"N",t.UVMOD)}),c&&e.jsx(Hn,{fullWidth:!0,variant:"contained",size:"large",color:"error",onClick:()=>c(t.traSeq)}),d&&e.jsx(W,{fullWidth:!0,disabled:!a,variant:"contained",size:"large",color:"success",onClick:()=>d(),children:e.jsx(Gt,{})})]})},ka=({item:n,ItemComponentProps:r})=>e.jsx(lr,{transaction:n,isNew:!1,onShowInputNumber:r.onShowInputNumber,format:r.format,onOpenLot:r.onOpenLot,onChangeForm:r.onChangeForm,onDelete:r.onDelete}),Ua=f.memo(ka),qa={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:120,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:60}},Qa=he(an)({display:"grid",gap:5,padding:"0 8",columnGap:8,gridTemplateColumns:"14ch 1fr 110px 180px 180px",gridTemplateAreas:' "nolot frn picking stock dlc" '});function za({item:n,style:r,onSelect:s,ItemComponentProps:a,className:o}){var u,d,i;const t=`${n.ACH_STATUS==="S"&&n.ACH_DATE_REC?me(n.ACH_DATE_REC)+" - ":""}  ${n.FOU_NOM} `;return e.jsxs(Qa,{style:r,disabled:n.ACH_STATUS==="S",dividerRight:!0,className:X(o,n.ACH_STATUS==="S"?"orange-lock":"jaune"),onClick:l=>{n.ACH_STATUS!=="S"&&(a!=null&&a.SPE_VALO_MASQUER_LOT||s(n))},children:[e.jsx(Z,{hideLabel:!0,className:"field-nolot",Icon:Ze,iconPosition:"body",field:"ACH_LOT",matchSearch:(u=n._properties)==null?void 0:u.matchSearch,text:String(a!=null&&a.SPE_VALO_MASQUER_LOT?"":n.ACH_LOT),label:"Numéro de lot",gridArea:"nolot"}),e.jsx(Z,{hideLabel:!0,className:"field-frn",Icon:Ir,field:"FOU_NOM",matchSearch:(d=n._properties)==null?void 0:d.matchSearch,iconPosition:"body",text:t,label:"Fournisseur",gridArea:"frn"}),e.jsx(Z,{hideLabel:!0,className:"field-dlc",Icon:Qt,iconPosition:"body",text:n.ACH_DLC&&me(n.ACH_DLC),label:"Dlc",gridArea:"dlc"}),e.jsx(Z,{disableGap:!0,hideLabel:!0,className:"field-picking",Icon:n.LOT_PICKING&&Dn.size(n.LOT_PICKING)>5?null:na,field:"LOT_PICKING",matchSearch:(i=n._properties)==null?void 0:i.matchSearch,iconPosition:"body",text:n.LOT_PICKING,label:"Picking",gridArea:"picking"}),e.jsx(Wt,{className:"field-stock",hideLabel:!0,withBorder:!1,iconPosition:"bodyRight",variant:"inherit",fontSize:"medium",label:"Pot.",format:a.format,gridArea:"stock",UVC:n.US||"C",value:n.ACH_COLIS})]})}function Ha({recherche:n=null,onSelect:r,...s}){const a=ma(n,{},null),t=Ke().getParametreBorneZone1("V2_MASQUERLOT"),u=Se(),d=f.useMemo(()=>({format:u,SPE_VALO_MASQUER_LOT:t}),[u,t]);return e.jsx(ge,{ItemMeasureCard:qa,ItemComponentProps:d,onSelect:r,ItemComponent:za,HeaderComponent:null,disableFavorite:!0,state:a,labelSearch:"",placeholderSearch:""})}function We({label:n,value1:r,value2:s}){return e.jsxs(e.Fragment,{children:[e.jsxs(S,{color:!r&&!s?"text.disabled":"default",variant:"h4",sx:{textTransform:"uppercase"},children:[n," "]}),e.jsx(Oe,{modal:!0,value:r||null}),e.jsx(Oe,{modal:!0,value:s||null})]})}function Ga(n){return n?L.startsWith(n,"CONFIRM")?"warning":L.startsWith(n,"ERROR")?"error":"primary":"primary"}function Wa(n,r){return r?r==="CONFIRM_REMPLACEMENT"?"Remplacement":L.startsWith(r,"CONFIRM")?n("confirmTitle"):L.startsWith(r,"ERROR")?n("errorTitle"):n("lotList"):""}function Ka(n){}const $a=({context:n,VEN_LOT_SEQ:r,VEN_NUMSEQ:s,SCAN_RESULT:a,commentModal:o,commentPopup:t,className:u,onCloseDetail:d,onNewTransaction:i,onChangeDetail:l,replaySubject:c})=>{const{lock:m,error:E,loading:h,detail:C,actions:R,ListComponentsProps:A,infiniteRef:N}=Ot(n,s,r,a,c??null,o,t,l,i,d);return E?e.jsx(Ne,{errorTitle:E,firstActionMessage:"retry",onFirstAction:R.refetch,secondActionMessage:"close",onSecondAction:R.onCloseRefresh}):!m.isLocking&&!m.lockSuccess?e.jsx(br,{onClose:d,lock:m}):e.jsx(Ya,{infiniteRef:N,context:n,className:u,detail:C,actions:R,ListComponentsProps:A,isLoading:h||C.isScanning})},Za=he(x)(({theme:n})=>({flexGrow:1,display:"flex",flexDirection:"column",padding:5,minHeight:0,gap:5,overflow:"auto","& > .new-container":{position:"relative",boxShadow:n.shadows[4],borderRadius:1,height:110,"& .progress":{position:"absolute",left:0,right:0,top:0,bottom:0,height:"100%",zIndex:2}},"&   .line-trans":{height:70},"& .list-container":{flex:1,overflow:"auto",minHeight:200},"& .line-transaction":{width:"100%",height:"100%",display:"grid",gridTemplateColumns:"85px 255px minmax(120px,1fr) minmax(120px,1fr) minmax(120px,1fr) 120px",fontSize:n.typography.h5.fontSize,alignItems:"stretch",gap:.6,color:n.palette.info.dark,"& > .group-lot > .btn-lot":{flexGrow:1,padding:.3,position:"relative",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start","& > .type-saisie":{opacity:.5,bgcolor:"warning.dark",position:"absolute",top:2,right:2}},"&:not(.isNew)":{height:"calc(100% - 2px)"},"&:not(.isNew) > .btn-raz":{opacity:.3}}})),Ya=({className:n,actions:r,context:s,detail:a,isLoading:o,ListComponentsProps:t,infiniteRef:u})=>{var C,R,A,N,p,g,T,q,V;const{t:d}=U(),i=a.showComment?"CONFIRM_COMMENT":a.lotOpen,l=Me(!i),c=f.useMemo(()=>a&&a.newTransaction&&jt(a),[a.newTransaction]),m=f.useCallback(async F=>{let M=!0;async function I(){var B;try{const D=await bt(F.ACH_LOT,s.current);M&&((B=D.res)!=null&&B.result)&&r.onManageSelectLotModal(D.res.result)}catch(D){alert(D)}}return I(),()=>{M=!1}},[a.lotOpenIndice,a.scanPending,s.current]),E=It(a.Detail,!0),h=Rn(a.Detail);return e.jsxs(Za,{className:n,children:[e.jsxs(ve,{dialogProps:{maxWidth:"md",fullScreen:i==="LIST_LOT",fullWidth:!1},i8ntitle:Wa(d,i),onCloseDialog:r.onCloseModal,"aria-labelledby":"customized-dialog-title",isOpen:!!i,color:Ga(i),withAppBar:!0,className:"",children:[i==="CONFIRM_COMMENT"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(x,{display:"flex",flexDirection:"column",rowGap:0,children:e.jsx(We,{label:"Commentaire",value1:(C=a.Detail)==null?void 0:C.VEN_COMMENT,value2:Rn(a.Detail||null,!1)})})}),e.jsx(ie,{children:e.jsx(ee,{textCancel:"close",onClose:()=>r.onCloseComment()})})]}),(i==="ERROR_LOT_INVALID"||i==="ERROR_LOT_NONVALOR")&&e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsxs(se,{children:[" ",i==="ERROR_LOT_INVALID"?"Lot invalide.":"Lot non valorisé."]}),e.jsx(se,{children:(A=(R=a.lotPending)==null?void 0:R.Article)==null?void 0:A.ART_CODE}),e.jsx(se,{children:(p=(N=a.lotPending)==null?void 0:N.Article)==null?void 0:p.ART_LIB1})]}),e.jsx(ie,{children:e.jsx(W,{fullWidth:!0,color:"error",variant:"outlined",size:"large",type:"button",onClick:r.onCloseModal,children:d("close")})})]}),i=="CONFIRM_LOT_NOTSET"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(se,{children:"Le lot n'est pas renseigné"})}),e.jsx(ie,{children:e.jsx(ee,{ButtonValidate:Ce,onSave:()=>r.onValidateNewTransaction(!1),onClose:()=>r.onCancelDepassement()})})]}),i=="CONFIRM_RAZ"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(se,{children:d("confirmDeleteTransactions")})}),e.jsx(ie,{children:e.jsx(ee,{ButtonValidate:Ce,onSave:r.onDeleteAllTransactions,onClose:r.onCloseModal})})]}),i=="CONFIRM_DEPASSEMENT"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(se,{children:d("confirmDepassement")})}),e.jsx(ie,{children:e.jsx(ee,{ButtonValidate:Ce,onSave:()=>r.onConfirmDepassement(a.lotOpenIndice),onClose:r.onCloseModal})})]}),i=="ERROR"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(se,{children:d(a.erreurCode)})}),e.jsx(ie,{children:e.jsx(W,{color:"error",fullWidth:!0,className:"kingSize",variant:"outlined",size:"large",type:"button",onClick:r.onCloseModal,children:d("close")})})]}),i=="CONFIRM_REMPLACEMENT"&&e.jsx(e.Fragment,{children:e.jsx(ya,{transaction:a.remplaceTransaction,onConfirm:r.onConfirmRemplacement,onCancel:r.onCancelRemplacement})}),i=="CONFIRM_LOT_SOLDE"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx(se,{children:d("confirmBatchUnsold",{batchNumber:((g=a.lotPending)==null?void 0:g.ACH_LOT)||""})})}),e.jsx(ie,{children:e.jsx(ee,{ButtonValidate:Ce,ButtonCancel:Mr,textCancel:"no",textValidate:"yes",onSave:r.onConfirmLotSolde,onClose:r.onCloseModal})})]}),i==="LIST_LOT"&&e.jsxs(e.Fragment,{children:[e.jsx(S,{color:"secondary.dark",margin:"auto",variant:"h3",children:((T=a.Detail)==null?void 0:T.VEN_LIB_ART)||((V=(q=a.Detail)==null?void 0:q.Article)==null?void 0:V.ART_LIB1)||"-"}),e.jsx(S,{color:"secondary.light",margin:"auto",variant:"h5",children:a.subTitle}),e.jsx(Ha,{onSelect:m,recherche:a.rechercheLot})]})]}),e.jsx(Va,{detail:a.Detail,classNameColor:E}),!!h&&a.showCommentDetail&&e.jsx(Oe,{value:h,onHideComment:r.onHideComment}),e.jsxs(x,{className:"list-container infiniteScrollList",children:[L.map(a.Transactions,F=>e.jsx(x,{className:"line-trans",children:e.jsx(Ua,{item:F,ItemComponentProps:t})},F.indice)),e.jsx("span",{ref:u})]}),e.jsxs(x,{flexDirection:"row",display:"flex",gap:.5,children:[e.jsx(wn,{showClearButton:!0,showScanButton:!0,ref:l,disabled:!1,onError:Ka,onScanSuccess:()=>{},lecture:r.onScanLecture,rootClassName:"",disableRemote:!1,disabledPadding:!0}),e.jsx(Hn,{disabled:L.isEmpty(a.Transactions),variant:"outlined",size:"large",color:"error",className:"grid-actions",onClick:r.onAskConfirmRaz})]}),e.jsxs(x,{className:"new-container",children:[e.jsx(Gn,{visible:o,className:"progress"}),a.newTransaction&&e.jsx(lr,{className:"isNew",onShowInputNumber:t.onShowInputNumber,canValidateNew:c??!1,format:t.format,transaction:a.newTransaction,isNew:!0,isLoading:o,onChangeForm:r.onChangeFormNew,onClose:r.onCloseRefresh,onValidate:r.onValidateNewTransaction,onOpenLot:r.onOpenModalLotSelection,onReset:r.onResetNewTransaction})]})]})};function Xa({context:n,replaySubject:r,commentModal:s,commentPopup:a,VEN_LOT_SEQ:o,VEN_NUMSEQ:t,SCAN_RESULT:u,onChangeDetail:d,onNewTransaction:i,onCloseDetail:l}){const{t:c}=U();return e.jsx(e.Fragment,{children:e.jsx(De,{fallbackRender:m=>e.jsx(ye,{errorOrigin:"SaisieDetail",...m,resetMessage:c("close")}),onReset:l,children:e.jsx($a,{commentModal:s,commentPopup:a,className:"",onChangeDetail:d,onCloseDetail:l,onNewTransaction:i,SCAN_RESULT:u,VEN_LOT_SEQ:o,VEN_NUMSEQ:t,replaySubject:r,context:n})})})}function Ja(n){const r=new mn,s=new mn;let a=n(),o=s.subscribe(a);return{observable:r.asObservable().pipe(ea(void 0),vr(()=>a)),next:t=>s.next(t),reset:()=>{o.unsubscribe(),a=n(),o=s.subscribe(a),r.next(void 0)}}}const Re=n=>({err:!0,message:n});function es(n,r,s,a,o,t,u,d,i,l,c){const{t:m}=U(),E=f.useMemo(()=>Ja(()=>new yr(2,4e3)),[r]),h=Dr({mutationFn:({codeBarre:A,venNumSeq:N})=>{async function p(g,T){var q,V,F,M,I,B,D,j,Q,K,J,$,te,w,z,de,pe,k;try{const P=await y().PrepaFidegeMethods().ScanEan128PreparationFidege({variables:{context:n.current,demande:{CodeBarre:g,VenLotSeq:null,VenNumSeq:T}}});if(((q=P.res)==null?void 0:q.codeResult)!=="OK")return Re(m("ERR_SCAN_INVALID",{batchNumber:(((V=P.res)==null?void 0:V.codeResult)||"error")+":"+g}));if((F=P.res.result)!=null&&F.RemoteCommit)return c(),{err:!1,message:null};if((I=(M=P.res)==null?void 0:M.result)!=null&&I.Article)if((D=(B=P.res)==null?void 0:B.result)!=null&&D.VenLotSeq){if(s&&((w=(te=($=P.res)==null?void 0:$.result)==null?void 0:te.Article.Picking)==null?void 0:w.PICK_ZONE_TRAVAIL)!==s)return Re(m("ERR_SCAN_INVALID_PICKING",{zonePicking:(pe=(de=(z=P.res)==null?void 0:z.result)==null?void 0:de.Article.Picking)==null?void 0:pe.PICK_ZONE_TRAVAIL}));{const H=await u({VEN_LOT_SEQ:(k=P.res)==null?void 0:k.result.VenLotSeq,InfoCodeBarre:P.res.result||null,disableCommentDetailModal:!1},!0);if(H&&H instanceof Error)throw new Error("alreadyOpen");return{err:null,message:null}}}else{const H=(Q=(j=P.res)==null?void 0:j.result)!=null&&Q.VenLotSeqComplete?"ERR_SCAN_PRODUCT_COMPLETE":"ERR_SCAN_PRODUCT_NOTFOUND";return Re(m(H,{label:(J=(K=P.res)==null?void 0:K.result)==null?void 0:J.Article.ART_LIB1}))}else return Re(m("ERR_SCAN_PRODUCT_INVALID"))}catch{}finally{}}return p(A,N).then(g=>g?g.err&&g.message?(E.reset(),i(g.message).then(T=>!1)):!g.err:!0)}}),C=f.useCallback((A,N)=>(h!=null&&h.isLoading||(console.warn("RESET REPLAY"),E.reset()),h.mutateAsyncLock({codeBarre:N,venNumSeq:r}).catch(p=>(A!=="MODAL"&&p instanceof Error&&(p.message==="isLoading"||p.message==="alreadyOpen")&&(console.warn("ADD REPLAY "+A+" "+N),E.next(N),d&&d({origine:A,codeBarre:N,venNumSeq:r})),!1))),[r]),R=f.useCallback((A,N=!1)=>(E.reset(),u(A,N)),[u]);return{replaySubject:E,onSelectDetail:R,isLoading:h.isLoading,gereCodeBarre:C}}const ns=({color:n="info",sx:r,value:s,subTitle:a,title:o,onChange:t,label:u})=>e.jsxs(Ye,{sx:Un({boxShadow:2,height:"100%",borderLeft:4,borderLeftColor:`${n}.main`},r),raised:!0,children:[e.jsxs(x,{display:"flex",sx:{p:.5,columnGap:.5},children:[e.jsx(ne,{fontSize:"large",uvc:"C"}),e.jsxs(x,{children:[e.jsx(S,{color:`${n}.main`,textTransform:"capitalize",variant:"h6",children:o}),e.jsxs(S,{variant:"h5",children:[a,"   "]})]})]}),e.jsxs(x,{sx:{p:1,m:0},children:[e.jsx(zt,{maskProps:{precision:0},name:"nbExEtiquette",label:u,type:"number",startIconAdornment:ra,value:s,onChange:d=>t(+d.target.value)}),e.jsxs(x,{sx:{display:"grid",gridColumnGap:8,gridTemplateColumns:"repeat(2, minmax(0, 1fr))",justifyContent:"space-between",alignItems:"stretch"},children:[e.jsx(Vr,{size:"large",className:"print-btn",onClick:d=>t("+")}),e.jsx(Fr,{size:"large",className:"print-btn",onClick:d=>t("-")})]})]}),e.jsx(x,{sx:{flexGrow:1}})]});function cr({children:n,onSave:r,onClose:s,...a}){return e.jsxs(x,{sx:{"  & .MuiTextField-root, button, svg ":{fontSize:"inherit"},typography:"h3",display:"flex",justifyContent:"space-around",height:"100%",flexDirection:"column",maxWidth:"lg",m:{xs:0,md:1},overflow:"auto"},children:[e.jsx(le,{container:!0,spacing:{xs:0,md:.5},children:n}),e.jsx(ee,{textCancel:"close",ButtonCancel:Br,...a,onSave:r,onClose:s})]})}const rs=({VEN_NUMSEQ:n,onClose:r,context:s})=>{var d;const a=ia(s,n),{onFinPreparationCommande:o}=ta(s),{onEditionPreparationFidege:t}=oa(s),u=f.useCallback(i=>{var l;(l=a.data)!=null&&l.CanValidateBl?o(n,c=>{(c==null?void 0:c.codeResult)==="OK"&&t(i,m=>{r()})}):t(i,c=>{r()})},[n,(d=a.data)==null?void 0:d.CanValidateBl]);return a.isLoading?e.jsx(Ae,{}):a.error?e.jsx(Ne,{errorTitle:Wn(a.error),firstActionMessage:"retry",secondActionMessage:"close",onFirstAction:a.refetch,onSecondAction:r}):e.jsx(ts,{init:a.data,VEN_NUMSEQ:n,onValidate:u,onClose:r,cloturePreparation:a.data.CanValidateBl||!1})},ts=({init:n,VEN_NUMSEQ:r,onValidate:s,onClose:a,cloturePreparation:o})=>{var A,N;const{t}=U(),[u,d]=Ge("imprimanteBlPreparation","",!1,"SCALAR"),[i,l]=Ge("imprimanteEtiquettePreparation","",!1,"SCALAR"),[c,m]=f.useState(()=>({Consigne1:n.Consigne1,Consigne2:n.Consigne2,AfficheBl:n.AfficheBl,nbExBl:n.NbBl,nbExEtiquette:1,nbExColis:0,MailBl:n.MailBl,PrintBl:!0})),E=(p,g)=>{m(T=>({...T,[p]:g}))},h=p=>{E(p.target.name,p.target.value)},C=()=>{const p={numSeq:r,consigne1:c.Consigne1,consigne2:c.Consigne2,colis:c.nbExColis,options:{imprimeBL:o,mailBL:o?c.MailBl:!1,imprimanteBL:u,imprimeEtiqLiv:!0,imprimanteEtiqLiv:i,exportExcelBL:!1,exportPdfBL:!1,nbExemplaireBl:c.nbExBl,nbExemplaireEtiquette:c.nbExEtiquette,imprimePalette:!1,imprimantePalette:null,nbExemplairePalette:null}};return s(p)},R=p=>o?e.jsx(qr,{...p,color:"success",children:t("validate")}):e.jsx(Qr,{...p,color:"success",children:t("print")});return e.jsxs(cr,{onSave:C,onClose:a,ButtonValidate:R,children:[e.jsx(le,{item:!0,xs:12,children:e.jsxs(Ye,{sx:{borderLeft:4,borderLeftColor:p=>p.palette.secondary.dark},raised:!0,children:[e.jsx(Kn,{sx:{padding:.5},avatar:e.jsx(wr,{sx:{color:"secondary.main"}}),title:t("dailyCommentary")}),"  ",e.jsx(Ve,{}),e.jsxs($n,{sx:{display:"flex",flexDirection:"column",gap:1,"&:last-child":{py:1}},children:[e.jsx(En,{multiline:!0,color:"secondary",margin:"none",variant:"outlined",name:"Consigne1",type:"text",sx:{"& > .MuiInputBase-root.MuiOutlinedInput-root":{py:0}},label:t("safetyNotice")+" 1",InputLabelProps:{shrink:!0},value:c.Consigne1||"",onChange:h,fullWidth:!0,autoComplete:"off"}),e.jsx(En,{sx:{"& > .MuiInputBase-root.MuiOutlinedInput-root":{py:0}},multiline:!0,color:"secondary",margin:"none",variant:"outlined",name:"Consigne2",type:"text",label:t("safetyNotice")+" 2",InputLabelProps:{shrink:!0},value:c.Consigne2||"",onChange:h,fullWidth:!0,autoComplete:"off"})]})]})}),e.jsx(le,{item:!0,xs:12,md:4,children:e.jsx(ns,{value:c.nbExColis,title:t("uniteC"),label:"",onChange:p=>E("nbExColis",Ue(p,c.nbExColis)),sx:void 0,subTitle:void 0})}),e.jsx(le,{item:!0,xs:12,md:4,children:e.jsx(Pn,{nbEx:c.nbExEtiquette||0,color:"warning",typeImprimante:hn.ETIQ,imprimante:i,imprimanteDefaut:((A=n.Imprimantes)==null?void 0:A.ImprimanteEtiqLiv)||null,onChangeNbEx:p=>E("nbExEtiquette",Ue(p,c.nbExEtiquette)),title:t("labelPrinter"),label:t("copy"),onChangePrinter:function(p){l(p)},children:e.jsx(x,{display:"flex",flexWrap:"wrap",justifyContent:"center",children:e.jsx(pn,{color:"warning",handleChange:p=>E("nbExEtiquette",p?1:0),hideLabel:!1,checked:!!c.nbExEtiquette})})})}),n.AfficheBl&&o&&e.jsx(le,{item:!0,xs:12,md:4,children:e.jsxs(Pn,{nbEx:c.nbExBl||0,color:"primary",typeImprimante:hn.BL,imprimante:u,imprimanteDefaut:((N=n.Imprimantes)==null?void 0:N.ImprimanteBL)||null,onChangeNbEx:p=>E("nbExBl",Ue(p,c.nbExBl||0)),title:t("deliveryNote"),label:t("copy"),onChangePrinter:function(p){d(p)},children:[e.jsxs(x,{display:"flex",flexWrap:"nowrap",justifyContent:"space-between",m:{md:.5},children:[e.jsx(pn,{handleChange:p=>E("nbExBl",p?1:0),hideLabel:!1,checked:!!c.nbExBl}),e.jsx(kr,{handleChange:p=>E("MailBl",p),hideLabel:!1,disabled:!n.MailClient,checked:c.MailBl})]}),e.jsx(Ur,{mail:n.MailClient,disabled:!c.MailBl})]})})]})};function as({context:n,VEN_NUMSEQ:r,VEN_DATE_CDE:s,VEN_DATE_LIV:a,onCloseCommande:o,onOpenEditionPreparation:t}){const{FinPreparationCommandeReliquat:u}=aa(n),[d,i]=f.useState(s&&xn(s)||Cn(new Date)),[l,c]=f.useState(a&&xn(a)||Cn(new Date)),m=Ee(),{t:E}=U(),h=()=>{try{fn(d)&&fn(l)&&(Hr(gn(d),gn(l),"date")?u.mutate({dateCommande:Nn(d),dateLivraison:Nn(l),venNumSeq:r,zoneTravail:n.current.zoneTravail},{onSettled(C,R,A,N){var p,g;C&&(C.err||((p=C.res)==null?void 0:p.codeResult)!=="OK"?m.errorMessage(E(((g=C.res)==null?void 0:g.codeResult)||"errorMessage")):C.res.result.numeroBl?t():o())}}):m.errorMessage(E("invalidDate")))}catch{}};return e.jsx(cr,{onSave:h,onClose:t,children:e.jsx(le,{item:!0,xs:12,children:e.jsxs(Ye,{sx:{border:1,borderColor:"text.disabled",boxShadow:2,flex:1},elevation:2,children:[e.jsx(Kn,{title:E("orderAdditional"),subheader:e.jsxs(e.Fragment,{children:[E("orderDate")," ",zr(d)]})}),e.jsx(Ve,{}),e.jsxs($n,{children:[e.jsx(S,{variant:"h6",sx:{margin:"auto",textAlign:"center",color:"info.main",userSelect:"none"},children:E("deliveryDate")}),e.jsx(Kt,{readOnlyDate:!1,onChange:c,date:l})]})]})})})}const ss=rr(as,"",!0,!0,"RELIQUAT");function Pe(n){var r,s;return(n==null?void 0:n.codeResult)==="OK"?((r=n==null?void 0:n.result)==null?void 0:r.NB_LIGNES_NONVAL)===0?"PREPATERMINE":((s=n==null?void 0:n.result)==null?void 0:s.NB_LIGNES_DEMARREE)===0?"PREPAVIDE":"PREPACOMMENCEE":"ERR"}const os=n=>!!(n!=null&&n.VEN_COM_PREPA)||!!(n!=null&&n.VEN_COM_PREPA2)||!!(n!=null&&n.LIVC_COM_PREPA),is=(n,r,s,a)=>{var de,pe;const o=Ke(),t=o.getParametreBorneZone1("V2_RELIQUAT"),u=o.getParametreBorneZone1("V2_MANQRELIQ"),d=s.VEN_NUMSEQ,i=s.VEN_LOT_SEQ,l=s.modalFor,c=Pa(r),m=ar(r),{clearCache:E}=rn(),{FinPreparationCommandeReliquat:h}=la(n),C=l||(i?"DETAIL":"COMMANDE"),R=!!l,A=sa(n,d||0,a||null,{enabled:!!d&&R===!1}),N=A.data,p=Mt(n,d),g=os((de=p.data)==null?void 0:de.res),[T,q]=f.useState(()=>{const k=o.getParametreBorne("V2_CONSIGNE_ENT"),P=o.getParametreBorne("V2_CONSIGNE_DET");return{enteteModal:xe(k,1),entetePopup:xe(k,2),enteteCloture:xe(k,4),cloture:!1,detailModal:xe(P,1),detailPopup:xe(P,2)}}),V=A.isLoading?"LOADING":Pe(N||null),F=(pe=p.data)==null?void 0:pe.res,M=c===b.PREPAARTICLE&&!!i;async function I(){try{const k=await A.refetch();return Pe(k.data||null)}catch{return null}}const B=f.useCallback(k=>{async function P(){var H;try{const ae=await A.refetch();(((H=ae.data)==null?void 0:H.codeResult)==="OK"&&Pe(ae.data||null))==="PREPATERMINE"?m.onOpenCloturePreparation():t?m.onOpenReliquatPreparation():m.unSelectPreparation()}catch{}}P()},[d]),D=f.useCallback(k=>{async function P(){var H;try{const ae=await A.refetch(),Be=((H=ae.data)==null?void 0:H.codeResult)==="OK"&&Pe(ae.data||null);Be==="PREPATERMINE"?m.onOpenCloturePreparation():h.mutate({venNumSeq:d},{onSettled:we=>{var dn;((dn=we==null?void 0:we.res)==null?void 0:dn.codeResult)==="OK"&&(Be==="PREPACOMMENCEE"?m.onOpenEditionPreparation():m.unSelectPreparation())}})}catch{}}P()},[d]),j=f.useCallback(k=>{async function P(){if(R){m.onStepBack();return}if(i){c===b.PREPAARTICLE?(E(["DETAILS"]),await I()==="PREPATERMINE"?m.onOpenCloturePreparation():m.onStepBack()):(E(["STATUT"]),m.onStepBack());return}const H=await I();H==="ERR"?m.onStepBack():H==="PREPACOMMENCEE"?m.onOpenEditionPreparation():m.onStepBack()}P()},[c,R,i]),Q=f.useCallback(k=>{q(P=>({...P,enteteModal:!0,cloture:!0}))},[]),K=f.useCallback(k=>{q(P=>({...P,entetePopup:!1}))},[]),J=f.useCallback(k=>{T.cloture?B(null):q(P=>({...P,enteteModal:!1}))},[T.cloture,B]),$=f.useCallback(k=>{m.leaveLinePreparation()},[m.leaveLinePreparation]),te=R||!!i,w=M||!u||V==="PREPATERMINE"?0:te?2:1;let z=M?1:te?2:V==="PREPATERMINE"||t?1:2;return!M&&z===2&&w&&!t&&(z=0),{error:p.error||!p.isLoading&&!F?"Not found":null,preparation:F||null,NB_LIGNES:N==null?void 0:N.result.NB_LIGNES,NB_LIGNES_VAL:((N==null?void 0:N.result.NB_LIGNES)??0)-((N==null?void 0:N.result.NB_LIGNES_NONVAL)??0),hideCloture:M?!1:V==="ERR"||V==="LOADING",canValidateBL:M?"NAVIGATEORDER":V,manqeReliq:w,clotureBtn:z,onClotureCommande:M?$:T.enteteCloture&&g?Q:B,onClotureCommandeManquantReliquat:D,onClose:j,actions:m,commentOpen:T,showCommentCloture:Q,showComment:C==="COMMANDE"&&!!(T.enteteModal&&g),onCloseModal:J,onHideComment:K,modalForC:C}},He=he(W)(({theme:n})=>({minWidth:"100px",borderRadius:0,"&.manqReliq.MuiButton-colorWarning":{backgroundColor:n.palette.warning.dark}})),ls=n=>n==="NAVIGATEORDER"?"order":n==="PREPACOMMENCEE"||n==="PREPAVIDE"?"orderAdditional":"preparationComplete";function cs({preparation:n,handleClotureCommande:r,handleManquantReliquat:s,handleClose:a,NB_LIGNES:o,NB_LIGNES_VAL:t,canValidateBL:u,hideCloture:d,clotureBtn:i,manqeReliq:l}){const{t:c}=U();if(!n)return null;const m=u==="NAVIGATEORDER"?Je:Kr,E=u==="NAVIGATEORDER"?"info":u==="PREPATERMINE"?"success":"warning";return e.jsxs(x,{display:"flex",gap:1,flexGrow:1,paddingLeft:1,children:[e.jsxs(x,{alignItems:"center",display:"flex",gridArea:"cde",children:[e.jsx(Gr,{icon:"ORDER"}),e.jsxs(x,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(S,{variant:"h6",color:"inherit",children:n.VEN_CDE}),e.jsx(S,{variant:"h6",children:me(n.VEN_DATE_LIV)})]})]}),e.jsxs(x,{sx:{paddingLeft:.8,flexGrow:1},display:"flex",alignItems:"center",children:[e.jsx(Xe,{width:"20px",height:"20px",color:"inherit"}),e.jsxs(x,{sx:{paddingLeft:2},display:"flex",flexDirection:"column",children:[e.jsx(S,{variant:"h6",color:"inherit",children:n.VEN_CLIENT}),e.jsxs(S,{variant:"h6",children:[n.NOM_CLIENT," - ",n.VILLE_CLIENT]})]})]}),e.jsxs(Pt,{children:[!d&&!!l&&e.jsxs(He,{fullWidth:!0,className:"manqReliq",size:"large",disabled:l===2,color:E,startIcon:e.jsx(Zn,{typeEntete:"R"}),variant:"contained",onClick:s,children:[c("orderEndMr"),e.jsx("br",{})," ",t," / ",o]}),!d&&!!i&&e.jsxs(He,{fullWidth:!0,size:"large",disabled:i==2,color:E,startIcon:e.jsx(m,{}),variant:"contained",onClick:r,children:[c(ls(u)),e.jsx("br",{})," ",t," / ",o]}),e.jsx(He,{fullWidth:!0,size:"large",variant:"contained",color:"error",startIcon:e.jsx(Wr,{}),onClick:a,children:c("back")})]})]})}const ds=f.memo(cs);function us({autoHideDuration:n,message:r,onCloseMessage:s}){const a=f.useCallback(()=>{s(r.id)},[r.id]);return e.jsx($r,{open:!0,autoHideDuration:n,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsxs(_e,{onClose:a,severity:"success",variant:"filled",sx:o=>({width:"auto",maWidth:"450px",...o.typography.h6}),children:[e.jsx(x,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:e.jsxs(Te,{children:[e.jsx(S,{variant:"inherit",children:r.CODE_ART}),e.jsx(S,{variant:"h6",children:r.LIBELLE_ART})]})}),e.jsx(Ve,{}),e.jsxs(Te,{direction:"row",children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsx(Ze,{fontSize:"large"}),r.LOT_ID]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(S,{variant:"h4",children:["+ ",L.round(r.QTE_ADD||0,3)]}),e.jsx(ne,{fontSize:"inherit",uvc:r.UNIT_CDE})]}),e.jsx(x,{sx:{display:"flex",alignItems:"center"},children:e.jsxs(S,{variant:"h6",children:["  ",L.round((r.QTE_ADD||0)+(r.QTE_PREP||0),3)," / ",L.round(r.QTE_TOT||0,3)," "]})})]})]})})}function ms({onCloseMessage:n,messages:r}){const[s]=Ge("messageAutoHideDuration",4e3,!1,"SCALAR");return e.jsx(e.Fragment,{children:L.map(r,a=>e.jsx(us,{message:a,onCloseMessage:n,autoHideDuration:+s},a.id))})}const Es=({context:n,operationId:r,zoneTravail:s,preparation:a,onCloseCommande:o})=>{const{t}=U(),u=Se(),d=vt(),{clearCache:i}=rn(),l=is(n,r,a,s),c=l.preparation,m=l.commentOpen,E=l.modalForC,{VEN_NUMSEQ:h,VEN_LOT_SEQ:C,InfoCodeBarre:R,MessagesTransactions:A,disableCommentDetailModal:N,modalFor:p}=a,{onCloseAutoScanMessage:g,leaveLinePreparation:T,selectPreparationLineModal:q,onLateScan:V,onOpenFenetreManquantDetail:F,onOpenEditionPreparation:M,onNewTransaction:I}=l.actions,{parseScan:B}=Fe(),D=!N&&m.detailModal,j=es(n,h,s,u,D,m.detailPopup,q,null,d,I,()=>{K.data.refetch()}),Q=f.useCallback(w=>{const z=B(w);if(z)try{return w.clearCb&&w.clearCb(),j.gereCodeBarre(w.origine??null,z.cbValue)}catch{}else w.updateQuery(w.val);return Promise.resolve(!0)},[j.gereCodeBarre]),K=be(n,{key:[Nt,h],keyConfigFilters:"PreparationClientDetails",transform:[Dt],fxt:(w,z)=>y().PrepaFidegeMethods().ListeDetailFidege({variables:{numSeq:h,recherche:w,context:(z==null?void 0:z.current)||null}}),query:ue("VEN_NUMSEQ",h,"="),options:{queryOptions:{enabled:!!h&&!C}},onSetQuickFilterValueParam:Q,onBeforeRefetch:()=>{i(["STATUT"])}}),J=Me(E==="COMMANDE"),$=f.useMemo(()=>({VEN_NUMSEQ:(c==null?void 0:c.VEN_NUMSEQ)||0,format:u,onOpenFenetreManquantDetail:F}),[c==null?void 0:c.VEN_NUMSEQ,u]),te=c?L.stringConcat(c.VEN_COM_PREPA,c==null?void 0:c.VEN_COM_PREPA2,c.LIVC_COM_PREPA):null;return l.error?e.jsx(Ne,{errorTitle:t("notFound"),secondActionMessage:t("close"),onSecondAction:o}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{onCloseMessage:g,messages:A||[]}),e.jsxs(ve,{dialogProps:{maxWidth:"md",fullScreen:!1,fullWidth:!1},i8ntitle:t("comment"),onCloseDialog:l.onCloseModal,"aria-labelledby":"customized-dialog-title",isOpen:!!l.showComment,withAppBar:!0,className:"",children:[e.jsx(oe,{children:e.jsxs(x,{display:"flex",flexDirection:"column",rowGap:{xs:0,md:.5},children:[e.jsx(We,{label:"Consigne de preparation fixe",value1:c==null?void 0:c.LIVC_COM_PREPA}),e.jsx(Ve,{}),e.jsx(We,{label:"Consigne de preparation journaliere",value1:c==null?void 0:c.VEN_COM_PREPA,value2:c==null?void 0:c.VEN_COM_PREPA2})]})}),e.jsx(ie,{children:e.jsx(ee,{textCancel:"close",onClose:()=>l.onCloseModal()})})]}),e.jsx(Yr,{color:"primary",children:e.jsx(ds,{preparation:l.preparation,handleClotureCommande:l.onClotureCommande,handleManquantReliquat:l.onClotureCommandeManquantReliquat,handleClose:l.onClose,NB_LIGNES:l.NB_LIGNES,NB_LIGNES_VAL:l.NB_LIGNES_VAL,canValidateBL:l.canValidateBL,hideCloture:l.hideCloture,clotureBtn:l.clotureBtn,manqeReliq:l.manqeReliq})}),c&&e.jsxs(e.Fragment,{children:[E==="RELIQUATPREPARATION"&&e.jsx(ss,{onCloseCommande:o,VEN_NUMSEQ:c.VEN_NUMSEQ,VEN_DATE_CDE:c.VEN_DATE_CDE,VEN_DATE_LIV:c.VEN_DATE_LIV,onOpenEditionPreparation:M,context:n}),(E==="EDITIONPREPARATION"||E==="CLOTUREPREPARATION")&&e.jsx(rs,{VEN_NUMSEQ:c.VEN_NUMSEQ,onClose:o,context:n}),E==="DETAIL"&&C&&e.jsx(Xa,{VEN_LOT_SEQ:C,VEN_NUMSEQ:h,SCAN_RESULT:R,onCloseDetail:l.onClose,onNewTransaction:I,onChangeDetail:j.onSelectDetail,commentModal:D,commentPopup:m.detailPopup,replaySubject:j.replaySubject.observable,context:n}),E==="COMMANDE"&&e.jsxs(x,{sx:{gap:1,flex:1,p:.5,display:"flex",flexDirection:"column",width:"100%"},children:[te&&m.entetePopup&&e.jsx(Oe,{value:te,onHideComment:l.onHideComment}),e.jsx(ge,{kbManageRef:J,labelSearch:"",gridModes:["list"],disablePadding:!0,disableContainer:!0,disableFavorite:!0,scanTitle:"lotNumber",onSelect:w=>j.onSelectDetail({VEN_LOT_SEQ:w.VEN_LOT_SEQ,InfoCodeBarre:null}),HeaderComponent:null,ItemComponentProps:$,ItemComponent:yt,placeholderSearch:t("placeHolderPreparation"),ItemMeasureCard:tn,isLoading:j.isLoading,state:K})]})]})]})},hs=rr(Es,"",!0,!0,"LIST"),ps={"& .MuiPaper-root.MuiDialog-paper:not(.MuiDialog-paperFullScreen)":{border:2,borderColor:"primary.dark",borderRadius:n=>n.shape.borderRadius,maxHeight:"none",height:"90vh","& > .MuiAppBar-root":{backgroundColor:"#50809C"}}};function xs({context:n,operationId:r,onClose:s}){var d,i,l;const a=_a(r),o=Zr("lg"),{t}=U(),u=(d=a.operation)==null?void 0:d.preparation;return e.jsx(ve,{keepMounted:!0,isOpen:!!((i=a.operation)!=null&&i.preparation),withAppBar:!1,sx:ps,className:"",dialogProps:{maxWidth:"lg",fullWidth:!0,fullScreen:o},children:e.jsx(De,{fallbackRender:c=>e.jsx(ye,{errorOrigin:"CurrentPreparation",...c,resetMessage:t("close")}),onReset:s,children:!!u&&e.jsx(hs,{operationId:r,context:n,preparation:u,zoneTravail:((l=a.operation)==null?void 0:l.zoneTravailPersonnelCode)||null,onCloseCommande:a.actions.unSelectPreparation,VEN_NUMSEQ:u.VEN_NUMSEQ})})})}const Cs=({qtePrep:n,onClose:r,onDeleteManquant:s})=>{const{t:a}=U();return e.jsxs(x,{sx:{p:1},children:[e.jsx(S,{variant:"h6",color:"warning",sx:{my:2,textAlign:"center"},children:n>0?a("MSG_REASON_VALIDATION_PREPARATION"):a("MSG_REASON_DELETE_PREPARATION")}),e.jsxs(x,{display:"flex",flexDirection:"column",sx:{p:3,gap:2},children:[e.jsx(qe,{disabled:n>0,color:"warning",size:"large",variant:"contained",onClick:o=>{s("M")},children:a("missing")}),e.jsx(qe,{color:"warning",size:"large",variant:"contained",onClick:o=>{s("A")},children:a("other")}),e.jsx(qe,{disabled:!(n>0),color:"warning",size:"large",variant:"contained",onClick:o=>{s("P")},children:a("missingPartial")})]}),e.jsx(ee,{onClose:function(){r()}})]})},fs=({context:n,VEN_NUMSEQ:r,VEN_LOT_SEQ:s,onClose:a})=>{var d,i,l;const o=Vt(n,r,s),t=Ft(n),u=f.useCallback(c=>{(async()=>{t.mutate({VEN_LOT_SEQ:s,MOTIF:c},{onSettled:E=>{var h;((h=E==null?void 0:E.res)==null?void 0:h.codeResult)==="OK"&&a()}})})()},[s]);return o.error||o.isLoading===!1&&!o.data?e.jsx(Ne,{errorTitle:o.error?Wn(o.error):"empty",firstActionMessage:"retry",onFirstAction:o.refetch,secondActionMessage:"close",onSecondAction:a}):o.isLoading?e.jsx(Ae,{}):e.jsx(Cs,{onDeleteManquant:u,qtePrep:((l=(i=(d=o.data)==null?void 0:d.detail)==null?void 0:i.Detail)==null?void 0:l.VEN_QTE_LIV)||0,onClose:a})};function gs({context:n,onFoundOrder:r,onNotFoundOrder:s,onCancel:a}){const[o,t]=f.useState(""),[u,d]=f.useState(""),i=Bt(n,u,{enabled:!!u});return f.useEffect(()=>{var l,c;if(i.data){const m=((l=i.data.res)==null?void 0:l.result)&&L.head((c=i.data.res)==null?void 0:c.result)||null;m?r(Le(m)):s(u)}},[i.data]),e.jsxs(e.Fragment,{children:[e.jsx(Xr,{onClose:function(l){a()},onSave:d,disableCalc:!0,label:Y("orderNumber")||"COMMA",maximumFractionDigits:0,state:o,updateState:t}),e.jsx(Gn,{visible:i.isInitialLoading})]})}const Ns=he(an)({position:"relative",display:"grid",alignItems:"center",gridTemplateColumns:"minmax(min-content,70px) 1fr 280px 110px",gridTemplateAreas:' "picking article qtecde qtefac"',"& .hl.input-uvc":{height:"100%",boxShadow:2}}),dr=({className:n,item:r,ItemComponentProps:s,onSelect:a,style:o,...t})=>{var E,h;const u=r,d=r.UNIT_CDE||"C",i=u||{ART_RUB1:null,ART_STAT_IMAGE:null,ART_CODE:null,ART_LIB1:null,ART_PAYS:null},l=en(d,s.format),c=r.VEN_QTE_CDE?L.round(+(r.VEN_QTE_LIV??0)/+r.VEN_QTE_CDE,2)*100:0,m=(r.NB_LIGNES??0)-(r.NB_LIGNES_NONVAL??0);return e.jsxs(Ns,{style:o,onClick:a?C=>a(r):void 0,className:X(n,"line-container",{"border-red":(r.NB_LOT_NON_RECEP||0)>0}),children:[e.jsx(nr,{gridArea:"picking",variant:"inherit",PICK_CODE:i.ART_PICKING||""}),e.jsxs(x,{display:"flex",alignItems:"center",className:"article",gridArea:"article",children:[e.jsx(zn,{title:i.ART_RUB1,children:e.jsx(Jr,{children:e.jsx($e,{codeStat:i.ART_STAT_IMAGE})})}),e.jsxs(x,{display:"flex",flexDirection:"column",sx:{overflow:"hidden"},children:[e.jsxs(x,{display:"flex",alignItems:"center",columnGap:.4,children:[e.jsx(fe,{field:"ART_CODE",typoProps:{noWrap:!0,variant:"subtitle2",color:"textPrimary"},content:i.ART_CODE,matchSearch:(E=r._properties)==null?void 0:E.matchSearch}),!!i.ART_PAYS&&i.ART_PAYS!=="0"&&e.jsx(Qn,{svg:!0,countryCode:i.ART_PAYS})]}),e.jsx(fe,{field:"ART_LIB1",typoProps:{noWrap:!0},content:i.ART_LIB1,matchSearch:(h=r._properties)==null?void 0:h.matchSearch})]})]}),e.jsxs(x,{display:"flex",className:X("hl","input-uvc","UC","LIV"),gridArea:"qtecde",flexDirection:"column",children:[e.jsx(S,{sx:{padding:0,color:C=>C.palette.grey[600],textAlign:"center"},variant:"caption",children:"Préparé / Commandé"}),e.jsxs(x,{display:"flex",alignItems:"center",flexDirection:"row",children:[e.jsx(ne,{fontSize:"inherit",uvc:d}),e.jsx(S,{component:"span",sx:{flexGrow:1,color:"inherit",textAlign:"center"},variant:"h4",children:G(r.VEN_QTE_LIV,(l==null?void 0:l.precision)??4)}),"/",e.jsx(S,{component:"span",sx:{flexGrow:1,color:"inherit",textAlign:"center"},variant:"h4",children:G(r.VEN_QTE_CDE,(l==null?void 0:l.precision)??4)})]}),e.jsx(Ae,{className:"linear",color:"inherit",value:c,variant:"determinate"})]}),e.jsxs(x,{display:"flex",gridArea:"qtefac",children:[e.jsx($t,{className:"icon number"}),e.jsxs(S,{variant:"inherit",color:"textPrimary",children:[m,"  /  ",r.NB_LIGNES]})]})]})};function As({state:n,onSelect:r}){const{t:s}=U(),a=f.useRef(null),o=Se(),t=f.useMemo(()=>({format:o}),[o]);return e.jsx(ge,{kbManageRef:a,labelSearch:"",gridModes:["list"],onSelect:u=>r(u.ART_CODE,null),HeaderComponent:null,ItemComponentProps:t,ItemComponent:dr,placeholderSearch:s("placeHolderPreparation"),ItemMeasureCard:tn,disableFavorite:!0,state:n})}const On={domain:[0,100],range:["orange","green"]},Ss=et().domain(On.domain).range(On.range),Rs=({className:n,item:r,ItemComponentProps:s,onSelect:a,style:o,...t})=>{var c,m,E;const u=r.UNIT_CDE||"C",d=en(u,s.format),i=r.VEN_QTE_CDE?L.round(+r.VEN_QTE_LIV/+r.VEN_QTE_CDE,2)*100:0,l=r.Commande;return e.jsxs(nt,{style:o,sx:{position:"relative",display:"grid",gap:1,px:1,borderLeft:4,width:"100%",flexBasis:"100%",alignItems:"center",gridTemplateColumns:"80px 200px 80px 1fr 200px minmax(250px,1fr)",gridTemplateAreas:` "cde client prep tournee date qtecde"
                "comment comment comment comment comment comment"`,fontSize:32,"& .hl.input-uvc":{position:"relative",height:"100%",boxShadow:2,"& .linear":{color:i>100?"red":Ss(i)}},...qn,...(r.NB_LOT_NON_RECEP||0)>0&&{borderColor:"red"}},onDelete:()=>s==null?void 0:s.onOpenFenetreManquantDetail(r.VEN_LOT_SEQ,r.VEN_NUMSEQ),className:X(n,r.NB_TRANS_NONVAL?(r.STO_TOT||0)<=0?"orange":"jaune":"green"),onClick:h=>a(r),disabledBtDel:!(r.VEN_QTE_LIV<r.VEN_QTE_CDE||r.NB_TRANS_NONVAL>0),children:[Yn(r)&&e.jsx(Xn,{lockByName:r.VERROU_USER}),e.jsx(x,{gridArea:"cde",children:e.jsx(fe,{typoProps:{width:"10ch",color:"textPrimary",variant:"h5",fontWeight:600},content:l.VEN_CDE,field:"VEN_CDE",matchSearch:(c=r._properties)==null?void 0:c.matchSearch})}),e.jsxs(x,{display:"flex",gridArea:"client",sx:{alignItems:"center"},children:[e.jsx(Xe,{className:"icon client"}),e.jsx(fe,{typoProps:{width:"20ch",color:"primary",variant:"body1",fontWeight:600},content:l.NOM_CLIENT,field:"NOM_CLIENT",matchSearch:(m=r._properties)==null?void 0:m.matchSearch})]}),e.jsx(x,{gridArea:"prep",children:e.jsx(S,{variant:"inherit",color:"textPrimary",children:l.VEN_PREPARATEUR})}),e.jsxs(x,{display:"flex",gridArea:"tournee",sx:{alignItems:"center"},children:[e.jsx(nn,{className:"icon livraison"}),e.jsx(S,{className:"trs",variant:"inherit",color:"textPrimary",children:(E=l.Tournee)==null?void 0:E.TOUR_CODE})]}),e.jsxs(x,{display:"flex",gridArea:"date",sx:{alignItems:"center"},children:[e.jsx(Zt,{type:"prep",className:"icon"}),e.jsx(S,{className:"date",variant:"inherit",color:"textPrimary",children:me(l.VEN_DATE_LIV)})]}),e.jsxs(x,{display:"flex",gridArea:"qtecde",className:X("hl","input-uvc","UC","LIV"),flexDirection:"column",children:[e.jsx(S,{sx:{padding:0,color:h=>h.palette.grey[600],textAlign:"center"},variant:"caption",children:"Préparé / Commandé"}),e.jsxs(x,{display:"flex",alignItems:"center",flexDirection:"row",children:[e.jsx(ne,{fontSize:"inherit",uvc:r.UNIT_CDE||"",sx:{order:3}}),e.jsx(S,{component:"span",sx:{flexGrow:1,color:"inherit",textAlign:"center"},variant:"h4",children:G(r.VEN_QTE_LIV,(d==null?void 0:d.precision)??4)}),"/",e.jsx(S,{component:"span",sx:{flexGrow:1,color:"inherit",textAlign:"center"},variant:"h4",children:G(r.VEN_QTE_CDE,(d==null?void 0:d.precision)??4)})]}),e.jsx(Ae,{className:"linear",color:"inherit",value:i,variant:"determinate"})]})]})};function Ps({operationId:n,codeArticle:r,enabled:s,onOpenFenetreManquantDetail:a,onSelectNumSeq:o,onClose:t,zoneTravail:u,onSelect:d,...i}){var N,p;const{t:l}=U(),c=Se(),m=sr(n),E=Ca(n),h=wt(m,E,r,{enabled:s}),A=ua(m,E,r||null,o,()=>{},()=>{h.refetch()},s);return f.useEffect(()=>{var g;!h.isLoading&&!((g=h.data)!=null&&g.res)&&t()},[]),!h.isLoading&&!((N=h.data)!=null&&N.res)?e.jsx(Ne,{errorTitle:"Détail entièrement préparé",secondActionMessage:l("close"),onSecondAction:t,severity:"info"}):e.jsxs(x,{display:"flex",flexDirection:"column",height:"100%",gap:.5,m:.5,children:[e.jsx(x,{children:((p=h.data)==null?void 0:p.res)&&e.jsx(dr,{style:{},item:h.data.res,onSelect:null,avatarField:null,favorites:[],editFavorite:!1,ItemComponentProps:{format:c}})}),e.jsx(ge,{disableGap:!0,disableContainer:!0,state:A,onSelect:d,ItemMeasureCard:tn,ItemComponentProps:{format:c,onOpenFenetreManquantDetail:a},ItemComponent:Rs,...i,labelSearch:"",placeholderSearch:l("placeHolderPreparation"),gridModes:["list"],disableFavorite:!0})]})}const _s={COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:120,md:{COLUMN_WIDTH:100,COLUMN_UNIT:"%",ROW_HEIGHT:64}},Ts={gridTemplateColumns:"90px minmax(0,1fr) 80px 90px 120px 190px 60px",gridTemplateAreas:' "VEN_CDE NOM_CLIENT VEN_PREPARATEUR TOUR_LIBELLE VEN_DATE_LIV COLIS_RESTANT NB_LIGNES"'},Ls=he(an)({display:"grid",width:"100%",flex:1,alignItems:"stretch",overflow:"hidden",gridTemplateColumns:"90px minmax(0,1fr) 80px 90px 120px 190px 60px",gridTemplateAreas:'"VEN_CDE NOM_CLIENT VEN_PREPARATEUR TOUR_LIBELLE VEN_DATE_LIV COLIS_RESTANT NB_LIGNES"'}),Os=he(Zn)({position:"absolute",top:1,border:"none !important"}),js=({className:n,item:r,ItemComponentProps:s,onSelect:a,style:o,...t})=>{var l,c,m;const u=r.NB_LIGNES-r.NB_LIGNES_NONVAL,d=en("C",s.format),i=r.COLIS_CDE?L.round(+(r.COLIS_LIV||0)/+r.COLIS_CDE,2)*100:0;return e.jsx(e.Fragment,{children:e.jsxs(Ls,{style:o,_properties:r._properties,className:X("line-preparation-fidege",n,r.COLIS_LIV?"magenta":"jaune"),onClick:E=>a(r),dividerRight:!0,children:[Yn(r)&&e.jsx(Xn,{lockByName:r.VERROU_USER}),r.VEN_MANQRELIQ==="R"&&e.jsx(Os,{className:"icon-uvc",typeEntete:"R",fontSize:"small",color:"warning"}),e.jsx(Z,{hideLabel:!0,textAlign:"center",variant:"inherit",gridArea:"VEN_CDE",Icon:Je,label:"Commande",text:String(r.VEN_CDE),field:"VEN_CDE",matchSearch:(l=r._properties)==null?void 0:l.matchSearch}),e.jsxs(Z,{hideLabel:!0,hideBody:!0,sx:{display:"flex",flexDirection:"column"},textAlign:"left",variant:"inherit",gridArea:"NOM_CLIENT",Icon:rt,label:"Client",children:[e.jsx(fe,{typoProps:{flex:1,flexBasis:"60%",className:"nomClient",noWrap:!0,color:"primary",variant:"inherit",fontWeight:600},content:r.NOM_CLIENT,field:"NOM_CLIENT",matchSearch:(c=r._properties)==null?void 0:c.matchSearch}),e.jsx(S,{className:"villeClient",variant:"body1",color:"textPrimary",component:"span",sx:{fontWeight:800},children:r.VILLE_CLIENT})]}),e.jsx(Z,{hideLabel:!0,variant:"inherit",gridArea:"VEN_PREPARATEUR",Icon:null,label:"Préparateur",text:r.VEN_PREPARATEUR}),e.jsx(Z,{hideLabel:!0,textAlign:"left",variant:"inherit",gridArea:"TOUR_LIBELLE",Icon:nn,label:"Tournée",text:((m=r.Tournee)==null?void 0:m.TOUR_CODE)||""}),e.jsx(Z,{hideLabel:!0,textAlign:"center",variant:"inherit",gridArea:"VEN_DATE_LIV",Icon:Ht,label:"Date Liv",text:me(r.VEN_DATE_LIV)}),e.jsx(x,{display:"flex",className:X("hl"),gridArea:"COLIS_RESTANT",flexDirection:"column",children:e.jsxs(x,{display:"flex",sx:{position:"relative"},alignItems:"center",flex:1,flexDirection:"row",justifyContent:"space-around",children:[e.jsx(S,{component:"span",sx:{flexGrow:1,flexBasis:"50%",color:"inherit",textAlign:"center"},variant:"inherit",children:G(r.COLIS_LIV,d)}),"/",e.jsx(S,{component:"span",sx:{flexGrow:1,flexBasis:"50%",color:"inherit",textAlign:"center"},variant:"inherit",children:G(r.COLIS_CDE,d)}),e.jsx(kt,{sx:{position:"absolute",bottom:4,left:2,right:2},value:i,variant:"determinate"})]})}),e.jsx(Z,{hideLabel:!0,textAlign:"center",variant:"inherit",gridArea:"NB_LIGNES",Icon:tt,label:"Lignes",text:`${u}/${r.NB_LIGNES}`})]})})},Is=[{label:"VEN_CDE",field:"VEN_CDE",icon:Je},{label:"NOM_CLIENT",field:"NOM_CLIENT",icon:Xe},{label:"VEN_PREPARATEUR",field:"VEN_PREPARATEUR"},{label:"TOUR_LIBELLE",field:"TOUR_LIBELLE",icon:nn},{label:"VEN_DATE_LIV",field:"VEN_DATE_LIV",icon:Yt},{label:"COLIS_RESTANT",field:"COLIS_RESTANT",icon:st},{label:"NB_LIGNES",field:"NB_LIGNES",disabled:!0}],bs=n=>e.jsx(at,{listTri:Is,...n,sx:Ts});function Ms({state:n,onSelect:r,disableScan:s}){const a=Se(),o=f.useMemo(()=>({format:a}),[a]),t=Me(!s);return e.jsx(ge,{state:n,onSelect:r,ItemMeasureCard:_s,kbManageRef:t,HeaderComponent:bs,ItemComponent:js,ItemComponentProps:o,labelSearch:"",gridModes:["list"],disableFavorite:!0})}function jn(n){n.data.removeQuery(),n.data.resetPreviousData(),n.actions.onClearQuickSearchValue()}function In(n,r){n.visualState.query&&(r.actions.onClearAll(),r.actions.onSetFiltersValue(lt(n.visualState.query)))}function vs({enableCommandePio:n,onSetOrderPrio:r,context:s,zoneTravail:a,children:o}){const t=Ut(s,a,{refetchInterval:5e3,enabled:n});return f.useEffect(()=>{var u,d;!t.isLoading&&t.data&&((u=t.data.res)==null?void 0:u.codeResult)==="OK"&&r(((d=t.data.res)==null?void 0:d.result)??null)},[t.data,t.isLoading]),e.jsx(e.Fragment,{children:t.isInitialLoading?e.jsx(Ae,{}):o})}function ur({operationId:n}){const{t:r}=U(),{codePersonnel:s,nomPersonnel:a,actions:o,operation:t,getParametreBorneZone1:u,gereAffPrepa:d,gereLockAffPrepa:i,gereZoneTravail:l,gereMANQRELIQ:c}=Ta(n),m=sr(n),E=!l||!!(t!=null&&t.zoneTravailPersonnelCode),h=f.useCallback(g=>o.onSelectOrder(Le(g)),[o.selectPreparation]),C=ca(m,null,g=>{o.selectPreparation({VEN_NUMSEQ:g,VEN_LOT_SEQ:null,InfoCodeBarre:null})},o.onScanError,o.onOpenModalSearchOrder,(t==null?void 0:t.mode)===b.PREPACLIENT&&(t==null?void 0:t.step)===O.LISTPREPARATIONS,c),R=da(m,null,g=>{o.selectPreparation({VEN_NUMSEQ:g,VEN_LOT_SEQ:null,InfoCodeBarre:null})},o.onScanError,(t==null?void 0:t.mode)===b.PREPAARTICLE&&(t==null?void 0:t.step)===O.LISTPREPARATIONS,c),A=f.useCallback(()=>{(t==null?void 0:t.mode)===b.PREPAARTICLE&&In(R,C),jn(C),o.onNavigateListCommande()},[C.data.resetPreviousData,t==null?void 0:t.mode,R.visualState.query]),N=f.useCallback(()=>{(t==null?void 0:t.mode)===b.PREPACLIENT&&In(C,R),jn(R),o.onNavigateListArticles()},[R.data.resetPreviousData,t==null?void 0:t.mode,C.visualState.query]);if(t===null)throw new Error("operation de preparation non trouvée!"+n);const p=t.modalFor;return e.jsx(Xt,{className:"preparationFidege",children:e.jsxs(vs,{onSetOrderPrio:o.onSetOrderPrio,enableCommandePio:!!(t&&E&&d&&(t==null?void 0:t.step)===O.HOME),context:m,zoneTravail:t.zoneTravailPersonnelCode,children:[e.jsx(ja,{operationId:n}),e.jsxs(ve,{dialogProps:{transitionDuration:0,disableRestoreFocus:!0,fullWidth:!0,fullScreen:L.includes([],p)},withAppBar:p!=="LOADING",isOpen:!!p,onCloseDialog:()=>o.onCloseModal(),i8ntitle:p==="SEARCHORDER"?r("order"):null,className:"",children:[p==="MANQUANT"&&e.jsx(fs,{VEN_LOT_SEQ:t.manquantLotSeq,VEN_NUMSEQ:t.manquantNumSeq,onClose:o.onCloseFenetreManquantDetail,context:m}),p==="LOADING"&&e.jsx(ot,{message:"loading"}),p==="SEARCHORDER"&&e.jsx(gs,{context:m,onFoundOrder:o.onSelectOrder,onNotFoundOrder:o.onNotFoundOrder,onCancel:o.onCloseModal})]}),t.step===O.HOME&&e.jsx(Da,{zoneTravailValid:E,className:"accueil",disableSwitchPersonnel:u("V2_LOCKPERS"),mode:t.mode,codePersonnel:s,nomPersonnel:a,modalOpen:!!p,zoneTravailPersonnelCode:t.zoneTravailPersonnelCode,zoneTravailPersonnelLibelle:t.zoneTravailPersonnelLibelle,onNavigateListCommande:A,onNavigateListArticles:N,onChangeZoneTravail:o.onChangeZoneTravail,onChangePersonnel:o.onChangePersonnel,onSelectOrder:o.onSelectOrderCommandes,onNotFoundOrder:o.onNotFoundOrder,onShowError:o.onShowError,onOpenModalSearchOrder:o.onOpenModalSearchOrder,onChangeMode:o.onChangeMode,dataCommandes:t.mode===b.PREPAARTICLE?R:C,contextGlobal:m,gereZoneTravail:l,disableFilter:!!t.orderPrio||i,orderPrio:t.orderPrio,onOpenCommandePrioritaire:o.onOpenCommandePrioritaire}),t.mode===b.PREPACLIENT&&t.showListCommandes&&e.jsx(Ms,{disableScan:t.prepaOpen,state:C,onSelect:h}),t.mode===b.PREPAARTICLE&&t.step===O.LISTPREPARATIONS&&e.jsx(As,{state:R,onSelect:g=>{const T=it(R.visualState.query,R.Recherches);o.onSelectArticlePreparation(g,T)}}),t.mode===b.PREPAARTICLE&&t.showListCommandes&&e.jsx(Ps,{enabled:t.step===O.CLIENTS,operationId:n,onSelectNumSeq:g=>o.selectPreparation({VEN_NUMSEQ:g,VEN_LOT_SEQ:null,InfoCodeBarre:null}),onSelect:g=>o.selectPreparation({VEN_NUMSEQ:g.VEN_NUMSEQ,VEN_LOT_SEQ:g.VEN_LOT_SEQ,InfoCodeBarre:null}),onClose:()=>o.onStepBack(),codeArticle:t.codeArticle,zoneTravail:t.zoneTravailPersonnelCode,onOpenFenetreManquantDetail:o.onOpenFenetreManquantDetail}),e.jsx(xs,{context:m,operationId:n,onClose:o.unSelectPreparation})]})})}function Ds({session:n,borneId:r}){const s=n.sessionId,{operationId:a,preparationClose:o}=xa(s,r,b.PREPACLIENT);return a?e.jsx(De,{fallbackRender:t=>e.jsx(ye,{errorOrigin:"CurrentPreparation",...t,resetMessage:Y("close")}),onReset:()=>o(),children:e.jsx(ur,{operationId:a})}):null}function ys(){const{operationId:n}=Jn();return e.jsx(ur,{operationId:n})}function Vs(){const{session:n,onLaunchOption:r}=dt(),{borneId:s}=Jn();return e.jsxs(ut,{children:[e.jsx(An,{index:!0,element:e.jsx(Ds,{session:n,borneId:s})}),e.jsx(An,{path:":operationId",element:e.jsx(ys,{})})]})}const Fs=n=>r=>{const s=ct();return e.jsx(De,{fallbackRender:a=>e.jsx(e.Fragment,{children:e.jsx(ye,{errorOrigin:"PreparationFicheOperationRouter",...a,resetMessage:"back"})}),onReset:()=>{s("/")},children:e.jsx(n,{...r})})},$s=Fs(Vs);export{$s as default};
